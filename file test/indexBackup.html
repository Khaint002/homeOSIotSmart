<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Scanner</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script> -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            align-items: center;
            height: 100vh;
            background-color: #1c1c1e;
            margin: 0 auto;
            padding: 0;
            max-width: 600px;
        }

        .hidden {
            display: none;
        }

        #toast-container {
            font-size: 14px;
            color: #1d9b21;
        }

        .container-homePage {
            text-align: center;
            /* background: #1E2833; */
            padding: 0 20px 0 20px;
            /* border-radius: 10px; */
            box-shadow: 0px 4px 20px rgba(0, 0, 0, 0.1);
            max-width: 450px;
            width: 100%;
            position: relative;
        }

        .container {
            height: 100vh;
            text-align: center;
            background: #1E2833;
            padding: 0 20px 0 20px;
            /* border-radius: 10px; */
            box-shadow: 0px 4px 20px rgba(0, 0, 0, 0.1);
            max-width: 450px;
            width: 100%;
            position: relative;
        }

        .ScanQR-header {
            text-align: center;
            padding: 0 10px 0 20px;
            /* border-radius: 10px; */
            /* box-shadow: 0px 4px 20px rgba(0, 0, 0, 0.1); */
            max-width: 400px;
            width: 100%;
            background-color: #1E2833;
            height: 50px;
        }

        .container img {
            margin-top: 20px;
        }

        h1 {
            font-size: 24px;
            margin-bottom: 20px;
            color: #333;
        }

        /* video {
            max-height: 60vh;
            width: 100%;
            border-radius: 10px;
            border: 2px solid #626262;
            margin-top: 10px;
            margin-bottom: 10px;
        } */

        #result {
            margin-top: 20px;
            font-size: 1.2em;
            color: #4caf50;
        }

        #homePage .header {
            height: 50px;
            background-color: #22abe3;
        }

        .app-bar {
            background-color: #0c0e13;
            color: white;
            padding: 10px;
            text-align: center;
            display: flex;
            justify-content: space-between;
            height: 55px;
        }

        #status {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: red;
        }

        #thongKe {
            padding: 0;
            margin: 0;
            width: 35px;
            height: 35px;
            border-radius: 12px;
            background-color: #282b32;
            border: none;
        }

        #Upload {
            margin: 0;
            padding: 0;
            width: 35px;
            height: 35px;
            border-radius: 12px;
            background-color: #282b32;
            border: none;
        }

        .ScanQRNext {
            margin: 0;
            padding: 0;
            width: 35px;
            height: 35px;
            border-radius: 12px;
            background-color: #282b32;
            border: none;
        }

        #lateTime {
            width: 200px;
            height: 35px;
            border: solid 1px #282b32;
            border-radius: 515px;
            padding-top: 5px;
            background-color: #282b32;
        }

        #boxValue {
            width: 100%;
            height: 150px;
            background-color: #242427;
            border: solid 1px #484848;
            box-shadow: 2px 2px #0c0c0c;
            color: white;
            border-radius: 10px;
            text-align: center;
            padding-top: 15px;
        }

        #listValue {
            --bs-gutter-x: 0;
            margin: 0 15px 0 15px;
        }

        #acQuy {
            margin: 15px;
        }

        .progress-vertical {
            width: 30px;
            height: 300px;
            display: flex;
            flex-direction: column-reverse;
            margin: 20px;
        }

        .progress-vertical .progress-bar {
            writing-mode: vertical-lr;
            transform: rotate(180deg);
            text-align: center;
        }

        .drop {
            position: relative;
            width: 120px;
            height: 180px;
            background: linear-gradient(to bottom, #67d1fb, #0077b6);
            border-radius: 50% 50% 50% 50%;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            margin: 50px auto;
        }

        .drop .shine {
            position: absolute;
            width: 50px;
            height: 90px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            top: 30px;
            left: 35px;
            transform: rotate(-30deg);
        }

        /* Thông tin lượng mưa bên trong giọt nước */
        #rainfall {
            margin: 0 20px 0 20px;
            background-color: #242427;
            border: solid 1px #484848;
            box-shadow: 2px 2px #0c0c0c;
            border-radius: 10px;
        }

        .rain-info {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
        }

        #Chart {
            margin: 0 20px 0 20px;
        }

        .button-list {
            border: solid 1px rgb(0, 0, 0);
            border-radius: 100px;
            width: 80%;
            padding: 0;
            display: flex;
            justify-content: space-between;
            background-color: #313030;
            float: right;
            margin: 10px;
            margin-right: 0;
        }

        .btn-chart {
            width: 25%;
            height: 30px;
            border: none;
            margin: 0;
            padding: 0;
            border-radius: 50px;
            background-color: #313030;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .btn-chart:hover {
            background-color: #000000;
        }

        .btn-chart.active {
            background-color: #181818 !important;
            color: #fff;
        }

        #switch-btn {
            position: absolute;
            top: 180px;
            right: 30px;
            background-color: rgba(0, 0, 0, 0.5);
            border: none;
            color: white;
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 1000;
        }

        #switch-btn i {
            font-size: 1.5em;
        }

        #switch-btn:hover {
            background-color: rgba(0, 0, 0, 0.7);
        }

        .iconApp {
            box-shadow: 0 0 1px rgba(0, 0, 0, .125), 0 1px 3px rgba(0, 0, 0, .2);
            border-radius: .25rem;
            background-color: #2E3A46;
            /* background-color: #24282c; */
            display: -ms-flexbox;
            display: flex;
            /* margin-bottom: 0.5rem; */
            min-height: 80px;
            padding: .5rem;
            position: relative;
            width: 100%;
            cursor: pointer;
        }

        .close-icon {
            position: absolute;
            top: -8px;
            right: -5px;
            /* Đặt bên tay phải */
            border: 1px solid #fff;
            /* Đường viền trắng */
            background-color: #202830;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            /* Hình tròn */
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
            /* Hiệu ứng đổ bóng */
            cursor: pointer;
            color: #fff;
            z-index: 10;
            /* Đảm bảo nút nằm trên cùng */
        }

        .pickApp-title h4 {
            display: flex;
            justify-content: flex-start;
            color: #fff;
            margin-bottom: 1rem;
        }

        .icon {
            border-radius: .25rem;
            -ms-flex-align: center;
            align-items: center;
            display: -ms-flexbox;
            display: flex;
            font-size: 1.875rem;
            -ms-flex-pack: center;
            justify-content: center;
            text-align: center;
            width: 70px;
        }

        .info-box-content {
            display: -ms-flexbox;
            display: flex;
            -ms-flex-direction: column;
            flex-direction: column;
            -ms-flex-pack: center;
            justify-content: center;
            line-height: 1.8;
            -ms-flex: 1;
            flex: 1;
            padding: 0 10px;
            overflow: hidden;
            text-align: start;
        }

        .app-text {
            display: block;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            color: #c2c7d0;
            padding: 0 10px;
        }

        .app-text-number {
            color: white;
            display: block;
            margin-top: .25rem;
            font-weight: 500;
            padding: 0 10px;
        }

        /* tab chức năng */
        .tab {
            cursor: pointer;
            border-bottom: 1px solid #535353;
        }

        .tab button {
            flex: 1;
            background-color: #1E2833;
            color: #c2c7d0;
            border: none;
            text-align: center;
            border-radius: 5px 5px 0 0;
            height: 40px;
            width: 49%;
        }

        .tab button:hover {
            /* border: 1px solid #626262; */
            border-bottom: none;
        }

        .tab button.active {
            background-color: #222;
            color: #fff;
            border: 1px solid #626262;
            border-bottom: none;
        }

        .tab-content {
            display: none;
            border-top: none;
        }

        .tab-content-guarantee {
            display: none;
            border-top: none;
        }

        .tab-content.active {
            display: block;
        }

        .tab-content-guarantee.active {
            display: block;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1060;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: rgba(0, 0, 0, 0.9);
            /* background-color: white; */
            padding: 0;
            margin: 0;
        }

        /* Phần tử quét QR full màn hình */
        #qr-reader {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }


        #qr-reader video {
            width: auto !important;
            height: 100vh !important;
            width: 100vh !important;
        }

        #qr-shaded-region {
            padding-bottom: 100px;
        }

        #close-scanner {
            position: absolute;
            top: 2%;
            left: 20px;
            height: 35px;
            width: 35px;
            background-color: rgba(0, 0, 0, 0.4);
            border: none;
            color: white;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            z-index: 1001;
            /* Đảm bảo nút ở trên cùng */

            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
        }

        /* Nút chuyển đổi camera */
        #toggle-camera {
            position: absolute;
            top: 2%;
            left: 88%;
            height: 35px;
            width: 35px;
            background-color: rgba(0, 0, 0, 0.4);
            border: none;
            color: white;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            z-index: 1001;
            /* Đảm bảo nút ở trên cùng */

            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
        }

        /* Nút upload hình ảnh */
        #upload-qr {
            position: absolute;
            top: 68%;
            left: 20%;
            color: white;
            border: none;
            cursor: pointer;
            z-index: 1001;
            /* Đảm bảo nút ở trên cùng */
            text-align: center;
        }

        #upload-qr button {
            width: 35px;
            height: 35px;
            border: none;
            background-color: rgba(0, 0, 0, 0.4);
            border-radius: 50%;
            color: white;

            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
        }

        #upload-qr p {
            color: white;
            font-size: 12px;
            margin: 5px 0;
            box-shadow: 0px 4px 20px rgba(0, 0, 0, 0.1);
        }

        /* Input file ẩn */
        #file-input {
            display: none;
        }

        /* form result scan qr */
        #result-form {
            width: 95vh;
            height: 200px;
            position: absolute;
            top: 50%;
            padding: 20px;
            z-index: 1005;
            /* left: 10%; */
        }

        #result-form #result-form-group {
            background-color: #1E2833;
            border-radius: 5px;
            width: 350px;
            padding: 20px;
        }

        .form-total {
            box-shadow: 0 0 1px rgba(0, 0, 0, .125), 0 1px 3px rgba(0, 0, 0, .2);
            margin-bottom: 1rem;
        }

        .header-form {
            background-color: rgb(63, 103, 145, 0.8);
            box-shadow: 0 0 1px rgba(0, 0, 0, .125), 0 1px 3px rgba(0, 0, 0, .2);
            border-radius: 4px 4px 0 0;
            height: 46px;
            padding: 12px 20px;
        }

        .header-form h3 {
            font-size: 1.1rem;
            font-weight: 400;
            color: white;
        }

        .content-form {
            padding: 1.5rem;
            color: white;
            background-color: rgba(0, 0, 0, 0.8);
            border-radius: 0 0 4px 4px;
        }

        .content-form-help {
            border-radius: 0 0 4px 4px;
        }

        .content-form .content-detail {
            text-align: start;
            margin-bottom: 1rem;
        }

        .content-form .content-detail .content-label {
            font-weight: 500;
        }

        .content-form .content-detail .content-input {
            background-color: #343a40;
            border-color: #6c757d;
            color: #fff;
        }

        .content-form .content-detail .content-input::placeholder {
            color: #6c757d;
        }

        .footer-form {
            padding: .75rem 1.25rem;
            background-color: #282d31;
            border-top: 0 solid rgba(0, 0, 0, .125);
            border-radius: 0 0 4px 4px;
        }

        .footer-form button {
            color: #fff;
            background-color: #335476;
            border-color: #304e6d;
        }

        .full-screen-img {
            width: 100vw;
            height: 100vh;
            object-fit: cover;
            position: fixed;
        }

        #LoadScreen {
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            /* Xếp logo và chấm động theo chiều dọc */
        }

        #LogoLoadScreen {
            width: 200px;
        }

        .dots-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 1rem;
        }

        .dot {
            width: 10px;
            height: 10px;
            margin: 0 5px;
            background-color: #fff;
            border-radius: 50%;
            opacity: 0;
            animation: blink 1.5s infinite ease-in-out;
        }

        /* Animation delay for each dot */
        .dot:nth-child(1) {
            animation-delay: 0s;
        }

        .dot:nth-child(2) {
            animation-delay: 0.3s;
        }

        .dot:nth-child(3) {
            animation-delay: 0.6s;
        }

        @keyframes blink {

            0%,
            100% {
                opacity: 0;
            }

            50% {
                opacity: 1;
            }
        }

        .footer-instruct {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            text-align: center;
            padding: 10px 0;
            z-index: 1000;
            color: #fff;
            height: 100px;
        }

        .step {
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            width: 100%;
            margin-bottom: 10px;
        }

        .step::before,
        .step::after {
            content: '';
            height: 2px;
            background-color: #ffffff;
            position: absolute;
            top: 50%;
            width: 45%;
        }

        .step::before {
            left: 0;
        }

        .step::after {
            right: 0;
        }

        .circle {
            background-color: #ffffff;
            color: #2a2f38;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            position: relative;
            z-index: 1;
        }

        .clickScanQR {
            width: 220px;
            height: 220px;
            margin-top: 8vh;
            border: none;
            border-radius: 10px;
            box-shadow: 0 0 1px rgba(0, 0, 0, .125), 0 1px 3px rgba(0, 0, 0, .2);
        }

        #temperature svg {

            width: 50px;
            height: 110px;

        }

        .dragger .label {
            fill: #FFFCF9;
            font-size: 1.8em;
            font-family: "din-condensed-web", sans-serif;
            text-anchor: middle;
            letter-spacing: 1.2px;
            font-size: 25px;
        }

        .tubeLabel {
            fill: #FCEFD6;
            font-size: 1.4em;
            font-family: "din-condensed-web", sans-serif;
            /* font-family: "filson-soft", sans-serif; */
            text-anchor: middle;
        }

        .dragger {
            -webkit-tap-highlight-color: transparent;
        }

        .range-container {
            position: relative;
            width: 30px;
            height: 220px;
            border-radius: 10px;
        }

        /* Solid color sections for each temperature range */
        .range-section {
            position: absolute;
            left: 0;
            width: 100%;
        }

        .section-0-5 {
            background-color: #006600;
            top: 14%;
            height: 14%;
        }

        /* Blue for 0-15°C */
        .section-5-10 {
            background-color: #66cc00;
            top: 28%;
            height: 14%;
        }

        /* Blue for 0-15°C */
        .section-10-20 {
            background-color: #b2ff66;
            top: 42%;
            height: 14%;
        }

        /* Blue for 0-15°C */
        .section-20-50 {
            background-color: #0084ff;
            top: 56%;
            height: 14%;
        }

        /* Blue for 0-15°C */
        .section-50-100 {
            background-color: #7fc1ff;
            top: 70%;
            height: 14%;
        }

        /* Light blue for 15-20°C */
        .section-100-150 {
            background-color: #bfe0ff;
            top: 84%;
            height: 14%;
        }

        /* Green for 20-27°C */
        .section-150-200 {
            background-color: #00ffff;
            top: 0;
            height: 14%;
        }

        /* Red for 27-50°C */

        /* Temperature Labels */
        .label {
            position: absolute;
            left: 90%;
            padding-left: 10px;
            font-size: 12px;
            color: #fff;
        }

        .label-200 {
            top: -6px;
        }

        .label-150 {
            top: 10%;
        }

        .label-100 {
            top: 24%;
        }

        .label-50 {
            top: 37%;
        }

        .label-20 {
            top: 50%;
        }

        .label-10 {
            top: 65%;
        }

        .label-5 {
            top: 80%;
        }

        .label-below-0 {
            bottom: 0;
        }

        #qr-shaded-region {
            border-width: 35vh 10vh !important;
        }

        /* history */
        .history-header {
            text-align: center;
            padding: 0 10px 0 20px;
            max-width: 500px;
            width: 100%;
            background-color: #1E2833;
            height: 50px;
            display: flex;
            justify-content: space-between;
        }

        .history-avt {
            line-height: 50px;
        }

        .history-avt img {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin-top: 10px;
        }

        .history-avt p {
            margin-left: 10px;
            color: white;
        }

        .box-value {
            box-shadow: 0 0 1px rgba(0, 0, 0, .125), 0 1px 3px rgba(0, 0, 0, .2);
            margin-bottom: 1rem;
            padding: 1rem;
            color: white;
            background: rgba(0, 0, 0, 0.6);
            margin: 7.5px;
            border-radius: 4px;
        }

        .header-form {
            background-color: #3f6791;
            box-shadow: 0 0 1px rgba(0, 0, 0, .125), 0 1px 3px rgba(0, 0, 0, .2);
            border-radius: 4px 4px 0 0;
            height: 46px;
            padding: 12px 20px;
        }

        .header-form h3 {
            font-size: 1.1rem;
            font-weight: 400;
            color: white;
        }

        .form-select {
            display: block;
            width: 100%;
            height: 30px;
            padding: .375rem .75rem;
            font-size: 1rem;
            font-weight: 400;
            line-height: 1.5;
            color: #495057;
            background-color: #fff;
            background-clip: padding-box;
            border: 1px solid #ced4da;
            border-radius: .25rem;
            box-shadow: inset 0 0 0 transparent;
            transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out;
        }

        .navbar {
            display: flex;
            align-items: center;
            padding: 10px;
            background-color: #333;
            color: white;
        }

        .menu-button {
            font-size: 24px;
            color: white;
            background: none;
            border: none;
            cursor: pointer;
            margin-right: 10px;
        }

        /* menu */

        .sidebar {
            position: fixed;
            top: 0;
            right: -250px;
            /* Hidden by default */
            width: 250px;
            height: 100%;
            background-color: #2c3e50;
            color: white;
            overflow: auto;
            transition: left 0.3s;
            z-index: 100;
        }

        .sidebar.open {
            right: 0;
        }

        .profile {
            text-align: center;
            padding: 20px;
        }

        .profile-pic {
            width: 50px;
            height: 50px;
            border-radius: 50%;
        }

        .menu {
            list-style: none;
            padding: 0;
        }

        .menu-item {
            padding: 15px;
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .menu-item:hover {
            background-color: #34495e;
        }

        .submenu {
            list-style: none;
            padding: 0 20px;
            display: none;
        }

        .submenu li {
            padding: 10px;
            cursor: pointer;
        }

        .submenu li:hover {
            background-color: #3b4a58;
        }

        .content {
            padding: 20px;
            transition: margin-left 0.3s;
        }

        .arrow {
            font-size: 12px;
        }

        .small-box-footer {
            background-color: rgba(0, 0, 0, .1);
            color: rgba(255, 255, 255, .8);
            display: block;
            padding: 3px 0;
            position: relative;
            text-align: center;
            text-decoration: none;
            z-index: 10;
        }

        .parent-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .parent-item {
            margin-bottom: 10px;
        }

        .toggle-button {
            display: flex;
            align-items: center;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }

        .arrow-icon {
            margin-right: 8px;
            transition: transform 0.3s ease;
        }

        .child-list {
            list-style: none;
            padding-left: 20px;
            display: none;
            /* Ban đầu ẩn */
        }

        /* Item cha */
        #history-setting-detail .parent-item, #history-warranty-detail .parent-item {
            margin: 10px 0;
            background: #2A3A4A;
            border-radius: 8px;
            transition: background 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        #history-setting-detail .parent-item:last-child, #history-warranty-detail .parent-item:last-child {
            border-bottom: none;
            /* Loại bỏ viền dưới cho item cuối */
        }

        /* Nút mở rộng */
        #history-setting-detail .toggle-button, #history-warranty-detail .toggle-button {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            background: none;
            border: none;
            padding: 12px 16px;
            font-size: 16px;
            color: #eaeaea !important;
            text-align: left;
            cursor: pointer;
            transition: background 0.3s ease, color 0.3s ease;
        }

        #history-setting-detail .toggle-button:hover, #history-warranty-detail .toggle-button:hover {
            border-radius: 8px;
            color: #fff;
        }

        #history-setting-detail .toggle-button:focus, #history-warranty-detail .toggle-button:focus {
            outline: none;
        }

        /* Icon mũi tên */
        #history-setting-detail .arrow-icon, #history-warranty-detail .arrow-icon {
            font-size: 14px;
            margin-left: 8px;
            transition: transform 0.3s ease, color 0.3s ease;
            color: #eaeaea;
        }

        /* Khi mở rộng */
        #history-setting-detail .arrow-icon.expanded, #history-warranty-detail .arrow-icon.expanded {
            transform: rotate(90deg);
            color: #fff;
        }

        /* Danh sách con */
        #history-setting-detail .child-list, #history-warranty-detail .child-list {
            border-radius: 0 0 8px 8px;
            list-style: none;
            padding: 0;
            margin: 0;
            background: #1E2833;
            display: none;
            /* Ban đầu ẩn */
            padding: 5px 10px;
        }

        #history-setting-detail .child-list li, #history-warranty-detail .child-list li {
            font-size: 14px;
            background-color: #333b44;
            color: #555;
            border-radius: 8px;
            margin: 10px 0;
        }

        #history-setting-detail .child-list li:hover, #history-warranty-detail .child-list li:hover {
            cursor: pointer;
        }

        .background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            /* Giữ nền không bị cuộn */
            z-index: -2;
            /* Đẩy nền ra sau tất cả */
        }

        /* Lớp nền 1 - Landscape */
        #landscape {
            position: absolute;
            width: 100%;
            height: 100%;
            background: url(https://s3-us-west-2.amazonaws.com/s.cdpn.io/54046/rainy_landscape.jpeg) center center / cover no-repeat;
            filter: blur(10px);
            animation: eye-focus var(--duration) ease-in infinite alternate,
                focus-shift var(--duration) ease-in infinite alternate;
        }

        /* Lớp nền 2 - Glass */
        #glass {
            position: absolute;
            width: 100%;
            height: 100%;
            /* background: url(https://s3-us-west-2.amazonaws.com/s.cdpn.io/54046/glass_droplets.jpeg) center center / cover no-repeat; */
            background: url(https://i.pinimg.com/736x/9d/1e/b3/9d1eb31563d0694c0eccd2724b5410a9.jpg) center center / cover no-repeat;
            opacity: 0.5;
            /* animation: eye-focus var(--duration) ease-in var(--pause) infinite alternate,
                focus-shift var(--duration) ease-in var(--pause) infinite alternate; */
        }

        @keyframes eye-focus {
            0% {
                filter: blur(0);
            }

            100% {
                filter: blur(10px);
            }
        }

        @keyframes focus-shift {
            0% {
                transform: scale(1);
            }

            100% {
                transform: scale(1.01);
            }
        }
        .custom-option {
            color: #fff;
            background-color: #f39c12;
        }
        #qrcode canvas {
            border-radius: 15px; /* Bo góc cho canvas */
            border: 2px solid #000; /* Thêm viền nếu cần */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Đổ bóng */
        }

        .bottom-navigation {
            display: flex;
            justify-content: space-around;
            position: fixed;
            bottom: 5px;
            left: 0;
            right: 0;
            background-color: #282d31;
            border-radius: 50px;
            padding: 10px 0;
            box-shadow: 0 -1px 5px rgba(0, 0, 0, 0.1);
            width: 95%;
            margin: 2.5%;
        }

        .bottom-navigation button {
            background-color: transparent;
            border: none;
            color: #fff;
            font-size: 14px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .bottom-navigation button:focus {
            color: #1976d2;
        }

        .bottom-navigation button img {
            width: 24px;
            height: 24px;
            margin-bottom: 5px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .blinking {
            animation: blink 0.5s linear infinite;
        }
        .card {
            background-color: #343a40;
            color: #fff;
            box-shadow: 0 0 1px rgba(0, 0, 0, .125), 0 1px 3px rgba(0, 0, 0, .2);
            margin-bottom: 1rem;
        }

        .card-header {
            background-color: transparent;
            border-bottom: 1px solid rgba(0, 0, 0, .125);
            padding: .75rem 1.25rem;
            position: relative;
            border-top-left-radius: .25rem;
            border-top-right-radius: .25rem;
            height: 50px;
        }
        .card-header>.card-tools {
            float: right;
            margin-right: -.625rem;
        }

        .card-body {
            -ms-flex: 1 1 auto;
            flex: 1 1 auto;
            min-height: 1px;
            padding: 1.25rem;
        }

        .badge-info {
            color: #fff;
            background-color: #17a2b8;
            font-weight: 200;
        }

        .products-list {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .products-list .item {
            background-color: #343a40;
            color: #fff;
            border-bottom-color: #6c757d;
            border-radius: 0;
            border-bottom: 1px solid rgba(0, 0, 0, .125);
            padding: 10px 0;
        }

        .products-list .product-img {
            float: left;
        }
        .products-list .product-info {
            margin-left: 60px;
            text-align: start;
        }
        .products-list .product-info .span {
            float: right;
        }
        .products-list .product-info a {
            color: #3395ff;
            text-decoration: none;
        }
        .products-list .product-info a:not(.btn):hover {
            color: #3395ff;
        }
        .products-list .product-img img {
            height: 50px;
            width: 50px;
            margin-top: 0;
            object-fit: cover;
        }
        .products-list .product-description {
            color: #6c757d;
            display: block;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .card-title {
            float: left;
            font-size: 1.1rem;
            font-weight: 400;
            margin: 0;
        }

        .menuWarranty{
            color: #1976d2 !important;
        }

        .bottom-navigation button:focus, .tab button:focus {
            outline: none; /* Bỏ hiệu ứng khi focus */
        }

        .vertical-timeline {
            width: 100%;
            position: relative;
            padding: 1.5rem 0 1rem;
        }

        .vertical-timeline::before {
            content: '';
            position: absolute;
            top: 0;
            left: 80px;
            height: 100%;
            width: 4px;
            background: #888b8f;
            border-radius: .25rem;
        }

        .vertical-timeline-element {
            position: relative;
            margin: 0 0 1rem;
        }

        .vertical-timeline--animate .vertical-timeline-element-icon.bounce-in {
            visibility: visible;
            animation: cd-bounce-1 .8s;
        }
        .vertical-timeline-element-icon {
            position: absolute;
            top: 0;
            left: 73px;
        }

        .vertical-timeline-element-icon .badge-dot-xl {
            box-shadow: 0 0 0 5px #fff;
        }

        .badge-dot-xl {
            width: 18px;
            height: 18px;
            position: relative;
        }
        .badge:empty {
            display: none;
        }


        .badge-dot-xl::before {
            content: '';
            width: 10px;
            height: 10px;
            border-radius: .25rem;
            position: absolute;
            left: 50%;
            top: 50%;
            margin: -5px 0 0 -5px;
            background: #fff;
        }

        .vertical-timeline-element-content {
            position: relative;
            margin-left: 100px;
            font-size: .8rem;
            color: #fff;
            text-align: start;
        }

        .vertical-timeline-element-content .timeline-title {
            font-size: .8rem;
            text-transform: uppercase;
            margin: 0 0 .5rem;
            padding: 2px 0 0;
        }

        .vertical-timeline-element-content .vertical-timeline-element-date {
            display: block;
            position: absolute;
            left: -90px;
            top: -20px;
            padding-right: 10px;
            text-align: right;
            color: #adb5bd;
            font-size: .7619rem;
            white-space: nowrap;
        }
        .vertical-timeline-element-content .vertical-timeline-element-dateTime {
            display: block;
            position: absolute;
            left: -90px;
            top: 0;
            padding-right: 10px;
            text-align: right;
            color: #adb5bd;
            font-size: .7619rem;
            white-space: nowrap;
        }

        .vertical-timeline-element-content:after {
            content: "";
            display: table;
            clear: both;
        }
    </style>
</head>

<body>
    <div class="app h-100">
        <div id="LoadScreen">
            <img id="LogoLoadScreen" src="https://central.homeos.vn/images/Logo_HomeOS_White.png" alt="" width="200">
            <img id="img-station" class="hidden full-screen-img"
                src="https://central.homeos.vn/images/MiniAppLoadingScreen.png" alt="Full Screen">
            <div id="" class=" dots-container">
                <div class="dot">.</div>
                <div class="dot">.</div>
                <div class="dot">.</div>
            </div>
        </div>
        <div id="pickApp" class="hidden h-100">
            <div class="container">
                <div id="QUYEN" class="row">
                    <div class="col-12" style="padding: 10px;">
                        <div id="PickApp-button-login" class="iconApp" style="background-color: #1265b9;">
                            <div class="icon d-none" style="background-color: #b7761b; width: 60px; height: 60px;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" style="color: #fff;" fill="currentColor" class="bi bi-box-arrow-in-right" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M6 3.5a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-2a.5.5 0 0 0-1 0v2A1.5 1.5 0 0 0 6.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-8A1.5 1.5 0 0 0 5 3.5v2a.5.5 0 0 0 1 0z"/>
                                    <path fill-rule="evenodd" d="M11.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H1.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708z"/>
                                </svg>
                            </div>
                            <div class="info-box-content" style="justify-content: start;">
                                <div class="d-flex justify-content-between">
                                    <span class="app-text-number" style="font-size: 16px; padding: 0;">Liên kết tài khoản</span>
                                    <span class="app-text d-none" >v1.1.5</span>
                                </div>
                                <span class="app-text" style="padding: 0; color: #fff; font-size: 14px;">Liên kết tài khoản để có Trải nhiệm tốt nhất</span>
                            </div>
                        </div>
                    </div>
                </div>
                <img id="LogoPickScreen" src="https://central.homeos.vn/images/Logo_HomeOS_White.png" alt="" width="200" style="padding-bottom: 3rem;">
                <div style="text-align: start; color: white;">
                    <h5>Ứng dụng:</h5>
                </div>
                <div class="row">
                    <div class="col-12" style="padding: 5px 10px;">
                        <div id="PickApp-button-mua" class="iconApp">
                            <div class="icon" style="background-color: #17a2b8;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor" style="color: #fff;" class="bi bi-cloud-sun" viewBox="0 0 16 16">
                                    <path d="M7 8a3.5 3.5 0 0 1 3.5 3.555.5.5 0 0 0 .624.492A1.503 1.503 0 0 1 13 13.5a1.5 1.5 0 0 1-1.5 1.5H3a2 2 0 1 1 .1-3.998.5.5 0 0 0 .51-.375A3.5 3.5 0 0 1 7 8m4.473 3a4.5 4.5 0 0 0-8.72-.99A3 3 0 0 0 3 16h8.5a2.5 2.5 0 0 0 0-5z" />
                                    <path d="M10.5 1.5a.5.5 0 0 0-1 0v1a.5.5 0 0 0 1 0zm3.743 1.964a.5.5 0 1 0-.707-.707l-.708.707a.5.5 0 0 0 .708.708zm-7.779-.707a.5.5 0 0 0-.707.707l.707.708a.5.5 0 1 0 .708-.708zm1.734 3.374a2 2 0 1 1 3.296 2.198q.3.423.516.898a3 3 0 1 0-4.84-3.225q.529.017 1.028.129m4.484 4.074c.6.215 1.125.59 1.522 1.072a.5.5 0 0 0 .039-.742l-.707-.707a.5.5 0 0 0-.854.377M14.5 6.5a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1z" />
                                </svg>
                            </div>
                            <div class="info-box-content">
                                <div class="d-flex justify-content-between">
                                    <span class="app-text">Môi trường</span>
                                    <span class="app-text">v1.1.4</span>
                                </div>
                                <span class="app-text-number">Khí tượng thuỷ văn</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 d-none" style="padding: 5px 10px;">
                        <div id="PickApp-button-IOT" class="iconApp">
                            <div class="icon" style="background-color: #da4a58!important;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor"
                                    style="color: #fff;" class="bi bi-pc-display-horizontal" viewBox="0 0 16 16">
                                    <path
                                        d="M1.5 0A1.5 1.5 0 0 0 0 1.5v7A1.5 1.5 0 0 0 1.5 10H6v1H1a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-5v-1h4.5A1.5 1.5 0 0 0 16 8.5v-7A1.5 1.5 0 0 0 14.5 0zm0 1h13a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-7a.5.5 0 0 1 .5-.5M12 12.5a.5.5 0 1 1 1 0 .5.5 0 0 1-1 0m2 0a.5.5 0 1 1 1 0 .5.5 0 0 1-1 0M1.5 12h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1 0-1M1 14.25a.25.25 0 0 1 .25-.25h5.5a.25.25 0 1 1 0 .5h-5.5a.25.25 0 0 1-.25-.25" />
                                </svg>
                            </div>
                            <div class="info-box-content">
                                <div class="d-flex justify-content-between">
                                    <span class="app-text">Web OS</span>
                                    <span class="app-text">v4.56 Pro</span>
                                </div>
                                <span class="app-text-number">IIoT</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 d-none" style="padding: 5px 10px;">
                        <div class="iconApp">
                            <div class="icon" style="background-color: #28a745!important;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" style="color: white;"
                                    fill="currentColor" class="bi bi-lightbulb-fill" viewBox="0 0 16 16">
                                    <path
                                        d="M2 6a6 6 0 1 1 10.174 4.31c-.203.196-.359.4-.453.619l-.762 1.769A.5.5 0 0 1 10.5 13h-5a.5.5 0 0 1-.46-.302l-.761-1.77a2 2 0 0 0-.453-.618A5.98 5.98 0 0 1 2 6m3 8.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1l-.224.447a1 1 0 0 1-.894.553H6.618a1 1 0 0 1-.894-.553L5.5 15a.5.5 0 0 1-.5-.5" />
                                </svg>
                            </div>
                            <div class="info-box-content">
                                <div class="d-flex justify-content-between">
                                    <span class="app-text">Đèn</span>
                                    <span class="app-text">v6.10.24</span>
                                </div>
                                <span class="app-text-number">Chiếu sáng thông minh</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-12" style="padding: 5px 10px;">
                        <div id="PickApp-button-guarantee" class="iconApp">
                            <div class="icon" style="background-color: #e29038!important;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" style="color: #fff;" fill="currentColor" class="bi bi-tools" viewBox="0 0 16 16">
                                    <path d="M1 0 0 1l2.2 3.081a1 1 0 0 0 .815.419h.07a1 1 0 0 1 .708.293l2.675 2.675-2.617 2.654A3.003 3.003 0 0 0 0 13a3 3 0 1 0 5.878-.851l2.654-2.617.968.968-.305.914a1 1 0 0 0 .242 1.023l3.27 3.27a.997.997 0 0 0 1.414 0l1.586-1.586a.997.997 0 0 0 0-1.414l-3.27-3.27a1 1 0 0 0-1.023-.242L10.5 9.5l-.96-.96 2.68-2.643A3.005 3.005 0 0 0 16 3q0-.405-.102-.777l-2.14 2.141L12 4l-.364-1.757L13.777.102a3 3 0 0 0-3.675 3.68L7.462 6.46 4.793 3.793a1 1 0 0 1-.293-.707v-.071a1 1 0 0 0-.419-.814zm9.646 10.646a.5.5 0 0 1 .708 0l2.914 2.915a.5.5 0 0 1-.707.707l-2.915-2.914a.5.5 0 0 1 0-.708M3 11l.471.242.529.026.287.445.445.287.026.529L5 13l-.242.471-.026.529-.445.287-.287.445-.529.026L3 15l-.471-.242L2 14.732l-.287-.445L1.268 14l-.026-.529L1 13l.242-.471.026-.529.445-.287.287-.445.529-.026z"/>
                                </svg>
                            </div>
                            <div class="info-box-content">
                                <div class="d-flex justify-content-between">
                                    <span class="app-text">Bảo hành</span>
                                    <span class="app-text">v1.0.3</span>
                                </div>
                                <span class="app-text-number">Bảo hành sản phẩm</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="footer-instruct">
                    <div class="step">
                        <div class="circle">01</div>
                    </div>
                    <p>Chọn ứng dụng muốn xem</p>
                </div>
            </div>
        </div>
        <div id="history" class="hidden h-100">
            <div class="container" style="padding: 0;">
                <div class="history-header">
                    <div class="history-avt">
                        <div class="d-flex">
                            <img class="userAvt" src="https://static.vecteezy.com/system/resources/previews/009/292/244/non_2x/default-avatar-icon-of-social-media-user-vector.jpg" alt="">
                            <p class="userName">Khách</p>
                        </div>
                    </div>
                    <div id="category-back" class="d-none">
                        <button id="backCategory" style="height: 50px; border: none; background-color: #1E2833;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                                style="color: #fff; margin-right: 10px;" class="bi bi-arrow-left" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8" />
                            </svg>
                        </button>
                    </div>
                    <div>
                        <div style="line-height: 50px; float: left;">
                            <button id="PickApp-button-scanQR"
                                style="height: 40px; border: none; background-color: #1E2833;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" style="color: #fff"
                                    fill="currentColor" class="bi bi-plus" viewBox="0 0 16 16">
                                    <path
                                        d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4" />
                                </svg>
                            </button>
                        </div>
                        <div style="line-height: 50px; float: left;">
                            <button class="menuToggle" style="height: 40px; border: none; background-color: #1E2833;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" style="color: #fff;"
                                    fill="currentColor" class="bi bi-list" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd"
                                        d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5" />
                                </svg>
                            </button>
                        </div>
                    </div>
                    <aside id="sidebar" class="sidebar">
                        <div class="profile">
                            <img src="https://central.homeos.vn/images/Logo_HomeOS_White.png" alt="" width="200"
                                style="margin-bottom: 30px; margin-top: 20px;">
                        </div>
                        <ul class="menu">
                            <li>
                                <div class="d-flex menu-item" style="color: #fff; padding-left: 10px;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" style="color: #fff;" fill="currentColor" class="bi bi-house" viewBox="0 0 16 16">
                                        <path d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L2 8.207V13.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V8.207l.646.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293zM13 7.207V13.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V7.207l5-5z"/>
                                    </svg>
                                    <span class="Pre-pickApp" style="padding-left: 10px; padding-left: 10px;">Giải pháp
                                        thông minh</span>
                                </div>
                            </li>
                            <li >
                                <div class="d-flex menu-item" style="color: #fff; padding-left: 10px;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                                        style="color: #fff; padding-top: 5px;" class="bi bi-question-circle-fill"
                                        viewBox="0 0 16 16">
                                        <path
                                            d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M5.496 6.033h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286a.237.237 0 0 0 .241.247m2.325 6.443c.61 0 1.029-.394 1.029-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94 0 .533.425.927 1.01.927z" />
                                    </svg>
                                    <span style="padding-left: 10px; padding-left: 10px;">Thông tin công ty</span>
                                </div>
                            </li>
                            <li>
                                <div class="d-flex menu-item" style="color: #fff; padding-left: 10px;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                                        class="bi bi-gear" viewBox="0 0 16 16">
                                        <path
                                            d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492M5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0" />
                                        <path
                                            d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115z" />
                                    </svg>
                                    <span style="padding-left: 10px; padding-left: 10px;">Quản lý danh mục</span>
                                </div>
                            </li>
                            <li>
                                <div class="d-flex menu-item" style="color: #fff; padding-left: 10px;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25"
                                        style="color: #d2d6db;" fill="currentColor"
                                        class="bi bi-cloud-lightning-rain-fill" viewBox="0 0 16 16">
                                        <path
                                            d="M2.658 11.026a.5.5 0 0 1 .316.632l-.5 1.5a.5.5 0 1 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.316m9.5 0a.5.5 0 0 1 .316.632l-.5 1.5a.5.5 0 0 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.316m-7.5 1.5a.5.5 0 0 1 .316.632l-.5 1.5a.5.5 0 1 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.316m9.5 0a.5.5 0 0 1 .316.632l-.5 1.5a.5.5 0 0 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.316m-7.105-1.25A.5.5 0 0 1 7.5 11h1a.5.5 0 0 1 .474.658l-.28.842H9.5a.5.5 0 0 1 .39.812l-2 2.5a.5.5 0 0 1-.875-.433L7.36 14H6.5a.5.5 0 0 1-.447-.724zm6.352-7.249a5.001 5.001 0 0 0-9.499-1.004A3.5 3.5 0 1 0 3.5 10H13a3 3 0 0 0 .405-5.973" />
                                    </svg>
                                    <span style="padding-left: 10px; padding-left: 10px;">Truy cập Trạm</span>
                                </div>
                            </li>
                        </ul>
                    </aside>
                </div>
                <div id="history-homePage">
                    <div class="history-body" style="padding: 20px 10px 0 10px;">
                        <img src="https://central.homeos.vn/images/Logo_HomeOS_White.png" alt="" width="200"
                            style="margin-bottom: 30px; margin-top: 20px; display: none;">
                        <div class="d-flex" style="color: #fff; padding-left: 10px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor"
                                class="bi bi-pc-horizontal" viewBox="0 0 16 16">
                                <path
                                    d="M1 6a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1zm11.5 1a.5.5 0 1 1 0 1 .5.5 0 0 1 0-1m2 0a.5.5 0 1 1 0 1 .5.5 0 0 1 0-1M1 7.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5M1.25 9h5.5a.25.25 0 0 1 0 .5h-5.5a.25.25 0 0 1 0-.5" />
                            </svg>
                            <h5 style="padding-left: 10px; padding-left: 10px;">Quan trắc:</h5>
                        </div>
                        <div class="d-flex justify-content-between" style="width: 100%; padding-left: 10px;">
                            <p style="color: #fff; text-align: left;">Lịch sử truy cập:</p>
                            <div>
                                <select id="historySelect" class="form-select bg-dark text-white border-secondary"
                                    style="font-size: 14px;" aria-label="Default select example">
                                    <option selected>Hiển thị tất cả...</option>
                                </select>
                            </div>
                        </div>

                        <div id="history-detail" style="overflow-y: auto; height: 450px; padding: 10px 10px 0 10px;">
                            <div style="margin-top: 10px; display: flex; justify-content: center; align-items: center;">
                                <button id="addWorkStation" style="width: 200px; height: 200px; border-radius: 50%; border: 1px dashed #fff; background-color: #1E2833; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #fff; font-size: 14px; text-align: center;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" style="color: #fff; margin-bottom: 8px;" fill="currentColor" class="bi bi-plus" viewBox="0 0 16 16">
                                        <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"/>
                                    </svg>
                                    Thêm trạm quan trắc
                                </button>
                            </div>                 
                            <!-- <div style="padding-bottom: 13px; position: relative;" class="history-item"
                                data-code="  item.CodeWorkStation  ">
                                <div class="close-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor"
                                        class="bi bi-x" viewBox="0 0 16 16">
                                        <path
                                            d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z" />
                                    </svg>
                                </div> -->
                                <!-- <div class="iconApp"> 
                                    <div id="Appitem.CodeWorkStation" class="icon" style="background-color: #28a745 !important; display: block;"> 
                                        <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" style="color: #fff;" fill="currentColor" class="bi bi-cloud-drizzle" viewBox="0 0 16 16"> 
                                            <path d="M4.158 12.025a.5.5 0 0 1 .316.633l-.5 1.5a.5.5 0 0 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.317m6 0a.5.5 0 0 1 .316.633l-.5 1.5a.5.5 0 0 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.317m-3.5 1.5a.5.5 0 0 1 .316.633l-.5 1.5a.5.5 0 0 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.317m6 0a.5.5 0 0 1 .316.633l-.5 1.5a.5.5 0 1 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.317m.747-8.498a5.001 5.001 0 0 0-9.499-1.004A3.5 3.5 0 1 0 3.5 11H13a3 3 0 0 0 .405-5.973M8.5 2a4 4 0 0 1 3.976 3.555.5.5 0 0 0 .5.445H13a2 2 0 0 1 0 4H3.5a2.5 2.5 0 1 1 .605-4.926.5.5 0 0 0 .596-.329A4 4 0 0 1 8.5 2"/> 
                                        </svg> 
                                        <div style="width: 100%; background-color: #28a745 !important; height: 20px; border-radius: .25rem .25rem 0 0;">

                                        </div>
                                        <div style="font-size: 14px; color: white; padding: 5px 0;">
                                            20mm
                                        </div>
                                    </div> 
                                    <div class="info-box-content" style="padding-right: 0"> 
                                        <div class="d-flex justify-content-between"> 
                                            <span class="app-text">  item.CodeWorkStation  </span> 
                                            <span class="app-text" style="padding-right: 0">  item.date  </span> 
                                        </div> 
                                        <span class="app-text-number" style="padding-right: 0">  item.NameWorkStation  </span> 
                                    </div> 
                                </div> -->

                            <!-- </div> -->
                        </div>
                    </div>
                    <div id="footer-instruct" class="footer-instruct">
                        <div class="step" style="margin: 0;">
                            <div class="circle">02</div>
                        </div>
                        <div class="d-flex justify-content-center" style="align-items: center;">
                            <img src="http://devices.homeos.vn/assets/img/Logo-Home-OS-crop.png" style="width: 30px; height: 35px; margin: 0 5px 20px 0;" alt="">
                        <p>Thêm mới mã trạm hoặc chọn trạm đã lưu</p>
                        </div>
                    </div>
                </div>
                <div id="history-setting" class="history-body d-none" style="padding: 0 10px 0 10px; margin-top: 20px;">
                    <!-- <img src="https://central.homeos.vn/images/Logo_HomeOS_White.png" alt="" width="200" style="margin-bottom: 30px; margin-top: 20px;"> -->
                    <div id="list-category">
                        <div>
                            <div class="d-flex" style="color: #fff; padding-left: 10px;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                                    class="bi bi-gear" viewBox="0 0 16 16">
                                    <path
                                        d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492M5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0" />
                                    <path
                                        d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115z" />
                                </svg>
                                <h6 style="padding-left: 10px; padding-left: 10px;">Quản lý danh mục trạm:</h6>
                            </div>
                        </div>


                        <ul id="history-setting-detail"
                            style="overflow-y: auto; max-height: 500px; padding: 10px 10px 0 10px;">
                            <div class="col-12"
                                style="margin-top: 10px; display: flex; justify-content: center; align-items: center;">
                                <button id="addCategory"
                                    style="width: 200px; height: 200px; border-radius: 50%; border: 1px dashed #fff; background-color: #1E2833; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #fff; font-size: 14px; text-align: center;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"
                                        style="color: #fff; margin-bottom: 8px;" fill="currentColor" class="bi bi-plus"
                                        viewBox="0 0 16 16">
                                        <path
                                            d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4" />
                                    </svg>
                                    Tạo mới danh mục trạm.
                                </button>
                            </div>
                        </ul>
                        <div style="width: 100%;padding: 10px">
                            <button id="btnAddCategory" class="d-none btn btn-warning"
                                style="background-color: #f39c12;border: solid 1px #f39c12; width: 100%; height: 35px; color: #fff; padding: 3px 10px;">Thêm
                                mới</button>
                        </div>
                    </div>
                    <div id="save-category" class="d-none">
                        <div class="d-flex" style="color: #fff; padding-left: 10px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                                class="bi bi-gear" viewBox="0 0 16 16">
                                <path
                                    d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492M5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0" />
                                <path
                                    d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115z" />
                            </svg>
                            <h5 style="padding-left: 10px; padding-left: 10px;">Thêm mới danh mục trạm:</h5>
                        </div>
                        <div>
                            <div style="text-align: start; margin: 15px 0; padding: 0 10px;">
                                <span style="color: #fff;">Tên danh mục:</span>
                                <input id="name-category" maxlength="20" type="text"
                                    style="width: 100%; height: 30px; color: #fff; padding-left: 20px; margin-top: 10px; background-color: #343a40; border: none; border-bottom: 1px solid #626262;"
                                    placeholder="Nhập Tên danh mục...">
                            </div>
                            <div>
                                <div class="d-flex justify-content-between" style="width: 100%; padding: 0 10px;">
                                    <p style="color: #fff; text-align: left;">Chọn trạm:</p>
                                    <div>
                                        <input id="search-category" type="text"
                                            style="width: 100%; height: 30px; color: #fff; padding-left: 20px; background-color: #343a40; border: none; border-bottom: 1px solid #626262;"
                                            placeholder="Tìm kiếm trạm...">
                                    </div>
                                </div>
                                <div id="list-history-detail"
                                    style="overflow-y: auto; height: 300px; padding: 10px 10px 0 10px;">

                                </div>
                                <div class="d-flex justify-content-between" style="width: 100%; padding: 10px;">
                                    <p style="color: #fff; text-align: left;">Trạm đã Chọn:</p>
                                    <div>
                                        <button id="saveCategory" class="btn btn-warning"
                                            style="background-color: #f39c12;border: solid 1px #f39c12; width: 100%; height: 35px; color: #fff;">Lưu
                                            danh mục</button>
                                    </div>
                                </div>
                                <div id="list-history-add"
                                    style="overflow-y: auto; height: 200px; padding: 10px 10px 0 10px;">

                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="detail-category" class="d-none">
                        <div class="d-flex" style="color: #fff; padding-left: 10px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                                class="bi bi-gear" viewBox="0 0 16 16">
                                <path
                                    d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492M5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0" />
                                <path
                                    d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115z" />
                            </svg>
                            <h5 style="padding-left: 10px; padding-left: 10px;">Chi tiết danh mục trạm:</h5>
                        </div>
                        <div>
                            <div style="text-align: start; margin: 15px 0; padding: 0 10px;">
                                <span style="color: #fff;">Tên danh mục:</span>
                            </div>
                            <div>
                                <div class="d-flex justify-content-between" style="width: 100%; padding: 0 10px;">
                                    <p style="color: #fff; text-align: left;">Danh sách trạm:</p>
                                </div>
                                <div id="list-category-detail"
                                    style="overflow-y: auto; height: 300px; padding: 10px 10px 0 10px;">

                                </div>
                            </div>
                        </div>
                        <div style="width: 100%;padding: 10px 3px;">
                            <button id="btnRemoveCategory" class="d-none btn btn-warning"
                                style="background-color: #d72323;border: solid 1px #d72323; width: 100%; height: 35px; color: #fff; padding: 3px 10px;">Thêm
                                mới</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="ScanQR" class="hidden h-100">
            <div class="container" style="padding: 0;">
                <div class="ScanQR-header">
                    <div style="line-height: 50px; float: left;">
                        <button id="PickApp-button-pick" style="height: 40px; border: none; background-color: #1E2833;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                style="color: #fff; margin-right: 10px;" class="bi bi-arrow-left" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8" />
                            </svg>
                        </button>

                        <!-- <img style="padding: 0; margin: 0;"
                            src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAMAAABF0y+mAAAA21BMVEVHcEzR7/mGqsR6pcHd8PaqzuCDrcdHfKMVYJEBWYw1cZz+///39fOMsMhUhqkeZZQ4cZwoaZYNXY9+psFThaphjq+b0Onu8O9kj7E8dJ1Crd/2+vv96eGN0u81r+QznMuw3/Isa5jb7/U7r+MfqeFOueecu9AsrOJuxOtXh6pKteVvw+mBzO1ZvOd8y+xcveit4PTw8e0VpeAyruP4rJT3p5D5vKjxWSnycEv2noX7w7H1k3j5wbD0gmLxXTD0hWb3qJH0iWr2lXnyb0vwUh/yZj7zc1DyZDn0gWEEvxu3AAAASXRSTlMAHXaZJxhRw/7/3gEJP6X3y/H/XZB8LQ+b2M0FGF7x6z7nMtv/zXP6lbLWdFOpgb5RPf/pX3Uo/9ZiNYtOm/iwSXdd0P/lve/Hl/YjrQAAAZ1JREFUeAFskAMSxAAMAFPbtnn2/192rptBsDGMBEExHNaFICmaYVGCWyJeECVaphSV0og5w3VWZQ3T0ihaEYUpIylVsgUegDMNR2X10WgOdxmKtH6OJ9i0Kmt+T4MwQrpEDryYYhKth2mWF6n327nU3kY5ghC7eVWbH2zZdCN44CPjbessbzfvCK/JamKYI2TGHGx3YV6/azlBT97ref22QbtHwAqKA/9xLbJR3Xi0beUGHpjHf/4pCoMeWsfwXO36y49FnqU9fBfsL+eqRj52fMjzw+hF19sd4t0lLwLC3Id5tud5a4CPV5vEkMBADJzitrnWto2Jsf7/i2o3HJuyUm2+GvVX0/5unAcu5DPao0JtLMnMBqPmYk7qjur9q/J1PwgjxWvF+TxD/Bi1OD6ZvAtHkYT0QM6wSsJU1t4Cis5kbhCjzSEJL4jkT6aMQio9kAEiapWHutHslaeMEQ2H0iFW0quftQP7PpWOIj1HUaoRazA5xwZvy+MqwtjVrx8j8LE8KJ1VdBxg9ErjnV/fU52ciwH/V13y0ht6AueMOFH8ctIWAAAAAElFTkSuQmCC"
                            alt="">
                        <span style="color: rgba(255, 255, 255, .75);;">HOMEOS VIỆT NAM</span> -->
                    </div>
                </div>
                <div style="padding: 0 20px 0 20px;">
                    <img src="https://central.homeos.vn/images/Logo_HomeOS_White.png" alt="" width="200"
                        style="margin-bottom: 30px; margin-top: 20px;">
                    <div style="padding: 20px 20px 0 20px;">
                        <div class="tab">
                            <button id="tab-scan-qr" class="tablinks tablinkQR">Quét QR</button>
                            <button id="tab-text" class="tablinks tablinkQR">Nhập thủ công</button>
                        </div>
                    </div>
                    <div id="tab1" class="tab-content">
                        <button class="clickScanQR start">
                            <svg xmlns="http://www.w3.org/2000/svg" width="180" height="180" fill="currentColor"
                                style="color: #000000;" class="bi bi-qr-code-scan" viewBox="0 0 16 16">
                                <path
                                    d="M0 .5A.5.5 0 0 1 .5 0h3a.5.5 0 0 1 0 1H1v2.5a.5.5 0 0 1-1 0zm12 0a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0V1h-2.5a.5.5 0 0 1-.5-.5M.5 12a.5.5 0 0 1 .5.5V15h2.5a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5v-3a.5.5 0 0 1 .5-.5m15 0a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1 0-1H15v-2.5a.5.5 0 0 1 .5-.5M4 4h1v1H4z" />
                                <path d="M7 2H2v5h5zM3 3h3v3H3zm2 8H4v1h1z" />
                                <path d="M7 9H2v5h5zm-4 1h3v3H3zm8-6h1v1h-1z" />
                                <path
                                    d="M9 2h5v5H9zm1 1v3h3V3zM8 8v2h1v1H8v1h2v-2h1v2h1v-1h2v-1h-3V8zm2 2H9V9h1zm4 2h-1v1h-2v1h3zm-4 2v-1H8v1z" />
                                <path d="M12 9h2V8h-2z" />
                            </svg>
                        </button>
                    </div>
                    <div id="tab2" class="tab-content">
                        <div style="color: #fff; font-size: 1.5rem; padding: 50px 0 0 0;">Định danh thiết bị</div>
                        <div style="text-align: start; margin: 15px 0;">
                            <span style="color: #fff;">Mã trạm:</span>
                            <input id="device_name" type="text"
                                style="width: 100%; height: 50px; color: #fff; padding-left: 20px; margin-top: 10px; background-color: #343a40; border: none; border-bottom: 1px solid #626262;"
                                placeholder="Nhập mã trạm...">
                        </div>
                        <button id="truycap" class="btn btn-warning"
                            style="background-color: #f39c12;border: solid 1px #f39c12; width: 100%; color: #fff; margin-top: 20px;">Truy
                            cập trạm</button>
                    </div>
                </div>


                <div id="footer-instruct-text" class="footer-instruct">
                    <div class="step" style="margin: 0;">
                        <div class="circle">03</div>
                    </div>
                    <div class="d-flex justify-content-center" style="align-items: center;">
                        <img src="http://devices.homeos.vn/assets/img/Logo-Home-OS-crop.png" style="display: none; width: 30px; height: 30px; margin: 0 5px 20px 0;" alt="">
                        <p>Nhấn nút quét hoặc nhập thông tin</p>
                    </div>
                    
                </div>
            </div>
        </div>
        <div id="ScanQRWarranty" class="hidden h-100">
            <div class="container" style="padding: 0;">
                <div class="ScanQR-header d-flex justify-content-between">
                    <div class="history-avt">
                        <div class="d-flex">
                            <img class="userAvt" src="https://static.vecteezy.com/system/resources/previews/009/292/244/non_2x/default-avatar-icon-of-social-media-user-vector.jpg" alt="">
                            <p class="userName">Khách</p>
                        </div>
                    </div>
                    <div class="d-none" style="line-height: 50px; float: left;">
                        <button class="homepage-Pre-pickApp" style="height: 40px; border: none; background-color: #1E2833;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" style="color: #fff; margin-right: 10px;" class="bi bi-arrow-left" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8" />
                            </svg>
                        </button>
                    </div>
                    <div style="line-height: 50px; float: left;">
                        <button class="menuToggle" style="height: 40px; border: none; background-color: #1E2833;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" style="color: #fff;"
                                fill="currentColor" class="bi bi-list" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5" />
                            </svg>
                        </button>
                    </div>
                </div>
                <aside class="sidebar">
                    <div class="profile">
                        <img src="https://central.homeos.vn/images/Logo_HomeOS_White.png" alt="" width="200"
                            style="margin-bottom: 30px; margin-top: 20px;">
                    </div>
                    <ul class="menu">
                        <li>
                            <div class="d-flex menu-item" style="color: #fff; padding-left: 10px;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" style="color: #fff;" fill="currentColor" class="bi bi-house" viewBox="0 0 16 16">
                                    <path d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L2 8.207V13.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V8.207l.646.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293zM13 7.207V13.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V7.207l5-5z"/>
                                </svg>
                                <span class="Pre-pickApp" style="padding-left: 10px; padding-left: 10px;">Giải pháp
                                    thông minh</span>
                            </div>
                        </li>
                        <li>
                            <div class="d-flex menu-item" style="color: #fff; padding-left: 10px;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                                    style="color: #fff; padding-top: 5px;" class="bi bi-question-circle-fill"
                                    viewBox="0 0 16 16">
                                    <path
                                        d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M5.496 6.033h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286a.237.237 0 0 0 .241.247m2.325 6.443c.61 0 1.029-.394 1.029-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94 0 .533.425.927 1.01.927z" />
                                </svg>
                                <span style="padding-left: 10px; padding-left: 10px;">Thông tin công ty</span>
                            </div>
                        </li>
                        <li>
                            <div class="d-flex menu-item" style="color: #fff; padding-left: 10px;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-list-ul" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2"/>
                                </svg>
                                <span style="padding-left: 10px; padding-left: 10px;">Thông tin sản phẩm</span>
                            </div>
                        </li>
                        <li id="warranty_scansQRcode">
                            <div class="d-flex menu-item" style="color: #fff; padding-left: 10px;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor" class="bi bi-qr-code" viewBox="0 0 16 16">
                                    <path d="M2 2h2v2H2z"/>
                                    <path d="M6 0v6H0V0zM5 1H1v4h4zM4 12H2v2h2z"/>
                                    <path d="M6 10v6H0v-6zm-5 1v4h4v-4zm11-9h2v2h-2z"/>
                                    <path d="M10 0v6h6V0zm5 1v4h-4V1zM8 1V0h1v2H8v2H7V1zm0 5V4h1v2zM6 8V7h1V6h1v2h1V7h5v1h-4v1H7V8zm0 0v1H2V8H1v1H0V7h3v1zm10 1h-1V7h1zm-1 0h-1v2h2v-1h-1zm-4 0h2v1h-1v1h-1zm2 3v-1h-1v1h-1v1H9v1h3v-2zm0 0h3v1h-2v1h-1zm-4-1v1h1v-2H7v1z"/>
                                    <path d="M7 12h1v3h4v1H7zm9 2v2h-3v-1h2v-1z"/>
                                </svg>
                                <span style="padding-left: 10px; padding-left: 10px;">Quét lô sản phẩm</span>
                            </div>
                        </li>
                        <li id="warranty_lot">
                            <div class="d-flex menu-item" style="color: #fff; padding-left: 10px;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor" class="bi bi-box-seam" viewBox="0 0 16 16">
                                    <path d="M8.186 1.113a.5.5 0 0 0-.372 0L1.846 3.5l2.404.961L10.404 2zm3.564 1.426L5.596 5 8 5.961 14.154 3.5zm3.25 1.7-6.5 2.6v7.922l6.5-2.6V4.24zM7.5 14.762V6.838L1 4.239v7.923zM7.443.184a1.5 1.5 0 0 1 1.114 0l7.129 2.852A.5.5 0 0 1 16 3.5v8.662a1 1 0 0 1-.629.928l-7.185 2.874a.5.5 0 0 1-.372 0L.63 13.09a1 1 0 0 1-.63-.928V3.5a.5.5 0 0 1 .314-.464z"/>
                                  </svg>
                                <span style="padding-left: 10px; padding-left: 10px;">Quản lý và xuất lô hàng</span>
                            </div>
                        </li>
                    </ul>
                </aside>
                <div id="warrantyDetailProduct" style="padding: 0 20px 0 20px;">
                    <img src="https://central.homeos.vn/images/Logo_HomeOS_White.png" alt="" width="200" style="margin-bottom: 30px; margin-top: 20px;">
                    <div style="padding: 20px 20px 0 20px;">
                        <div class="tab">
                            <button id="tab-scan" class="tablinks tablinkGuarantee">Quét QR</button>
                            <button id="tab-history" class="tablinks tablinkGuarantee">Lịch sử quét</button>
                        </div>
                    </div>
                    <div id="tab3" class="tab-content-guarantee">
                        <button class="clickScanQR start">
                            <svg xmlns="http://www.w3.org/2000/svg" width="180" height="180" fill="currentColor" style="color: #000000;" class="bi bi-qr-code-scan" viewBox="0 0 16 16">
                                <path d="M0 .5A.5.5 0 0 1 .5 0h3a.5.5 0 0 1 0 1H1v2.5a.5.5 0 0 1-1 0zm12 0a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0V1h-2.5a.5.5 0 0 1-.5-.5M.5 12a.5.5 0 0 1 .5.5V15h2.5a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5v-3a.5.5 0 0 1 .5-.5m15 0a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1 0-1H15v-2.5a.5.5 0 0 1 .5-.5M4 4h1v1H4z" />
                                <path d="M7 2H2v5h5zM3 3h3v3H3zm2 8H4v1h1z" />
                                <path d="M7 9H2v5h5zm-4 1h3v3H3zm8-6h1v1h-1z" />
                                <path d="M9 2h5v5H9zm1 1v3h3V3zM8 8v2h1v1H8v1h2v-2h1v2h1v-1h2v-1h-3V8zm2 2H9V9h1zm4 2h-1v1h-2v1h3zm-4 2v-1H8v1z" />
                                <path d="M12 9h2V8h-2z" />
                            </svg>
                        </button>
                    </div>
                    <div id="tab4" class="tab-content-guarantee">
                        <div id="warrantyHistory" style="padding: 20px 0;">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">sản phẩm đã xem</h3>
                                    <div class="card-tools">
                                        <button type="button" class="btn btn-tool p-0" style="color: #fff;" data-card-widget="remove">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                                <!-- /.card-header -->
                                <div class="card-body p-0">
                                    <ul class="products-list product-list-in-card pl-2 pr-2">
                                        <li class="item">
                                            <div class="product-img">
                                                <img src="https://central.homeos.vn/images/ROLETP.jpg" alt="Product Image" class="img-size-50">
                                            </div>
                                            <div class="product-info">
                                                <a class="product-title">ROLE-TP-1.1
                                                    <span class="badge badge-info float-right">2024-12-12 09:20:08</span></a>
                                                <span class="product-description">
                                                    ROLE Thuận Phong.
                                                </span>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="ScanAllQRcode" class="d-none">
                    <img src="https://central.homeos.vn/images/Logo_HomeOS_White.png" alt="" width="200" style="margin-bottom: 30px; margin-top: 20px;">
                    <div class="content-form" style="background-color: #1E2833; padding: 0 20px;">
                        <div class="form-group content-detail">
                            <label class="form-label content-label" for="ap_ssid">Lô sản phẩm:</label>
                            <select name="" id="errorType" class="form-control content-input">
                                <option value="0">Chọn lô cần quét</option>
                            </select>
                        </div>
                    </div>
                    <button class="clickScanQR start" style="margin-top: 4vh;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="180" height="180" fill="currentColor" style="color: #000000;" class="bi bi-qr-code" viewBox="0 0 16 16">
                            <path d="M2 2h2v2H2z"/>
                            <path d="M6 0v6H0V0zM5 1H1v4h4zM4 12H2v2h2z"/>
                            <path d="M6 10v6H0v-6zm-5 1v4h4v-4zm11-9h2v2h-2z"/>
                            <path d="M10 0v6h6V0zm5 1v4h-4V1zM8 1V0h1v2H8v2H7V1zm0 5V4h1v2zM6 8V7h1V6h1v2h1V7h5v1h-4v1H7V8zm0 0v1H2V8H1v1H0V7h3v1zm10 1h-1V7h1zm-1 0h-1v2h2v-1h-1zm-4 0h2v1h-1v1h-1zm2 3v-1h-1v1h-1v1H9v1h3v-2zm0 0h3v1h-2v1h-1zm-4-1v1h1v-2H7v1z"/>
                            <path d="M7 12h1v3h4v1H7zm9 2v2h-3v-1h2v-1z"/>
                        </svg>
                    </button>
                </div>
                <div id="lotProduct" class="d-none">

                </div>
                <div id="footer-instruct-warranty" class="footer-instruct">
                    <div class="step">
                        <div class="circle">02</div>
                    </div>
                    <p>Nhấn nút để quét sản phẩm cần bảo hành</p>
                </div>
            </div>
        </div>
        <div id="homePage" class="hidden">
            <div class="background">
                <div id="landscape"></div>
                <div id="glass"></div>
            </div>
            <div class="container-homePage" style="padding: 0; width: 100%;">
                <div class="homePage-header history-header" style="background-color: #282d31;">
                    <div style="line-height: 50px; justify-content: flex-start;" class="d-flex">
                        <button class="ScanQRNext" style="height: 40px; border: none; background-color: #282d31;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                                style="color: #fff; margin-right: 10px;" class="bi bi-arrow-left" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8" />
                            </svg>
                        </button>
                        <p id="footer-stationName"
                            style="width: 250px; color: #fff; text-align: left; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">
                            -</p>
                    </div>
                    <div class="d-flex" style="line-height: 50px;">
                        <button id="share-qrcode-workstation" style="height: 40px; border: none; background-color: #282d31; padding: 0;margin-right: 10px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="20" style="color: #fff;" fill="currentColor" class="bi bi-qr-code" viewBox="0 0 16 16">
                                <path d="M2 2h2v2H2z"/>
                                <path d="M6 0v6H0V0zM5 1H1v4h4zM4 12H2v2h2z"/>
                                <path d="M6 10v6H0v-6zm-5 1v4h4v-4zm11-9h2v2h-2z"/>
                                <path d="M10 0v6h6V0zm5 1v4h-4V1zM8 1V0h1v2H8v2H7V1zm0 5V4h1v2zM6 8V7h1V6h1v2h1V7h5v1h-4v1H7V8zm0 0v1H2V8H1v1H0V7h3v1zm10 1h-1V7h1zm-1 0h-1v2h2v-1h-1zm-4 0h2v1h-1v1h-1zm2 3v-1h-1v1h-1v1H9v1h3v-2zm0 0h3v1h-2v1h-1zm-4-1v1h1v-2H7v1z"/>
                                <path d="M7 12h1v3h4v1H7zm9 2v2h-3v-1h2v-1z"/>
                              </svg>
                        </button>
                        <button class="homepage-Pre-pickApp" style="height: 40px; border: none; background-color: #282d31; padding: 0;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" style="color: #fff;" fill="currentColor" class="bi bi-house" viewBox="0 0 16 16">
                                <path d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L2 8.207V13.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V8.207l.646.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293zM13 7.207V13.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V7.207l5-5z"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div id="homePage-body">
                    <div id="box-status" class="row" style="margin: 15px; margin-bottom: 0;">
                        <div class=" col-5" style="padding-left: 0; padding-right: 0; padding-bottom: 15px;">
                            <div class="box-value" style="height: 100%; padding-left: 0; padding-right: 0; margin-right: 0; display: flex; align-items: center; justify-content: center;">
                                <div>
                                    <div class="d-flex">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" style="margin-right: 5px;" fill="currentColor" class="bi bi-battery-half" viewBox="0 0 16 16">
                                            <path d="M2 6h5v4H2z" />
                                            <path d="M2 4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2zm10 1a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1zm4 3a1.5 1.5 0 0 1-1.5 1.5v-3A1.5 1.5 0 0 1 16 8" />
                                        </svg>
                                        <p style="margin: 0; font-size: 14px;">Năng lượng</p>
                                    </div>
                                    <div>
                                        <p id="energy" style="font-size: 25px; margin: 0;">-</p>
                                    </div>
                                </div>

                            </div>
                        </div>
                        <div class="col-7" style="padding-left: 0; padding-right: 0;">
                            <div class="box-value" style="height: 80px;">
                                <div class="d-flex" style="line-height: 20px;">
                                    <div id="status"></div>
                                    <p style="margin: 0; font-size: 14px; margin-left: 10px;">Trạng thái</p>
                                </div>
                                <div>
                                    <p id="text-status" style="font-size: 16px; margin: 0;">mất kết nối</p>
                                </div>
                            </div>
                            <div class="box-value" style="height: 80px;">
                                <div class="d-flex" style="line-height: 20px;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-arrow-left-right" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd" d="M1 11.5a.5.5 0 0 0 .5.5h11.793l-3.147 3.146a.5.5 0 0 0 .708.708l4-4a.5.5 0 0 0 0-.708l-4-4a.5.5 0 0 0-.708.708L13.293 11H1.5a.5.5 0 0 0-.5.5m14-7a.5.5 0 0 1-.5.5H2.707l3.147 3.146a.5.5 0 1 1-.708.708l-4-4a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L2.707 4H14.5a.5.5 0 0 1 .5.5" />
                                    </svg>
                                    <p style="margin: 0; font-size: 14px; margin-left: 10px;">Cập nhật</p>
                                </div>
                                <div>
                                    <p id="lateDateTime" style="font-size: 16px; margin: 0;">-</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="listValue" class="row">
                        <div id="box-RT" class="d-none col-6 p-2">
                            <div class="box-value d-flex"
                                style="height: 116px; margin: 0; padding-left: 0; padding-top: 0;">
                                <div style="width: 60px;">
                                    <div id="temperature"
                                        style="pointer-events: none; margin-left: 5px; width: 50px; height: 100px;">
                                        <svg xmlns="http://www.w3.org/2000/svg"
                                            xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="250 200 200 200">
                                            <defs>
                                                <linearGradient id="liquidGrad" x1="557" y1="150" x2="557" y2="546"
                                                    gradientUnits="userSpaceOnUse">
                                                    <stop offset="0" stop-color="#FF0909" />
                                                    <stop offset="0.2" stop-color="#F3481A" />
                                                    <stop offset="0.5" stop-color="#FABA2C" />
                                                    <stop offset="1" stop-color="#00BCF2" />
                                                </linearGradient>
                                                <rect id="tube" x="357" y="150" width="60" height="400" rx="43"
                                                    ry="43" />
                                                <clipPath id="liquidMask">
                                                    <use xlink:href="#tube" class="liquidMask" />
                                                </clipPath>
                                                <clipPath id="tubeMask">
                                                    <use xlink:href="#tube" class="liquidMask" />
                                                </clipPath>
                                                <path id="liquid"
                                                    d="M757,552v490H357V552c50,0,50,20,100,20s50-20,100-20,50,20,100,20S707,552,757,552Z" />
                                                <mask id="gradMask">
                                                    <use xlink:href="#liquid" class="liquid" x="0" fill="#FCEFD6" />
                                                    <use xlink:href="#liquid" class="liquid" x="0" fill="#EEE"
                                                        opacity="0.7" />
                                                </mask>
                                            </defs>


                                            <g class="whole" transform="translate(0, -40)">

                                                <use xlink:href="#tube" class="tubeBg" fill="#C8D9D3" opacity="0.61" />

                                                <g class="dragger d-none" transform="translate(-6, 0)">
                                                    <circle cx="294" cy="540" r="36" fill="#FABA2C" />
                                                    <path class="dragTip"
                                                        d="M315.5,556.76,299.24,540.5l16.26-16.26,36.26,16.26Z"
                                                        fill="#FABA2C" />
                                                    <text class="label" x="294" y="551"
                                                        style="font-weight: 700;">100</text>
                                                    <!--  <path id="dragShine" d="M330,540c-26,2-18-44-72,0a36,36,0,0,1,72,0Z" fill="#E9E9E9" opacity="0.052"/>    -->
                                                </g>


                                                <g mask="url(#gradMask)">
                                                    <use xlink:href="#tube" fill="url(#liquidGrad)" />
                                                </g>
                                                <line class="tubeShine" x1="371" y1="200" x2="371" y2="443" fill="none"
                                                    stroke="#FFF" stroke-linecap="round" stroke-miterlimit="10"
                                                    stroke-width="8" opacity="0.21" stroke-dasharray="153 30"
                                                    stroke-dashoffset="-20" />
                                                <!--        <text class="tubeLabel" x="400" y="180">100°</text>
                                                  <text class="tubeLabel" x="400" y="356">50°</text>
                                                  <text class="tubeLabel" x="400" y="540">0°</text> -->
                                                <g class="measurements" fill="none" stroke="#FCEFD6" stroke-width="3"
                                                    stroke-linecap="round" opacity="1">
                                                    <line x1="358" y1="196" x2="370" y2="196" />
                                                    <line x1="358" y1="234" x2="370" y2="234" />
                                                    <line x1="358" y1="273" x2="370" y2="273" />
                                                    <line x1="358" y1="311" x2="370" y2="311" />
                                                    <line x1="358" y1="350" x2="370" y2="350" />
                                                    <line x1="358" y1="388" x2="370" y2="388" />
                                                    <line x1="358" y1="426" x2="370" y2="426" />
                                                    <line x1="358" y1="465" x2="370" y2="465" />
                                                    <line x1="358" y1="503" x2="370" y2="503" />
                                                </g>

                                                <!--  <rect class="tubeShine" x="372" y="162" width="56" height="364.02" rx="31.5" ry="31.5" fill="none" stroke="#fff" stroke-miterlimit="10" stroke-width="8" stroke-linecap="round" stroke-dasharray="15 30" opacity="0.31"/> -->
                                                <circle class="follower" cx="400" cy="540" r="0" fill="#62B6CB"
                                                    fill-opacity="1" stroke="#FCEFD6" stroke-width="0" />
                                            </g>
                                        </svg>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: center;">
                                    <div>
                                        <p>Nhiệt độ</p>
                                        <h5 id="RT">-</h5>
                                    </div>

                                </div>
                            </div>
                        </div>
                        <div id="box-RH" class="d-none col-6 p-2" style="padding-right: 0;">
                            <div class="box-value" style="height: 116px; margin: 0;">
                                <div class="d-flex justify-content-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" style="color: #00ffff;" fill="currentColor" class="bi bi-thermometer-snow" viewBox="0 0 16 16">
                                        <path d="M5 12.5a1.5 1.5 0 1 1-2-1.415V9.5a.5.5 0 0 1 1 0v1.585A1.5 1.5 0 0 1 5 12.5" />
                                        <path d="M1 2.5a2.5 2.5 0 0 1 5 0v7.55a3.5 3.5 0 1 1-5 0zM3.5 1A1.5 1.5 0 0 0 2 2.5v7.987l-.167.15a2.5 2.5 0 1 0 3.333 0L5 10.486V2.5A1.5 1.5 0 0 0 3.5 1m5 1a.5.5 0 0 1 .5.5v1.293l.646-.647a.5.5 0 0 1 .708.708L9 5.207v1.927l1.669-.963.495-1.85a.5.5 0 1 1 .966.26l-.237.882 1.12-.646a.5.5 0 0 1 .5.866l-1.12.646.884.237a.5.5 0 1 1-.26.966l-1.848-.495L9.5 8l1.669.963 1.849-.495a.5.5 0 1 1 .258.966l-.883.237 1.12.646a.5.5 0 0 1-.5.866l-1.12-.646.237.883a.5.5 0 1 1-.966.258L10.67 9.83 9 8.866v1.927l1.354 1.353a.5.5 0 0 1-.708.708L9 12.207V13.5a.5.5 0 0 1-1 0v-11a.5.5 0 0 1 .5-.5" />
                                    </svg>
                                    <p style="padding-left: 5px;">Độ ẩm</p>
                                </div>
                                <h5 id="RH">-</h5>
                            </div>
                        </div>
                        <div id="box-RP" class="d-none col-6 p-2">
                            <div class="box-value" style="height: 116px; margin: 0;">
                                <div class="d-flex justify-content-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                        style="color: #0084ff;" fill="currentColor" class="bi bi-speedometer2"
                                        viewBox="0 0 16 16">
                                        <path
                                            d="M8 4a.5.5 0 0 1 .5.5V6a.5.5 0 0 1-1 0V4.5A.5.5 0 0 1 8 4M3.732 5.732a.5.5 0 0 1 .707 0l.915.914a.5.5 0 1 1-.708.708l-.914-.915a.5.5 0 0 1 0-.707M2 10a.5.5 0 0 1 .5-.5h1.586a.5.5 0 0 1 0 1H2.5A.5.5 0 0 1 2 10m9.5 0a.5.5 0 0 1 .5-.5h1.5a.5.5 0 0 1 0 1H12a.5.5 0 0 1-.5-.5m.754-4.246a.39.39 0 0 0-.527-.02L7.547 9.31a.91.91 0 1 0 1.302 1.258l3.434-4.297a.39.39 0 0 0-.029-.518z" />
                                        <path fill-rule="evenodd"
                                            d="M0 10a8 8 0 1 1 15.547 2.661c-.442 1.253-1.845 1.602-2.932 1.25C11.309 13.488 9.475 13 8 13c-1.474 0-3.31.488-4.615.911-1.087.352-2.49.003-2.932-1.25A8 8 0 0 1 0 10m8-7a7 7 0 0 0-6.603 9.329c.203.575.923.876 1.68.63C4.397 12.533 6.358 12 8 12s3.604.532 4.923.96c.757.245 1.477-.056 1.68-.631A7 7 0 0 0 8 3" />
                                    </svg>
                                    <p style="padding-left: 5px;">Áp suất</p>
                                </div>
                                <h5 id="RP">-</h5>
                            </div>
                        </div>
                        <div id="box-RD" class="d-none col-6 p-2">
                            <div class="box-value" style="height: 116px; margin: 0;">
                                <div class="d-flex justify-content-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" style="color: #d2d6db;" fill="currentColor" class="bi bi-cloud-lightning-rain-fill" viewBox="0 0 16 16">
                                        <path d="M2.658 11.026a.5.5 0 0 1 .316.632l-.5 1.5a.5.5 0 1 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.316m9.5 0a.5.5 0 0 1 .316.632l-.5 1.5a.5.5 0 0 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.316m-7.5 1.5a.5.5 0 0 1 .316.632l-.5 1.5a.5.5 0 1 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.316m9.5 0a.5.5 0 0 1 .316.632l-.5 1.5a.5.5 0 0 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.316m-7.105-1.25A.5.5 0 0 1 7.5 11h1a.5.5 0 0 1 .474.658l-.28.842H9.5a.5.5 0 0 1 .39.812l-2 2.5a.5.5 0 0 1-.875-.433L7.36 14H6.5a.5.5 0 0 1-.447-.724zm6.352-7.249a5.001 5.001 0 0 0-9.499-1.004A3.5 3.5 0 1 0 3.5 10H13a3 3 0 0 0 .405-5.973" />
                                    </svg>
                                    <p style="padding-left: 5px;">Lượng mưa</p>
                                </div>
                                <div class="d-flex justify-content-center" style="align-items: center;">
                                    <h5 id="RD">0 mm</h5><p style="font-size: 12px; margin: 0; margin-left: 5px; padding-bottom: 5px;" id="lastTimeRain"></p>
                                </div>
                                <p>Trong ngày</p>
                            </div>
                        </div>
                        <div id="box-RN" class="d-none col-6 p-2">
                            <div class="box-value" style="height: 116px; margin: 0;">
                                <div class="d-flex justify-content-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                        class="bi bi-moisture" viewBox="0 0 16 16">
                                        <path
                                            d="M13.5 0a.5.5 0 0 0 0 1H15v2.75h-.5a.5.5 0 0 0 0 1h.5V7.5h-1.5a.5.5 0 0 0 0 1H15v2.75h-.5a.5.5 0 0 0 0 1h.5V15h-1.5a.5.5 0 0 0 0 1h2a.5.5 0 0 0 .5-.5V.5a.5.5 0 0 0-.5-.5zM7 1.5l.364-.343a.5.5 0 0 0-.728 0l-.002.002-.006.007-.022.023-.08.088a29 29 0 0 0-1.274 1.517c-.769.983-1.714 2.325-2.385 3.727C2.368 7.564 2 8.682 2 9.733 2 12.614 4.212 15 7 15s5-2.386 5-5.267c0-1.05-.368-2.169-.867-3.212-.671-1.402-1.616-2.744-2.385-3.727a29 29 0 0 0-1.354-1.605l-.022-.023-.006-.007-.002-.001zm0 0-.364-.343zm-.016.766L7 2.247l.016.019c.24.274.572.667.944 1.144.611.781 1.32 1.776 1.901 2.827H4.14c.58-1.051 1.29-2.046 1.9-2.827.373-.477.706-.87.945-1.144zM3 9.733c0-.755.244-1.612.638-2.496h6.724c.395.884.638 1.741.638 2.496C11 12.117 9.182 14 7 14s-4-1.883-4-4.267" />
                                    </svg>
                                    <p style="padding-left: 5px;">Mực nước</p>
                                </div>
                                <h5 id="RN">-</h5>
                            </div>
                        </div>
                    </div>
                    <div id="acQuy">
                        <!-- <div class="progress"
                            style="background-color: #242427; border: solid 1px #484848; height: 25px; border-radius: 15px; box-shadow: 2px 2px #0c0c0c;">
                            <div id="acQuy-bar" class="progress-bar" role="progressbar" style="width: 25%;" aria-valuenow="25"
                                aria-valuemin="0" aria-valuemax="100">-</div>
                        </div> -->
                    </div>
                    <div id="Chart">
                        <div class="d-flex justify-content-between">
                            <div class="d-none d-flex justify-content-center align-items-center"
                                style="height: 40px; padding-top: 10px; padding-left: 10px;">
                                <div id="loading-spinner" class="d-none spinner-border text-light" role="status">
                                </div>
                            </div>
                            <div class="button-list">
                                <button id="button-list-ngay" class="btn btn-primary btn-chart active"
                                    type="button">Ngày</button>
                                <button id="button-list-tuan" class="btn btn-primary btn-chart"
                                    type="button">Tuần</button>
                                <button id="button-list-thang" class="btn btn-primary btn-chart"
                                    type="button">Tháng</button>
                                <button id="button-list-nam" class="btn btn-primary btn-chart"
                                    type="button">Năm</button>
                            </div>
                        </div>
                        <div id="chart-RD" class="d-none form-total">
                            <div class="header-form d-flex">
                                <!-- <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" style="color: white; padding-top: 5px;" class="bi bi-gear-fill" viewBox="0 0 16 16">
                                    <path d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"/>
                                </svg> -->
                                <h3 style="margin: 0; padding-left: 2px;">Biểu đồ lượng mưa</h3>
                            </div>
                            <div class="content-form">
                                <canvas id="lineBarChart" width="400" height="200"></canvas>
                            </div>
                        </div>
                        <div id="chart-RT" class="d-none form-total">
                            <div class="header-form d-flex">
                                <!-- <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" style="color: white; padding-top: 5px;" class="bi bi-gear-fill" viewBox="0 0 16 16">
                                    <path d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"/>
                                </svg> -->
                                <h3 style="margin: 0; padding-left: 2px;">Biểu đồ nhiệt độ</h3>
                            </div>
                            <div class="content-form">
                                <canvas id="ChartRT" width="400" height="200"></canvas>
                            </div>
                        </div>
                        <div id="chart-RH" class="d-none form-total">
                            <div class="header-form d-flex">
                                <!-- <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" style="color: white; padding-top: 5px;" class="bi bi-gear-fill" viewBox="0 0 16 16">
                                    <path d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"/>
                                </svg> -->
                                <h3 style="margin: 0; padding-left: 2px;">Biểu đồ độ ẩm</h3>
                            </div>
                            <div class="content-form">
                                <canvas id="ChartRH" width="400" height="200"></canvas>
                            </div>
                        </div>
                        <div id="chart-RP" class="d-none form-total">
                            <div class="header-form d-flex">
                                <!-- <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" style="color: white; padding-top: 5px;" class="bi bi-gear-fill" viewBox="0 0 16 16">
                                    <path d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"/>
                                </svg> -->
                                <h3 style="margin: 0; padding-left: 2px;">Biểu đồ áp suất</h3>
                            </div>
                            <div class="content-form">
                                <canvas id="ChartRP" width="400" height="200"></canvas>
                            </div>
                        </div>
                        <div id="chart-RN" class="d-none form-total">
                            <div class="header-form d-flex">
                                <!-- <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" style="color: white; padding-top: 5px;" class="bi bi-gear-fill" viewBox="0 0 16 16">
                                    <path d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"/>
                                </svg> -->
                                <h3 style="margin: 0; padding-left: 2px;">Biểu đồ mực nước</h3>
                            </div>
                            <div class="content-form">
                                <canvas id="ChartRN" width="400" height="200"></canvas>
                            </div>
                        </div>
                        <div style="color: #313539;">-</div>
                    </div>
                </div>
            </div>
        </div>
        <div id="guarantee" class="hidden">
            <div class="container-homePage" style="padding: 0; width: 100%;">
                <div class="homePage-header history-header" style="background-color: #282d31;">
                    <div style="line-height: 50px; justify-content: flex-start;" class="d-flex">
                        <button class="WarrantyScanNext" style="height: 40px; border: none; background-color: #282d31;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                                style="color: #fff; margin-right: 10px;" class="bi bi-arrow-left" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8" />
                            </svg>
                        </button>
                        <p id="header-productName" style="width: 250px; color: #fff; text-align: left; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">-</p>
                    </div>
                    <div class="d-flex" style="line-height: 50px;">
                        <button id="errorWarranty" style="height: 40px; border: none; background-color: #282d31; padding: 0;margin-right: 10px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" style="color: #fff;" fill="currentColor" class="bi bi-exclamation-circle" viewBox="0 0 16 16">
                                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
                                <path d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0M7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0z"/>
                            </svg>
                        </button>
                        <button class="homepage-Pre-pickApp"
                            style="height: 40px; border: none; background-color: #282d31; padding: 0;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" style="color: #fff;" fill="currentColor" class="bi bi-house" viewBox="0 0 16 16">
                                <path d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L2 8.207V13.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V8.207l.646.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293zM13 7.207V13.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V7.207l5-5z"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div id="warranty-body">
                    <div class="content">
                        <!-- Tab Content -->
                        <div id="tab-0" class="tab-content">
                            <div>
                                <div class="d-flex" style="color: #fff; padding-left: 10px;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-clock-history" viewBox="0 0 16 16">
                                        <path d="M8.515 1.019A7 7 0 0 0 8 1V0a8 8 0 0 1 .589.022zm2.004.45a7 7 0 0 0-.985-.299l.219-.976q.576.129 1.126.342zm1.37.71a7 7 0 0 0-.439-.27l.493-.87a8 8 0 0 1 .979.654l-.615.789a7 7 0 0 0-.418-.302zm1.834 1.79a7 7 0 0 0-.653-.796l.724-.69q.406.429.747.91zm.744 1.352a7 7 0 0 0-.214-.468l.893-.45a8 8 0 0 1 .45 1.088l-.95.313a7 7 0 0 0-.179-.483m.53 2.507a7 7 0 0 0-.1-1.025l.985-.17q.1.58.116 1.17zm-.131 1.538q.05-.254.081-.51l.993.123a8 8 0 0 1-.23 1.155l-.964-.267q.069-.247.12-.501m-.952 2.379q.276-.436.486-.908l.914.405q-.24.54-.555 1.038zm-.964 1.205q.183-.183.35-.378l.758.653a8 8 0 0 1-.401.432z"/>
                                        <path d="M8 1a7 7 0 1 0 4.95 11.95l.707.707A8.001 8.001 0 1 1 8 0z"/>
                                        <path d="M7.5 3a.5.5 0 0 1 .5.5v5.21l3.248 1.856a.5.5 0 0 1-.496.868l-3.5-2A.5.5 0 0 1 7 9V3.5a.5.5 0 0 1 .5-.5"/>
                                      </svg>
                                    <h6 style="padding-left: 10px; padding-left: 10px;">Lịch sử bảo hành sản phẩm:</h6>
                                </div>
                            </div>
                            <ul id="history-warranty-detail" style="overflow-y: auto; max-height: 538px; padding: 10px 0 0px;">
                                <h5 style="color: #fff;">Sản phẩm chưa từng bảo hành</h5>
                            </ul>
                        </div>
            
                        <div id="tab-1" class="tab-content active">
                            <div class="row">
                                <div class=" col-12 p-2">
                                    <div class="box-value" style="height: 150px; margin: 0;">
                                        <div class="d-flex justify-content-center">
                                            <!-- <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-moisture" viewBox="0 0 16 16">
                                                <path d="M13.5 0a.5.5 0 0 0 0 1H15v2.75h-.5a.5.5 0 0 0 0 1h.5V7.5h-1.5a.5.5 0 0 0 0 1H15v2.75h-.5a.5.5 0 0 0 0 1h.5V15h-1.5a.5.5 0 0 0 0 1h2a.5.5 0 0 0 .5-.5V.5a.5.5 0 0 0-.5-.5zM7 1.5l.364-.343a.5.5 0 0 0-.728 0l-.002.002-.006.007-.022.023-.08.088a29 29 0 0 0-1.274 1.517c-.769.983-1.714 2.325-2.385 3.727C2.368 7.564 2 8.682 2 9.733 2 12.614 4.212 15 7 15s5-2.386 5-5.267c0-1.05-.368-2.169-.867-3.212-.671-1.402-1.616-2.744-2.385-3.727a29 29 0 0 0-1.354-1.605l-.022-.023-.006-.007-.002-.001zm0 0-.364-.343zm-.016.766L7 2.247l.016.019c.24.274.572.667.944 1.144.611.781 1.32 1.776 1.901 2.827H4.14c.58-1.051 1.29-2.046 1.9-2.827.373-.477.706-.87.945-1.144zM3 9.733c0-.755.244-1.612.638-2.496h6.724c.395.884.638 1.741.638 2.496C11 12.117 9.182 14 7 14s-4-1.883-4-4.267" />
                                            </svg> -->
                                            <p style="padding-left: 5px;">Thông tin sản phẩm</p>
                                        </div>
                                        <h6 id="productName">Sản phẩm: -</h6>
                                        <h6 id="productCode">Mã định danh: -</h6>
                                        <h6 id="productSeri">Số seri: -</h6>
                                    </div>
                                </div>
                                <div class=" col-6 p-2">
                                    <div class="box-value" style="height: 116px; margin: 0;">
                                        <div class="d-flex justify-content-center">
                                            <p style="padding-left: 5px;">Bảo hành</p>
                                        </div>
                                        <h6 id="warrantyActive">-</h6>
                                    </div>
                                </div>
                                <div class=" col-6 p-2">
                                    <div class="box-value" style="height: 116px; margin: 0;">
                                        <div class="d-flex justify-content-center">
                                            <!-- <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-moisture" viewBox="0 0 16 16">
                                                <path d="M13.5 0a.5.5 0 0 0 0 1H15v2.75h-.5a.5.5 0 0 0 0 1h.5V7.5h-1.5a.5.5 0 0 0 0 1H15v2.75h-.5a.5.5 0 0 0 0 1h.5V15h-1.5a.5.5 0 0 0 0 1h2a.5.5 0 0 0 .5-.5V.5a.5.5 0 0 0-.5-.5zM7 1.5l.364-.343a.5.5 0 0 0-.728 0l-.002.002-.006.007-.022.023-.08.088a29 29 0 0 0-1.274 1.517c-.769.983-1.714 2.325-2.385 3.727C2.368 7.564 2 8.682 2 9.733 2 12.614 4.212 15 7 15s5-2.386 5-5.267c0-1.05-.368-2.169-.867-3.212-.671-1.402-1.616-2.744-2.385-3.727a29 29 0 0 0-1.354-1.605l-.022-.023-.006-.007-.002-.001zm0 0-.364-.343zm-.016.766L7 2.247l.016.019c.24.274.572.667.944 1.144.611.781 1.32 1.776 1.901 2.827H4.14c.58-1.051 1.29-2.046 1.9-2.827.373-.477.706-.87.945-1.144zM3 9.733c0-.755.244-1.612.638-2.496h6.724c.395.884.638 1.741.638 2.496C11 12.117 9.182 14 7 14s-4-1.883-4-4.267" />
                                            </svg> -->
                                            <p style="padding-left: 5px;">Thời gian Bảo hành</p>
                                        </div>
                                        <h6 id="warrantyTime">-</h6>
                                    </div>
                                </div>
                                <div class=" col-12 p-2">
                                    <div class="box-value" style="height: 250px; margin: 0; padding: 0;">
                                        <img id="deviceImg" style="width: 100%; height: 100%; object-fit: cover; border-radius: 4px;" src="" alt="">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="tab-2" class="tab-content">
                            <h3 style="color: #fff; margin-top: 50px;">Tạo nhiều QR Code</h3>
                            <!-- <input type="number" class="form-control"  id="startValue" placeholder="Nhập số lượng mã QR cần in"> -->
                            <input id="startValue" type="text" placeholder="Nhập số lượng mã QR cần in"
                            style="width: 100%; border-radius: 4px; height: 50px; color: #fff; padding-left: 20px; margin-top: 10px; background-color: #343a40; border: none; border-bottom: 1px solid #626262;">
                            <button id="generateQRCodes" class="btn btn-warning"
                                            style="background-color: #f39c12;margin-top: 20px; border: solid 1px #f39c12; width: 100%; height: 35px; color: #fff;">Tạo QR</button>
                        </div>
                    </div>
            
                    <!-- Bottom Navigation -->
                    <div id="menu-warranty" class="bottom-navigation d-none">
                        <button id="btn-tab1" data-tab="1">
                            <!-- <img src="https://cdn-icons-png.flaticon.com/512/3409/3409588.png" alt="Quét QR"> -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-list-ul" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2"/>
                            </svg>
                            Chi tiết
                        </button>
                        <button id="btn-tab1" data-tab="0">
                            <!-- <img src="./assets/img/Screenshot 2024-10-11 103819.png" alt="Tạo QR"> -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-clock-history" viewBox="0 0 16 16">
                                <path d="M8.515 1.019A7 7 0 0 0 8 1V0a8 8 0 0 1 .589.022zm2.004.45a7 7 0 0 0-.985-.299l.219-.976q.576.129 1.126.342zm1.37.71a7 7 0 0 0-.439-.27l.493-.87a8 8 0 0 1 .979.654l-.615.789a7 7 0 0 0-.418-.302zm1.834 1.79a7 7 0 0 0-.653-.796l.724-.69q.406.429.747.91zm.744 1.352a7 7 0 0 0-.214-.468l.893-.45a8 8 0 0 1 .45 1.088l-.95.313a7 7 0 0 0-.179-.483m.53 2.507a7 7 0 0 0-.1-1.025l.985-.17q.1.58.116 1.17zm-.131 1.538q.05-.254.081-.51l.993.123a8 8 0 0 1-.23 1.155l-.964-.267q.069-.247.12-.501m-.952 2.379q.276-.436.486-.908l.914.405q-.24.54-.555 1.038zm-.964 1.205q.183-.183.35-.378l.758.653a8 8 0 0 1-.401.432z"/>
                                <path d="M8 1a7 7 0 1 0 4.95 11.95l.707.707A8.001 8.001 0 1 1 8 0z"/>
                                <path d="M7.5 3a.5.5 0 0 1 .5.5v5.21l3.248 1.856a.5.5 0 0 1-.496.868l-3.5-2A.5.5 0 0 1 7 9V3.5a.5.5 0 0 1 .5-.5"/>
                              </svg>
                            Lịch sử
                        </button>
                        <button id="btn-tab1" data-tab="2" class="d-none">
                            <!-- <img src="./assets/img/Screenshot 2024-10-11 103819.png" alt="Tạo nhiều QR"> -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-qr-code" viewBox="0 0 16 16">
                                <path d="M2 2h2v2H2z"/>
                                <path d="M6 0v6H0V0zM5 1H1v4h4zM4 12H2v2h2z"/>
                                <path d="M6 10v6H0v-6zm-5 1v4h4v-4zm11-9h2v2h-2z"/>
                                <path d="M10 0v6h6V0zm5 1v4h-4V1zM8 1V0h1v2H8v2H7V1zm0 5V4h1v2zM6 8V7h1V6h1v2h1V7h5v1h-4v1H7V8zm0 0v1H2V8H1v1H0V7h3v1zm10 1h-1V7h1zm-1 0h-1v2h2v-1h-1zm-4 0h2v1h-1v1h-1zm2 3v-1h-1v1h-1v1H9v1h3v-2zm0 0h3v1h-2v1h-1zm-4-1v1h1v-2H7v1z"/>
                                <path d="M7 12h1v3h4v1H7zm9 2v2h-3v-1h2v-1z"/>
                            </svg>
                            Tạo QR
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div id="qr-popup" class="modal">
            <div id="qr-reader"></div>
            <button id="close-scanner">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-x"
                    viewBox="0 0 16 16">
                    <path
                        d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708" />
                </svg>
            </button>
            <button id="toggle-camera">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                    class="bi bi-arrow-repeat" viewBox="0 0 16 16">
                    <path
                        d="M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41m-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9" />
                    <path fill-rule="evenodd"
                        d="M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5 5 0 0 0 8 3M3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9z" />
                </svg>
            </button>
            <div id="result-form" class="d-none" style="width: 95vh; height: 200px;">
                <div id="result-form-group">
                    <div id="result-form-total" class="d-none">
                        <div id="result-form-title" class="d-none" style="width: 100%; text-align: center;">
                            <p style="color: #fff;">Mã truy cập lỗi, vui lòng thử lại.</p>
                        </div>
                        <input id="result-form-stationID" disabled type="text"
                            style="width: 100%; height: 50px; color: #fff; padding-left: 20px; margin-top: 10px; background-color: #343a40; border: none; border-bottom: 1px solid #626262;">
                        <input id="result-form-stationName" disabled type="text"
                            style="width: 100%; height: 50px; color: #fff; padding-left: 20px; margin-top: 10px; background-color: #343a40; border: none; border-bottom: 1px solid #626262;">
                        <div class="d-flex justify-content-center pt-2">
                            <button id="result-scanagain" class="btn mx-2" style="background-color: #c44133;border: solid 1px #c44133; width: 47%; color: #fff;">Quét lại</button>
                            <button id="result-truycap" disabled class="btn mx-2" style="background-color: #f39c12;border: solid 1px #f39c12; width: 47%; color: #fff;">Truy cập</button>
                        </div>
                    </div>
                    <div id="result-product" class="d-none">
                        <div id="result-product-title" class="d-none" style="width: 100%; text-align: center;">
                            <p style="color: #fff;">Mã sản phẩm lỗi, vui lòng thử lại.</p>
                        </div>
                        <p></p>
                        <input id="result-form-productName" disabled type="text" style="width: 100%; height: 50px; color: #fff; padding-left: 20px; margin-top: 10px; background-color: #343a40; border: none; border-bottom: 1px solid #626262;">
                        <input id="result-form-productCode" disabled type="text" style="width: 100%; height: 50px; color: #fff; padding-left: 20px; margin-top: 10px; background-color: #343a40; border: none; border-bottom: 1px solid #626262;">
                        <div class="d-flex justify-content-between pt-2">
                            <button id="result-product-scanagain" class="btn "
                                style="background-color: #c44133;border: solid 1px #c44133; width: 47%; color: #fff;">Quét
                                lại</button>
                            <button id="result-product-truycap" disabled class="btn "
                                style="background-color: #f39c12;border: solid 1px #f39c12; width: 47%; color: #fff;">Xem chi tiết</button>
                        </div>
                        <button id="result-product-warranty" class="btn mt-2"
                                style="background-color: #f39c12;border: solid 1px #f39c12; width: 100%; color: #fff;">Kích hoạt bảo hành</button>
                    </div>
                    <div id="result-form-loading">
                        <div style="width: 100%; text-align: center;">
                            <p style="color: #fff;">Đang kiểm tra dữ liệu.</p>
                        </div>
                        <div class="progress">
                            <div class="progress-bar progress-bar-striped" role="progressbar" style="width: 100%"
                                aria-valuenow="10" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="upload-qr">
                <p>Di chuyển camera đến mã QR để quét hoặc</p>
                <div class="d-flex justify-content-center">
                    <button style="margin-right: 5px;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                            class="bi bi-cloud-arrow-up" viewBox="0 0 16 16">
                            <path fill-rule="evenodd"
                                d="M7.646 5.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708z" />
                            <path
                                d="M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383m.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z" />
                        </svg>
                    </button>
                    <p style="margin-top: 10px;">Tải hình ảnh lên</p>
                </div>
            </div>
            <div id="footer-instruct-scanQR" class="d-none footer-instruct">
                <div class="step">
                    <div class="circle">04</div>
                </div>
                <p>Truy cập xem thông tin hoặc nhấn quét lại</p>
            </div>
            <input type="file" id="file-input" accept="image/*">
        </div>
        <div id="loading-popup" class="modal">
            <div class="modal-content" style="width: 80%; margin-top: 50px; margin-left: 10%;">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Đang tải dữ liệu...</h5>
                    <button id="button-modal-close" type="button" class="btn-close d-none" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="progress">
                        <div class="progress-bar progress-bar-striped" role="progressbar" style="width: 100%" aria-valuenow="10" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>
            </div>
        </div>
        <div id="share-popup" class="modal">
            <div class="container" style="width: 100%; height: 100%; background-color: #1E2833;">
                <div class="d-flex" style="line-height: 50px;">
                    <button id="BackCodeQR" style="height: 40px; border: none; background-color: #1E2833;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                            style="color: #fff; margin-right: 10px;" class="bi bi-arrow-left" viewBox="0 0 16 16">
                            <path fill-rule="evenodd"
                                d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8" />
                        </svg>
                    </button>
                    <p
                        style="width: 250px;font-size: 20px; color: #fff; text-align: left; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">
                        Chia sẻ trạm</p>
                </div>
                <img src="https://central.homeos.vn/images/Logo_HomeOS_White.png" alt="" width="200" style="padding-bottom: 3rem;">
                <div>
                    <p id="text-content-QRcode" style="color: #fff;"></p>
                </div>
                <div id="qrcode"></div>
                <button id="download-QRcode" class="d-none btn btn-warning" style="margin-top: 20px; background-color: #f39c12;border: solid 1px #f39c12; width: 100%; height: 35px; color: #fff; padding: 3px 10px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-download" viewBox="0 0 16 16">
                        <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5"/>
                        <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708z"/>
                    </svg> Tải ảnh QR
                </button> 
            </div>
            
        </div>
        <div id="error-popup" class="modal">
            <div class="container" style="width: 100%; height: 100%; background-color: #1E2833;">
                <div class="d-flex" style="line-height: 50px;">
                    <button id="BackWarranty" style="height: 40px; border: none; background-color: #1E2833;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                            style="color: #fff; margin-right: 10px;" class="bi bi-arrow-left" viewBox="0 0 16 16">
                            <path fill-rule="evenodd"
                                d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8" />
                        </svg>
                    </button>
                    <p
                        style="width: 250px;font-size: 20px; color: #fff; text-align: left; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">
                        Khai báo lỗi</p>
                </div>
                <img src="https://central.homeos.vn/images/Logo_HomeOS_White.png" alt="" width="200" style="padding-bottom: 3rem;">
                <div>
                    <div class="content-form" style="background-color: #1E2833; padding: 0;">
                        <div class="form-group content-detail">
                            <label class="form-label content-label" for="errorInput">Lỗi:</label>
                            <input type="text" id="errorInput" class="form-control content-input" placeholder="Nhập lỗi...">
                        </div>
                        <div class="form-group content-detail">
                            <label class="form-label content-label" for="ap_ssid">Loại lỗi:</label>
                            <!-- <input type="text" id="ap_ssid" class="form-control content-input" placeholder="Nhập tên điểm truy cập..."> -->
                            <select name="" id="errorType" class="form-control content-input">
                                <option value="1">Lỗi thiết bị</option>
                                <option value="2">Lỗi người dùng</option>
                            </select>
                        </div>
                        <div class="form-group content-detail">
                            <label class="form-label content-label" for="ap_password">Mô tả:</label>
                            <!-- <input type="tex" id="ap_password" class="form-control content-input" placeholder="Nhập mật khẩu điểm truy cập..."> -->
                            <textarea id="errorDesc" class="form-control content-input" style="height: 120px;" placeholder="Mô tả lỗi"></textarea>
                        </div>
                    </div>
                    <button id="submitError" class="btn btn-warning" style="margin-top: 20px; background-color: #f39c12;border: solid 1px #f39c12; width: 100%; height: 35px; color: #fff; padding: 3px 10px;">
                        Xác nhận lỗi
                    </button>
                </div>
                
            </div>
            
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.2/Draggable.min.js"></script>
    <script type="text/javascript" src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
    <script>
        $(document).ready(function () {
            var DataUser;
            // Gọi hàm GetUser từ script chính
            DataUser = JSON.parse(localStorage.getItem("userInfo"));
            var UserID = localStorage.getItem("userID");
            async function handleUser() {
                if (UserID) {
                    try {
                        if (DataUser && DataUser.id === UserID) {
                            $(".userName").text(DataUser.name);
                            document.getElementById("PickApp-button-login").classList.add("d-none");
                            $(".userAvt").attr("src", DataUser.avatar);
                            document.getElementById("LogoPickScreen").style.paddingTop = "10vh";
                            const dataUserResponse = await getDM("WARRANTY_USER", "USER_ID='" + UserID + "'");
                            console.log(dataUserResponse.data);
                            if(dataUserResponse.data.length == 0){
                                const willInsertData = {
                                    USER_ID: DataUser.id,
                                    USER_NAME: DataUser.name,
                                    USER_ROLE: "GUEST",
                                    DATE_CREATE: new Date(),
                                    DATASTATE: "ADD",
                                };
                                add('WARRANTY_USER', willInsertData);
                                localStorage.setItem('RoleUser', "GUEST");
                            } else {
                                console.log(dataUserResponse);
                                localStorage.setItem('RoleUser', dataUserResponse.data[0].USER_ROLE);
                            }
                        } else if(DataUser != undefined) {
                            const dataUserResponse = await getDM("WARRANTY_USER", "USER_ID='" + UserID + "'");
                            console.log(dataUserResponse.data);
                            if(dataUserResponse.data.length == 0){
                                const willInsertData = {
                                    USER_ID: DataUser.id,
                                    USER_NAME: DataUser.name,
                                    USER_ROLE: "GUEST",
                                    DATE_CREATE: new Date(),
                                    DATASTATE: "ADD",
                                };
                                add('WARRANTY_USER', willInsertData);
                            }
                        }
                    } catch (error) {
                        console.error("Error fetching user data:", error);
                    }
                } else {
                    localStorage.setItem('RoleUser', 'GUEST');
                    document.getElementById("QUYEN").classList.add("d-none");
                    document.getElementById("LogoPickScreen").style.paddingTop = "10vh";
                }
                WarrantyCheckUser(localStorage.getItem("RoleUser"));
            }

            handleUser();
            var historyItems = [];
            var CategoryItems = [];
            var DataCategory = [];
            var historyListDetail = $('#history-detail');
            var historyListCategoryDetail = $('#list-history-detail');
            var historyListCategoryAdd = $('#list-history-add');
            var listCategory = $('#history-setting-detail');
            var listWarrantyHistory = $('#history-warranty-detail');
            var NameWorkStation;
            var intervalId; // Lưu ID của setInterval
            var checkTab = false;
            var checkAppQR;
            // var user_id = "admin";
            // var session = "7b504acc-988a-437a-890f-389765305b47";

            const buttons = document.querySelectorAll(".btn-chart");
            buttons.forEach((button) => {
                button.addEventListener("click", function () {
                    buttons.forEach((btn) => btn.classList.remove("active"));
                    this.classList.add("active");
                });
            });
            function openTab(evt, tabName) {
                // Ẩn tất cả nội dung tab
                var tabContent = document.getElementsByClassName("tab-content");
                for (var i = 0; i < tabContent.length; i++) {
                    tabContent[i].classList.remove("active");
                }

                // Xóa class 'active' trên tất cả các nút
                var tabLinks = document.getElementsByClassName("tablinks");
                for (var i = 0; i < tabLinks.length; i++) {
                    tabLinks[i].classList.remove("active");
                }

                // Hiển thị tab được chọn và thêm class 'active' cho nút đã nhấn
                document.getElementById(tabName).classList.add("active");
                evt.currentTarget.classList.add("active");
            }
            function openTabGuarantee(evt, tabName) {
                // Ẩn tất cả nội dung tab
                
                var tabContent = document.getElementsByClassName("tab-content-guarantee");
                for (var i = 0; i < tabContent.length; i++) {
                    tabContent[i].classList.remove("active");
                }

                // Xóa class 'active' trên tất cả các nút
                var tabLinks = document.getElementsByClassName("tablinkGuarantee");
                for (var i = 0; i < tabLinks.length; i++) {
                    tabLinks[i].classList.remove("active");
                }

                // Hiển thị tab được chọn và thêm class 'active' cho nút đã nhấn
                document.getElementById(tabName).classList.add("active");
                evt.currentTarget.classList.add("active");
            }

            function checkHeight() {
                const viewportHeight = window.innerHeight;
                const historyDetail = document.getElementById('history-detail');
                historyDetail.style.height = (viewportHeight - 340) + 'px';
                const categoryDetail = document.getElementById('list-history-detail');
                categoryDetail.style.height = (viewportHeight - 530) + 'px';
                const category = document.getElementById('history-setting-detail');
                category.style.maxHeight = (viewportHeight - 200) + 'px';
            };
            checkHeight();
            window.addEventListener('resize', function () {
                const viewportHeight = window.innerHeight;
                const historyDetail = document.getElementById('history-detail');
                historyDetail.style.height = (viewportHeight - 340) + 'px'; // 80% chiều cao của thiết bị
                const categoryDetail = document.getElementById('list-history-detail');
                categoryDetail.style.height = (viewportHeight - 530) + 'px'; // 80% chiều cao của thiết bị
                const category = document.getElementById('history-setting-detail');
                category.style.maxHeight = (viewportHeight - 200) + 'px';
            });
            // Mặc định mở tab đầu tiên
            setTimeout(() => {
                document.getElementById("LoadScreen").classList.add("d-none");
                document.getElementById("LogoLoadScreen").classList.add("hidden");
                document.getElementById("pickApp").classList.remove("hidden");
                // document.getElementById("guarantee").classList.remove("hidden");
            }, 2000);

            var maTram = '';
            function changeHistory() {
                document.getElementById("history").classList.remove("hidden");
                document.getElementById("homePage").classList.add("hidden");
                maTram = '';
            }
            function changeQRcode() {
                // openTab(event, 'tab1');
                document.getElementById("ScanQR").classList.remove("hidden");
                document.getElementById("homePage").classList.add("hidden");
                document.getElementById("history").classList.add("hidden");
                document.querySelector(".tablinkQR").click();
                maTram = '';
            }
            function OpenAddCategory() {
                $(".history-avt").addClass("d-none");
                document.getElementById("category-back").classList.remove("d-none");
                localStorage.setItem('listItemCategory', JSON.stringify([]));
                historyListCategoryAdd.empty()
                showHistoryCategory();
                document.getElementById("list-category").classList.add("d-none");
                document.getElementById("save-category").classList.remove("d-none");
            }
            function truyCap() {
                document.getElementById("footer-instruct-scanQR").classList.add("d-none");
                document.getElementById("result-form").classList.add("d-none");
                $('#qr-popup').modal('hide');
                document.getElementById("ScanQR").classList.add("hidden");
                document.getElementById("history").classList.add("hidden");
                document.getElementById("homePage").classList.remove("hidden");
                matram = localStorage.getItem("MATRAM");
                $("button-modal-loading").click();
                saveHistory(localStorage.getItem('MATRAM'));
                checkTypeWorkstation()
                getDataMonitoring();
            }
            function DetailProduct() {
                document.getElementById("footer-instruct-scanQR").classList.add("d-none");
                document.getElementById("result-form").classList.add("d-none");
                document.getElementById("result-product").classList.add("d-none");
                document.getElementById("result-product").classList.add("d-none");
                document.getElementById("tab-0").classList.remove("active");
                document.getElementById("tab-1").classList.add("active");
                document.getElementById("btn-tab1").classList.add("menuWarranty");
                $('#qr-popup').modal('hide');
                document.getElementById("ScanQRWarranty").classList.add("hidden");
                document.getElementById("guarantee").classList.remove("hidden");
                document.getElementById("menu-warranty").classList.remove("d-none");
                $('#loading-popup').modal('hide');
                console.log('hide');

            }
            function scanAgain() {
                console.log("scan2");
                document.getElementById("footer-instruct-scanQR").classList.add("d-none");
                document.getElementById("result-form").classList.add("d-none");
                document.getElementById("file-input").value = '';
                startQRcode();
            }
            $(".start").click(function () {
                startQRcode();
            })
            $("#PickApp-button-mua").click(function () {
                showHistory();
                pickApp('MUA');
            });
            $("#PickApp-button-IOT").click(function () {
                pickApp('IOT');
            });
            $("#PickApp-button-pick").click(function () {
                showHistory();
                pickApp('PICK');
            });
            $("#PickApp-button-login").click(function () {
                pickApp('LOGIN');
            });
            $("#PickApp-button-guarantee").click(function () {
                pickApp('GUA');
            });
            $(".Pre-pickApp").click(function () {
                stopInterval()
                pickApp('PRE');
            });
            $("#share-qrcode-workstation").click(function () {
                // Hiển thị popup với hiệu ứng modal
                $("#share-popup").modal({
                    fadeDuration: 250,
                    escapeClose: false,
                    clickClose: false,
                    showClose: false
                });

                // Xóa nội dung mã QR cũ
                $('#qrcode').empty();

                // Dữ liệu để tạo mã QR
                const text = localStorage.getItem("URL") + "$" + localStorage.getItem("MATRAM");
                document.getElementById("text-content-QRcode").textContent =
                    localStorage.getItem("MATRAM") + " - " + JSON.parse(localStorage.getItem('itemHistory')).NameWorkStation;
                // Tạo mã QR
                QRCode.toCanvas(text, { width: 200 }, function (error, canvas) {
                    if (error) {
                        console.error("Lỗi khi tạo mã QR:", error);
                        alert('Lỗi khi tạo mã QR!');
                        return;
                    }

                    // Thêm canvas QR vào DOM
                    $('#qrcode').append(canvas);

                    // Tạo ảnh ẩn từ canvas (tùy chọn)
                    const image = canvas.toDataURL('image/png');
                    const img = $('<img>')
                        .attr('src', image)
                        .css({ display: 'none' }) // Ẩn ảnh đi
                        .attr('id', 'hidden-image');
                    $('#qrcode').append(img);
                });
            });

            $("#errorWarranty").click(function () {
                $("#error-popup").modal({
                    fadeDuration: 250,
                    escapeClose: false,
                    clickClose: false,
                    showClose: false
                });
            });
            $("#BackCodeQR").click(function () {
                $('#share-popup').modal('hide');
            });
            $("#download-QRcode").click(function () {
                const img = $('#hidden-image')[0];

                if (!img) {
                    alert('Chưa có mã QR để tải!');
                }

                // Tạo thẻ <a> để tải xuống
                const link = document.createElement('a');
                link.href = img.src;
                link.download = 'qrcode.pdf';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            });
            $(".homepage-Pre-pickApp").click(function () {
                stopInterval();
                pickApp('PRE');
            });
            $("#tab-scan-qr").click(function (event) {
                openTab(event, 'tab1')
            });
            $("#tab-text").click(function (event) {
                openTab(event, 'tab2')
            });
            $("#tab-scan").click(function (event) {
                checkTab = false;
                openTabGuarantee(event, 'tab3')
            });
            $("#tab-history").click(function (event) {
                openTabGuarantee(event, 'tab4')
            });
            $("#truycap").click(function () {
                getInputValue()
            });
            $("#saveCategory").click(function () {
                saveCategory()
            });
            $(".ScanQRNext").click(function () {
                document.getElementById("RT").textContent = '-';
                document.getElementById("RH").textContent = '-';
                document.getElementById("energy").textContent = '-';
                document.getElementById("status").style.background = "red";
                document.getElementById("text-status").textContent = "Mất kết nối";
                document.getElementById("RP").textContent = '-';
                document.getElementById("RD").textContent = '0 mm';
                document.getElementById("lastTimeRain").textContent = '';
                document.getElementById("lateDateTime").textContent = "-";
                pickApp('HISTORY')
            });
            $(".WarrantyScanNext").click(function () {
                document.getElementById("ScanQRWarranty").classList.remove("hidden");
                document.getElementById("guarantee").classList.add("hidden");
                document.getElementById("menu-warranty").classList.add("d-none");
            });
            $("#button-list-ngay").click(function () {
                clickGetData('NGAY')
            });
            $("#button-list-tuan").click(function () {
                clickGetData('TUAN')
            });
            $("#button-list-thang").click(function () {
                clickGetData('THANG')
            });
            $("#button-list-nam").click(function () {
                clickGetData('NAM')
            });
            $("#result-scanagain").click(function () {
                document.getElementById("result-form-total").classList.add("d-none");
                document.getElementById("result-form-loading").classList.remove("d-none");
                document.getElementById("result-form-title").classList.add("d-none");
                document.getElementById("result-form-stationID").classList.remove("d-none");
                document.getElementById("result-form-stationName").classList.remove("d-none");
                document.getElementById("result-truycap").classList.remove("d-none");
                scanAgain()
            });
            $("#result-product-scanagain").click(function () {
                document.getElementById("result-product").classList.add("d-none");
                document.getElementById("result-form-loading").classList.remove("d-none");
                document.getElementById("result-product-title").classList.add("d-none");
                document.getElementById("result-form-productName").classList.remove("d-none");
                document.getElementById("result-form-productCode").classList.remove("d-none");
                document.getElementById("result-truycap").classList.remove("d-none");
                scanAgain()
            });
            $("#PickApp-button-scanQR").click(function () {
                stopInterval()
                changeQRcode()
            });
            $("#addWorkStation").click(function () {
                changeQRcode()
            });
            $("#addCategory").click(function () {
                OpenAddCategory()
            });
            $("#btnAddCategory").click(function () {
                OpenAddCategory()
            });
            $("#backCategory").click(function () {
                $(".history-avt").removeClass("d-none");
                document.getElementById("category-back").classList.add("d-none");
                document.getElementById("list-category").classList.remove("d-none");
                document.getElementById("save-category").classList.add("d-none");
                document.getElementById("detail-category").classList.add("d-none");
                showCategory()
                historyListCategoryAdd.empty();
            });
            $("#result-truycap").click(function () {
                document.getElementById("result-truycap").disabled = true;
                $("#loading-popup").modal({
                    fadeDuration: 250,
                    escapeClose: false,
                    clickClose: false,
                    showClose: false
                });
                truyCap()
            });
            $("#result-product-truycap").click(function () {
                document.getElementById("result-product-truycap").disabled = true;
                $("#loading-popup").modal({
                    fadeDuration: 250,
                    escapeClose: false,
                    clickClose: false,
                    showClose: false
                });
                DetailProduct();
            });
            $("#BackWarranty").click(function () {
                $("#error-popup").modal('hide');
                $("#errorInput").val("");
                $("#errorType").val("");
                $("#errorDesc").val("");
            });
            document.getElementById("historySelect").addEventListener("change", function () {
                const selectedValue = this.value; // Lấy giá trị đã chọn
                const selectedText = this.options[this.selectedIndex].text; // Lấy văn bản đã chọn
                showHistory(selectedValue);
            });
            async function pickApp(type) {
                if (type == 'MUA') {
                    document.getElementById("LoadScreen").classList.remove("d-none");
                    document.getElementById("img-station").classList.remove("hidden");
                    document.getElementById("pickApp").classList.add("hidden");
                    setTimeout(() => {
                        document.getElementById("LoadScreen").classList.add("d-none");
                        document.getElementById("img-station").classList.add("hidden");
                        document.getElementById("history").classList.remove("hidden");
                    }, 2000);
                } else if (type == 'IOT') {
                    window.location.href = "http://devices.homeos.vn/";
                } else if (type == 'PICK') {
                    document.getElementById("history").classList.remove("hidden");
                    document.getElementById("ScanQR").classList.add("hidden");
                    document.getElementById("history-setting").classList.add("d-none");
                    document.getElementById("history-homePage").classList.remove("d-none");
                } else if (type == 'PRE') {
                    document.getElementById("history").classList.add("hidden");
                    document.getElementById("homePage").classList.add("hidden");
                    document.getElementById("pickApp").classList.remove("hidden");
                    document.getElementById("guarantee").classList.add("hidden");
                    document.getElementById("ScanQRWarranty").classList.add("hidden");
                    document.getElementById("menu-warranty").classList.add("d-none");
                    document.getElementById("footer-instruct-warranty").classList.add("d-none");
                } else if (type == 'HISTORY') {
                    showHistory()
                    document.getElementById("history").classList.remove("hidden");
                    document.getElementById("homePage").classList.add("hidden");
                } else if (type == 'GUA') {
                    document.getElementById("ScanQRWarranty").classList.remove("hidden");
                    document.getElementById("pickApp").classList.add("hidden");
                    document.getElementById("footer-instruct-warranty").classList.remove("d-none");
                    document.querySelector(".tablinkGuarantee").click();
                    $("#warrantyDetailProduct").removeClass("d-none");
                    $("#ScanAllQRcode").addClass("d-none");
                    checkTab = false;
                } else if (type == 'LOGIN'){
                    if (window.GetUser) {
                        await window.GetUser();
                        DataUser = JSON.parse(localStorage.getItem("userInfo"));
                        $(".userName").text(DataUser.name);
                        document.getElementById("PickApp-button-login").classList.add("d-none");
                        $(".userAvt").attr("src", DataUser.avatar);
                        document.getElementById("LogoPickScreen").style.paddingTop = '10vh';
                        const dataUserResponse = await getDM("WARRANTY_USER", "USER_ID='" + UserID + "'");
                        if(dataUserResponse.data.length == 0){
                            const willInsertData = {
                                USER_ID: DataUser.id,
                                USER_NAME: DataUser.name,
                                USER_ROLE: "GUEST",
                                DATE_CREATE: new Date(),
                                DATASTATE: "ADD",
                            };
                            add('WARRANTY_USER', willInsertData);
                        }
                    }
                }
            }
            async function CheckWorkStation(workstationID) {
                var listDomain = ["thoitiet.ifee.edu.vn", "namdinh.homeos.vn", "kttvthaibinh.com.vn", "cctl-dongthap.homeos.vn", "angiang.homeos.vn", "thanthongnhat.homeos.vn", "ninhbinh.homeos.vn"]
                var domain;
                var data;
                for (let i = 0; i < listDomain.length; i++) {
                    data = await getDataStation(workstationID, listDomain[i]);

                    if (data.length == 0 || data.length == undefined || data == null || data == '' || data == []) {
                        domain = '';
                    } else {
                        domain = listDomain[i];
                        break;
                    }
                }
                if (domain == '') {
                    toastr.error("Mã trạm không tồn tại");
                    $('#loading-popup').modal('hide');
                } else {
                    localStorage.setItem("URL", "https://" + domain + "/Service/Service.svc");
                    //$("#result").text("Kết quả quét: " + data[0].WORKSTATION_ID +"- Trạm:"+ data[0].WORKSTATION_NAME);
                    document.getElementById("footer-stationName").textContent = data[0].WORKSTATION_ID + " - " + data[0].WORKSTATION_NAME;
                    localStorage.setItem("MATRAM", data[0].WORKSTATION_ID);
                    toastr.success("Truy cập thành công!");
                    truyCap()
                }
            }
            // kiểm tra xem trạm nhập chạy ở service nào
            async function getDomain(workstationID, type) {
                return new Promise(async (resolve, reject) => {
                    var listDomain = ["thoitiet.ifee.edu.vn", "namdinh.homeos.vn", "kttvthaibinh.com.vn", "cctl-dongthap.homeos.vn", "angiang.homeos.vn", "thanthongnhat.homeos.vn", "ninhbinh.homeos.vn"]
                    var domain;
                    var data;
                    for (let i = 0; i < listDomain.length; i++) {
                        data = await getDataStation(workstationID, listDomain[i]);

                        if (data.length == 0 || data.length == undefined || data == null || data == '' || data == []) {
                            domain = '';
                        } else {
                            domain = listDomain[i]
                            break;
                        }
                    }
                    if (type == "domain") {
                        resolve(domain);
                    } else {
                        resolve(data);
                    }
                });
            }

            async function getDataMonitoring() {
                createNewChart()
                const data = await getNewData(
                    localStorage.getItem("MATRAM"),
                    "WORKSTATION_ID='" + localStorage.getItem("MATRAM") + "'",
                    localStorage.getItem("URL")
                );
                const item = JSON.parse(localStorage.getItem('itemHistory'));
                const TypeWorkstation = getDayMessage(item.workstationType);
                const dataChart = await getDataChart('NGAY', '', '', TypeWorkstation, localStorage.getItem("MATRAM"), localStorage.getItem("URL"));
                // const dataChart = await getDataChart('NGAY', '', '', 'RD---', localStorage.getItem("MATRAM"), localStorage.getItem("URL"));
                if (dataChart != []) {
                    createChartData(dataChart, 'RD', 'NGAY')
                }

                changeDataHomePage(data.D);
                setInterval(async () => {
                    const data = await getNewData(
                        localStorage.getItem("MATRAM"),
                        "WORKSTATION_ID='" + localStorage.getItem("MATRAM") + "'",
                        localStorage.getItem("URL")
                    );
                    changeDataHomePage(data.D);
                }, 10000);
            }

            function getCurrentTime(time) {
                // Tạo đối tượng Date mới để lấy thời gian hiện tại
                let now;
                if (time) {
                    now = new Date(time);
                } else {
                    now = new Date();
                }

                const ngay = now.getDate(); // Ngày (1-31)
                const thang = now.getMonth() + 1; // Tháng (0-11) nên cần +1
                const nam = now.getFullYear(); // Năm (4 chữ số)
                // Lấy giờ, phút, giây
                const hours = now.getHours();   // Giờ (0-23)
                const minutes = now.getMinutes(); // Phút (0-59)
                const seconds = now.getSeconds(); // Giây (0-59)

                // Định dạng giờ thành dạng HH:MM:SS
                const chuoiNgay = `${ngay.toString().padStart(2, '0')}/${thang.toString().padStart(2, '0')}/${nam}`;
                const currentTime = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

                // Hiển thị giờ hiện tại
                if (time) {
                    document.getElementById("lateDateTime").textContent = chuoiNgay + " " + currentTime;
                }
                return chuoiNgay + " " + currentTime;
            }

            function getIconWorkstation(type) {
                switch (type) {
                    case "NAAM":
                        return '<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" style="color: #fff;" fill="currentColor" viewBox="0 0 640 512"><path d="M294.2 1.2c5.1 2.1 8.7 6.7 9.6 12.1l10.4 62.4c-23.3 10.8-42.9 28.4-56 50.3c-14.6-9-31.8-14.1-50.2-14.1c-53 0-96 43-96 96c0 35.5 19.3 66.6 48 83.2c.8 31.8 13.2 60.7 33.1 82.7l-56 39.2c-4.5 3.2-10.3 3.8-15.4 1.6s-8.7-6.7-9.6-12.1L98.1 317.9 13.4 303.8c-5.4-.9-10-4.5-12.1-9.6s-1.5-10.9 1.6-15.4L52.5 208 2.9 137.2c-3.2-4.5-3.8-10.3-1.6-15.4s6.7-8.7 12.1-9.6L98.1 98.1l14.1-84.7c.9-5.4 4.5-10 9.6-12.1s10.9-1.5 15.4 1.6L208 52.5 278.8 2.9c4.5-3.2 10.3-3.8 15.4-1.6zM208 144c13.8 0 26.7 4.4 37.1 11.9c-1.2 4.1-2.2 8.3-3 12.6c-37.9 14.6-67.2 46.6-77.8 86.4C151.8 243.1 144 226.5 144 208c0-35.3 28.7-64 64-64zm69.4 276c11 7.4 14 22.3 6.7 33.3l-32 48c-7.4 11-22.3 14-33.3 6.7s-14-22.3-6.7-33.3l32-48c7.4-11 22.3-14 33.3-6.7zm96 0c11 7.4 14 22.3 6.7 33.3l-32 48c-7.4 11-22.3 14-33.3 6.7s-14-22.3-6.7-33.3l32-48c7.4-11 22.3-14 33.3-6.7zm96 0c11 7.4 14 22.3 6.7 33.3l-32 48c-7.4 11-22.3 14-33.3 6.7s-14-22.3-6.7-33.3l32-48c7.4-11 22.3-14 33.3-6.7zm96 0c11 7.4 14 22.3 6.7 33.3l-32 48c-7.4 11-22.3 14-33.3 6.7s-14-22.3-6.7-33.3l32-48c7.4-11 22.3-14 33.3-6.7zm74.5-116.1c0 44.2-35.8 80-80 80l-271.9 0c-53 0-96-43-96-96c0-47.6 34.6-87 80-94.6l0-1.3c0-53 43-96 96-96c34.9 0 65.4 18.6 82.2 46.4c13-9.1 28.8-14.4 45.8-14.4c44.2 0 80 35.8 80 80c0 5.9-.6 11.7-1.9 17.2c37.4 6.7 65.8 39.4 65.8 78.7z"/></svg>';
                    case "N":
                        return '<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" style="color: #fff;" fill="currentColor" class="bi bi-moisture" viewBox="0 0 16 16"><path d="M13.5 0a.5.5 0 0 0 0 1H15v2.75h-.5a.5.5 0 0 0 0 1h.5V7.5h-1.5a.5.5 0 0 0 0 1H15v2.75h-.5a.5.5 0 0 0 0 1h.5V15h-1.5a.5.5 0 0 0 0 1h2a.5.5 0 0 0 .5-.5V.5a.5.5 0 0 0-.5-.5zM7 1.5l.364-.343a.5.5 0 0 0-.728 0l-.002.002-.006.007-.022.023-.08.088a29 29 0 0 0-1.274 1.517c-.769.983-1.714 2.325-2.385 3.727C2.368 7.564 2 8.682 2 9.733 2 12.614 4.212 15 7 15s5-2.386 5-5.267c0-1.05-.368-2.169-.867-3.212-.671-1.402-1.616-2.744-2.385-3.727a29 29 0 0 0-1.354-1.605l-.022-.023-.006-.007-.002-.001zm0 0-.364-.343zm-.016.766L7 2.247l.016.019c.24.274.572.667.944 1.144.611.781 1.32 1.776 1.901 2.827H4.14c.58-1.051 1.29-2.046 1.9-2.827.373-.477.706-.87.945-1.144zM3 9.733c0-.755.244-1.612.638-2.496h6.724c.395.884.638 1.741.638 2.496C11 12.117 9.182 14 7 14s-4-1.883-4-4.267"/></svg>';
                    case "M":
                        return '<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" style="color: #fff;" fill="currentColor" class="bi bi-cloud-lightning-rain" viewBox="0 0 16 16"><path d="M2.658 11.026a.5.5 0 0 1 .316.632l-.5 1.5a.5.5 0 1 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.316m9.5 0a.5.5 0 0 1 .316.632l-.5 1.5a.5.5 0 1 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.316m-7.5 1.5a.5.5 0 0 1 .316.632l-.5 1.5a.5.5 0 1 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.316m9.5 0a.5.5 0 0 1 .316.632l-.5 1.5a.5.5 0 1 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.316m-.753-8.499a5.001 5.001 0 0 0-9.499-1.004A3.5 3.5 0 1 0 3.5 10H13a3 3 0 0 0 .405-5.973M8.5 1a4 4 0 0 1 3.976 3.555.5.5 0 0 0 .5.445H13a2 2 0 0 1 0 4H3.5a2.5 2.5 0 1 1 .605-4.926.5.5 0 0 0 .596-.329A4 4 0 0 1 8.5 1M7.053 11.276A.5.5 0 0 1 7.5 11h1a.5.5 0 0 1 .474.658l-.28.842H9.5a.5.5 0 0 1 .39.812l-2 2.5a.5.5 0 0 1-.875-.433L7.36 14H6.5a.5.5 0 0 1-.447-.724z"/></svg>';
                    default:
                        return '<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" style="color: #fff;" fill="currentColor" class="bi bi-cloud" viewBox="0 0 16 16"><path d="M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383m.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z"/></svg>';
                }
            }

            function addItemHistory(item, type) {
                // Tạo phần tử nội dung chính
                if (type) {
                    const element = $(
                        '<div class="iconApp">' +
                        '<div id="App' + item.CodeWorkStation + '" class="icon" style="background-color: #28a745 !important;">' +
                        getIconWorkstation(item.workstationType) +
                        '</div>' +
                        '<div class="info-box-content" style="padding-right: 0">' +
                        '<div class="d-flex justify-content-between">' +
                        '<span class="app-text">' + item.CodeWorkStation + '</span>' +
                        '<span class="app-text" style="padding-right: 0">' + item.date + '</span>' +
                        '</div>' +
                        '<span class="app-text-number" style="padding-right: 0">' + item.NameWorkStation + '</span>' +
                        '</div>' +
                        '</div>'
                    );
                    // Tạo phần tử bao bọc với nút X
                    const totalElement = $(
                        '<div style="padding-bottom: 13px; position: relative;" class="history-item" data-code="' + item.CodeWorkStation + '">' +
                        '</div>'
                    );

                    // Thêm phần tử chính vào phần tử bao bọc
                    totalElement.append(element);
                    // Gắn sự kiện click cho phần tử chính
                    element.on('click', function () {
                        handleItemCategoryClick(item);
                    });
                    if (type == 'category') {
                        historyListCategoryDetail.append(totalElement);
                    } else {
                        historyListCategoryAdd.append(totalElement);
                    }
                } else {
                    const element = $(
                        '<div class="iconApp">' +
                        '<div id="App' + item.CodeWorkStation + '" class="icon" style="background-color: #28a745 !important; display: block">' +
                            '<div id="Value' + item.CodeWorkStation + '" style="background-color: #1052e7; width: 70px; height: 20px;font-size: 12px;color: #fff; border-radius: 4px 4px 0 0;">0 mm</div>'+
                        getIconWorkstation(item.workstationType) +
                        '</div>' +
                        '<div class="info-box-content" style="padding-right: 0">' +
                        '<div class="d-flex justify-content-between">' +
                        '<span class="app-text">' + item.CodeWorkStation + '</span>' +
                        '<span class="app-text" style="padding-right: 0">' + item.date + '</span>' +
                        '</div>' +
                        '<span class="app-text-number" style="padding-right: 0">' + item.NameWorkStation + '</span>' +
                        '</div>' +
                        '</div>'
                    );
                    // Tạo phần tử bao bọc với nút X
                    const totalElement = $(
                        '<div style="padding-bottom: 13px; position: relative;" class="history-item" data-code="' + item.CodeWorkStation + '">' +
                        '<div class="close-icon">' +
                        '<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-x" viewBox="0 0 16 16">' +
                        '<path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>' +
                        '</svg>' +
                        '</div>' +
                        '</div>'
                    );

                    // Thêm phần tử chính vào phần tử bao bọc
                    totalElement.append(element);

                    // Gắn sự kiện click cho nút X
                    totalElement.find('.close-icon').on('click', function (e) {
                        e.stopPropagation(); // Ngăn chặn sự kiện click lan đến phần tử chính

                        // Hiển thị popup xác nhận
                        const confirmDelete = confirm(`Bạn có chắc chắn muốn xóa trạm "${item.NameWorkStation} [${item.CodeWorkStation}]" không?`);
                        if (confirmDelete) {
                            totalElement.remove(); // Xóa phần tử nếu người dùng chọn "Có"
                            historyItems = historyItems.filter(i => i.CodeWorkStation !== item.CodeWorkStation);
                            localStorage.setItem('dataHistory', JSON.stringify(historyItems));
                            toastr.success(`Trạm "${item.CodeWorkStation}" đã bị xóa!`);
                            if (historyItems.length == 0) {
                                showAddWorkStationButton(); // Ẩn nút nếu có ít nhất 1 phần tử
                            }
                        }
                    });

                    // Gắn sự kiện click cho phần tử chính
                    element.on('click', function () {
                        handleItemClick(item);
                    });

                    // Thêm phần tử vào danh sách lịch sử

                    historyListDetail.append(totalElement);
                }

            }

            $(document).ready(function () {
                $(".toggle-button").click(function () {
                    // Lấy danh sách con gần nhất (nếu có)
                    const childList = $(this).siblings(".child-list");

                    // Toggle hiển thị/ẩn danh sách con
                    childList.slideToggle(200);

                    // Xoay icon mũi tên
                    const arrowIcon = $(this).find(".arrow-icon");
                    arrowIcon.toggleClass("expanded");

                    if (arrowIcon.hasClass("expanded")) {
                        arrowIcon.css("transform", "rotate(90deg)");
                    } else {
                        arrowIcon.css("transform", "rotate(0deg)");
                    }
                });
            });

            function addItemCategory(item, type) {
                let element = ''
                for (let i = 0; i < item.itemCategory.length; i++) {
                    element += '<li>' +
                        '<div style="position: relative;" class="history-item" data-code="' + item.itemCategory[i].CodeWorkStation + '">' +
                        '<div class="iconApp">' +
                        '<div id="App' + item.itemCategory[i].CodeWorkStation + '" class="icon" style="background-color: #28a745 !important;">' +
                        getIconWorkstation(item.itemCategory[i].workstationType) +
                        '</div>' +
                        '<div class="info-box-content" style="padding-right: 0">' +
                        '<div class="d-flex justify-content-between">' +
                        '<span class="app-text">' + item.itemCategory[i].CodeWorkStation + '</span>' +
                        '<span class="app-text" style="padding-right: 0">' + item.itemCategory[i].date + '</span>' +
                        '</div>' +
                        '<span class="app-text-number" style="padding-right: 0">' + item.itemCategory[i].NameWorkStation + '</span>' +
                        '</div>' +
                        '</div>' +
                        '</div>' +
                        '</li>'
                }

                element += '<li>' +
                    '<div  style="width: 100%;">' +
                    '<button class="btnRemoveCategory btn btn-danger" style="width: 100%; height: 35px; color: #fff; padding: 3px 10px;">Xoá danh mục</button>' +
                    '</div>' +
                    '</li>'
                // Tạo phần tử bao bọc với nút X
                const totalElement = $(
                    '<li class="parent-item">' +
                    '<button class="toggle-button">' +
                    '<div>' +
                    '<h4 style="margin: 0;">' + item.NameCategory + '</h4>' +
                    '<p style="margin: 10px 0 0 0; font-size: 14px; font-weight: 300;">Danh mục có ' + item.itemCategory.length + ' trạm</p>' +
                    '</div>' +
                    '<span class="arrow-icon">▶</span>' +
                    '</button>' +
                    '<ul class="child-list">' +
                    element +
                    '</ul>' +
                    '</li>'
                );

                // Thêm phần tử chính vào phần tử bao bọc
                // totalElement.append(element);

                // Gắn sự kiện click cho nút X
                // totalElement.find('.close-icon').on('click', function (e) {
                //     e.stopPropagation(); // Ngăn chặn sự kiện click lan đến phần tử chính

                //     // Hiển thị popup xác nhận
                //     const confirmDelete = confirm(`Bạn có chắc chắn muốn xóa danh mục "${item.NameCategory}" không?`);
                //     if (confirmDelete) {
                //         totalElement.remove(); // Xóa phần tử nếu người dùng chọn "Có"
                //         DataCategory = DataCategory.filter(i => i.NameCategory !== item.NameCategory);
                //         localStorage.setItem('dataCategory', JSON.stringify(DataCategory));
                //         toastr.success(`Danh mục "${item.NameCategory}" đã bị xóa!`);
                //         if (DataCategory.length == 0) {
                //             showAddCategoryButton();
                //         }
                //     }
                // }); 

                totalElement.find('.toggle-button').on('click', function (e) {
                    e.preventDefault(); // Ngăn chặn hành động mặc định của thẻ <a>

                    // Lấy danh sách con gần nhất (nếu có)
                    const childList = $(this).siblings(".child-list");

                    // Toggle hiển thị/ẩn danh sách con
                    childList.slideToggle(200);

                    // Xoay icon mũi tên
                    const arrowIcon = $(this).find(".arrow-icon");
                    arrowIcon.toggleClass("expanded");

                    if (arrowIcon.hasClass("expanded")) {
                        arrowIcon.css("transform", "rotate(90deg)");
                    } else {
                        arrowIcon.css("transform", "rotate(0deg)");
                    }
                });

                totalElement.find('.btnRemoveCategory').on('click', function (e) {
                    e.preventDefault(); // Ngăn chặn hành động mặc định của thẻ <a>
                    const confirmDelete = confirm(`Bạn có chắc chắn muốn xóa danh mục "${item.NameCategory}" không?`);
                    if (confirmDelete) {
                        totalElement.remove(); // Xóa phần tử nếu người dùng chọn "Có"
                        DataCategory = DataCategory.filter(i => i.NameCategory !== item.NameCategory);
                        localStorage.setItem('dataCategory', JSON.stringify(DataCategory));
                        toastr.success(`Danh mục "${item.NameCategory}" đã bị xóa!`);
                        if (DataCategory.length == 0) {
                            showAddCategoryButton();
                        }
                    }
                });

                // Gắn sự kiện click cho phần tử chính
                // element.on('click', function () {
                //     // handleItemClick(item);
                // });

                // Thêm phần tử vào danh sách lịch sử

                listCategory.append(totalElement);
            }
            function showAddCategoryButton() {
                const buttonHTML = $(
                    '<div class="col-12" style="margin-top: 10px; display: flex; justify-content: center; align-items: center;">' +
                    '<button id="addCategory" style="width: 200px; height: 200px; border-radius: 50%; border: 1px dashed #fff; background-color: #1E2833; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #fff; font-size: 14px; text-align: center;">' +
                    '<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" style="color: #fff; margin-bottom: 8px;" fill="currentColor" class="bi bi-plus" viewBox="0 0 16 16">' +
                    '<path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"/>' +
                    '</svg>' +
                    'Tạo mới danh mục trạm.' +
                    '</button>' +
                    '</div>'
                );
                document.getElementById("btnAddCategory").classList.add("d-none");
                buttonHTML.on('click', function () {

                    OpenAddCategory();
                });
                listCategory.append(buttonHTML);
            }

            function showAddWorkStationButton() {
                const buttonHTML = $(
                    '<div style="margin-top: 10px; display: flex; justify-content: center; align-items: center;">' +
                    '<button id="addWorkStation" style="width: 200px; height: 200px; border-radius: 50%; border: 1px dashed #fff; background-color: #1E2833; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #fff; font-size: 14px; text-align: center;">' +
                    '<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" style="color: #fff; margin-bottom: 8px;" fill="currentColor" class="bi bi-plus" viewBox="0 0 16 16">' +
                    '<path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"/>' +
                    '</svg>' +
                    'Thêm trạm quan trắc' +
                    '</button>' +
                    '</div>'
                );
                buttonHTML.on('click', function () {
                    changeQRcode()
                });
                historyListDetail.append(buttonHTML); // Giả sử bạn có một div với id "addWorkStationContainer" để chứa nút này
            }

            // click ở trang lịch sử để truy cập
            function handleItemClick(item) {
                stopInterval()
                localStorage.setItem("URL", "https://" + item.domain + "/Service/Service.svc");
                document.getElementById("footer-stationName").textContent = item.CodeWorkStation + " - " + item.NameWorkStation;
                localStorage.setItem("MATRAM", item.CodeWorkStation);
                const itemHistory = { 'CodeWorkStation': item.CodeWorkStation, 'NameWorkStation': item.NameWorkStation, 'domain': item.domain, 'date': getCurrentTime(), 'workstationType': item.workstationType }
                localStorage.setItem('itemHistory', JSON.stringify(itemHistory));
                $("#loading-popup").modal({
                    fadeDuration: 250,
                    escapeClose: false,
                    clickClose: false,
                    showClose: false
                });
                truyCap();
            }

            function handleItemCategoryClick(item) {
                const itemHistory = { 'CodeWorkStation': item.CodeWorkStation, 'NameWorkStation': item.NameWorkStation, 'domain': item.domain, 'date': getCurrentTime(), 'workstationType': item.workstationType }
                CategoryItems = JSON.parse(localStorage.getItem('listItemCategory'));
                let filterItem = []
                if (CategoryItems) {
                    filterItem = CategoryItems.filter(itemdetail => itemdetail.CodeWorkStation === item.CodeWorkStation);
                }
                if (filterItem.length > 0) {
                    CategoryItems = CategoryItems.filter(itemdetail => itemdetail.CodeWorkStation !== item.CodeWorkStation);
                    localStorage.setItem('listItemCategory', JSON.stringify(CategoryItems));

                    historyListCategoryAdd.empty();
                    for (let i = CategoryItems.length - 1; i >= 0; i--) {
                        addItemHistory(CategoryItems[i], 'add');
                    }
                } else {
                    if (CategoryItems) {
                        CategoryItems = CategoryItems.filter(itemdetail => itemdetail.CodeWorkStation !== item.CodeWorkStation);
                        CategoryItems.push(itemHistory);
                        if (CategoryItems.length > 20) {
                            CategoryItems.shift();
                        }
                    } else {
                        CategoryItems = [];
                        CategoryItems.push(itemHistory);
                    }
                    localStorage.setItem('listItemCategory', JSON.stringify(CategoryItems));

                    if (CategoryItems && CategoryItems.length > 0) {
                        historyListCategoryAdd.empty();
                        for (let i = CategoryItems.length - 1; i >= 0; i--) {
                            addItemHistory(CategoryItems[i], 'add');
                        }
                    }
                }
                showHistoryCategory()
            }

            var ZONE_PROPERTY;
            var ZONE_UNIT;
            // chạy Interval để check trạng thái hoạt động
            async function startInterval() {
                // Chạy setInterval nếu chưa chạy
                
                if (!intervalId) {
                    ZONE_PROPERTY = 'RD';
                    ZONE_UNIT = ' mm';
                    for (let i = historyItems.length - 1; i >= 0; i--) {
                        const data = await getNewData(
                            historyItems[i].CodeWorkStation,
                            "WORKSTATION_ID='" + historyItems[i].CodeWorkStation + "'",
                            "https://" + historyItems[i].domain + "/Service/Service.svc"
                        );
                        let filteredItems = data.D.filter(item => item.ZONE_ADDRESS === historyItems[i].CodeWorkStation);

                        if (filteredItems.length != 0) {
                            if (historyItems[i].workstationType == "NAAM") {
                                const dataRD = filteredItems.filter(item => item.ZONE_PROPERTY === ZONE_PROPERTY);
                                if(dataRD.length != 0){
                                    document.getElementById('Value' + historyItems[i].CodeWorkStation).textContent = dataRD[0].ZONE_VALUE/10 + ZONE_UNIT
                                }
                            } else if (historyItems[i].workstationType == "N") {
                                const dataRD = filteredItems.filter(item => item.ZONE_PROPERTY === 'RN');
                                if(dataRD.length != 0){
                                    document.getElementById('Value' + historyItems[i].CodeWorkStation).textContent = dataRD[0].ZONE_VALUE + " cm"
                                }
                            } else if (historyItems[i].workstationType == "M") {
                                const dataRD = filteredItems.filter(item => item.ZONE_PROPERTY === 'RD');
                                if(dataRD.length != 0){
                                    document.getElementById('Value' + historyItems[i].CodeWorkStation).textContent = dataRD[0].ZONE_VALUE/10 + " mm"
                                }
                            } else if (historyItems[i].workstationType == "MS") {
                                const dataRD = filteredItems.filter(item => item.ZONE_PROPERTY === 'RD');
                                if(dataRD.length != 0){
                                    document.getElementById('Value' + historyItems[i].CodeWorkStation).textContent = dataRD[0].ZONE_VALUE/10 + " mm"
                                }
                            }
                            const now = new Date();
                            const dataRA = filteredItems.filter(item => item.ZONE_PROPERTY === 'RA');
                            const providedTime = new Date(dataRA[0].DATE_CREATE);
                            const differenceInMilliseconds = now.getTime() - providedTime.getTime();
                            const checkTimeOnline = differenceInMilliseconds / (1000 * 60)
                            if (checkTimeOnline < 15) {
                                const button = document.getElementById('App' + historyItems[i].CodeWorkStation);
                                if (button) {
                                    button.style.backgroundColor = "#28a745";
                                }
                            } else {
                                const button = document.getElementById('App' + historyItems[i].CodeWorkStation);
                                if (button) {
                                    button.style.backgroundColor = "#da4a58";
                                }
                            }
                        } else {
                            const button = document.getElementById('App' + historyItems[i].CodeWorkStation);
                            if (button) {
                                button.style.backgroundColor = "#da4a58";
                            }
                        }
                    }
                    intervalId = setInterval(async () => {
                        if(ZONE_PROPERTY == 'RD'){
                            ZONE_PROPERTY = 'RT'
                            ZONE_UNIT = ' °C'
                        } else if(ZONE_PROPERTY == 'RT'){
                            ZONE_PROPERTY = 'RH'
                            ZONE_UNIT = ' %'
                        } else if(ZONE_PROPERTY == 'RH'){
                            ZONE_PROPERTY = 'RP'
                            ZONE_UNIT = ' hPa'
                        } else if(ZONE_PROPERTY == 'RP'){
                            ZONE_PROPERTY = 'RD'
                            ZONE_UNIT = ' mm'
                        }
                        for (let i = historyItems.length - 1; i >= 0; i--) {
                            const data = await getNewData(
                                historyItems[i].CodeWorkStation,
                                "WORKSTATION_ID='" + historyItems[i].CodeWorkStation + "'",
                                "https://" + historyItems[i].domain + "/Service/Service.svc"
                            );
                            let filteredItems = data.D.filter(item => item.ZONE_ADDRESS === historyItems[i].CodeWorkStation);

                                if (filteredItems.length != 0) {
                                    if (historyItems[i].workstationType == "NAAM") {
                                    const dataRD = filteredItems.filter(item => item.ZONE_PROPERTY === ZONE_PROPERTY);
                                    if(dataRD.length != 0){
                                        document.getElementById('Value' + historyItems[i].CodeWorkStation).textContent = dataRD[0].ZONE_VALUE/10 + ZONE_UNIT
                                    } else {
                                        document.getElementById('Value' + historyItems[i].CodeWorkStation).textContent = '0 mm';
                                    }
                                } else if (historyItems[i].workstationType == "N") {
                                    const dataRD = filteredItems.filter(item => item.ZONE_PROPERTY === 'RN');
                                    if(dataRD.length != 0){
                                        document.getElementById('Value' + historyItems[i].CodeWorkStation).textContent = dataRD[0].ZONE_VALUE + " cm"
                                    }
                                } else if (historyItems[i].workstationType == "M") {
                                    const dataRD = filteredItems.filter(item => item.ZONE_PROPERTY === 'RD');
                                    if(dataRD.length != 0){
                                        document.getElementById('Value' + historyItems[i].CodeWorkStation).textContent = dataRD[0].ZONE_VALUE/10 + " mm"
                                    }
                                } else if (historyItems[i].workstationType == "MS") {
                                    const dataRD = filteredItems.filter(item => item.ZONE_PROPERTY === 'RD');
                                    if(dataRD.length != 0){
                                        document.getElementById('Value' + historyItems[i].CodeWorkStation).textContent = dataRD[0].ZONE_VALUE/10 + " mm"
                                    }
                                }
                                const now = new Date();
                                const dataRA = filteredItems.filter(item => item.ZONE_PROPERTY === 'RA');
                                const providedTime = new Date(dataRA[0].DATE_CREATE);
                                const differenceInMilliseconds = now.getTime() - providedTime.getTime();
                                const checkTimeOnline = differenceInMilliseconds / (1000 * 60);
                                if (checkTimeOnline < 15) {
                                    const button = document.getElementById('App' + historyItems[i].CodeWorkStation);
                                    if (button) {
                                        button.style.backgroundColor = "#28a745";
                                    }
                                } else {
                                    const button = document.getElementById('App' + historyItems[i].CodeWorkStation);
                                    if (button) {
                                        button.style.backgroundColor = "#da4a58";
                                    }
                                }
                            } else {
                                const button = document.getElementById('App' + historyItems[i].CodeWorkStation);
                                if (button) {
                                    button.style.backgroundColor = "#da4a58";
                                }
                            }
                        }
                    }, 10000);
                }
            }

            function stopInterval() {
                // Xóa interval nếu đang chạy
                if (intervalId) {
                    clearInterval(intervalId);
                    intervalId = null;
                }
            }

            $('#search-category').on('change', function () {
                const searchValue = $(this).val().toLowerCase();
                showHistoryCategory(searchValue)
            });
            // hiển thị dữ liệu lịch sử truy cập 
            function showHistory(type) {
                if(type == "ADD"){
                    document.getElementById("history-setting").classList.remove("d-none");
                    document.getElementById("history-homePage").classList.add("d-none");
                    OpenAddCategory()
                } else {
                    historyItems = JSON.parse(localStorage.getItem('dataHistory'));
                    DataCategory = JSON.parse(localStorage.getItem('dataCategory'));
                    let arrayCategory = [];
                    arrayCategory.push("ADD");
                    if (DataCategory) {
                        if (DataCategory.length > 0) {
                            for (let i = DataCategory.length - 1; i >= 0; i--) {
                                if (!arrayCategory.includes(DataCategory[i].NameCategory)) { // Kiểm tra nếu phần tử chưa có trong mảng
                                    arrayCategory.push(DataCategory[i].NameCategory);
                                }
                            }
                        }
                    }
                    if (type) {
                        if (DataCategory) {
                            DataCategory = DataCategory.filter(item => item.NameCategory == type);
                        } else {
                            DataCategory = []
                        }
                        if (type != "ALL" && DataCategory.length == 0) {
                            historyItems = historyItems.filter(item => item.workstationType === type);
                        } else if (DataCategory) {
                            if (DataCategory.length > 0) {
                                let arrayWostation = [];
                                for (let i = DataCategory[0].itemCategory.length - 1; i >= 0; i--) {
                                    const filterHistoryItems = historyItems.filter(item => item.CodeWorkStation === DataCategory[0].itemCategory[i].CodeWorkStation);
                                    arrayWostation.push(filterHistoryItems[0]);
                                }
                                historyItems = arrayWostation;
                            }
                        }
                    }
                    if (historyItems && historyItems.length > 0) {
                        historyListDetail.empty();
                        for (let i = historyItems.length - 1; i >= 0; i--) {
                            addItemHistory(historyItems[i]);
                            if (!arrayCategory.includes(historyItems[i].workstationType)) { // Kiểm tra nếu phần tử chưa có trong mảng
                                arrayCategory.push(historyItems[i].workstationType);
                            }
                        }
                        arrayCategory.push("ALL");
                        if (!type) {
                            const selectElement = $('#historySelect');
                            selectElement.empty();
                            for (let i = arrayCategory.length - 1; i >= 0; i--) {
                                const selectElement = document.getElementById("historySelect");
                                const newOption = document.createElement("option");
                                let value;
                                let text;
                                if (arrayCategory[i] == "NAAM") {
                                    value = arrayCategory[i]
                                    text = "Trạm Mưa, nhiệt, ẩm, áp"
                                } else if (arrayCategory[i] == "N") {
                                    value = arrayCategory[i]
                                    text = "Trạm mực nước"
                                } else if (arrayCategory[i] == "M") {
                                    value = arrayCategory[i]
                                    text = "Trạm Mưa"
                                } else if (arrayCategory[i] == "MS") {
                                    value = arrayCategory[i]
                                    text = "Trạm Mưa, sóng"
                                } else if (arrayCategory[i] == "ALL") {
                                    value = arrayCategory[i]
                                    text = "Tất cả trạm"
                                } else if (arrayCategory[i] == "ADD") {
                                    value = arrayCategory[i]
                                    text = " + Thêm danh mục mới"
                                    newOption.className = "custom-option";
                                } else {
                                    value = arrayCategory[i]
                                    text = arrayCategory[i]
                                }
                                newOption.value = value; // Giá trị mới
                                newOption.text = text; // Văn bản mới
                                selectElement.appendChild(newOption); // Thêm vào danh sách select
                            }
                        }
                        startInterval();
                    }
                }
            }

            function showHistoryCategory(type) {
                historyItems = JSON.parse(localStorage.getItem('dataHistory'));
                CategoryItems = JSON.parse(localStorage.getItem('listItemCategory'));
                if (type) {
                    historyItems = historyItems.filter(item =>
                        item.CodeWorkStation.includes(type) ||
                        item.NameWorkStation.toLowerCase().includes(type)
                    );
                }
                if (CategoryItems) {
                    for (let i = 0; i < CategoryItems.length; i++) {
                        historyItems = historyItems.filter(item => item.CodeWorkStation != CategoryItems[i].CodeWorkStation);
                    }
                }
                if (historyItems) {
                    historyListCategoryDetail.empty();
                    for (let i = historyItems.length - 1; i >= 0; i--) {
                        addItemHistory(historyItems[i], 'category');
                    }
                }
            }

            function showCategory(type) {
                DataCategory = JSON.parse(localStorage.getItem('dataCategory'));
                if (DataCategory) {
                    if (DataCategory.length > 0) {
                        document.getElementById("btnAddCategory").classList.remove("d-none");
                        listCategory.empty();
                        for (let i = DataCategory.length - 1; i >= 0; i--) {
                            addItemCategory(DataCategory[i], 'category');
                        }
                    }
                }
            }
            // lưu lịch sử
            function saveHistory(code) {
                historyItems = JSON.parse(localStorage.getItem('dataHistory'));
                if (historyItems) {
                    historyItems = historyItems.filter(item => item.CodeWorkStation !== code);
                    const item = JSON.parse(localStorage.getItem('itemHistory'));
                    historyItems.push(item);
                    if (historyItems.length > 20) {
                        historyItems.shift();
                    }
                } else {
                    historyItems = [];
                    const item = JSON.parse(localStorage.getItem('itemHistory'));
                    historyItems.push(item);
                }

                localStorage.setItem('dataHistory', JSON.stringify(historyItems));
            }

            function saveCategory() {
                const inputValue = $('#name-category').val();
                if (inputValue) {
                    const item = JSON.parse(localStorage.getItem('listItemCategory'));
                    let itemCategory = { 'NameCategory': inputValue, 'itemCategory': item }
                    DataCategory = JSON.parse(localStorage.getItem('dataCategory'));
                    if (DataCategory) {
                        const checkInput = DataCategory.filter(item => item.NameCategory === inputValue);
                        if (checkInput.length > 0) {
                            const confirmEDIT = confirm(`Danh mục "${inputValue}" đã tồn tại, xác nhận có muốn thêm những trạm đã chọn chưa nằm trong danh mục hay không?`);
                            if(confirmEDIT){
                                itemCategory.itemCategory.forEach(item2 => {
                                    const exists = checkInput[0].itemCategory.some(item1 => item1.CodeWorkStation === item2.CodeWorkStation);
                                    if (!exists) {
                                        checkInput[0].itemCategory.push(item2);
                                    }
                                });
                                DataCategory = DataCategory.filter(item => item.NameCategory !== inputValue);
                                DataCategory.push(checkInput[0]);
                                localStorage.setItem('dataCategory', JSON.stringify(DataCategory));
                                document.getElementById("list-category").classList.remove("d-none");
                                document.getElementById("save-category").classList.add("d-none");
                                $('#name-category').val('');
                                $('#search-category').val('');
                                localStorage.setItem('listItemCategory', JSON.stringify([]));
                                historyListCategoryAdd.empty();
                                showCategory()
                            }
                        } else if (item.length == 0) {
                            toastr.error("Vui lòng chọn trạm để thêm vào danh mục!");
                        } else {
                            if (DataCategory) {
                                DataCategory.push(itemCategory);
                                if (DataCategory.length > 20) {
                                    DataCategory.shift();
                                }
                            } else {
                                DataCategory = [];
                                DataCategory.push(itemCategory);
                            }
                            localStorage.setItem('dataCategory', JSON.stringify(DataCategory));
                            document.getElementById("list-category").classList.remove("d-none");
                            document.getElementById("save-category").classList.add("d-none");
                            $('#name-category').val('');
                            $('#search-category').val('');
                            localStorage.setItem('listItemCategory', JSON.stringify([]));
                            historyListCategoryAdd.empty();
                            showCategory()
                        }
                    } else {
                        DataCategory = [];
                        DataCategory.push(itemCategory);
                        localStorage.setItem('dataCategory', JSON.stringify(DataCategory));
                        document.getElementById("list-category").classList.remove("d-none");
                        document.getElementById("save-category").classList.add("d-none");
                        $('#name-category').val('');
                        $('#search-category').val('');
                        localStorage.setItem('listItemCategory', JSON.stringify([]));
                        historyListCategoryAdd.empty();
                        showCategory()
                    }

                } else {
                    toastr.error("Vui lòng nhập tên danh mục!");
                }
            }
            // update data của trang chính xem dữ liệu
            function changeDataHomePage(data) {
                if (data != [] && data != null && data != '') {
                    let checkRD = false;
                    let checkRT = false;
                    let filteredItems = data.filter(item => item.ZONE_ADDRESS === localStorage.getItem('MATRAM'));
                    console.log(filteredItems);
                    
                    for (let i = 0; i < filteredItems.length; i++) {
                        if (filteredItems[i].ZONE_PROPERTY == "RT") {
                            checkRT = true;
                            document.getElementById("RT").textContent = filteredItems[i].ZONE_VALUE / 10 + " °C";
                            setRangeValue(filteredItems[i].ZONE_VALUE / 10, "success")
                        } else if (filteredItems[i].ZONE_PROPERTY == "RH") {
                            document.getElementById("RH").textContent = filteredItems[i].ZONE_VALUE / 10 + " %";
                        } else if (filteredItems[i].ZONE_PROPERTY == "RA") {
                            document.getElementById("energy").textContent = filteredItems[i].ZONE_VALUE / 10 + " V";
                            // updateProgressBar("acQuy-bar",0, 50, filteredItems[i].ZONE_VALUE / 10, "v")
                            getCurrentTime(filteredItems[i].DATE_CREATE);
                            const now = new Date();
                            const providedTime = new Date(filteredItems[i].DATE_CREATE);
                            const differenceInMilliseconds = now.getTime() - providedTime.getTime();
                            const checkTimeOnline = differenceInMilliseconds / (1000 * 60)
                            if (checkTimeOnline < 15) {
                                document.getElementById("status").style.background = "green";
                                document.getElementById("text-status").textContent = "Đang hoạt động";
                                document.getElementById("status").classList.add('blinking'); // Thêm class nhấp nháy

                                // Dừng nhấp nháy sau 3 giây
                                setTimeout(() => {
                                    document.getElementById("status").classList.remove('blinking'); // Xóa class nhấp nháy
                                }, 3000);
                            } else {
                                document.getElementById("status").style.background = "red";
                                document.getElementById("text-status").textContent = "Ngừng hoạt động";
                            }
                            // document.getElementById("RA").textContent = filteredItems[i].ZONE_VALUE / 10 ;
                        } else if (filteredItems[i].ZONE_PROPERTY == "RP") {
                            document.getElementById("RP").textContent = filteredItems[i].ZONE_VALUE / 10 + " hPa";
                        } else if (filteredItems[i].ZONE_PROPERTY == "RD") {
                            checkRD = true;
                            document.getElementById("RD").textContent = filteredItems[i].ZONE_VALUE / 10 + " mm ";
                            document.getElementById("glass").style.background = "url(https://s3-us-west-2.amazonaws.com/s.cdpn.io/54046/glass_droplets.jpeg) center center / cover no-repeat";
                            document.getElementById("lastTimeRain").textContent = " ("+getCurrentTime(filteredItems[i].DATE_CREATE).substring(11)+")";
                            // const color = getColor(filteredItems[i].ZONE_VALUE / 10);
                            // changeColorAndText(color, color, filteredItems[i].ZONE_VALUE / 10);
                            // updateProgressBar("rain-bar", -500, 500, (filteredItems[i].LAST_VALUE / 10), "mm");
                        } else if (filteredItems[i].ZONE_PROPERTY == "RN") {
                            checkRD = true;
                            document.getElementById("RN").textContent = filteredItems[i].ZONE_VALUE + " cm";
                        }
                        if (checkRT == false) {
                            setRangeValue(0)
                        }
                        if (checkRD == false) {
                            const now = new Date();
                            const hours = String(now.getHours()).padStart(2, '0');
                            if(hours < 18 && hours > 6){
                                document.getElementById("glass").style.background = "url(https://i.pinimg.com/736x/9d/1e/b3/9d1eb31563d0694c0eccd2724b5410a9.jpg) center center / cover no-repeat";
                            } else {
                                document.getElementById("landscape").classList.add("d-none");
                                document.getElementById("glass").style.background = "url(https://i.pinimg.com/736x/43/d4/5d/43d45ddb855463920c7505f846bf2900.jpg) center center / cover no-repeat";
                            }
                            
                        }
                    }
                } else {
                    const path = document.querySelector("#mySvg path");
                    path.setAttribute("fill", "#007bff");
                }
                $('#loading-popup').modal('hide');
            }


            if (maTram != "") {
                getDataMonitoring();
                document.getElementById("ScanQR").classList.add("hidden");
                document.getElementById("homePage").classList.remove("hidden");
            }

            function formatDateTime(date) {
                const now = new Date(date);

                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const seconds = String(now.getSeconds()).padStart(2, '0');

                const formattedDatetime = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
                return formattedDatetime
            }
            var checkCam = true;
            // call api getnewdata lấy data mới nhất
            function getNewData(workstation, c, url) {
                return new Promise((resolve, reject) => {
                    $.ajax({
                        url: url + "/GetNewData?w=" + workstation,
                        type: "GET",
                        dataType: "jsonp",
                        contentType: "application/json; charset=utf-8",
                        success: function (msg) {
                            try {
                                let state = JSON.parse(msg);
                                resolve(state); // Trả về dữ liệu khi thành công
                            } catch (error) {
                                reject(error); // Bắt lỗi nếu JSON parse thất bại
                            }
                        },
                        complete: function (data) {
                            // Có thể thêm xử lý khi request hoàn thành ở đây nếu cần
                        },
                        error: function (e, t, x) {
                            document.getElementById("result-form-total").classList.remove("d-none");
                            document.getElementById("result-form-loading").classList.add("d-none");
                            document.getElementById("result-form").classList.remove("d-none");
                            document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
                            document.getElementById("result-form-title").classList.remove("d-none");
                            document.getElementById("result-form-stationID").classList.add("d-none");
                            document.getElementById("result-form-stationName").classList.add("d-none");
                            document.getElementById("result-truycap").classList.add("d-none");
                            //toastr.error("Vui lòng quét đúng mã QR!");
                        },
                    });
                });
            }

            function getDayMessage(type) {
                switch (type) {
                    case "NAAM":
                        return 'RD-RT-RH-RP';
                    case "N":
                        return 'RN---';
                    case "M":
                        return 'RD---';
                    case "MS":
                        return 'RD---';
                    default:
                        return "";
                }
            }

            // lọc theo ngày, tháng, năm
            async function clickGetData(type) {
                if (lineBarChart != null) {
                    lineBarChart.destroy();
                    document.getElementById("loading-spinner").classList.remove("d-none");
                }
                const item = JSON.parse(localStorage.getItem('itemHistory'));
                const TypeWorkstation = getDayMessage(item.workstationType);

                if (type == 'NGAY') {
                    const dataChart = await getDataChart('NGAY', '', '', TypeWorkstation, localStorage.getItem("MATRAM"), localStorage.getItem("URL"));

                    if (dataChart != []) {
                        createChartData(dataChart, 'RD', type)
                    }
                } else if (type == 'TUAN') {
                    const dataChart = await getDataChart('TUAN', '', '', TypeWorkstation, localStorage.getItem("MATRAM"), localStorage.getItem("URL"));
                    if (dataChart != []) {
                        createChartData(dataChart, 'RD', type)
                    }
                } else if (type == 'THANG') {
                    const dataChart = await getDataChart('THANG', '', '', TypeWorkstation, localStorage.getItem("MATRAM"), localStorage.getItem("URL"));
                    if (dataChart != []) {
                        createChartData(dataChart, 'RD', type)
                    }
                } else if (type == 'NAM') {
                    const dataChart = await getDataChart('NAM', '2024-01-01 16$50$08', '2024-12-30 16$50$08', TypeWorkstation, localStorage.getItem("MATRAM"), localStorage.getItem("URL"));
                    if (dataChart != []) {
                        createChartData(dataChart, 'RD', type)
                    }
                }
            }
            //call api GetDataWorkStation lấy dữ liệu của WorkStation được chỉ định
            function getDataStation(workstationID, domain) {

                return new Promise((resolve, reject) => {
                    $.ajax({
                        url: "https://" + domain + "/Service/Service.svc/ApiServicePublic/" + "GetDataWorkStation" + "/" + "WORKSTATION_ID='" + workstationID + "'",
                        type: "GET",
                        dataType: "jsonp",
                        contentType: "application/json; charset=utf-8",
                        success: function (msg) {
                            try {
                                let state = JSON.parse(msg);
                                if (state != [] && state != "" && state != null && state.length != 0 && state.length != undefined) {
                                    const item = { 'CodeWorkStation': workstationID, 'NameWorkStation': state[0].WORKSTATION_NAME, 'domain': domain, 'date': getCurrentTime(), 'workstationType': state[0].TEMPLATE_TOOLTIP }
                                    localStorage.setItem('itemHistory', JSON.stringify(item));
                                }
                                resolve(state); // Trả về dữ liệu khi thành công
                            } catch (error) {
                                reject(error); // Bắt lỗi nếu JSON parse thất bại
                            }
                        },
                        complete: function (data) {
                            // Có thể thêm xử lý khi request hoàn thành ở đây nếu cần
                        },
                        error: function (e, t, x) {
                            // document.getElementById("result-form").classList.remove("d-none");
                            // document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
                            // toastr.error("Vui lòng quét đúng mã QR của trạm mưa");
                        },
                    });
                });

            }

            //call api GetDataFilterLogzone
            function getDataChart(typeTime, start, end, type, zone, url) {

                const Url = "https://DEV.HOMEOS.vn/service/service.svc/";

                return new Promise((resolve, reject) => {
                    $.ajax({
                        url: url + "/ApiServicePublic/" + "GetDataFilterLogzone" + "/" + "TYPE_TIME='" + typeTime + "',START_DATE='" + start + "',END_DATE='" + end + "',TYPE_VALUE='" + type + "',ZONE_ADDRESS='" + zone + "'",
                        type: "GET",
                        dataType: "jsonp",
                        contentType: "application/json; charset=utf-8",
                        success: function (msg) {
                            try {
                                let state = JSON.parse(msg);
                                resolve(state); // Trả về dữ liệu khi thành công
                            } catch (error) {
                                reject(error); // Bắt lỗi nếu JSON parse thất bại
                            }
                        },
                        complete: function (data) {
                            // Có thể thêm xử lý khi request hoàn thành ở đây nếu cần
                        },
                        error: function (e, t, x) {
                            toastr.error("Lấy dữ liệu bị lỗi vui lòng thử lại sau!");
                        },
                    });
                });
            }

            function checkTypeWorkstation() {
                document.getElementById("box-RT").classList.add("d-none");
                document.getElementById("box-RH").classList.add("d-none");
                document.getElementById("box-RD").classList.add("d-none");
                document.getElementById("box-RD").classList.add("col-6");
                document.getElementById("box-RD").classList.remove("col-12");
                document.getElementById("box-RP").classList.add("d-none");
                document.getElementById("box-RN").classList.add("d-none");
                document.getElementById("box-RN").classList.add("col-6");
                document.getElementById("box-RN").classList.remove("col-12");
                document.getElementById("chart-RT").classList.add("d-none");
                document.getElementById("chart-RH").classList.add("d-none");
                document.getElementById("chart-RD").classList.add("d-none");
                document.getElementById("chart-RP").classList.add("d-none");
                document.getElementById("chart-RN").classList.add("d-none");
                const item = JSON.parse(localStorage.getItem('itemHistory'));
                if (item.workstationType == "NAAM") {
                    document.getElementById("box-RT").classList.remove("d-none");
                    document.getElementById("box-RH").classList.remove("d-none");
                    document.getElementById("box-RD").classList.remove("d-none");
                    document.getElementById("box-RP").classList.remove("d-none");
                    document.getElementById("chart-RT").classList.remove("d-none");
                    document.getElementById("chart-RH").classList.remove("d-none");
                    document.getElementById("chart-RD").classList.remove("d-none");
                    document.getElementById("chart-RP").classList.remove("d-none");
                } else if (item.workstationType == "N") {
                    document.getElementById("box-RN").classList.remove("d-none");
                    document.getElementById("chart-RN").classList.remove("d-none");
                    document.getElementById("box-RN").classList.remove("col-6");
                    document.getElementById("box-RN").classList.add("col-12");
                } else if (item.workstationType == "M" || item.workstationType == "MS") {
                    document.getElementById("box-RD").classList.remove("d-none");
                    document.getElementById("chart-RD").classList.remove("d-none");
                    document.getElementById("box-RD").classList.remove("col-6");
                    document.getElementById("box-RD").classList.add("col-12");
                }
            }
            var ctx = document.getElementById("lineBarChart");
            var lineBarChart;
            var ctx_RT = document.getElementById("ChartRT");
            var ChartRT;
            var ctx_RH = document.getElementById("ChartRH");
            var ChartRH;
            var ctx_RP = document.getElementById("ChartRP");
            var ChartRP;
            var ctx_RN = document.getElementById("ChartRN");
            var ChartRN;
            // khởi Tạo biểu đồ
            ctx.getContext("2d");
            function createNewChart() {
                if (lineBarChart != null) {
                    lineBarChart.destroy();
                }
                lineBarChart = new Chart(ctx, {
                    type: "bar", // Chọn loại biểu đồ chính là bar
                    data: {
                        labels: ["January", "February", "March", "April", "May", "June", "July"],
                        datasets: [
                            {
                                type: "bar", // Chọn kiểu bar cho dataset này
                                label: "Lượng bán hàng",
                                data: [30, 50, 40, 60, 70, 45, 80],
                                backgroundColor: "rgba(75, 192, 192, 0.5)",
                                borderColor: "rgba(75, 192, 192, 1)",
                                borderWidth: 1,
                            },
                            {
                                type: "line", // Chọn kiểu line cho dataset này
                                label: "Doanh thu",
                                data: [300, 400, 350, 450, 500, 400, 550],
                                backgroundColor: "rgba(255, 99, 132, 0.2)",
                                borderColor: "rgba(255, 99, 132, 1)",
                                fill: false, // Không tô nền dưới đường
                                tension: 0.3, // Tạo độ cong cho đường
                                borderWidth: 2,
                            },
                        ],
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true, // Đảm bảo trục Y bắt đầu từ 0
                            },
                        },
                    },
                });
            }

            function roundToTwoDecimals(num) {
                if (Number.isInteger(num)) {
                    return num; // Nếu là số nguyên thì trả về nguyên gốc
                }
                return Math.round(num * 100) / 100; // Làm tròn đến 2 chữ số thập phân
            }
            // lọc data để tạo chart
            createChartData = function (data, type, typeData) {
                if (lineBarChart != null) {
                    lineBarChart.destroy();
                }
                if (ChartRT != null) {
                    ChartRT.destroy();
                }
                if (ChartRH != null) {
                    ChartRH.destroy();
                }
                if (ChartRP != null) {
                    ChartRP.destroy();
                }
                if (ChartRN != null) {
                    ChartRN.destroy();
                }
                var RA = ctx.getContext('2d');
                var RT = ctx_RT.getContext('2d');
                var RH = ctx_RH.getContext('2d');
                var RP = ctx_RP.getContext('2d');
                var RN = ctx_RN.getContext('2d');
                let newDataRA = [];
                let newlabelRA = [];
                let newDataRT = [];
                let newlabelRT = [];
                let newDataRH = [];
                let newlabelRH = [];
                let newDataRP = [];
                let newlabelRP = [];
                let newDataRN = [];
                let newlabelRN = [];
                $.each(data, function (i, item) {
                    //if (item.AverageValue != 0) {
                        if (item.ZONE_PROPERTY == 'RD') {
                            newlabelRA.push(item.Label);
                            const value = roundToTwoDecimals(item.AverageValue / 10)
                            newDataRA.push(value)
                        } else if (item.AverageValue != 0) {
                            if (item.ZONE_PROPERTY == 'RT') {
                                newlabelRT.push(item.Label);
                                const value = roundToTwoDecimals(item.AverageValue / 10)
                                newDataRT.push(value.toFixed(2))
                            } else if (item.ZONE_PROPERTY == 'RH') {
                                newlabelRH.push(item.Label);
                                const value = roundToTwoDecimals(item.AverageValue / 10)
                                newDataRH.push(value.toFixed(2))
                            } else if (item.ZONE_PROPERTY == 'RP') {
                                newlabelRP.push(item.Label);
                                const value = roundToTwoDecimals(item.AverageValue / 10)
                                newDataRP.push(value.toFixed(2))
                            } else if (item.ZONE_PROPERTY == 'RN') {
                                newlabelRN.push(item.Label);
                                const value = roundToTwoDecimals(item.AverageValue)
                                newDataRN.push(value.toFixed(2))
                            }
                        }
                        

                    //}
                })
                var dataSetRA = [
                    {
                        type: "bar", // Chọn kiểu bar cho dataset này
                        label: "Lượng mưa (mm)",
                        data: newDataRA,
                        backgroundColor: "rgba(75, 192, 192, 0.5)",
                        borderColor: "rgba(75, 192, 192, 1)",
                        borderWidth: 1,
                    }
                ]
                var dataSetRP = [
                    {
                        type: "line", // Chọn kiểu bar cho dataset này
                        label: "Áp suất (hPa)",
                        data: newDataRP,
                        backgroundColor: "rgb(40, 167, 69)",
                        borderColor: "rgb(40, 167, 69)",
                        borderDash: [5, 5],
                        borderWidth: 1,
                    }
                ]
                var dataSetRT = [
                    {
                        type: "line", // Chọn kiểu bar cho dataset này
                        label: "Nhiệt độ (°C)",
                        data: newDataRT,
                        backgroundColor: "rgb(173 14 14)",
                        borderColor: "rgb(173 14 14)",
                        borderWidth: 1,
                        // fill: 'start',
                        tension: 0.4,
                    }
                ]
                var dataSetRH = [
                    {
                        type: "line", // Chọn kiểu bar cho dataset này
                        label: "Độ ẩm (%)",
                        data: newDataRH,
                        backgroundColor: "rgb(13,154,154, 0.5)",
                        borderColor: "rgb(13,154,154)",
                        borderWidth: 1,
                        fill: 'start',
                        tension: 0.4,
                    }
                ]
                var dataSetRN = [
                    {
                        type: "line", // Chọn kiểu bar cho dataset này
                        label: "Mực nước (cm)",
                        data: newDataRN,
                        backgroundColor: "rgb(0,95,95, 0.5)",
                        borderColor: "rgb(13,154,154)",
                        borderWidth: 1,
                        fill: 'start',
                        tension: 0.4,
                    }
                ]
                var label = '';
                if (typeData == 'NGAY') {
                    label = "giờ"
                }
                lineBarChart = new Chart(RA, createChart("bar", newlabelRA, [], "mm", "", dataSetRA, label));
                ChartRT = new Chart(RT, createChart("bar", newlabelRT, [], "°C", "", dataSetRT, label));
                ChartRH = new Chart(RH, createChart("bar", newlabelRH, [], "%", "", dataSetRH, label, 0, 100));
                ChartRP = new Chart(RP, createChart("bar", newlabelRP, [], "hPa", "", dataSetRP, label));
                ChartRN = new Chart(RN, createChart("bar", newlabelRN, [], "cm", "", dataSetRN, label));
                document.getElementById("loading-spinner").classList.add("d-none");
            }

            // hàm để tạo chart
            createChart = function (type, Label, Data, Unit, LabelData, dataSet, labelNgay, Min, Max) {
                return {
                    type: type, // Loại biểu đồ
                    data: {
                        labels: Label,
                        datasets: dataSet
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true, // Không giữ tỷ lệ khung hình
                        responsive: true,
                        scales: {
                            y: {  // Sử dụng 'y' thay vì 'yAxes'
                                beginAtZero: false,
                                ticks: {
                                    callback: function (value, index, values) {
                                        return roundToTwoDecimals(value) + ' ' + Unit;  // Thêm đơn vị Volts vào mỗi giá trị trục y
                                    }
                                },
                                min: Min ?? undefined,
                                max: Max ?? undefined,
                            }
                        },
                        interaction: {
                            mode: 'nearest', // hoặc 'index'
                            axis: 'x',       // hoặc 'y', hoặc 'xy'
                            intersect: false // Đảm bảo tooltip hiển thị ngay cả khi không chạm chính xác
                        },
                        plugins: {
                            tooltip: { // Sử dụng 'plugins.tooltip' thay vì 'tooltips'
                                callbacks: {
                                    title: function (tooltipItems) {
                                        const index = tooltipItems[0].dataIndex; // Lấy index của điểm dữ liệu
                                        return Label[index] + " " + labelNgay; // Thay "labelNgay" bằng array chứa thời gian
                                    },
                                    label: function (tooltipItem) {
                                        let label = tooltipItem.dataset.label || ''; // Lấy label từ dataset
                                        if (label) {
                                            label += ': ';
                                        }
                                        label += tooltipItem.raw + ' ' + Unit; // Sử dụng tooltipItem.raw để lấy giá trị y
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                }
            }

            //qrcode
            var html5QrCode;
            var currentCameraIndex = 0;  // Index camera hiện tại
            var devices = [];  // Danh sách các camera
            var isScannerRunning = false;  // Biến theo dõi trạng thái quét
            var currentCamera;
            // Hàm khởi tạo quét QR
            function startScan(cameraId, cam) {
                currentCamera = cam;
                html5QrCode = new Html5Qrcode("qr-reader");
                html5QrCode.start(
                    cameraId,
                    {
                        fps: 10,    // Số khung hình trên giây
                        qrbox: { width: 250, height: 250 },  // Kích thước khung quét QR
                        aspectRatio: 1.7, // Đặt tỉ lệ khung hình
                        videoConstraints: {
                            facingMode: { exact: cam },
                        }
                    },
                    onScanSuccess,
                    onScanFailure
                ).then(() => {
                    isScannerRunning = true;  // Đánh dấu scanner đang chạy
                }).catch(err => {
                    console.error("Lỗi khi khởi động camera: ", err);
                });
            }

            // Khi nhấn nút mở popup quét QR
            function startQRcode() {
                document.getElementById("result-form-total").classList.add("d-none");
                document.getElementById("result-form-loading").classList.remove("d-none");
                document.getElementById("result-form-title").classList.add("d-none");
                document.getElementById("result-form-stationID").classList.remove("d-none");
                document.getElementById("result-form-stationName").classList.remove("d-none");
                $("#qr-popup").modal({
                    fadeDuration: 250,
                    escapeClose: false,
                    clickClose: false,
                    showClose: false
                });

                // Lấy danh sách camera và bắt đầu quét
                Html5Qrcode.getCameras().then(_devices => {
                    devices = _devices; // Lưu lại danh sách camera
                    if (devices && devices.length) {
                        if (devices.length == 1) {
                            startScan(devices[currentCameraIndex].id, "user");  // Bắt đầu quét với camera đầu tiên
                        } else {
                            startScan(devices[currentCameraIndex].id, "environment");
                        }
                    } else {
                        console.error("Không tìm thấy thiết bị camera nào.");
                    }
                }).catch(err => {
                    console.error("Lỗi khi lấy danh sách camera: ", err);
                });
            };

            // Chuyển đổi camera
            $("#toggle-camera").click(function () {
                if (currentCameraIndex == devices.length) {
                    currentCamera = 0
                } else {
                    currentCameraIndex = (currentCameraIndex + 1) % devices.length; // Chuyển qua camera tiếp theo
                }
                if (currentCamera == "user") {
                    startScan(devices[currentCameraIndex].id, 'environment'); // Bắt đầu quét với camera mới
                } else {
                    startScan(devices[currentCameraIndex].id, 'user');
                }
            });

            // Khi nhấn nút đóng popup
            $("#close-scanner").click(function () {
                if (isScannerRunning) {
                    html5QrCode.stop().then(ignore => {
                        isScannerRunning = false;  // Đánh dấu scanner đã dừng
                        $('#qr-popup').modal('hide'); // Đóng popup
                    }).catch(err => {
                        console.error("Lỗi khi dừng quét QR: ", err);
                    });
                } else {
                    $('#qr-popup').modal('hide'); // Nếu không có quét đang chạy, chỉ đóng popup
                }
            });

            // Hàm xử lý khi quét thành công
            async function onScanSuccess(decodedText, decodedResult) {
                // Hiển thị kết quả trên trang chính
                //$("#result").text("Kết quả quét: " + decodedText);

                html5QrCode.stop().then(ignore => {
                    isScannerRunning = false;  // Đánh dấu scanner đã dừng
                    document.getElementById("result-form").classList.remove("d-none");
                    document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
                }).catch(err => {
                    console.error("Lỗi khi dừng camera sau khi quét thành công: ", err);
                });
                let data;
                let domain;
                let workstation;
                let checkQRcode = decodedText.split(',');
                if(checkQRcode[0].substring(0, 3) == "T20"){
                    data = await getDataMDQRcode(decodedText.replaceAll(',', '$'));  
                    if(data.length > 0){
                        if(checkTab){
                            toastr.success("Quét QR và lưu thông tin thành công!");
                            scanAgain()
                        } else {
                            document.getElementById("result-product").classList.remove("d-none");
                            document.getElementById("result-form-loading").classList.add("d-none");
                            document.getElementById("result-form").classList.remove("d-none");
                            document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
                            document.getElementById("result-product-truycap").disabled = false;
                            document.getElementById("result-form-productName").value = checkQRcode[1];
                            document.getElementById("result-form-productCode").value = checkQRcode[2].substring(1);
                            document.getElementById("header-productName").textContent = checkQRcode[1]+" - "+checkQRcode[2].substring(1);
                            changeDataWarranty(data);
                        }
                        
                    } else {
                        const willInsertData = {
                            QR_CODE: decodedText,
                            MA_SAN_PHAM: checkQRcode[1],
                            DATE_CREATE: new Date(),
                            ACTIVATE_WARRANTY: new Date('1999-01-01 07:00:00.000'),
                            USER_ID: UserID,
                            DATASTATE: "ADD",
                        };
                        add('DM_QRCODE', willInsertData).then(async data => {
                            try {
                                toastr.success("Quét QR và lưu thông tin thành công!");
                                if(checkTab){
                                    scanAgain();
                                } else {
                                    document.getElementById("result-product").classList.remove("d-none");
                                    document.getElementById("result-form-loading").classList.add("d-none");
                                    document.getElementById("result-form").classList.remove("d-none");
                                    document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
                                    document.getElementById("result-product-truycap").disabled = false;
                                    document.getElementById("result-form-productName").value = checkQRcode[1];
                                    console.log(1);
                                    document.getElementById("result-form-productCode").value = checkQRcode[2].substring(1);
                                    document.getElementById("header-productName").textContent = checkQRcode[1]+" - "+checkQRcode[2].substring(1);
                                    data = await getDataMDQRcode(decodedText.replaceAll(',', '$'));  
                                    const willInsertData = {
                                        TYPE: "ADD",
                                        ERROR_NAME: "Hoàn thành sản phẩm",
                                        DESCRIPTION: "Nhập sản phẩm vào hệ thống",
                                        DATE_CREATE: new Date(),
                                        ERROR_STATUS: 0,
                                        QRCODE_ID: data[0].PR_KEY,
                                        USER_ID: UserID,
                                        DATASTATE: "ADD",
                                    };
                                    await add('WARRANTY_ERROR', willInsertData)
                                    changeDataWarranty(data);
                                }
                                
                            } catch (e) { }
                        }).catch(err => {
                            console.error('Error:', err);
                        });
                    }
                } else {
                    if (decodedText.length > 6) {
                        var resultArray = decodedText.split("$");
                        data = await getNewData(
                            localStorage.getItem("MATRAM"),
                            "WORKSTATION_ID='" + resultArray[1] + "'",
                            resultArray[0]
                        );
                        localStorage.setItem("URL", resultArray[0]);
                        workstation = resultArray[1];
                        document.getElementById("result-form-total").classList.remove("d-none");
                        document.getElementById("result-form-loading").classList.add("d-none");
                        document.getElementById("result-form").classList.remove("d-none");
                        document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
                    } else if (decodedText.length == 6) {
                        domain = await getDomain(decodedText, 'domain');
                        const url = "https://" + domain + "/service/service.svc/"
                        data = await getNewData(
                            localStorage.getItem("MATRAM"),
                            "WORKSTATION_ID='" + decodedText + "'",
                            url
                        );
                        localStorage.setItem("URL", url);
                        workstation = decodedText;
                        document.getElementById("result-form-total").classList.remove("d-none");
                        document.getElementById("result-form-loading").classList.add("d-none");
                        document.getElementById("result-form").classList.remove("d-none");
                        document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
                    } else {
                        document.getElementById("result-form-total").classList.remove("d-none");
                        document.getElementById("result-form-loading").classList.add("d-none");
                        document.getElementById("result-form-title").classList.remove("d-none");
                        document.getElementById("result-form-stationID").classList.add("d-none");
                        document.getElementById("result-form-stationName").classList.add("d-none");
                        document.getElementById("result-truycap").classList.add("d-none");
                        toastr.error("Vui lòng quét đúng mã QR!");
                    }

                    if (data.data != []) {
                        document.getElementById("result-truycap").disabled = false;
                        matram = workstation;
                        const value = await getDomain(workstation);
                        document.getElementById("result-form-stationID").value = workstation;
                        document.getElementById("result-form-stationName").value = value[0].WORKSTATION_NAME;
                        document.getElementById("footer-stationName").textContent = workstation + " - " + value[0].WORKSTATION_NAME;
                        checkCam = true;
                        localStorage.setItem("MATRAM", workstation);
                        toastr.success("Quét QR thành công");
                    } else {
                        document.getElementById("result-form-total").classList.remove("d-none");
                        document.getElementById("result-form-loading").classList.add("d-none");
                        document.getElementById("result-form-title").classList.remove("d-none");
                        document.getElementById("result-form-stationID").classList.add("d-none");
                        document.getElementById("result-form-stationName").classList.add("d-none");
                        document.getElementById("result-truycap").classList.add("d-none");
                        toastr.error("Vui lòng quét đúng mã QR!");
                    }
                }
            }

            // Hàm xử lý khi quét thất bại
            function onScanFailure(error) {
                // Xử lý lỗi (nếu cần)
            }

            // Khi nhấn nút upload QR từ hình ảnh
            $("#upload-qr").click(function () {
                $("#file-input").click();  // Mở hộp thoại chọn file
            });

            // Khi chọn file hình ảnh từ input
            $("#file-input").change(function (event) {
                var file = event.target.files[0];  // Đảm bảo lấy file đúng
                if (file) {
                    // Dừng quét camera trước khi quét file
                    if (isScannerRunning) {
                        html5QrCode.stop().then(function () {
                            isScannerRunning = false;  // Đánh dấu scanner đã dừng
                            var reader = new FileReader();
                            reader.onload = function (e) {
                                var img = new Image();
                                img.onload = function () {
                                    // Quét QR từ hình ảnh đã tải lên
                                    html5QrCode.scanFile(file).then(async decodedText => {  // Sửa tại đây
                                        document.getElementById("result-form").classList.remove("d-none");
                                        document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
                                        let data;
                                        let domain;
                                        let workstation;
                                        let checkQRcode = decodedText.split(',');
                                        
                                        if(checkQRcode[0].substring(0, 3) == "T20"){
                                            data = await getDataMDQRcode(decodedText.replaceAll(',', '$'));
                                            
                                            if(data.length > 0){
                                                if(checkTab){
                                                    console.log(data);
                                                    
                                                    if(data[0].LOT_ID == 0){
                                                        if($('#errorType').val() != 0){
                                                            const willInsertData = {
                                                                PR_KEY: data[0].PR_KEY,
                                                                QR_CODE: decodedText,
                                                                MA_SAN_PHAM: checkQRcode[1],
                                                                LOT_ID: $('#errorType').val(),
                                                                DATE_CREATE: new Date(),
                                                                ACTIVATE_WARRANTY: new Date('1999-01-01 07:00:00.000'),
                                                                USER_ID: UserID,
                                                                DATASTATE: "EDIT",
                                                            };
                                                            add('DM_QRCODE', willInsertData);
                                                            toastr.success("Quét QR và lưu thông tin thành công!");
                                                        } else {
                                                            toastr.error("Chưa chọn lô sản phẩm, vui lòng chọn rồi tiếp tục quét!");
                                                        }
                                                    } else {
                                                        toastr.error("Sản phẩm đã thuộc 1 lô khác, vui lòng kiểm tra lại!");
                                                    }
                                                    scanAgain()
                                                } else {
                                                    document.getElementById("result-product").classList.remove("d-none");
                                                    document.getElementById("result-form-loading").classList.add("d-none");
                                                    document.getElementById("result-form").classList.remove("d-none");
                                                    document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
                                                    document.getElementById("result-product-truycap").disabled = false;
                                                    document.getElementById("result-form-productName").value = checkQRcode[1];
                                                    document.getElementById("result-form-productCode").value = checkQRcode[2].substring(1);
                                                    document.getElementById("header-productName").textContent = checkQRcode[1]+" - "+checkQRcode[2].substring(1);
                                                    changeDataWarranty(data);
                                                }
                                                
                                            } else {
                                                if($('#errorType').val() != 0){
                                                    const willInsertData = {
                                                        QR_CODE: decodedText,
                                                        MA_SAN_PHAM: checkQRcode[1],
                                                        LOT_ID: $('#errorType').val(),
                                                        DATE_CREATE: new Date(),
                                                        ACTIVATE_WARRANTY: new Date('1999-01-01 07:00:00.000'),
                                                        USER_ID: UserID,
                                                        DATASTATE: "ADD",
                                                    };
                                                    add('DM_QRCODE', willInsertData).then(async data => {
                                                        try {
                                                            toastr.success("Quét QR và lưu thông tin thành công!");
                                                            if(checkTab){
                                                                scanAgain();
                                                            } else {
                                                                document.getElementById("result-product").classList.remove("d-none");
                                                                document.getElementById("result-form-loading").classList.add("d-none");
                                                                document.getElementById("result-form").classList.remove("d-none");
                                                                document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
                                                                document.getElementById("result-product-truycap").disabled = false;
                                                                document.getElementById("result-form-productName").value = checkQRcode[1];
                                                                document.getElementById("result-form-productCode").value = checkQRcode[2].substring(1);
                                                                document.getElementById("header-productName").textContent = checkQRcode[1]+" - "+checkQRcode[2].substring(1);
                                                                data = await getDataMDQRcode(decodedText.replaceAll(',', '$'));  
                                                                const willInsertData = {
                                                                    TYPE: "ADD",
                                                                    ERROR_NAME: "Hoàn thành sản phẩm",
                                                                    DESCRIPTION: "Nhập sản phẩm vào hệ thống",
                                                                    DATE_CREATE: new Date(),
                                                                    ERROR_STATUS: 0,
                                                                    QRCODE_ID: data[0].PR_KEY,
                                                                    USER_ID: UserID,
                                                                    DATASTATE: "ADD",
                                                                };
                                                                await add('WARRANTY_ERROR', willInsertData)
                                                                changeDataWarranty(data);
                                                            }
                                                        } catch (e) { }
                                                    }).catch(err => {
                                                        console.error('Error:', err);
                                                    });
                                                } else {
                                                    toastr.error("Chưa chọn lô sản phẩm, vui lòng chọn rồi tiếp tục quét!");
                                                }
                                            }
                                        } else {
                                            if (decodedText.length > 6) {
                                                var resultArray = decodedText.split("$");
                                                data = await getNewData(
                                                    localStorage.getItem("MATRAM"),
                                                    "WORKSTATION_ID='" + resultArray[1] + "'",
                                                    resultArray[0]
                                                );
                                                localStorage.setItem("URL", resultArray[0]);
                                                workstation = resultArray[1];
                                                document.getElementById("result-form-total").classList.remove("d-none");
                                                document.getElementById("result-form-loading").classList.add("d-none");
                                                document.getElementById("result-form").classList.remove("d-none");
                                                document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
                                            } else if (decodedText.length == 6) {
                                                domain = await getDomain(decodedText, 'domain');
                                                const url = "https://" + domain + "/service/service.svc/"
                                                data = await getNewData(
                                                    localStorage.getItem("MATRAM"),
                                                    "WORKSTATION_ID='" + decodedText + "'",
                                                    url
                                                );
                                                localStorage.setItem("URL", url);
                                                workstation = decodedText;
                                                document.getElementById("result-form-total").classList.remove("d-none");
                                                document.getElementById("result-form-loading").classList.add("d-none");
                                                document.getElementById("result-form").classList.remove("d-none");
                                                document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
                                            } else {
                                                document.getElementById("result-form-total").classList.remove("d-none");
                                                document.getElementById("result-form-loading").classList.add("d-none");
                                                toastr.error("Vui lòng quét đúng mã QR!");
                                            }


                                            if (data != []) {

                                                document.getElementById("result-truycap").disabled = false;
                                                matram = workstation
                                                const value = await getDomain(workstation);
                                                document.getElementById("result-form-stationID").value = workstation;
                                                document.getElementById("result-form-stationName").value = value[0].WORKSTATION_NAME;
                                                document.getElementById("footer-stationName").textContent = workstation + " - " + value[0].WORKSTATION_NAME;
                                                checkCam = true;
                                                toastr.success("Quét QR thành công");
                                                localStorage.setItem("MATRAM", workstation);
                                            }
                                        }
                                    }).catch(err => {
                                        document.getElementById("result-form").classList.remove("d-none");
                                        document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
                                        document.getElementById("result-form-total").classList.remove("d-none");
                                        document.getElementById("result-form-loading").classList.add("d-none");
                                        document.getElementById("result-form-title").classList.remove("d-none");
                                        document.getElementById("result-form-stationID").classList.add("d-none");
                                        document.getElementById("result-form-stationName").classList.add("d-none");
                                        document.getElementById("result-truycap").classList.add("d-none");
                                        toastr.error("Vui lòng quét đúng mã QR!");
                                    });
                                };
                                img.src = e.target.result;
                            };
                            reader.readAsDataURL(file);  // Đọc hình ảnh từ file
                        }).catch(err => {
                            console.error("Lỗi khi dừng camera: ", err);
                        });
                    } else {
                        // Nếu không có scanner đang chạy, quét trực tiếp từ hình ảnh
                        var reader = new FileReader();
                        reader.onload = function (e) {
                            var img = new Image();
                            img.onload = function () {
                                html5QrCode.scanFile(file).then(decodedText => {
                                    $("#result").text("Kết quả quét: " + decodedText); // Hiển thị kết quả
                                }).catch(err => {
                                    $("#result").text("Không thể quét QR từ hình ảnh.");
                                    console.error("Lỗi khi quét hình ảnh QR: ", err);
                                });
                            };
                            img.src = e.target.result;
                        };
                        reader.readAsDataURL(file);  // Đọc hình ảnh từ file
                    }
                }
            });


            //lấy value khi nhập mã trạm thủ công.
            async function getInputValue() {
                var inputValue = document.getElementById("device_name").value;
                if (inputValue == null || inputValue == "") {
                    toastr.error("Vui lòng nhập mã trạm!");
                } else {
                    $("#loading-popup").modal({
                        fadeDuration: 250,
                        escapeClose: false,
                        clickClose: false,
                        showClose: false
                    });
                    CheckWorkStation(inputValue)
                }
            }

            // ẩn phần bước khi bật bàn phí trên mobile
            function adjustFooter() {
                const footer = document.querySelector('.footer-instruct');
                const windowHeight = window.innerHeight;

                window.addEventListener('resize', () => {
                    if (window.innerHeight < windowHeight) {
                        // Keyboard is visible, hide or adjust footer
                        document.getElementById("footer-instruct-text").classList.add("d-none");
                        footer.style.display = 'none'; // You can also reposition it instead of hiding
                    } else {
                        // Keyboard is hidden, show footer
                        document.getElementById("footer-instruct-text").classList.remove("d-none");
                        footer.style.display = 'block';
                    }
                });
            }
            adjustFooter();

            // Sidebar toggle logic
            const menuToggle = $(".menuToggle");
            const sidebar = $(".sidebar");

            // Toggle the sidebar visibility
            menuToggle.on("click", (e) => {
                e.stopPropagation(); // Ngăn chặn sự kiện click lan ra ngoài
                sidebar.toggleClass("open");
            });

            // Detect clicks outside the sidebar
            $(document).on("click", (e) => {
                if (sidebar.hasClass("open") && !$(e.target).closest(".sidebar").length) {
                    sidebar.removeClass("open");
                }
            });


            // Handle menu item clicks
            const menuItems = document.querySelectorAll(".menu-item, .submenu li");
            menuItems.forEach((item) => {
                item.addEventListener("click", async (e) => {
                    e.stopPropagation(); // Prevent the click from propagating to the document

                    // Detect which menu item was clicked
                    const menuText = item.innerText.trim(); // Get the text of the menu item

                    if (menuText == "Giải pháp thông minh") {
                        console.log(menuText);
                        $("#tab-add-category").click();
                    } else if (menuText == "Quản lý danh mục") {
                        document.getElementById("history-setting").classList.remove("d-none");
                        document.getElementById("history-homePage").classList.add("d-none");
                        document.getElementById("list-category").classList.remove("d-none");
                        document.getElementById("save-category").classList.add("d-none");
                        $(".history-avt").removeClass("d-none");
                        document.getElementById("category-back").classList.add("d-none");
                        showCategory()
                        // document.querySelector(".tablink-history").click();
                    } else if (menuText == "Truy cập Trạm") {
                        document.getElementById("history-setting").classList.add("d-none");
                        document.getElementById("history-homePage").classList.remove("d-none");
                        localStorage.setItem('listItemCategory', JSON.stringify([]));
                        showHistory()
                    } else if (menuText == "Thông tin công ty") {
                        window.location.href = "https://homeos.com.vn/";
                    } else if (menuText == "Thông tin sản phẩm") {
                        $("#warrantyDetailProduct").removeClass("d-none");
                        $("#ScanAllQRcode").addClass("d-none");
                        $("#lotProduct").addClass("d-none");
                        checkTab = false;
                    } else if (menuText == "Quét lô sản phẩm") {
                        $("#warrantyDetailProduct").addClass("d-none");
                        $("#ScanAllQRcode").removeClass("d-none");
                        $("#lotProduct").addClass("d-none");
                        $('#errorType').empty();
                        const Data = await getDM('WARRANTY_LOT', "1=1");
                        const newOption = $('<option>', {
                            value: '0', // Giá trị của option
                            text: 'Chọn lô sản phẩm' // Nội dung hiển thị
                        });
                        // Thêm vào select
                        $('#errorType').append(newOption);
                        Data.data.forEach(item => {
                            console.log(item);
                            const newOption = $('<option>', {
                                value: item.PR_KEY, // Giá trị của option
                                text: item.LOT_NAME // Nội dung hiển thị
                            });
                            // Thêm vào select
                            $('#errorType').append(newOption);
                        });
                        checkTab = true;
                    } else if (menuText == "Quản lý và xuất lô hàng") {
                        $("#warrantyDetailProduct").addClass("d-none");
                        $("#ScanAllQRcode").addClass("d-none");
                        $("#lotProduct").removeClass("d-none");
                    }
                    // Close the sidebar after selection (optional)
                    sidebar.removeClass("open");
                });
            });

            // Code Bảo hành:

            // Hàm thêm sửa xoá dữ liệu
            function add(table, data) {
                // const d = {Uid: "vannt", Sid:'3d798037-9bd9-4195-8673-a4794547d2fd', tablename:table, jd:JSON.stringify(data), ex:''};
                const d = {Uid: "admin", Sid:'cb880c13-5465-4a1d-a598-28e06be43982', tablename:table, jd:JSON.stringify(data), ex:''};
                
                return new Promise((resolve, reject) => {
                    $.ajax({
                        // url: "https://DEV.HOMEOS.vn/service/service.svc/ExecuteData?callback=?",
                        url: "https://central.homeos.vn/service_XD/service.svc/ExecuteData?callback=?",
                        type: "GET",
                        dataType: "jsonp",
                        data: d,
                        contentType: "application/json; charset=utf-8",
                        success: function (msg) {
                            try {
                                let state = JSON.parse(msg);
                                resolve(state);  // Trả về dữ liệu khi thành công
                            } catch (error) {
                                reject(error);  // Bắt lỗi nếu JSON parse thất bại
                            }
                        },
                        complete: function (data) {
                        },
                        error: function (e, t, x) {
                        }
                    });
                });
            }

            // lấy dữ liệu QR code
            function getDataMDQRcode(QRcode) {

                // const url = "https://DEV.HOMEOS.vn/service/service.svc/";
                const url = "https://central.homeos.vn/service_XD/service.svc/";
                console.log();
                
                return new Promise((resolve, reject) => {
                    $.ajax({
                        url: url + "ApiServicePublic/" + "GetDataQRcode" + "/" + "QRCODEINPUT=" + QRcode,
                        type: "GET",
                        dataType: "jsonp",
                        contentType: "application/json; charset=utf-8",
                        success: function (msg) {
                            try {
                                let state = JSON.parse(msg);
                                console.log(state);
                                resolve(state); // Trả về dữ liệu khi thành công
                            } catch (error) {
                                reject(error); // Bắt lỗi nếu JSON parse thất bại
                            }
                        },
                        complete: function (data) {
                            // Có thể thêm xử lý khi request hoàn thành ở đây nếu cần
                        },
                        error: function (e, t, x) {
                            // document.getElementById("result-form").classList.remove("d-none");
                            // document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
                            // toastr.error("Vui lòng quét đúng mã QR của trạm mưa");
                        },
                    });
                });
            } 

            $('.bottom-navigation button').click(function () {
                value = $(this).data('tab');
                $('.bottom-navigation button').removeClass('menuWarranty');
                $(this).addClass('menuWarranty');
                $('.tab-content').removeClass('active');
                $('#tab-' + value).addClass('active');
            });

            function changeDataWarranty(data) {
                let DataQRcode = data[0].QR_CODE.split(',');
                localStorage.setItem("productWarranty", JSON.stringify(data));
                const dataWarranty = JSON.parse(localStorage.getItem("productWarranty"));
                console.log(dataWarranty);
                document.getElementById('productName').textContent = "Tên sản phẩm: "+ data[0].PRODUCT_NAME;
                document.getElementById('productCode').textContent = "Mã định danh: "+ data[0].PRODUCT_CODE;
                document.getElementById('productSeri').textContent = "Số seri: "+ DataQRcode[2].substring(1);
                document.getElementById("deviceImg").src = data[0].PRODUCT_IMG;
                if(data[0].ACTIVATE_WARRANTY == "1999-01-01T00:00:00"){
                    document.getElementById('warrantyActive').textContent = "Chưa kích hoạt";
                    const WarrantyAct = DataQRcode[0].substring(1, 5) +"-"+ DataQRcode[0].substring(5, 7) +"-"+ DataQRcode[0].substring(7, 9);
                    const time =  calculateWarrantyRemaining(WarrantyAct,  Number(data[0].TIME_WARRANTY));
                    document.getElementById('warrantyTime').textContent = time;
                    document.getElementById('result-product-warranty').classList.remove("d-none");
                } else {
                    document.getElementById('warrantyActive').textContent = "Đã kích hoạt";
                    document.getElementById('result-product-warranty').classList.add("d-none");
                    const WarrantyAct = DataQRcode[0].substring(1, 5) +"-"+ DataQRcode[0].substring(5, 7) +"-"+ DataQRcode[0].substring(7, 9);
                    const time =  calculateWarrantyRemaining(WarrantyAct,  Number(data[0].TIME_WARRANTY));
                    document.getElementById('warrantyTime').textContent = time;
                }
                addItemHistoryWarranty(data[0].PR_KEY);
            }

            $('#result-product-warranty').click(function () {
                const dataWarranty = JSON.parse(localStorage.getItem("productWarranty"));
                const DataQRcode = dataWarranty[0].QR_CODE.split(',');
                const confirmActivate = confirm(`Xác nhận kích hoạt bảo hành của sản phẩm "${dataWarranty[0].PRODUCT_NAME}-${DataQRcode[2].substring(1)}" không?`);
                if (confirmActivate) {
                    const willInsertData = {
                        PR_KEY: dataWarranty[0].PR_KEY,
                        QR_CODE: dataWarranty[0].QR_CODE,
                        MA_SAN_PHAM: dataWarranty[0].MA_SAN_PHAM,
                        DATE_CREATE: dataWarranty[0].DATE_CREATE,
                        ACTIVATE_WARRANTY: new Date(),
                        USER_ID: dataWarranty[0].USER_ID,
                        DATASTATE: "EDIT",
                    };
                    add('DM_QRCODE', willInsertData).then(async data => {
                        try {
                            toastr.success("Kích hoạt bảo hành của sản phẩm thành công!");
                            const InsertData = {
                                TYPE: "ACTIVATE",
                                ERROR_NAME: "Kích hoạt bảo hành",
                                DESCRIPTION: DataUser.name +" đã kích hoạt bảo hành sản phẩm",
                                DATE_CREATE: new Date(),
                                ERROR_STATUS: 0,
                                QRCODE_ID: dataWarranty[0].PR_KEY,
                                USER_ID: UserID,
                                DATASTATE: "ADD",
                            };
                            add('WARRANTY_ERROR', InsertData)

                            data = await getDataMDQRcode(dataWarranty[0].QR_CODE.replaceAll(',', '$'));  
                            changeDataWarranty(data);
                        } catch (e) { }
                    }).catch(err => {
                        console.error('Error:', err);
                    });
                }
            });

            function calculateWarrantyRemaining(startDate, timeWarranty) {
                const warrantyPeriodMonths = timeWarranty; // Thời gian bảo hành là 12 tháng

                // Chuyển ngày bắt đầu bảo hành sang đối tượng Date
                const startDateObj = new Date(startDate);

                // Ngày kết thúc bảo hành
                const warrantyEndDate = new Date(startDateObj);
                warrantyEndDate.setMonth(warrantyEndDate.getMonth() + warrantyPeriodMonths);

                // Ngày hiện tại
                const currentDate = new Date();

                // Tính thời gian còn lại
                if (currentDate > warrantyEndDate) {
                    return "Thời gian bảo hành đã hết.";
                } else {
                    // Tính tổng số tháng còn lại
                    let totalMonthsRemaining =
                        (warrantyEndDate.getFullYear() - currentDate.getFullYear()) * 12 +
                        (warrantyEndDate.getMonth() - currentDate.getMonth());

                    // Tính số ngày còn lại
                    let daysRemaining = warrantyEndDate.getDate() - currentDate.getDate();

                    // Điều chỉnh nếu số ngày âm
                    if (daysRemaining < 0) {
                        // Lấy số ngày của tháng trước
                        const lastMonth = new Date(warrantyEndDate.getFullYear(), warrantyEndDate.getMonth(), 0);
                        daysRemaining += lastMonth.getDate();
                        totalMonthsRemaining -= 1;
                    }
                    // ${daysRemaining} ngày.
                    return `Còn lại: ${totalMonthsRemaining} tháng`;
                }
            }

            $("#submitError").click(function () {
                // Lấy giá trị từ các trường
                const errorInput = $("#errorInput").val();
                const errorType = $("#errorType").val();
                const errorDesc = $("#errorDesc").val();
                const dataWarranty = JSON.parse(localStorage.getItem("productWarranty"));
                console.log(dataWarranty);
                const willInsertData = {
                    TYPE: 'ERROR',
                    ERROR_TYPE: errorType,
                    ERROR_NAME: errorInput,
                    DESCRIPTION: errorDesc,
                    DATE_CREATE: new Date(),
                    ERROR_STATUS: 1,
                    QRCODE_ID: dataWarranty[0].PR_KEY,
                    USER_ID: UserID,
                    DATASTATE: "ADD",
                };
                add('WARRANTY_ERROR', willInsertData).then(async data => {
                    try {
                        toastr.success("Báo lỗi thành công!");
                        addItemHistoryWarranty(dataWarranty[0].PR_KEY);
                        $("#BackWarranty").click();
                    } catch (e) { }
                }).catch(err => {
                    console.error('Error:', err);
                });
            });

            $('#generateQRCodes').click(function () {
                startValue = parseInt($('#startValue').val()) || 1;
                getTranNo();
            });

            async function getTranNo() {
                try {
                    const data = await getDM('SYS_TRAN_NO', "TABLE_NAME='DM_QRCODE'");
                    const state = data.data;
                    let temp = state[0].TRAN_NO || null;
                    temp = temp.replace(/\[YEAR\]/g, (new Date()).getFullYear());
                    temp = temp.replace(/\[MONTH\]/g, ((new Date()).getMonth() + 1).toString().padStart(2, '0'));
                    temp = temp.replace(/\[DAY\]/g, (new Date()).getDate().toString().padStart(2, '0'));
                    temp = temp.replace(/\[HOUR\]/g, (new Date()).getHours().toString().padStart(2, '0'));
                    temp = temp.replace(/\[MINUTE\]/g, (new Date()).getMinutes().toString().padStart(2, '0'));
                    temp = temp.replace(/\[SECOND\]/g, (new Date()).getSeconds().toString().padStart(2, '0'));
                    const codes = [];
                    let auto_key = state[0].AUTO_KEY;
                    for (let i = 1; i <= startValue; i++) {
                        auto_key += 1;
                        const code = temp.replace(/\[AUTO_KEY\]/g, (auto_key).toString().padStart(state[0].LENGTH_KEY, '0'));
                        codes.push(code);
                    }
                    generateQRCodes(codes);
                    console.log(auto_key, state[0].TABLE_NAME, state[0].TRAN_NO, state[0].LENGTH_KEY);
                    
                    updateTranNo(auto_key, state[0].TABLE_NAME, state[0].TRAN_NO, state[0].LENGTH_KEY);
                } catch (error) {
                    console.error("Lỗi khi lấy dữ liệu:", error);
                }
            }

            function getDM(table_name, c) {
                const d = {
                    // Uid: 'vannt',
                    // Sid: 'b99213e4-a8a5-45f4-bb5c-cf03ae90d8d7',
                    Uid: 'admin',
                    Sid: 'cb880c13-5465-4a1d-a598-28e06be43982',
                    tablename: table_name,
                    c: c,
                    other: '',
                    cmd: ''
                };
                
                // const Url = 'https://DEV.HOMEOS.vn/service/service.svc/';
                
                return new Promise((resolve, reject) => {
                    $.ajax({
                        url: "https://central.homeos.vn/service_XD/service.svc/getDm?callback=?",
                        type: "GET",
                        dataType: "jsonp",
                        data: d,
                        contentType: "application/json; charset=utf-8",
                        success: function (msg) {
                            try {
                                let state = JSON.parse(msg);
                                resolve(state);  // Trả về dữ liệu khi thành công
                            } catch (error) {
                                reject(error);  // Bắt lỗi nếu JSON parse thất bại
                            }
                        },
                        complete: function (data) {
                            // Có thể thêm xử lý khi request hoàn thành ở đây nếu cần
                        },
                        error: function (e, t, x) {
                            HomeOS.Service.SetActionControl(true);
                            HomeOS.Service.ShowLabel('Lỗi dữ liệu');
                            reject(e);  // Trả về lỗi nếu thất bại
                        }
                    });
                });
            }

            async function generateQRCodes(listcode) {
                const newTab = window.open('', '_blank');
                if (!newTab || newTab.closed || typeof newTab.closed == 'undefined') {
                    alert('Tab mới không thể mở. Vui lòng kiểm tra cài đặt popup của trình duyệt.');
                    return;
                }
                let htmlContent = `
                    <html>
                    <head>
                        <style>
                            body {
                                text-align: center;
                                padding: 5px;
                            }
                            .qr-grid {
                                display: grid;
                                grid-template-columns: repeat(auto-fill, minmax(68px, 1fr));
                                margin-top: 10px;
                            }
                            .qr-item {
                                display: flex;
                                flex-direction: column;
                                align-items: center;
                            }
                            .qr-item img {
                                width: 57px;
                            }
                            .qr-item p {
                                margin-top: 5px;
                                margin-bottom: 8px;
                                font-size: 11px;
                            }
                        </style>
                    </head>
                    <body>
                        <div class="qr-grid">
                `;
                for (const code of listcode) {
                    // Tạo một <div> tạm để render mã QR
                    const tempDiv = document.createElement('div');
                    const qrCode = new QRCode(tempDiv, {
                        text: code,           // Mã code muốn tạo
                        width: 57,           // Chiều rộng mã QR
                        height: 57           // Chiều cao mã QR
                        // width: 76,           // Chiều rộng mã QR
                        // height: 76           // Chiều cao mã QR
                    });

                    // Chờ QRCode render xong và lấy hình ảnh từ thẻ canvas
                    const qrDataUrl = await new Promise((resolve) => {
                        setTimeout(() => {
                            const canvas = tempDiv.querySelector('canvas');  // Lấy thẻ canvas chứa mã QR
                            resolve(canvas.toDataURL());                    // Chuyển canvas thành DataURL
                        }, 500);  // Đợi một thời gian ngắn để chắc chắn mã QR được tạo xong
                    });
                    const mang = code.split(',');
                    
                    // Thêm nội dung HTML vào chuỗi htmlContent
                    htmlContent += `
                        <div class="qr-item">
                            <img src="${qrDataUrl}" alt="QR Code for ${code}" />
                            <p>${mang[2].substring(3)}</p>
                        </div>
                    `;
                }
                


                // Chèn nội dung HTML vào tab mới
                newTab.document.write(htmlContent);
                newTab.document.close();

                const script = newTab.document.createElement("script");
                script.textContent = "window.onload = function() { window.print(); }";
                newTab.document.body.appendChild(script);
            }

            function updateTranNo(result, tableName, tranNo, lengthKey) {
                const willInsertData = {
                    PR_KEY: 15,
                    TABLE_NAME: tableName,
                    TRAN_NO: tranNo,
                    ORGANIZATION_ID: '',
                    AUTO_KEY: result,
                    LENGTH_KEY: lengthKey,
                    DATASTATE: "EDIT",
                };
                console.log(willInsertData);
                add(user_id, session, 'SYS_TRAN_NO', willInsertData)
            }
            
            async function addItemHistoryWarranty(QRID) {
                const data = await getDM('WARRANTY_ERROR', "QRCODE_ID='"+QRID+"'");
                let dataWarranty = data.data.filter(item => item.GROUP_ID === 0);
                let dataWarrantyGroup = data.data.filter(item => item.GROUP_ID !== 0);
                if(localStorage.getItem('RoleUser') == "GUEST"){
                    dataWarranty = data.data.filter(item => item.TYPE !== "ADD");
                }
                if(dataWarranty.length > 0){
                    listWarrantyHistory.empty();
                    for (let i = 0; i < dataWarranty.length; i++) {
                        let element = '';
                        const CheckGroupWarranty = dataWarrantyGroup.filter(item => item.GROUP_ID == dataWarranty[i].PR_KEY);
                        let itemElement = '';
                        const [dateALL, timeALL] = dataWarranty[i].DATE_CREATE.split('T');
                        if(CheckGroupWarranty.length > 0){
                            for (let i = 0; i < CheckGroupWarranty.length; i++) {
                                const [date, time] = CheckGroupWarranty[i].DATE_CREATE.split('T');
                                let nameClass;
                                if(CheckGroupWarranty[i].ERROR_STATUS == 1){
                                    nameClass = 'badge-warning';
                                } else if(CheckGroupWarranty[i].ERROR_STATUS == 2) {
                                    nameClass = 'badge-danger';
                                } else if(CheckGroupWarranty[i].ERROR_STATUS == 3) {
                                    nameClass = 'badge-success';
                                } 
                                itemElement += '<div class="vertical-timeline-item vertical-timeline-element">'+
                                    '<div>'+
                                        '<span class="vertical-timeline-element-icon bounce-in">'+
                                            '<i class="badge badge-dot badge-dot-xl '+nameClass+'"> </i>'+
                                        '</span>'+
                                        '<div class="vertical-timeline-element-content bounce-in">'+
                                            '<h4 class="timeline-title">'+CheckGroupWarranty[i].ERROR_NAME+'</h4>'+
                                            '<p>'+CheckGroupWarranty[i].DESCRIPTION+'</p>'+
                                            '<span class="vertical-timeline-element-date">'+date+'</span>'+
                                            '<span class="vertical-timeline-element-dateTime">'+time+'</span>'+
                                        '</div>'+
                                    '</div>'+
                                '</div>'
                            }
                        }

                        if(dataWarranty[i].TYPE == "ERROR"){
                            element += '<li class="parent-item">'+
                                        '<button class="toggle-button">'+
                                            '<div>'+
                                                '<h4 style="margin: 0;">'+
                                                    '<svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" style="color: #cd5757;" fill="currentColor" class="bi bi-exclamation-triangle" viewBox="0 0 16 16">'+
                                                        '<path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.15.15 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.2.2 0 0 1-.054.06.1.1 0 0 1-.066.017H1.146a.1.1 0 0 1-.066-.017.2.2 0 0 1-.054-.06.18.18 0 0 1 .002-.183L7.884 2.073a.15.15 0 0 1 .054-.057m1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767z"/>'+
                                                        '<path d="M7.002 12a1 1 0 1 1 2 0 1 1 0 0 1-2 0M7.1 5.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0z"/>'+
                                                    '</svg>'+
                                                    ' Bảo hành'+
                                                '</h4>'+
                                                '<p style="margin: 1px 0 0 0; font-size: 14px; font-weight: 300;">'+dataWarranty[i].ERROR_NAME+'</p>'+
                                                '<p style="margin: 1px 0 0 0; font-size: 14px; font-weight: 300;">'+dateALL+' '+timeALL+'</p>'+
                                            '</div>'+
                                            '<span class="arrow-icon expanded" style="transform: rotate(90deg);">▶</span>'+
                                        '</button>'+
                                        '<ul class="child-list" style="display: none;">'+
                                            '<div class="vertical-timeline vertical-timeline--animate vertical-timeline--one-column">'+
                                                '<div class="vertical-timeline-item vertical-timeline-element">'+
                                                    '<div>'+
                                                        '<span class="vertical-timeline-element-icon bounce-in">'+
                                                            '<i class="badge badge-dot badge-dot-xl badge-warning"> </i>'+
                                                        '</span>'+
                                                        '<div class="vertical-timeline-element-content bounce-in">'+
                                                            '<h4 class="timeline-title">Báo lỗi sản phẩm</h4>'+
                                                            '<p>'+dataWarranty[i].DESCRIPTION+'</p>'+
                                                            '<span class="vertical-timeline-element-date">'+dateALL+'</span>'+
                                                            '<span class="vertical-timeline-element-dateTime">'+timeALL+'</span>'+
                                                        '</div>'+
                                                    '</div>'+
                                                '</div>'+
                                                itemElement+
                                            '</div>'+
                                        '</ul>'+
                                    '</li>'
                        } else {
                            element += '<li class="parent-item">'+
                                        '<button class="toggle-button">'+
                                            '<div>'+
                                                '<h4 style="margin: 0;">'+
                                                    '<svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" style="color: #27c527;" fill="currentColor" class="bi bi-check-circle" viewBox="0 0 16 16">'+
                                                        '<path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>'+
                                                        '<path d="m10.97 4.97-.02.022-3.473 4.425-2.093-2.094a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05"/>'+
                                                    '</svg>'+
                                                    ' '+ dataWarranty[i].ERROR_NAME+
                                                '</h4>'+
                                                '<p style="margin: 1px 0 0 0; font-size: 14px; font-weight: 300;">'+dataWarranty[i].DESCRIPTION+'</p>'+
                                                '<p style="margin: 1px 0 0 0; font-size: 14px; font-weight: 300;">'+dateALL+' '+timeALL+'</p>'+
                                            '</div>'+
                                        '</button>'+
                                    '</li>'
                        }
                        const $element = $(element);

                        $element.find('.toggle-button').on('click', function (e) {
                            e.preventDefault(); // Ngăn chặn hành động mặc định của thẻ <a>

                            // Lấy danh sách con gần nhất (nếu có)
                            const childList = $(this).siblings(".child-list");

                            // Toggle hiển thị/ẩn danh sách con
                            childList.slideToggle(200);

                            // Xoay icon mũi tên
                            const arrowIcon = $(this).find(".arrow-icon");
                            arrowIcon.toggleClass("expanded");

                            if (arrowIcon.hasClass("expanded")) {
                                arrowIcon.css("transform", "rotate(90deg)");
                            } else {
                                arrowIcon.css("transform", "rotate(0deg)");
                            }
                        });

                        listWarrantyHistory.append($element);
                    }
                }
                
            }

            function WarrantyCheckUser(ROLE) {
                switch (ROLE) {
                    case "GUEST":
                        document.getElementById('warranty_scansQRcode').classList.add('d-none');
                        document.getElementById('result-product-warranty').classList.add('hidden');
                        break;
                    case "DISTRIBUTIVE":

                        break;
                    default:
                        break;
                }
            }
            //-----------------------------------------------------------------------------------------------------------

            // code gauge nhiệt độ
            var xmlns = "http://www.w3.org/2000/svg",
                xlinkns = "http://www.w3.org/1999/xlink",
                select = function (s) {
                    return document.querySelector(s);
                },
                selectAll = function (s) {
                    return document.querySelectorAll(s);
                },
                liquid = selectAll('.liquid'),
                tubeShine = select('.tubeShine'),
                label = select('.label'),
                follower = select('.follower'),
                dragger = select('.dragger'),
                dragTip = select('.dragTip'),
                minDragY = -380,
                liquidId = 0,
                step = Math.abs(minDragY / 50),
                snap = Math.abs(minDragY / 10),
                followerVY = 0;

            gsap.set('svg', { visibility: 'visible' });
            gsap.set(dragTip, { transformOrigin: '20% 50%' });

            var tl = gsap.timeline();
            tl.to(liquid, { x: '-=200', ease: 'none', repeat: -1, stagger: 0.9 });

            tl.time(100);

            document.addEventListener('touchmove', function (event) {
                event.preventDefault();
            });

            Draggable.create(dragger, {
                type: 'y',
                bounds: { minY: minDragY, maxY: 0 },
                onDrag: onUpdate,
                throwProps: true,
                throwResistance: 2300,
                onThrowUpdate: onUpdate,
                overshootTolerance: 0,
                snap: function (value) {
                    // Optional: snap to steps of 10
                    // return Math.round(value / snap) * snap;
                }
            });

            function onUpdate() {
                // Get the current y position of the dragger using gsap.getProperty
                var draggerY = gsap.getProperty(dragger, 'y');
                liquidId = Math.abs(Math.round(draggerY / step));
                label.textContent = liquidId + '°C';;

                gsap.to(liquid, {
                    y: draggerY * 1.12,
                    ease: 'elastic.out(1, 0.4)',
                    duration: 1.3
                });
            }

            gsap.to(follower, {
                y: '+=0',
                repeat: -1,
                duration: 1,
                modifiers: {
                    y: function (y) {
                        var draggerY = gsap.getProperty(dragger, 'y');
                        followerVY += (draggerY - gsap.getProperty(follower, 'y')) * 0.23;
                        followerVY *= 0.69;
                        return gsap.getProperty(follower, 'y') + followerVY;
                    }
                }
            });

            gsap.to(dragTip, {
                rotation: '+=0',
                repeat: -1,
                duration: 1,
                modifiers: {
                    rotation: function (rotation) {
                        return rotation - followerVY;
                    }
                }
            });

            gsap.to(label, {
                y: '+=0',
                repeat: -1,
                duration: 1,
                modifiers: {
                    y: function (y) {
                        return y - followerVY * 0.5;
                    }
                }
            });

            gsap.to(dragger, {
                y: minDragY / 2,
                onUpdate: onUpdate,
                ease: 'expo.inOut',
                duration: 1.4
            });
            function setRangeValue(value, type) {
                // Chuyển đổi giá trị value từ 0-100 thành vị trí y tương ứng
                var newY
                if (type == 'success') {
                    newY = value * (minDragY / 50);
                } else {
                    newY = 1 * (minDragY / 50);
                }


                // Cập nhật vị trí của dragger và các phần liên quan
                gsap.to(dragger, {
                    y: newY,
                    onUpdate: onUpdate, // Gọi lại onUpdate để cập nhật các phần khác
                    ease: "expo.inOut",
                    duration: 1.0 // Tốc độ di chuyển
                });
            }
        });
    </script>
</body>

</html>