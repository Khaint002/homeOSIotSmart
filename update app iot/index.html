<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Scanner</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script> -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />
    <!-- <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script> -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

    <style>
        body {
            font-family: 'Roboto', sans-serif;
            align-items: center;
            height: 100vh;
            background-color: #1c1c1e;
            margin: 0 auto;
            padding: 0;
            max-width: 600px;
        }

        .hidden {
            display: none;
        }

        #toast-container {
            font-size: 14px;
            color: #1d9b21;
        }

        .container-homePage {
            text-align: center;
            /* background: #1E2833; */
            padding: 0 20px 0 20px;
            /* border-radius: 10px; */
            box-shadow: 0px 4px 20px rgba(0, 0, 0, 0.1);
            max-width: 450px;
            width: 100%;
            position: relative;
        }

        .container {
            height: 100vh;
            text-align: center;
            background: #1E2833;
            padding: 0 20px 0 20px;
            /* border-radius: 10px; */
            box-shadow: 0px 4px 20px rgba(0, 0, 0, 0.1);
            max-width: 450px;
            width: 100%;
            position: relative;
        }

        .ScanQR-header {
            text-align: center;
            padding: 0 10px 0 20px;
            /* border-radius: 10px; */
            /* box-shadow: 0px 4px 20px rgba(0, 0, 0, 0.1); */
            max-width: 400px;
            width: 100%;
            background-color: #1E2833;
            height: 50px;
        }

        .container img {
            margin-top: 20px;
        }

        h1 {
            font-size: 24px;
            margin-bottom: 20px;
            color: #333;
        }

        /* video {
            max-height: 60vh;
            width: 100%;
            border-radius: 10px;
            border: 2px solid #626262;
            margin-top: 10px;
            margin-bottom: 10px;
        } */

        #result {
            margin-top: 20px;
            font-size: 1.2em;
            color: #4caf50;
        }

        #homePage .header {
            height: 50px;
            background-color: #22abe3;
        }

        .app-bar {
            background-color: #0c0e13;
            color: white;
            padding: 10px;
            text-align: center;
            display: flex;
            justify-content: space-between;
            height: 55px;
        }

        #status {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: red;
        }

        #thongKe {
            padding: 0;
            margin: 0;
            width: 35px;
            height: 35px;
            border-radius: 12px;
            background-color: #282b32;
            border: none;
        }

        #Upload {
            margin: 0;
            padding: 0;
            width: 35px;
            height: 35px;
            border-radius: 12px;
            background-color: #282b32;
            border: none;
        }

        .ScanQRNext {
            margin: 0;
            padding: 0;
            width: 35px;
            height: 35px;
            border-radius: 12px;
            background-color: #282b32;
            border: none;
        }

        #lateTime {
            width: 200px;
            height: 35px;
            border: solid 1px #282b32;
            border-radius: 515px;
            padding-top: 5px;
            background-color: #282b32;
        }

        #boxValue {
            width: 100%;
            height: 150px;
            background-color: #242427;
            border: solid 1px #484848;
            box-shadow: 2px 2px #0c0c0c;
            color: white;
            border-radius: 10px;
            text-align: center;
            padding-top: 15px;
        }

        #listValue {
            --bs-gutter-x: 0;
            margin: 0 15px 0 15px;
        }

        #acQuy {
            margin: 15px;
        }

        .progress-vertical {
            width: 30px;
            height: 300px;
            display: flex;
            flex-direction: column-reverse;
            margin: 20px;
        }

        .progress-vertical .progress-bar {
            writing-mode: vertical-lr;
            transform: rotate(180deg);
            text-align: center;
        }

        .drop {
            position: relative;
            width: 120px;
            height: 180px;
            background: linear-gradient(to bottom, #67d1fb, #0077b6);
            border-radius: 50% 50% 50% 50%;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            margin: 50px auto;
        }

        .drop .shine {
            position: absolute;
            width: 50px;
            height: 90px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            top: 30px;
            left: 35px;
            transform: rotate(-30deg);
        }

        /* Thông tin lượng mưa bên trong giọt nước */
        #rainfall {
            margin: 0 20px 0 20px;
            background-color: #242427;
            border: solid 1px #484848;
            box-shadow: 2px 2px #0c0c0c;
            border-radius: 10px;
        }

        .rain-info {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
        }

        #Chart {
            margin: 0 20px 0 20px;
        }

        .button-list {
            border: solid 1px rgb(0, 0, 0);
            border-radius: 100px;
            width: 80%;
            padding: 0;
            display: flex;
            justify-content: space-between;
            background-color: #313030;
            float: right;
            margin: 10px;
            margin-right: 0;
        }

        .btn-chart {
            width: 25%;
            height: 30px;
            border: none;
            margin: 0;
            padding: 0;
            border-radius: 50px;
            background-color: #313030;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .btn-chart:hover {
            background-color: #000000;
        }

        .btn-chart.active {
            background-color: #181818 !important;
            color: #fff;
        }

        #switch-btn {
            position: absolute;
            top: 180px;
            right: 30px;
            background-color: rgba(0, 0, 0, 0.5);
            border: none;
            color: white;
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 1000;
        }

        #switch-btn i {
            font-size: 1.5em;
        }

        #switch-btn:hover {
            background-color: rgba(0, 0, 0, 0.7);
        }

        .iconApp {
            box-shadow: 0 0 1px rgba(0, 0, 0, .125), 0 1px 3px rgba(0, 0, 0, .2);
            border-radius: .25rem;
            background-color: #2E3A46;
            /* background-color: #24282c; */
            display: -ms-flexbox;
            display: flex;
            /* margin-bottom: 0.5rem; */
            min-height: 80px;
            padding: .5rem;
            position: relative;
            width: 100%;
            cursor: pointer;
        }

        .close-icon {
            position: absolute;
            top: -8px;
            right: -5px;
            /* Đặt bên tay phải */
            border: 1px solid #fff;
            /* Đường viền trắng */
            background-color: #202830;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            /* Hình tròn */
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
            /* Hiệu ứng đổ bóng */
            cursor: pointer;
            color: #fff;
            z-index: 10;
            /* Đảm bảo nút nằm trên cùng */
        }

        .pickApp-title h4 {
            display: flex;
            justify-content: flex-start;
            color: #fff;
            margin-bottom: 1rem;
        }

        .icon {
            border-radius: .25rem;
            -ms-flex-align: center;
            align-items: center;
            display: -ms-flexbox;
            display: flex;
            font-size: 1.875rem;
            -ms-flex-pack: center;
            justify-content: center;
            text-align: center;
            width: 70px;
        }

        .info-box-content {
            display: -ms-flexbox;
            display: flex;
            -ms-flex-direction: column;
            flex-direction: column;
            -ms-flex-pack: center;
            justify-content: center;
            line-height: 1.8;
            -ms-flex: 1;
            flex: 1;
            padding: 0 10px;
            overflow: hidden;
            text-align: start;
        }

        .app-text {
            display: block;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            color: #c2c7d0;
            padding: 0 10px;
        }

        .app-text-number {
            color: white;
            display: block;
            margin-top: .25rem;
            font-weight: 500;
            padding: 0 10px;
        }

        /* tab chức năng */
        .tab {
            cursor: pointer;
            border-bottom: 1px solid #535353;
        }

        .tab button {
            flex: 1;
            background-color: #1E2833;
            color: #c2c7d0;
            border: none;
            text-align: center;
            border-radius: 5px 5px 0 0;
            height: 40px;
            width: 49%;
        }

        .tab button:hover {
            /* border: 1px solid #626262; */
            border-bottom: none;
        }

        .tab button.active {
            background-color: #222;
            color: #fff;
            border: 1px solid #626262;
            border-bottom: none;
        }

        .tab-content {
            display: none;
            border-top: none;
        }

        .tab-content-guarantee {
            display: none;
            border-top: none;
        }

        .tab-content-history {
            display: none;
            border-top: none;
        }

        .tab-content.active {
            display: block;
        }

        .tab-content-guarantee.active {
            display: block;
        }

        .tab-content-history.active {
            display: block;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1060;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: rgba(0, 0, 0, 0.9);
            /* background-color: white; */
            padding: 0;
            margin: 0;
        }

        /* Phần tử quét QR full màn hình */
        #qr-reader {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }


        #qr-reader video {
            width: auto !important;
            height: 100vh !important;
            width: 100vh !important;
        }

        #qr-shaded-region {
            padding-bottom: 100px;
        }

        #close-scanner {
            position: absolute;
            top: 2%;
            left: 20px;
            height: 35px;
            width: 35px;
            background-color: rgba(0, 0, 0, 0.4);
            border: none;
            color: white;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            z-index: 1001;
            /* Đảm bảo nút ở trên cùng */

            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
        }

        /* Nút chuyển đổi camera */
        #toggle-camera {
            position: absolute;
            top: 2%;
            left: 88%;
            height: 35px;
            width: 35px;
            background-color: rgba(0, 0, 0, 0.4);
            border: none;
            color: white;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            z-index: 1001;
            /* Đảm bảo nút ở trên cùng */

            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
        }

        /* Nút upload hình ảnh */
        #upload-qr {
            position: absolute;
            top: 68%;
            left: 20%;
            color: white;
            border: none;
            cursor: pointer;
            z-index: 1001;
            /* Đảm bảo nút ở trên cùng */
            text-align: center;
        }

        #upload-qr button {
            width: 35px;
            height: 35px;
            border: none;
            background-color: rgba(0, 0, 0, 0.4);
            border-radius: 50%;
            color: white;

            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
        }

        #upload-qr p {
            color: white;
            font-size: 12px;
            margin: 5px 0;
            box-shadow: 0px 4px 20px rgba(0, 0, 0, 0.1);
        }

        /* Input file ẩn */
        #file-input {
            display: none;
        }

        /* form result scan qr */
        #result-form {
            width: 95vh;
            height: 200px;
            position: absolute;
            top: 50%;
            padding: 20px;
            z-index: 1005;
            /* left: 10%; */
        }

        #result-form #result-form-group {
            background-color: #1E2833;
            border-radius: 5px;
            width: 350px;
            padding: 20px;
        }

        .form-total {
            box-shadow: 0 0 1px rgba(0, 0, 0, .125), 0 1px 3px rgba(0, 0, 0, .2);
            margin-bottom: 1rem;
        }

        .header-form {
            background-color: rgb(63, 103, 145, 0.8);
            box-shadow: 0 0 1px rgba(0, 0, 0, .125), 0 1px 3px rgba(0, 0, 0, .2);
            border-radius: 4px 4px 0 0;
            height: 46px;
            padding: 12px 20px;
        }

        .header-form h3 {
            font-size: 1.1rem;
            font-weight: 400;
            color: white;
        }

        .content-form {
            padding: 1.5rem;
            color: white;
            background-color: rgba(0, 0, 0, 0.8);
            border-radius: 0 0 4px 4px;
        }

        .content-form-help {
            border-radius: 0 0 4px 4px;
        }

        .content-form .content-detail {
            text-align: start;
            margin-bottom: 1rem;
        }

        .content-form .content-detail .content-label {
            font-weight: 500;
        }

        .content-form .content-detail .content-input {
            background-color: #343a40;
            border-color: #6c757d;
            color: #fff;
        }

        .content-form .content-detail .content-input::placeholder {
            color: #6c757d;
        }

        .footer-form {
            padding: .75rem 1.25rem;
            background-color: #282d31;
            border-top: 0 solid rgba(0, 0, 0, .125);
            border-radius: 0 0 4px 4px;
        }

        .footer-form button {
            color: #fff;
            background-color: #335476;
            border-color: #304e6d;
        }

        .full-screen-img {
            width: 100vw;
            height: 100vh;
            object-fit: cover;
            position: fixed;
        }

        #LoadScreen {
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            /* Xếp logo và chấm động theo chiều dọc */
        }

        #LogoLoadScreen {
            width: 200px;
        }

        .dots-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 1rem;
        }

        .dot {
            width: 10px;
            height: 10px;
            margin: 0 5px;
            background-color: #fff;
            border-radius: 50%;
            opacity: 0;
            animation: blink 1.5s infinite ease-in-out;
        }

        /* Animation delay for each dot */
        .dot:nth-child(1) {
            animation-delay: 0s;
        }

        .dot:nth-child(2) {
            animation-delay: 0.3s;
        }

        .dot:nth-child(3) {
            animation-delay: 0.6s;
        }

        @keyframes blink {

            0%,
            100% {
                opacity: 0;
            }

            50% {
                opacity: 1;
            }
        }

        .footer-instruct {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            text-align: center;
            padding: 10px 0;
            z-index: 1000;
            color: #fff;
            height: 100px;
        }

        .step {
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            width: 100%;
            margin-bottom: 10px;
        }

        .step::before,
        .step::after {
            content: '';
            height: 2px;
            background-color: #ffffff;
            position: absolute;
            top: 50%;
            width: 45%;
        }

        .step::before {
            left: 0;
        }

        .step::after {
            right: 0;
        }

        .circle {
            background-color: #ffffff;
            color: #2a2f38;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            position: relative;
            z-index: 1;
        }

        .clickScanQR {
            width: 220px;
            height: 220px;
            margin-top: 8vh;
            border: none;
            border-radius: 10px;
            box-shadow: 0 0 1px rgba(0, 0, 0, .125), 0 1px 3px rgba(0, 0, 0, .2);
        }

        #temperature svg {

            width: 50px;
            height: 110px;

        }

        .dragger .label {
            fill: #FFFCF9;
            font-size: 1.8em;
            font-family: "din-condensed-web", sans-serif;
            text-anchor: middle;
            letter-spacing: 1.2px;
            font-size: 25px;
        }

        .tubeLabel {
            fill: #FCEFD6;
            font-size: 1.4em;
            font-family: "din-condensed-web", sans-serif;
            /* font-family: "filson-soft", sans-serif; */
            text-anchor: middle;
        }

        .dragger {
            -webkit-tap-highlight-color: transparent;
        }

        .range-container {
            position: relative;
            width: 30px;
            height: 220px;
            border-radius: 10px;
        }

        /* Solid color sections for each temperature range */
        .range-section {
            position: absolute;
            left: 0;
            width: 100%;
        }

        .section-0-5 {
            background-color: #006600;
            top: 14%;
            height: 14%;
        }

        /* Blue for 0-15°C */
        .section-5-10 {
            background-color: #66cc00;
            top: 28%;
            height: 14%;
        }

        /* Blue for 0-15°C */
        .section-10-20 {
            background-color: #b2ff66;
            top: 42%;
            height: 14%;
        }

        /* Blue for 0-15°C */
        .section-20-50 {
            background-color: #0084ff;
            top: 56%;
            height: 14%;
        }

        /* Blue for 0-15°C */
        .section-50-100 {
            background-color: #7fc1ff;
            top: 70%;
            height: 14%;
        }

        /* Light blue for 15-20°C */
        .section-100-150 {
            background-color: #bfe0ff;
            top: 84%;
            height: 14%;
        }

        /* Green for 20-27°C */
        .section-150-200 {
            background-color: #00ffff;
            top: 0;
            height: 14%;
        }

        /* Red for 27-50°C */

        /* Temperature Labels */
        .label {
            position: absolute;
            left: 90%;
            padding-left: 10px;
            font-size: 12px;
            color: #fff;
        }

        .label-200 {
            top: -6px;
        }

        .label-150 {
            top: 10%;
        }

        .label-100 {
            top: 24%;
        }

        .label-50 {
            top: 37%;
        }

        .label-20 {
            top: 50%;
        }

        .label-10 {
            top: 65%;
        }

        .label-5 {
            top: 80%;
        }

        .label-below-0 {
            bottom: 0;
        }

        /* #qr-shaded-region {
            border-width: 40vh 15vh !important;
        } */

        /* history */
        .history-header {
            text-align: center;
            padding: 0 10px 0 20px;
            max-width: 500px;
            width: 100%;
            background-color: #1E2833;
            height: 50px;
            display: flex;
            justify-content: space-between;
        }

        .history-avt {
            line-height: 50px;
        }

        .history-avt img {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin-top: 10px;
        }

        .history-avt p {
            margin-left: 10px;
            color: white;
        }

        .box-value {
            box-shadow: 0 0 1px rgba(0, 0, 0, .125), 0 1px 3px rgba(0, 0, 0, .2);
            margin-bottom: 1rem;
            padding: 1rem;
            color: white;
            background: rgba(0, 0, 0, 0.6);
            margin: 7.5px;
            border-radius: 4px;
        }

        .header-form {
            background-color: #3f6791;
            box-shadow: 0 0 1px rgba(0, 0, 0, .125), 0 1px 3px rgba(0, 0, 0, .2);
            border-radius: 4px 4px 0 0;
            height: 46px;
            padding: 12px 20px;
        }

        .header-form h3 {
            font-size: 1.1rem;
            font-weight: 400;
            color: white;
        }

        .form-select {
            display: block;
            width: 100%;
            height: 30px;
            padding: .375rem .75rem;
            font-size: 1rem;
            font-weight: 400;
            line-height: 1.5;
            color: #495057;
            background-color: #fff;
            background-clip: padding-box;
            border: 1px solid #ced4da;
            border-radius: .25rem;
            box-shadow: inset 0 0 0 transparent;
            transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out;
        }

        .navbar {
            display: flex;
            align-items: center;
            padding: 10px;
            background-color: #333;
            color: white;
        }

        .menu-button {
            font-size: 24px;
            color: white;
            background: none;
            border: none;
            cursor: pointer;
            margin-right: 10px;
        }

        /* menu */

        .sidebar {
            position: fixed;
            top: 0;
            right: -250px;
            /* Hidden by default */
            width: 250px;
            height: 100%;
            background-color: #2c3e50;
            color: white;
            overflow: auto;
            transition: left 0.3s;
            z-index: 100;
        }

        .sidebar.open {
            right: 0;
        }

        .profile {
            text-align: center;
            padding: 20px;
        }

        .profile-pic {
            width: 50px;
            height: 50px;
            border-radius: 50%;
        }

        .menu {
            list-style: none;
            padding: 0;
        }

        .menu-item {
            padding: 15px;
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .menu-item:hover {
            background-color: #34495e;
        }

        .submenu {
            list-style: none;
            padding: 0 20px;
            display: none;
        }

        .submenu li {
            padding: 10px;
            cursor: pointer;
        }

        .submenu li:hover {
            background-color: #3b4a58;
        }

        .content {
            padding: 20px;
            transition: margin-left 0.3s;
        }

        .arrow {
            font-size: 12px;
        }

        .small-box-footer {
            background-color: rgba(0, 0, 0, .1);
            color: rgba(255, 255, 255, .8);
            display: block;
            padding: 3px 0;
            position: relative;
            text-align: center;
            text-decoration: none;
            z-index: 10;
        }

        .parent-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .parent-item {
            margin-bottom: 10px;
        }

        .toggle-button {
            display: flex;
            align-items: center;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }

        .arrow-icon {
            margin-right: 8px;
            transition: transform 0.3s ease;
        }

        .child-list {
            list-style: none;
            padding-left: 20px;
            display: none;
            /* Ban đầu ẩn */
        }

        /* Item cha */
        #history-setting-detail .parent-item,
        #history-warranty-detail .parent-item,
        #lot-warranty-detail .parent-item {
            margin: 10px 0;
            background: #2A3A4A;
            border-radius: 8px;
            transition: background 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        #history-setting-detail .parent-item:last-child,
        #history-warranty-detail .parent-item:last-child,
        #lot-warranty-detail .parent-item:last-child {
            border-bottom: none;
            /* Loại bỏ viền dưới cho item cuối */
        }

        /* Nút mở rộng */
        #history-setting-detail .toggle-button,
        #history-warranty-detail .toggle-button,
        #lot-warranty-detail .toggle-button {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            background: none;
            border: none;
            padding: 12px 16px;
            font-size: 16px;
            color: #eaeaea !important;
            text-align: left;
            cursor: pointer;
            transition: background 0.3s ease, color 0.3s ease;
        }

        #history-setting-detail .toggle-button:hover,
        #history-warranty-detail .toggle-button:hover,
        #lot-warranty-detail .toggle-button:hover {
            border-radius: 8px;
            color: #fff;
        }

        #history-setting-detail .toggle-button:focus,
        #history-warranty-detail .toggle-button:focus,
        #lot-warranty-detail .toggle-button:focus {
            outline: none;
        }

        /* Icon mũi tên */
        #history-setting-detail .arrow-icon,
        #history-warranty-detail .arrow-icon,
        #lot-warranty-detail .arrow-icon {
            font-size: 14px;
            margin-left: 8px;
            transition: transform 0.3s ease, color 0.3s ease;
            color: #eaeaea;
        }

        /* Khi mở rộng */
        #history-setting-detail .arrow-icon.expanded,
        #history-warranty-detail .arrow-icon.expanded,
        #lot-warranty-detail .arrow-icon.expanded {
            transform: rotate(90deg);
            color: #fff;
        }

        /* Danh sách con */
        #history-setting-detail .child-list,
        #history-warranty-detail .child-list,
        #lot-warranty-detail .child-list {
            border-radius: 0 0 8px 8px;
            list-style: none;
            padding: 0;
            margin: 0;
            background: #1E2833;
            display: none;
            /* Ban đầu ẩn */
            padding: 5px 10px;
        }

        #history-setting-detail .child-list li,
        #history-warranty-detail .child-list li,
        #lot-warranty-detail .child-list li {
            font-size: 14px;
            background-color: #333b44;
            color: #555;
            border-radius: 8px;
            margin: 10px 0;
        }

        #history-setting-detail .child-list li:hover,
        #history-warranty-detail .child-list li:hover,
        #lot-warranty-detail .child-list li:hover {
            cursor: pointer;
        }

        .background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            /* Giữ nền không bị cuộn */
            z-index: -2;
            /* Đẩy nền ra sau tất cả */
        }

        /* Lớp nền 1 - Landscape */
        #landscape {
            position: absolute;
            width: 100%;
            height: 100%;
            background: url(https://s3-us-west-2.amazonaws.com/s.cdpn.io/54046/rainy_landscape.jpeg) center center / cover no-repeat;
            filter: blur(10px);
            animation: eye-focus var(--duration) ease-in infinite alternate,
                focus-shift var(--duration) ease-in infinite alternate;
        }

        /* Lớp nền 2 - Glass */
        #glass {
            position: absolute;
            width: 100%;
            height: 100%;
            /* background: url(https://s3-us-west-2.amazonaws.com/s.cdpn.io/54046/glass_droplets.jpeg) center center / cover no-repeat; */
            background: url(https://i.pinimg.com/736x/9d/1e/b3/9d1eb31563d0694c0eccd2724b5410a9.jpg) center center / cover no-repeat;
            opacity: 0.5;
            /* animation: eye-focus var(--duration) ease-in var(--pause) infinite alternate,
                focus-shift var(--duration) ease-in var(--pause) infinite alternate; */
        }

        @keyframes eye-focus {
            0% {
                filter: blur(0);
            }

            100% {
                filter: blur(10px);
            }
        }

        @keyframes focus-shift {
            0% {
                transform: scale(1);
            }

            100% {
                transform: scale(1.01);
            }
        }

        .custom-option {
            color: #fff;
            background-color: #f39c12;
        }

        #qrcode canvas {
            border-radius: 15px;
            /* Bo góc cho canvas */
            border: 2px solid #000;
            /* Thêm viền nếu cần */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            /* Đổ bóng */
        }

        .bottom-navigation {
            display: flex;
            justify-content: space-around;
            position: fixed;
            bottom: 5px;
            left: 0;
            right: 0;
            background-color: #282d31;
            border-radius: 50px;
            padding: 10px 0;
            box-shadow: 0 -1px 5px rgba(0, 0, 0, 0.1);
            width: 95%;
            margin: 2.5%;
        }

        .bottom-navigation button {
            background-color: transparent;
            border: none;
            color: #fff;
            font-size: 14px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .bottom-navigation button:focus {
            color: #1976d2;
        }

        .bottom-navigation button img {
            width: 24px;
            height: 24px;
            margin-bottom: 5px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .blinking {
            animation: blink 0.5s linear infinite;
        }

        .card {
            background-color: #343a40;
            color: #fff;
            box-shadow: 0 0 1px rgba(0, 0, 0, .125), 0 1px 3px rgba(0, 0, 0, .2);
            margin-bottom: 1rem;
        }

        .card-header {
            background-color: transparent;
            border-bottom: 1px solid rgba(0, 0, 0, .125);
            padding: .75rem 1.25rem;
            position: relative;
            border-top-left-radius: .25rem;
            border-top-right-radius: .25rem;
            height: 50px;
        }

        .card-header>.card-tools {
            float: right;
            margin-right: -.625rem;
        }

        .card-body {
            -ms-flex: 1 1 auto;
            flex: 1 1 auto;
            min-height: 1px;
            padding: 1.25rem;
        }

        .badge-info {
            color: #fff;
            background-color: #17a2b8;
            font-weight: 200;
        }

        .products-list {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .products-list .item {
            background-color: #343a40;
            color: #fff;
            border-bottom-color: #6c757d;
            border-radius: 0;
            border-bottom: 1px solid rgba(0, 0, 0, .125);
            padding: 10px 0;
        }

        .products-list .product-img {
            float: left;
        }

        .products-list .product-info {
            margin-left: 60px;
            text-align: start;
        }

        .products-list .product-info .span {
            float: right;
        }

        .products-list .product-info a {
            color: #3395ff;
            text-decoration: none;
        }

        .products-list .product-info a:not(.btn):hover {
            color: #3395ff;
        }

        .products-list .product-img img {
            height: 50px;
            width: 50px;
            margin-top: 0;
            object-fit: cover;
        }

        .products-list .product-description {
            color: #6c757d;
            display: block;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .card-title {
            float: left;
            font-size: 1.1rem;
            font-weight: 400;
            margin: 0;
        }

        .menuWarranty {
            color: #1976d2 !important;
        }

        .bottom-navigation button:focus,
        .tab button:focus {
            outline: none;
            /* Bỏ hiệu ứng khi focus */
        }

        .vertical-timeline {
            width: 100%;
            position: relative;
            padding: 1.5rem 0 1rem;
        }

        .vertical-timeline::before {
            content: '';
            position: absolute;
            top: 0;
            left: 80px;
            height: 100%;
            width: 4px;
            background: #888b8f;
            border-radius: .25rem;
        }

        .vertical-timeline-element {
            position: relative;
            margin: 0 0 1rem;
        }

        .vertical-timeline--animate .vertical-timeline-element-icon.bounce-in {
            visibility: visible;
            animation: cd-bounce-1 .8s;
        }

        .vertical-timeline-element-icon {
            position: absolute;
            top: 0;
            left: 73px;
        }

        .vertical-timeline-element-icon .badge-dot-xl {
            box-shadow: 0 0 0 5px #fff;
        }

        .badge-dot-xl {
            width: 18px;
            height: 18px;
            position: relative;
        }

        .badge:empty {
            display: none;
        }


        .badge-dot-xl::before {
            content: '';
            width: 10px;
            height: 10px;
            border-radius: .25rem;
            position: absolute;
            left: 50%;
            top: 50%;
            margin: -5px 0 0 -5px;
            background: #fff;
        }

        .vertical-timeline-element-content {
            position: relative;
            margin-left: 100px;
            font-size: .8rem;
            color: #fff;
            text-align: start;
        }

        .vertical-timeline-element-content .timeline-title {
            font-size: .8rem;
            text-transform: uppercase;
            margin: 0 0 .5rem;
            padding: 2px 0 0;
        }

        .vertical-timeline-element-content .vertical-timeline-element-date {
            display: block;
            position: absolute;
            left: -90px;
            top: -20px;
            padding-right: 10px;
            text-align: right;
            color: #adb5bd;
            font-size: .7619rem;
            white-space: nowrap;
        }

        .vertical-timeline-element-content .vertical-timeline-element-dateTime {
            display: block;
            position: absolute;
            left: -90px;
            top: 0;
            padding-right: 10px;
            text-align: right;
            color: #adb5bd;
            font-size: .7619rem;
            white-space: nowrap;
        }

        .vertical-timeline-element-content:after {
            content: "";
            display: table;
            clear: both;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .spin-loading {
            animation: spin 1s linear infinite;
        }

        .marker-wrapper {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
            /* animation: bounce 1s infinite ease-in-out; */
            transform-origin: bottom center;
        }

            .marker-label {
                min-width: 40px;
                min-height: 12px;
                font-size: 14px;
                font-weight: bold;
                color: black;
                margin-bottom: 4px;
                line-height: 1;
                transition: transform 0.2s;
            }

            .marker-pin {
                width: 28px;
                height: 28px;
                transition: transform 0.2s;
                position: relative;
                z-index: 1;  /* Place marker-pin below mePin-wrapper */
            }

            .mePin-wrapper {
                position: absolute;
                top: 25px;  /* Adjust to make mePin-wrapper overlap marker-pin */
                right: -10px;
                z-index: 1;  /* Ensure mePin-wrapper is below the "R" text */
            }

            .mePin-child{
                position: relative;
            }

            .mePin-wrapper b {
                position: absolute;
                top: 2px;  /* Adjust to make "R" appear above the mePin */
                right: 10px;
                /*color: #dc3545;*/
                color: #5984ff;
                font-weight: bold;
                z-index: 2;  /* Ensure "R" text is above mePin */
                font-size: 12px;
            }

            #mePin {
                width: 33.3px;
                height: 32.4px;
                position: relative;
                opacity: 1; /* Initially visible */
                animation: fadeInBoth 4s infinite ease-in-out;
                animation-delay: 1s; /* Delay the start of the animation by 1 second */
            }

            .ring_outer {
                opacity: 1; /* Initially visible */
                animation: fadeOutRingOuter 4s infinite ease-in-out;
                animation-delay: 1s; /* Delay the start of the outer ring's animation by 1 second */
            }

            .ring_inner {
                opacity: 1; /* Initially visible */
                animation: fadeOutRingInner 4s infinite ease-in-out;
                animation-delay: 1s; /* Delay the start of the inner ring's animation by 1 second */
            }


            @keyframes fadeOutRingOuter {
                0% {
                    opacity: 1; /* Fully visible at the start */
                }
                50% {
                    opacity: 0; /* Fades out at the midpoint */
                }
                100% {
                    opacity: 0; /* Stays hidden after fading out */
                }
            }

            @keyframes fadeOutRingInner {
                0% {
                    opacity: 1; /* Fully visible at the start */
                }
                50% {
                    opacity: 1; /* Stays visible until the midpoint */
                }
                100% {
                    opacity: 0; /* Fades out at the end */
                }
            }

            @keyframes fadeInBoth {
                0%, 50% {
                    opacity: 1; /* Both rings are visible at the start and midpoint */
                }
                100% {
                    opacity: 1; /* Both rings reappear at the end */
                }
            }



            @keyframes bounce {
            0%, 100% {
                transform: translateY(0) scale(1, 1);
            }
            50% {
                transform: translateY(-18px) scale(1, 1);
            }
            70% {
                transform: translateY(0) scale(1.2, 0.5); /* ép mạnh hơn: cao thấp méo ngang */
            }
            85% {
                transform: translateY(0) scale(0.95, 1.05); /* dội lại */
            }
            }

        .bounce-animation {
            animation: bounce 1s infinite ease-in-out;
        }
        .custom-marker {
            margin-left: -16px;
            margin-top: -16px;
            width: 20px;
            height: 20px;
            transform: translate3d(321px, 41px, 0px);
            outline: none;
            --pos-x: 321px;
            --pos-y: 41px;
            --pos-y-jump: 26px;
            --pos-y-contract: 53px;
            --scale-contract: 0.4;
            --duration-jump: 211ms;
            --duration-contract: 199ms;
            --delays: 0ms, 211ms, 422ms, 621ms;
            opacity: 1;
            z-index: 41;
        }
        #mappingWorkstation {
            height: 100%; /* hoặc 500px, tùy layout */
            width: 100%;
            z-index: 1;
        }
        .leaflet-marker-pane {
            margin-top: 18px !important;
        }
        .leaflet-popup {
            bottom: -35px !important;
        }
        .leaflet-control-attribution {
            display: none !important;
        }

        .chat-bubble {
            background-color: #0e0e0f;
            border-radius: 20px;
            padding: 10px 20px;
            display: inline-block;
            margin-bottom: 10px;
        }
        .star-icon {
            color: #1e88e5;
            font-size: 1.2rem;
        }
        .chat-input {
            background-color: #1e1e1e;
            border: none;
            border-radius: 20px;
            color: white;
        }
        .chat-input:hover {
            background-color: #1e1e1e;
            border: none;
            border-radius: 20px;
            color: white;
        }
        .chat-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: #1e1e1e;
            padding: 10px 20px;
        }

    </style>
</head>

<body>
    <div class="app h-100">
        <div id="LoadScreen">
            <img id="LogoLoadScreen" src="https://central.homeos.vn/images/Logo_HomeOS_White.png" alt="" width="200">
            <img id="img-station" class="hidden full-screen-img"
                src="https://central.homeos.vn/images/MiniAppLoadingScreen.png" alt="Full Screen">
            <div id="" class=" dots-container">
                <div class="dot">.</div>
                <div class="dot">.</div>
                <div class="dot">.</div>
            </div>
        </div>
        <div id="pickApp" class="hidden h-100">
            <div class="container">
                <div id="QUYEN" class="row">
                    <div class="col-12" style="padding: 10px;">
                        <div id="PickApp-button-login" class="iconApp" style="background-color: #1265b9;">
                            <div class="icon d-none" style="background-color: #b7761b; width: 60px; height: 60px;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" style="color: #fff;"
                                    fill="currentColor" class="bi bi-box-arrow-in-right" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd"
                                        d="M6 3.5a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-2a.5.5 0 0 0-1 0v2A1.5 1.5 0 0 0 6.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-8A1.5 1.5 0 0 0 5 3.5v2a.5.5 0 0 0 1 0z" />
                                    <path fill-rule="evenodd"
                                        d="M11.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H1.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708z" />
                                </svg>
                            </div>
                            <div class="info-box-content" style="justify-content: start;">
                                <div class="d-flex justify-content-between">
                                    <span class="app-text-number" style="font-size: 16px; padding: 0;">Liên kết tài
                                        khoản</span>
                                    <span class="app-text d-none">v1.1.5</span>
                                </div>
                                <span class="app-text" style="padding: 0; color: #fff; font-size: 14px;">Liên kết tài
                                    khoản để có Trải nhiệm tốt nhất</span>
                            </div>
                        </div>
                    </div>
                </div>
                <img id="LogoPickScreen" src="https://central.homeos.vn/images/Logo_HomeOS_White.png" alt="" width="200" style="padding-bottom: 3rem;">
                <div style="text-align: start; color: white;">
                    <h5>Ứng dụng:</h5>
                </div>
                <div class="row">
                    <div class="col-12" style="padding: 5px 10px;">
                        <div id="PickApp-button-mua" class="iconApp">
                            <div class="icon" style="background-color: #17a2b8;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor" style="color: #fff;" class="bi bi-cloud-sun" viewBox="0 0 16 16">
                                    <path d="M7 8a3.5 3.5 0 0 1 3.5 3.555.5.5 0 0 0 .624.492A1.503 1.503 0 0 1 13 13.5a1.5 1.5 0 0 1-1.5 1.5H3a2 2 0 1 1 .1-3.998.5.5 0 0 0 .51-.375A3.5 3.5 0 0 1 7 8m4.473 3a4.5 4.5 0 0 0-8.72-.99A3 3 0 0 0 3 16h8.5a2.5 2.5 0 0 0 0-5z" />
                                    <path d="M10.5 1.5a.5.5 0 0 0-1 0v1a.5.5 0 0 0 1 0zm3.743 1.964a.5.5 0 1 0-.707-.707l-.708.707a.5.5 0 0 0 .708.708zm-7.779-.707a.5.5 0 0 0-.707.707l.707.708a.5.5 0 1 0 .708-.708zm1.734 3.374a2 2 0 1 1 3.296 2.198q.3.423.516.898a3 3 0 1 0-4.84-3.225q.529.017 1.028.129m4.484 4.074c.6.215 1.125.59 1.522 1.072a.5.5 0 0 0 .039-.742l-.707-.707a.5.5 0 0 0-.854.377M14.5 6.5a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1z" />
                                </svg>
                            </div>
                            <div class="info-box-content">
                                <div class="d-flex justify-content-between">
                                    <span class="app-text">Môi trường</span>
                                    <span class="app-text">v1.1.7</span>
                                </div>
                                <span class="app-text-number">Khí tượng thuỷ văn</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 d-none" style="padding: 5px 10px;">
                        <div id="PickApp-button-IOT" class="iconApp">
                            <div class="icon" style="background-color: #da4a58!important;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor" style="color: #fff;" class="bi bi-pc-display-horizontal" viewBox="0 0 16 16">
                                    <path d="M1.5 0A1.5 1.5 0 0 0 0 1.5v7A1.5 1.5 0 0 0 1.5 10H6v1H1a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-5v-1h4.5A1.5 1.5 0 0 0 16 8.5v-7A1.5 1.5 0 0 0 14.5 0zm0 1h13a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-7a.5.5 0 0 1 .5-.5M12 12.5a.5.5 0 1 1 1 0 .5.5 0 0 1-1 0m2 0a.5.5 0 1 1 1 0 .5.5 0 0 1-1 0M1.5 12h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1 0-1M1 14.25a.25.25 0 0 1 .25-.25h5.5a.25.25 0 1 1 0 .5h-5.5a.25.25 0 0 1-.25-.25" />
                                </svg>
                            </div>
                            <div class="info-box-content">
                                <div class="d-flex justify-content-between">
                                    <span class="app-text">Web OS</span>
                                    <span class="app-text">v4.56 Pro</span>
                                </div>
                                <span class="app-text-number">IIoT</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 d-none" style="padding: 5px 10px;">
                        <div class="iconApp">
                            <div class="icon" style="background-color: #28a745!important;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" style="color: white;" fill="currentColor" class="bi bi-lightbulb-fill" viewBox="0 0 16 16">
                                    <path d="M2 6a6 6 0 1 1 10.174 4.31c-.203.196-.359.4-.453.619l-.762 1.769A.5.5 0 0 1 10.5 13h-5a.5.5 0 0 1-.46-.302l-.761-1.77a2 2 0 0 0-.453-.618A5.98 5.98 0 0 1 2 6m3 8.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1l-.224.447a1 1 0 0 1-.894.553H6.618a1 1 0 0 1-.894-.553L5.5 15a.5.5 0 0 1-.5-.5" />
                                </svg>
                            </div>
                            <div class="info-box-content">
                                <div class="d-flex justify-content-between">
                                    <span class="app-text">Đèn</span>
                                    <span class="app-text">v6.10.24</span>
                                </div>
                                <span class="app-text-number">Chiếu sáng thông minh</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-12" style="padding: 5px 10px;">
                        <div id="PickApp-button-warranty" class="iconApp">
                            <div class="icon" style="background-color: #e29038!important;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" style="color: #fff;" fill="currentColor" class="bi bi-tools" viewBox="0 0 16 16">
                                    <path d="M1 0 0 1l2.2 3.081a1 1 0 0 0 .815.419h.07a1 1 0 0 1 .708.293l2.675 2.675-2.617 2.654A3.003 3.003 0 0 0 0 13a3 3 0 1 0 5.878-.851l2.654-2.617.968.968-.305.914a1 1 0 0 0 .242 1.023l3.27 3.27a.997.997 0 0 0 1.414 0l1.586-1.586a.997.997 0 0 0 0-1.414l-3.27-3.27a1 1 0 0 0-1.023-.242L10.5 9.5l-.96-.96 2.68-2.643A3.005 3.005 0 0 0 16 3q0-.405-.102-.777l-2.14 2.141L12 4l-.364-1.757L13.777.102a3 3 0 0 0-3.675 3.68L7.462 6.46 4.793 3.793a1 1 0 0 1-.293-.707v-.071a1 1 0 0 0-.419-.814zm9.646 10.646a.5.5 0 0 1 .708 0l2.914 2.915a.5.5 0 0 1-.707.707l-2.915-2.914a.5.5 0 0 1 0-.708M3 11l.471.242.529.026.287.445.445.287.026.529L5 13l-.242.471-.026.529-.445.287-.287.445-.529.026L3 15l-.471-.242L2 14.732l-.287-.445L1.268 14l-.026-.529L1 13l.242-.471.026-.529.445-.287.287-.445.529-.026z" />
                                </svg>
                            </div>
                            <div class="info-box-content">
                                <div class="d-flex justify-content-between">
                                    <span class="app-text">Bảo hành</span>
                                    <span class="app-text">v1.0.4</span>
                                </div>
                                <span class="app-text-number">Bảo hành sản phẩm</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-12" style="padding: 5px 10px;">
                        <div id="PickApp-button-condition" class="iconApp">
                            <div class="icon" style="background-color: #17a2b8;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor" style="color: #fff;" class="bi bi-toggles" viewBox="0 0 16 16">
                                    <path d="M4.5 9a3.5 3.5 0 1 0 0 7h7a3.5 3.5 0 1 0 0-7zm7 6a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5m-7-14a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5m2.45 0A3.5 3.5 0 0 1 8 3.5 3.5 3.5 0 0 1 6.95 6h4.55a2.5 2.5 0 0 0 0-5zM4.5 0h7a3.5 3.5 0 1 1 0 7h-7a3.5 3.5 0 1 1 0-7" />
                                </svg>
                            </div>
                            <div class="info-box-content">
                                <div class="d-flex justify-content-between">
                                    <span class="app-text">Điều khiển</span>
                                    <span class="app-text">v1.0.4</span>
                                </div>
                                <span class="app-text-number">Điều khiển, giám sát năng lượng</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 d-none" style="padding: 5px 10px;">
                        <div id="PickApp-button-AI" class="iconApp">
                            <div class="icon" style="background-color: #17a2b8;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor" style="color: #fff;" class="bi bi-chat-dots" viewBox="0 0 16 16">
                                    <path d="M5 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2"/>
                                    <path d="m2.165 15.803.02-.004c1.83-.363 2.948-.842 3.468-1.105A9 9 0 0 0 8 15c4.418 0 8-3.134 8-7s-3.582-7-8-7-8 3.134-8 7c0 1.76.743 3.37 1.97 4.6a10.4 10.4 0 0 1-.524 2.318l-.003.011a11 11 0 0 1-.244.637c-.079.186.074.394.273.362a22 22 0 0 0 .693-.125m.8-3.108a1 1 0 0 0-.287-.801C1.618 10.83 1 9.468 1 8c0-3.192 3.004-6 7-6s7 2.808 7 6-3.004 6-7 6a8 8 0 0 1-2.088-.272 1 1 0 0 0-.711.074c-.387.196-1.24.57-2.634.893a11 11 0 0 0 .398-2"/>
                                </svg>
                            </div>
                            <div class="info-box-content">
                                <div class="d-flex justify-content-between">
                                    <span class="app-text">AI</span>
                                    <span class="app-text">v1.0.1</span>
                                </div>
                                <span class="app-text-number">Chat AI</span>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- <div class="footer-instruct">
                    <div class="step">
                        <div class="circle">01</div>
                    </div>
                    <p>Chọn ứng dụng muốn xem</p>
                </div> -->
            </div>
        </div>
        <div id="history" class="hidden h-100">
            <div class="container" style="padding: 0;">
                <div class="history-header">
                    <div class="history-avt">
                        <div class="d-flex">
                            <img class="userAvt"
                                src="https://static.vecteezy.com/system/resources/previews/009/292/244/non_2x/default-avatar-icon-of-social-media-user-vector.jpg"
                                alt="">
                            <p class="userName">Khách</p>
                        </div>
                    </div>
                    <div id="category-back" class="d-none">
                        <button id="backCategory" style="height: 50px; border: none; background-color: #1E2833;" >
                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                                style="color: #fff; margin-right: 10px;" class="bi bi-arrow-left" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8" />
                            </svg>
                        </button>
                    </div>
                    <div>
                        <div style="line-height: 50px; float: left;" id="extra_view"></div>
                        <div style="line-height: 50px; float: left;">
                            <button id="PickApp-button-scanQR"
                                style="height: 40px; border: none; background-color: #1E2833;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" style="color: #fff"
                                    fill="currentColor" class="bi bi-plus" viewBox="0 0 16 16">
                                    <path
                                        d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4" />
                                </svg>
                            </button>
                        </div>
                        <div style="line-height: 50px; float: left;">
                            <button class="menuToggle" style="height: 40px; border: none; background-color: #1E2833;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" style="color: #fff;" fill="currentColor" class="bi bi-list" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5" />
                                </svg>
                            </button>
                        </div>
                    </div>
                    <aside id="sidebar" class="sidebar">
                        <div class="profile">
                            <img src="https://central.homeos.vn/images/Logo_HomeOS_White.png" alt="" width="200"
                                style="margin-bottom: 30px; margin-top: 20px;">
                        </div>
                        <ul class="menu">
                            <li>
                                <div class="d-flex menu-item" style="color: #fff; padding-left: 10px;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" style="color: #fff;"
                                        fill="currentColor" class="bi bi-house" viewBox="0 0 16 16">
                                        <path
                                            d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L2 8.207V13.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V8.207l.646.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293zM13 7.207V13.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V7.207l5-5z" />
                                    </svg>
                                    <span class="Pre-pickApp" style="padding-left: 10px; padding-left: 10px;">Giải pháp
                                        thông minh</span>
                                </div>
                            </li>
                            <li class="workstation_category">
                                <div class="d-flex menu-item" style="color: #fff; padding-left: 10px;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                                        class="bi bi-gear" viewBox="0 0 16 16">
                                        <path
                                            d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492M5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0" />
                                        <path
                                            d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115z" />
                                    </svg>
                                    <span style="padding-left: 10px; padding-left: 10px;">Quản lý danh mục</span>
                                </div>
                            </li>
                            <li class="workstation_access">
                                <div class="d-flex menu-item" style="color: #fff; padding-left: 10px;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25"
                                        style="color: #d2d6db;" fill="currentColor"
                                        class="bi bi-cloud-lightning-rain-fill" viewBox="0 0 16 16">
                                        <path
                                            d="M2.658 11.026a.5.5 0 0 1 .316.632l-.5 1.5a.5.5 0 1 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.316m9.5 0a.5.5 0 0 1 .316.632l-.5 1.5a.5.5 0 0 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.316m-7.5 1.5a.5.5 0 0 1 .316.632l-.5 1.5a.5.5 0 1 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.316m9.5 0a.5.5 0 0 1 .316.632l-.5 1.5a.5.5 0 0 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.316m-7.105-1.25A.5.5 0 0 1 7.5 11h1a.5.5 0 0 1 .474.658l-.28.842H9.5a.5.5 0 0 1 .39.812l-2 2.5a.5.5 0 0 1-.875-.433L7.36 14H6.5a.5.5 0 0 1-.447-.724zm6.352-7.249a5.001 5.001 0 0 0-9.499-1.004A3.5 3.5 0 1 0 3.5 10H13a3 3 0 0 0 .405-5.973" />
                                    </svg>
                                    <span style="padding-left: 10px; padding-left: 10px;">Truy cập Trạm</span>
                                </div>
                            </li>
                            <li class="warranty_scanQRcode">
                                <div class="d-flex menu-item" style="color: #fff; padding-left: 10px;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                                        class="bi bi-list-ul" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd"
                                            d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2" />
                                    </svg>
                                    <span style="padding-left: 10px; padding-left: 10px;">Thông tin sản phẩm</span>
                                </div>
                            </li>
                            <li class="warranty_scansQRcode">
                                <div class="d-flex menu-item" style="color: #fff; padding-left: 10px;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor"
                                        class="bi bi-qr-code" viewBox="0 0 16 16">
                                        <path d="M2 2h2v2H2z" />
                                        <path d="M6 0v6H0V0zM5 1H1v4h4zM4 12H2v2h2z" />
                                        <path d="M6 10v6H0v-6zm-5 1v4h4v-4zm11-9h2v2h-2z" />
                                        <path
                                            d="M10 0v6h6V0zm5 1v4h-4V1zM8 1V0h1v2H8v2H7V1zm0 5V4h1v2zM6 8V7h1V6h1v2h1V7h5v1h-4v1H7V8zm0 0v1H2V8H1v1H0V7h3v1zm10 1h-1V7h1zm-1 0h-1v2h2v-1h-1zm-4 0h2v1h-1v1h-1zm2 3v-1h-1v1h-1v1H9v1h3v-2zm0 0h3v1h-2v1h-1zm-4-1v1h1v-2H7v1z" />
                                        <path d="M7 12h1v3h4v1H7zm9 2v2h-3v-1h2v-1z" />
                                    </svg>
                                    <span style="padding-left: 10px; padding-left: 10px;">Quét lô sản phẩm</span>
                                </div>
                            </li>
                            <li class="warranty_lot">
                                <div class="d-flex menu-item" style="color: #fff; padding-left: 10px;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor"
                                        class="bi bi-box-seam" viewBox="0 0 16 16">
                                        <path
                                            d="M8.186 1.113a.5.5 0 0 0-.372 0L1.846 3.5l2.404.961L10.404 2zm3.564 1.426L5.596 5 8 5.961 14.154 3.5zm3.25 1.7-6.5 2.6v7.922l6.5-2.6V4.24zM7.5 14.762V6.838L1 4.239v7.923zM7.443.184a1.5 1.5 0 0 1 1.114 0l7.129 2.852A.5.5 0 0 1 16 3.5v8.662a1 1 0 0 1-.629.928l-7.185 2.874a.5.5 0 0 1-.372 0L.63 13.09a1 1 0 0 1-.63-.928V3.5a.5.5 0 0 1 .314-.464z" />
                                    </svg>
                                    <span style="padding-left: 10px; padding-left: 10px;">Quản lý và xuất lô hàng</span>
                                </div>
                            </li>
                            <li>
                                <div class="d-flex menu-item" style="color: #fff; padding-left: 10px;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                                        style="color: #fff; padding-top: 5px;" class="bi bi-question-circle-fill"
                                        viewBox="0 0 16 16">
                                        <path
                                            d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M5.496 6.033h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286a.237.237 0 0 0 .241.247m2.325 6.443c.61 0 1.029-.394 1.029-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94 0 .533.425.927 1.01.927z" />
                                    </svg>
                                    <span style="padding-left: 10px; padding-left: 10px;">Thông tin công ty</span>
                                </div>
                            </li>
                        </ul>
                    </aside>
                </div>
                <div id="history-homePage">
                    <div class="history-body" style="padding: 20px 10px 0 10px;">
                        <div id="listTabMap" style="margin-bottom: 10px;">
                            <div class="tab">
                                <button id="tab-historys" class="tablinks tablinkHistory active">Quan trắc</button>
                                <button id="tab-map" class="tablinks tablinkHistory">Bản đồ</button>
                            </div>
                        </div>
                        <div id="tabHistory" class="tab-content-history active">
                            <div id="nameHistory" class="d-flex d-none" style="color: #fff; padding-left: 10px;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-pc-horizontal" viewBox="0 0 16 16">
                                    <path d="M1 6a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1zm11.5 1a.5.5 0 1 1 0 1 .5.5 0 0 1 0-1m2 0a.5.5 0 1 1 0 1 .5.5 0 0 1 0-1M1 7.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5M1.25 9h5.5a.25.25 0 0 1 0 .5h-5.5a.25.25 0 0 1 0-.5" />
                                </svg>
                                <h5 id="NameHistoryPage" style="padding-left: 10px; padding-left: 10px;">Quan trắc:</h5>
                            </div>
                            <div class="d-flex justify-content-between" style="width: 100%; padding-left: 10px;">
                                <p id="descHistoryPage" style="color: #fff; text-align: left;">Lịch sử truy cập:</p>
                                <div>
                                    <select id="historySelect" class="form-select bg-dark text-white border-secondary" style="font-size: 14px;" aria-label="Default select example">
                                        <option selected>Hiển thị tất cả...</option>
                                    </select>
                                </div>
                            </div>
                            <div id="history-detail" style="overflow-y: auto; height: 450px; padding: 10px 10px 0 10px;">
                                <div style="margin-top: 10px; display: flex; justify-content: center; align-items: center;">
                                    <button id="addWorkStation" style="width: 200px; height: 200px; border-radius: 50%; border: 1px dashed #fff; background-color: #1E2833; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #fff; font-size: 14px; text-align: center;">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" style="color: #fff; margin-bottom: 8px;" fill="currentColor" class="bi bi-plus" viewBox="0 0 16 16">
                                            <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4" />
                                        </svg>
                                        Thêm mới
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div id="tabMap" class="tab-content-history">
                            <div id="mappingWorkstation"></div>
                        </div>
                    </div>
                    <!-- <div id="footer-instruct" class="footer-instruct">
                        <div class="step" style="margin: 0;">
                            <div class="circle">02</div>
                        </div>
                        <div class="d-flex justify-content-center" style="align-items: center;">
                            <img src="https://central.homeos.vn/images/Logo-Home-OS-crop.png"
                                style="width: 30px; height: 35px; margin: 0 5px 20px 0;" alt="">
                            <p id="footerHistoryPage">Thêm mới mã trạm hoặc chọn trạm đã lưu</p>
                        </div>
                    </div> -->
                </div>
                <div id="history-setting" class="history-body d-none" style="padding: 0 10px 0 10px; margin-top: 20px;">
                    <!-- <img src="https://central.homeos.vn/images/Logo_HomeOS_White.png" alt="" width="200" style="margin-bottom: 30px; margin-top: 20px;"> -->
                    <div id="list-category">
                        <div>
                            <div class="d-flex" style="color: #fff; padding-left: 10px;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-gear" viewBox="0 0 16 16">
                                    <path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492M5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0" />
                                    <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115z" />
                                </svg>
                                <h6 style="padding-left: 10px; padding-left: 10px;">Quản lý danh mục trạm:</h6>
                            </div>
                        </div>
                        <ul id="history-setting-detail" style="overflow-y: auto; max-height: 500px; padding: 10px 10px 0 10px;">
                            <div class="col-12" style="margin-top: 10px; display: flex; justify-content: center; align-items: center;">
                                <button id="addCategory" style="width: 200px; height: 200px; border-radius: 50%; border: 1px dashed #fff; background-color: #1E2833; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #fff; font-size: 14px; text-align: center;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" style="color: #fff; margin-bottom: 8px;" fill="currentColor" class="bi bi-plus" viewBox="0 0 16 16">
                                        <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4" />
                                    </svg>
                                    Tạo mới danh mục trạm.
                                </button>
                            </div>
                        </ul>
                        <div style="width: 100%;padding: 10px">
                            <button id="btnAddCategory" class="d-none btn btn-warning"
                                style="background-color: #f39c12;border: solid 1px #f39c12; width: 100%; height: 35px; color: #fff; padding: 3px 10px;">Thêm
                                mới</button>
                        </div>
                    </div>
                    <div id="save-category" class="d-none">
                        <div class="d-flex" style="color: #fff; padding-left: 10px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                                class="bi bi-gear" viewBox="0 0 16 16">
                                <path
                                    d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492M5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0" />
                                <path
                                    d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115z" />
                            </svg>
                            <h5 style="padding-left: 10px; padding-left: 10px;">Thêm mới danh mục trạm:</h5>
                        </div>
                        <div>
                            <div style="text-align: start; margin: 15px 0; padding: 0 10px;">
                                <span style="color: #fff;">Tên danh mục:</span>
                                <input id="name-category" maxlength="20" type="text"
                                    style="width: 100%; height: 30px; color: #fff; padding-left: 20px; margin-top: 10px; background-color: #343a40; border: none; border-bottom: 1px solid #626262;"
                                    placeholder="Nhập Tên danh mục...">
                            </div>
                            <div>
                                <div class="d-flex justify-content-between" style="width: 100%; padding: 0 10px;">
                                    <p style="color: #fff; text-align: left;">Chọn trạm:</p>
                                    <div>
                                        <input id="search-category" type="text"
                                            style="width: 100%; height: 30px; color: #fff; padding-left: 20px; background-color: #343a40; border: none; border-bottom: 1px solid #626262;"
                                            placeholder="Tìm kiếm trạm...">
                                    </div>
                                </div>
                                <div id="list-history-detail"
                                    style="overflow-y: auto; height: 300px; padding: 10px 10px 0 10px;">

                                </div>
                                <div class="d-flex justify-content-between" style="width: 100%; padding: 10px;">
                                    <p style="color: #fff; text-align: left;">Trạm đã Chọn:</p>
                                    <div>
                                        <button id="saveCategory" class="btn btn-warning"
                                            style="background-color: #f39c12;border: solid 1px #f39c12; width: 100%; height: 35px; color: #fff;">Lưu
                                            danh mục</button>
                                    </div>
                                </div>
                                <div id="list-history-add"
                                    style="overflow-y: auto; height: 200px; padding: 10px 10px 0 10px;">

                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="detail-category" class="d-none">
                        <div class="d-flex" style="color: #fff; padding-left: 10px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                                class="bi bi-gear" viewBox="0 0 16 16">
                                <path
                                    d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492M5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0" />
                                <path
                                    d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115z" />
                            </svg>
                            <h5 style="padding-left: 10px; padding-left: 10px;">Chi tiết danh mục trạm:</h5>
                        </div>
                        <div>
                            <div style="text-align: start; margin: 15px 0; padding: 0 10px;">
                                <span style="color: #fff;">Tên danh mục:</span>
                            </div>
                            <div>
                                <div class="d-flex justify-content-between" style="width: 100%; padding: 0 10px;">
                                    <p style="color: #fff; text-align: left;">Danh sách trạm:</p>
                                </div>
                                <div id="list-category-detail"
                                    style="overflow-y: auto; height: 300px; padding: 10px 10px 0 10px;">

                                </div>
                            </div>
                        </div>
                        <div style="width: 100%;padding: 10px 3px;">
                            <button id="btnRemoveCategory" class="d-none btn btn-warning"
                                style="background-color: #d72323;border: solid 1px #d72323; width: 100%; height: 35px; color: #fff; padding: 3px 10px;">Thêm
                                mới</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="ScanQR" class="hidden h-100">
            <div class="container" style="padding: 0;">
                <div class="ScanQR-header">
                    <div style="line-height: 50px; float: left;">
                        <button id="PickApp-button-pick" style="height: 40px; border: none; background-color: #1E2833;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                style="color: #fff; margin-right: 10px;" class="bi bi-arrow-left" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8" />
                            </svg>
                        </button>

                        <!-- <img style="padding: 0; margin: 0;"
                            src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAMAAABF0y+mAAAA21BMVEVHcEzR7/mGqsR6pcHd8PaqzuCDrcdHfKMVYJEBWYw1cZz+///39fOMsMhUhqkeZZQ4cZwoaZYNXY9+psFThaphjq+b0Onu8O9kj7E8dJ1Crd/2+vv96eGN0u81r+QznMuw3/Isa5jb7/U7r+MfqeFOueecu9AsrOJuxOtXh6pKteVvw+mBzO1ZvOd8y+xcveit4PTw8e0VpeAyruP4rJT3p5D5vKjxWSnycEv2noX7w7H1k3j5wbD0gmLxXTD0hWb3qJH0iWr2lXnyb0vwUh/yZj7zc1DyZDn0gWEEvxu3AAAASXRSTlMAHXaZJxhRw/7/3gEJP6X3y/H/XZB8LQ+b2M0FGF7x6z7nMtv/zXP6lbLWdFOpgb5RPf/pX3Uo/9ZiNYtOm/iwSXdd0P/lve/Hl/YjrQAAAZ1JREFUeAFskAMSxAAMAFPbtnn2/192rptBsDGMBEExHNaFICmaYVGCWyJeECVaphSV0og5w3VWZQ3T0ihaEYUpIylVsgUegDMNR2X10WgOdxmKtH6OJ9i0Kmt+T4MwQrpEDryYYhKth2mWF6n327nU3kY5ghC7eVWbH2zZdCN44CPjbessbzfvCK/JamKYI2TGHGx3YV6/azlBT97ref22QbtHwAqKA/9xLbJR3Xi0beUGHpjHf/4pCoMeWsfwXO36y49FnqU9fBfsL+eqRj52fMjzw+hF19sd4t0lLwLC3Id5tud5a4CPV5vEkMBADJzitrnWto2Jsf7/i2o3HJuyUm2+GvVX0/5unAcu5DPao0JtLMnMBqPmYk7qjur9q/J1PwgjxWvF+TxD/Bi1OD6ZvAtHkYT0QM6wSsJU1t4Cis5kbhCjzSEJL4jkT6aMQio9kAEiapWHutHslaeMEQ2H0iFW0quftQP7PpWOIj1HUaoRazA5xwZvy+MqwtjVrx8j8LE8KJ1VdBxg9ErjnV/fU52ciwH/V13y0ht6AueMOFH8ctIWAAAAAElFTkSuQmCC"
                            alt="">
                        <span style="color: rgba(255, 255, 255, .75);;">HOMEOS VIỆT NAM</span> -->
                    </div>
                </div>
                <div style="padding: 0 20px 0 20px;">
                    <img src="https://central.homeos.vn/images/Logo_HomeOS_White.png" alt="" width="200"
                        style="margin-bottom: 30px; margin-top: 20px;">
                    <div style="padding: 20px 20px 0 20px;">
                        <div class="tab">
                            <button id="tab-scan-qr" class="tablinks tablinkQR">Quét QR</button>
                            <button id="tab-text" class="tablinks tablinkQR">Nhập thủ công</button>
                        </div>
                    </div>
                    <div id="tab1" class="tab-content">
                        <button class="clickScanQR start" data-id="1">
                            <svg xmlns="http://www.w3.org/2000/svg" width="180" height="180" fill="currentColor"
                                style="color: #000000;" class="bi bi-qr-code-scan" viewBox="0 0 16 16">
                                <path
                                    d="M0 .5A.5.5 0 0 1 .5 0h3a.5.5 0 0 1 0 1H1v2.5a.5.5 0 0 1-1 0zm12 0a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0V1h-2.5a.5.5 0 0 1-.5-.5M.5 12a.5.5 0 0 1 .5.5V15h2.5a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5v-3a.5.5 0 0 1 .5-.5m15 0a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1 0-1H15v-2.5a.5.5 0 0 1 .5-.5M4 4h1v1H4z" />
                                <path d="M7 2H2v5h5zM3 3h3v3H3zm2 8H4v1h1z" />
                                <path d="M7 9H2v5h5zm-4 1h3v3H3zm8-6h1v1h-1z" />
                                <path
                                    d="M9 2h5v5H9zm1 1v3h3V3zM8 8v2h1v1H8v1h2v-2h1v2h1v-1h2v-1h-3V8zm2 2H9V9h1zm4 2h-1v1h-2v1h3zm-4 2v-1H8v1z" />
                                <path d="M12 9h2V8h-2z" />
                            </svg>
                        </button>
                    </div>
                    <div id="tab2" class="tab-content">
                        <div style="color: #fff; font-size: 1.5rem; padding: 50px 0 0 0;">Định danh thiết bị</div>
                        <div style="text-align: start; margin: 15px 0;">
                            <span style="color: #fff;">Mã trạm:</span>
                            <input id="device_name" type="text"
                                style="width: 100%; height: 50px; color: #fff; padding-left: 20px; margin-top: 10px; background-color: #343a40; border: none; border-bottom: 1px solid #626262;"
                                placeholder="Nhập mã trạm...">
                        </div>
                        <button id="truycap" class="btn btn-warning"
                            style="background-color: #f39c12;border: solid 1px #f39c12; width: 100%; color: #fff; margin-top: 20px;">Truy
                            cập trạm</button>
                    </div>
                </div>


                <!-- <div id="footer-instruct-text" class="footer-instruct">
                    <div class="step" style="margin: 0;">
                        <div class="circle">03</div>
                    </div>
                    <div class="d-flex justify-content-center" style="align-items: center;">
                        <img src="https://central.homeos.vn/images/Logo-Home-OS-crop.png"
                            style="display: none; width: 30px; height: 30px; margin: 0 5px 20px 0;" alt="">
                        <p>Nhấn nút quét hoặc nhập thông tin</p>
                    </div>

                </div> -->
            </div>
        </div>
        <div id="ScanQRWarranty" class="hidden h-100">
            <div class="container" style="padding: 0;">
                <div class="ScanQR-header d-flex justify-content-between">
                    <div class="history-avt">
                        <div class="d-flex">
                            <button id="backHistoryWarranty"
                                style="height: 40px; border: none; background-color: #1E2833;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                    style="color: #fff; margin-right: 10px;" class="bi bi-arrow-left"
                                    viewBox="0 0 16 16">
                                    <path fill-rule="evenodd"
                                        d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8" />
                                </svg>
                            </button>
                            <img class="userAvt"
                                src="https://static.vecteezy.com/system/resources/previews/009/292/244/non_2x/default-avatar-icon-of-social-media-user-vector.jpg"
                                alt="">
                            <p class="userName">Khách</p>
                        </div>
                    </div>
                    <div class="d-none" style="line-height: 50px; float: left;">
                        <button class="homepage-Pre-pickApp"
                            style="height: 40px; border: none; background-color: #1E2833;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                style="color: #fff; margin-right: 10px;" class="bi bi-arrow-left" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8" />
                            </svg>
                        </button>
                    </div>
                    <div style="line-height: 50px; float: left;">
                        <button class="menuToggle" style="height: 40px; border: none; background-color: #1E2833;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" style="color: #fff;"
                                fill="currentColor" class="bi bi-list" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5" />
                            </svg>
                        </button>
                    </div>
                </div>
                <aside class="sidebar">
                    <div class="profile">
                        <img src="https://central.homeos.vn/images/Logo_HomeOS_White.png" alt="" width="200"
                            style="margin-bottom: 30px; margin-top: 20px;">
                    </div>
                    <ul class="menu">
                        <li>
                            <div class="d-flex menu-item" style="color: #fff; padding-left: 10px;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" style="color: #fff;"
                                    fill="currentColor" class="bi bi-house" viewBox="0 0 16 16">
                                    <path
                                        d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L2 8.207V13.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V8.207l.646.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293zM13 7.207V13.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V7.207l5-5z" />
                                </svg>
                                <span class="Pre-pickApp" style="padding-left: 10px; padding-left: 10px;">Giải pháp
                                    thông minh</span>
                            </div>
                        </li>
                        <li>
                            <div class="d-flex menu-item" style="color: #fff; padding-left: 10px;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                                    style="color: #fff; padding-top: 5px;" class="bi bi-question-circle-fill"
                                    viewBox="0 0 16 16">
                                    <path
                                        d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M5.496 6.033h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286a.237.237 0 0 0 .241.247m2.325 6.443c.61 0 1.029-.394 1.029-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94 0 .533.425.927 1.01.927z" />
                                </svg>
                                <span style="padding-left: 10px; padding-left: 10px;">Thông tin công ty</span>
                            </div>
                        </li>
                        <li>
                            <div class="d-flex menu-item" style="color: #fff; padding-left: 10px;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                                    class="bi bi-list-ul" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd"
                                        d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2" />
                                </svg>
                                <span style="padding-left: 10px; padding-left: 10px;">Thông tin sản phẩm</span>
                            </div>
                        </li>
                        <li class="warranty_scansQRcode">
                            <div class="d-flex menu-item" style="color: #fff; padding-left: 10px;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor"
                                    class="bi bi-qr-code" viewBox="0 0 16 16">
                                    <path d="M2 2h2v2H2z" />
                                    <path d="M6 0v6H0V0zM5 1H1v4h4zM4 12H2v2h2z" />
                                    <path d="M6 10v6H0v-6zm-5 1v4h4v-4zm11-9h2v2h-2z" />
                                    <path
                                        d="M10 0v6h6V0zm5 1v4h-4V1zM8 1V0h1v2H8v2H7V1zm0 5V4h1v2zM6 8V7h1V6h1v2h1V7h5v1h-4v1H7V8zm0 0v1H2V8H1v1H0V7h3v1zm10 1h-1V7h1zm-1 0h-1v2h2v-1h-1zm-4 0h2v1h-1v1h-1zm2 3v-1h-1v1h-1v1H9v1h3v-2zm0 0h3v1h-2v1h-1zm-4-1v1h1v-2H7v1z" />
                                    <path d="M7 12h1v3h4v1H7zm9 2v2h-3v-1h2v-1z" />
                                </svg>
                                <span style="padding-left: 10px; padding-left: 10px;">Quét lô sản phẩm</span>
                            </div>
                        </li>
                        <li class="warranty_lot">
                            <div class="d-flex menu-item" style="color: #fff; padding-left: 10px;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor"
                                    class="bi bi-box-seam" viewBox="0 0 16 16">
                                    <path
                                        d="M8.186 1.113a.5.5 0 0 0-.372 0L1.846 3.5l2.404.961L10.404 2zm3.564 1.426L5.596 5 8 5.961 14.154 3.5zm3.25 1.7-6.5 2.6v7.922l6.5-2.6V4.24zM7.5 14.762V6.838L1 4.239v7.923zM7.443.184a1.5 1.5 0 0 1 1.114 0l7.129 2.852A.5.5 0 0 1 16 3.5v8.662a1 1 0 0 1-.629.928l-7.185 2.874a.5.5 0 0 1-.372 0L.63 13.09a1 1 0 0 1-.63-.928V3.5a.5.5 0 0 1 .314-.464z" />
                                </svg>
                                <span style="padding-left: 10px; padding-left: 10px;">Quản lý và xuất lô hàng</span>
                            </div>
                        </li>
                    </ul>
                </aside>
                <div class="warrantyDetailProduct" style="padding: 0 20px 0 20px;">
                    <img src="https://central.homeos.vn/images/Logo_HomeOS_White.png" alt="" width="200"
                        style="margin-bottom: 30px; margin-top: 20px;">
                    <div style="padding: 20px 20px 0 20px;">
                        <div class="tab">
                            <button id="tab-scan" class="tablinks tablinkGuarantee">Quét QR</button>
                            <button id="tab-history" class="tablinks tablinkGuarantee">Nhập thủ công</button>
                        </div>
                    </div>
                    <div id="tab3" class="tab-content-guarantee">
                        <button class="clickScanQR start" data-id="2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="180" height="180" fill="currentColor"
                                style="color: #000000;" class="bi bi-qr-code-scan" viewBox="0 0 16 16">
                                <path
                                    d="M0 .5A.5.5 0 0 1 .5 0h3a.5.5 0 0 1 0 1H1v2.5a.5.5 0 0 1-1 0zm12 0a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0V1h-2.5a.5.5 0 0 1-.5-.5M.5 12a.5.5 0 0 1 .5.5V15h2.5a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5v-3a.5.5 0 0 1 .5-.5m15 0a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1 0-1H15v-2.5a.5.5 0 0 1 .5-.5M4 4h1v1H4z" />
                                <path d="M7 2H2v5h5zM3 3h3v3H3zm2 8H4v1h1z" />
                                <path d="M7 9H2v5h5zm-4 1h3v3H3zm8-6h1v1h-1z" />
                                <path
                                    d="M9 2h5v5H9zm1 1v3h3V3zM8 8v2h1v1H8v1h2v-2h1v2h1v-1h2v-1h-3V8zm2 2H9V9h1zm4 2h-1v1h-2v1h3zm-4 2v-1H8v1z" />
                                <path d="M12 9h2V8h-2z" />
                            </svg>
                        </button>
                    </div>
                    <div id="tab4" class="tab-content-guarantee">
                        <div style="color: #fff; font-size: 1.5rem; padding: 50px 0 0 0;">Thiết bị cần xem</div>
                        <div style="text-align: start; margin: 15px 0;">
                            <span style="color: #fff;">Mã QRcode:</span>
                            <input id="warranty_QR" type="text"
                                style="width: 100%; height: 50px; color: #fff; padding-left: 20px; margin-top: 10px; background-color: #343a40; border: none; border-bottom: 1px solid #626262;"
                                placeholder="Nhập mã bên dưới QRcode...">
                        </div>
                        <button id="warranty-detail" class="btn btn-warning"
                            style="background-color: #f39c12;border: solid 1px #f39c12; width: 100%; color: #fff; margin-top: 20px;">Xem
                            thiết bị</button>
                        <!-- <div id="warrantyHistory" style="padding: 20px 0;">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">sản phẩm đã xem</h3>
                                    <div class="card-tools">
                                        <button type="button" class="btn btn-tool p-0" style="color: #fff;" data-card-widget="remove">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body p-0">
                                    <ul class="products-list product-list-in-card pl-2 pr-2">
                                        <li class="item">
                                            <div class="product-img">
                                                <img src="https://central.homeos.vn/images/ROLETP.jpg" alt="Product Image" class="img-size-50">
                                            </div>
                                            <div class="product-info">
                                                <a class="product-title">ROLE-TP-1.1
                                                    <span class="badge badge-info float-right">2024-12-12 09:20:08</span></a>
                                                <span class="product-description">
                                                    ROLE Thuận Phong.
                                                </span>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div> -->
                    </div>
                </div>
                <div id="ScanAllQRcode" class="d-none">
                    <img src="https://central.homeos.vn/images/Logo_HomeOS_White.png" alt="" width="200"
                        style="margin-bottom: 10px; margin-top: 10px;">
                    <div class="content-form" style="background-color: #1E2833; padding: 0 20px;">
                        <div class="form-group content-detail mb-1">
                            <label class="form-label content-label" for="ap_ssid">Lô sản phẩm:</label>
                            <select name="" id="lot-number" class="form-control content-input">
                                <option value="0">Chọn lô cần quét</option>
                            </select>
                        </div>
                        <div class="form-group content-detail mb-1">
                            <label class="form-label content-label" for="ap_ssid">Lớp sản phẩm:</label>
                            <input id="classProduct" class="form-control content-input" type="text"
                                placeholder="Nhập lớp cần quét">
                        </div>
                        <div class="form-group content-detail mb-1">
                            <label class="form-label content-label" for="ap_ssid">Số lượng cần quét của 1 lớp:</label>
                            <input id="classProductNumber" class="form-control content-input" type="text"
                                placeholder="Nhập số lượng cần quét">
                        </div>
                    </div>
                    <button class="clickScanQR start" data-id="3" style="margin-top: 4vh;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="180" height="180" fill="currentColor"
                            style="color: #000000;" class="bi bi-qr-code" viewBox="0 0 16 16">
                            <path d="M2 2h2v2H2z" />
                            <path d="M6 0v6H0V0zM5 1H1v4h4zM4 12H2v2h2z" />
                            <path d="M6 10v6H0v-6zm-5 1v4h4v-4zm11-9h2v2h-2z" />
                            <path
                                d="M10 0v6h6V0zm5 1v4h-4V1zM8 1V0h1v2H8v2H7V1zm0 5V4h1v2zM6 8V7h1V6h1v2h1V7h5v1h-4v1H7V8zm0 0v1H2V8H1v1H0V7h3v1zm10 1h-1V7h1zm-1 0h-1v2h2v-1h-1zm-4 0h2v1h-1v1h-1zm2 3v-1h-1v1h-1v1H9v1h3v-2zm0 0h3v1h-2v1h-1zm-4-1v1h1v-2H7v1z" />
                            <path d="M7 12h1v3h4v1H7zm9 2v2h-3v-1h2v-1z" />
                        </svg>
                    </button>
                </div>
                <div id="lotProduct" class="d-none">
                    <div>
                        <div class="d-flex" style="color: #fff; padding-left: 10px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                                class="bi bi-box-seam" viewBox="0 0 16 16">
                                <path
                                    d="M8.186 1.113a.5.5 0 0 0-.372 0L1.846 3.5l2.404.961L10.404 2zm3.564 1.426L5.596 5 8 5.961 14.154 3.5zm3.25 1.7-6.5 2.6v7.922l6.5-2.6V4.24zM7.5 14.762V6.838L1 4.239v7.923zM7.443.184a1.5 1.5 0 0 1 1.114 0l7.129 2.852A.5.5 0 0 1 16 3.5v8.662a1 1 0 0 1-.629.928l-7.185 2.874a.5.5 0 0 1-.372 0L.63 13.09a1 1 0 0 1-.63-.928V3.5a.5.5 0 0 1 .314-.464z" />
                            </svg>
                            <h6 style="padding-left: 10px; padding-left: 10px;">Lô sản phẩm:</h6>
                        </div>
                    </div>
                    <ul id="lot-warranty-detail" style="overflow-y: auto; max-height: 538px; padding: 10px 0 0px;">
                    </ul>
                </div>
                <!-- <div id="footer-instruct-warranty" class="footer-instruct">
                    <div class="step">
                        <div class="circle">02</div>
                    </div>
                    <p>Nhấn nút để quét QRcode của thiết bị</p>
                </div> -->
            </div>
        </div>
        <div id="homePage" class="hidden">
            <div class="background">
                <div id="landscape"></div>
                <div id="glass"></div>
            </div>
            <div class="container-homePage" style="padding: 0; width: 100%;">
                <div class="homePage-header history-header" style="background-color: #282d31; z-index: 1001; position: fixed; height: 50px; top: 0; left: 0;">
                    <div style="line-height: 50px; justify-content: flex-start;" class="d-flex">
                        <button class="ScanQRNext" style="height: 40px; border: none; background-color: #282d31;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                                style="color: #fff; margin-right: 10px;" class="bi bi-arrow-left" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8" />
                            </svg>
                        </button>
                        <p id="footer-stationName" style="width: 250px; color: #fff; text-align: left; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">-</p>
                    </div>
                    <div class="d-flex" style="line-height: 50px; margin-right: 20px;">
                        <button id="share-qrcode-workstation" style="height: 40px; border: none; background-color: #282d31; padding: 0;margin-right: 10px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" style="color: #fff;" fill="currentColor" class="bi bi-share" viewBox="0 0 16 16">
                                <path d="M13.5 1a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3M11 2.5a2.5 2.5 0 1 1 .603 1.628l-6.718 3.12a2.5 2.5 0 0 1 0 1.504l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.256l6.718-3.12A2.5 2.5 0 0 1 11 2.5m-8.5 4a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3m11 5.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div>-</div>
                <div id="homePage-body" class="pb-5 pt-4" >
                    <div id="box-status" class="row" style="margin: 15px; margin-bottom: 0;">
                        <div class=" col-5" style="padding-left: 0; padding-right: 0; padding-bottom: 15px;">
                            <div class="box-value"
                                style="height: 100%; padding-left: 0; padding-right: 0; margin-right: 0; display: flex; align-items: center; justify-content: center;">
                                <div>
                                    <div class="d-flex">
                                        <div id="statusBattery">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" style="margin-right: 5px; color: yellow" fill="currentColor" class="bi bi-battery-half" viewBox="0 0 16 16">
                                                <path d="M2 6h5v4H2z" />
                                                <path d="M2 4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2zm10 1a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1zm4 3a1.5 1.5 0 0 1-1.5 1.5v-3A1.5 1.5 0 0 1 16 8" />
                                            </svg>
                                        </div>
                                        <p style="margin: 0; font-size: 14px; line-height: 30px;">Năng lượng</p>
                                    </div>
                                    <div>
                                        <p id="energy" style="font-size: 25px; margin: 0;">-</p>
                                    </div>
                                </div>

                            </div>
                        </div>
                        <div class="col-7" style="padding-left: 0; padding-right: 0;">
                            <div class="box-value" style="height: 80px;">
                                <div class="d-flex" style="line-height: 20px;">
                                    <div id="status"></div>
                                    <p style="margin: 0; font-size: 14px; margin-left: 10px;">Trạng thái</p>
                                </div>
                                <div>
                                    <p id="text-status" style="font-size: 16px; margin: 0;">mất kết nối</p>
                                </div>
                            </div>
                            <div class="box-value" style="height: 80px;">
                                <div class="d-flex" style="line-height: 20px;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                        class="bi bi-arrow-left-right" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd"
                                            d="M1 11.5a.5.5 0 0 0 .5.5h11.793l-3.147 3.146a.5.5 0 0 0 .708.708l4-4a.5.5 0 0 0 0-.708l-4-4a.5.5 0 0 0-.708.708L13.293 11H1.5a.5.5 0 0 0-.5.5m14-7a.5.5 0 0 1-.5.5H2.707l3.147 3.146a.5.5 0 1 1-.708.708l-4-4a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L2.707 4H14.5a.5.5 0 0 1 .5.5" />
                                    </svg>
                                    <p style="margin: 0; font-size: 14px; margin-left: 10px;">Cập nhật</p>
                                </div>
                                <div>
                                    <p id="lateDateTime" style="font-size: 16px; margin: 0;">-</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="listValue" class="row">
                        <div id="box-RT" class="d-none col-6 p-2">
                            <div class="box-value d-flex"
                                style="height: 116px; margin: 0; padding-left: 0; padding-top: 0;">
                                <div style="width: 60px;">
                                    <div id="temperature"
                                        style="pointer-events: none; margin-left: 5px; width: 50px; height: 100px;">
                                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="250 200 200 200">
                                            <defs>
                                                <linearGradient id="liquidGrad" x1="557" y1="150" x2="557" y2="546" gradientUnits="userSpaceOnUse">
                                                    <stop offset="0" stop-color="#FF0909" />
                                                    <stop offset="0.2" stop-color="#F3481A" />
                                                    <stop offset="0.5" stop-color="#FABA2C" />
                                                    <stop offset="1" stop-color="#00BCF2" />
                                                </linearGradient>
                                                <rect id="tube" x="357" y="150" width="60" height="400" rx="43" ry="43" />
                                                <clipPath id="liquidMask">
                                                    <use xlink:href="#tube" class="liquidMask" />
                                                </clipPath>
                                                <clipPath id="tubeMask">
                                                    <use xlink:href="#tube" class="liquidMask" />
                                                </clipPath>
                                                <path id="liquid" d="M757,552v490H357V552c50,0,50,20,100,20s50-20,100-20,50,20,100,20S707,552,757,552Z" />
                                                <mask id="gradMask">
                                                    <use xlink:href="#liquid" class="liquid" x="0" fill="#FCEFD6" />
                                                    <use xlink:href="#liquid" class="liquid" x="0" fill="#EEE" opacity="0.7" />
                                                </mask>
                                            </defs>


                                            <g class="whole" transform="translate(0, -40)">

                                                <use xlink:href="#tube" class="tubeBg" fill="#C8D9D3" opacity="0.61" />

                                                <g class="dragger d-none" transform="translate(-6, 0)">
                                                    <circle cx="294" cy="540" r="36" fill="#FABA2C" />
                                                    <path class="dragTip"
                                                        d="M315.5,556.76,299.24,540.5l16.26-16.26,36.26,16.26Z"
                                                        fill="#FABA2C" />
                                                    <text class="label" x="294" y="551"
                                                        style="font-weight: 700;">100</text>
                                                    <!--  <path id="dragShine" d="M330,540c-26,2-18-44-72,0a36,36,0,0,1,72,0Z" fill="#E9E9E9" opacity="0.052"/>    -->
                                                </g>


                                                <g mask="url(#gradMask)">
                                                    <use xlink:href="#tube" fill="url(#liquidGrad)" />
                                                </g>
                                                <line class="tubeShine" x1="371" y1="200" x2="371" y2="443" fill="none"
                                                    stroke="#FFF" stroke-linecap="round" stroke-miterlimit="10"
                                                    stroke-width="8" opacity="0.21" stroke-dasharray="153 30"
                                                    stroke-dashoffset="-20" />
                                                <!--        <text class="tubeLabel" x="400" y="180">100°</text>
                                                  <text class="tubeLabel" x="400" y="356">50°</text>
                                                  <text class="tubeLabel" x="400" y="540">0°</text> -->
                                                <g class="measurements" fill="none" stroke="#FCEFD6" stroke-width="3"
                                                    stroke-linecap="round" opacity="1">
                                                    <line x1="358" y1="196" x2="370" y2="196" />
                                                    <line x1="358" y1="234" x2="370" y2="234" />
                                                    <line x1="358" y1="273" x2="370" y2="273" />
                                                    <line x1="358" y1="311" x2="370" y2="311" />
                                                    <line x1="358" y1="350" x2="370" y2="350" />
                                                    <line x1="358" y1="388" x2="370" y2="388" />
                                                    <line x1="358" y1="426" x2="370" y2="426" />
                                                    <line x1="358" y1="465" x2="370" y2="465" />
                                                    <line x1="358" y1="503" x2="370" y2="503" />
                                                </g>

                                                <!--  <rect class="tubeShine" x="372" y="162" width="56" height="364.02" rx="31.5" ry="31.5" fill="none" stroke="#fff" stroke-miterlimit="10" stroke-width="8" stroke-linecap="round" stroke-dasharray="15 30" opacity="0.31"/> -->
                                                <circle class="follower" cx="400" cy="540" r="0" fill="#62B6CB"
                                                    fill-opacity="1" stroke="#FCEFD6" stroke-width="0" />
                                            </g>
                                        </svg>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: center;">
                                    <div>
                                        <p id="titleRT">Nhiệt độ</p>
                                        <h5 id="RT">-</h5>
                                    </div>

                                </div>
                            </div>
                        </div>
                        <div id="box-RH" class="d-none col-6 p-2" style="padding-right: 0;">
                            <div class="box-value" style="height: 116px; margin: 0;">
                                <div class="d-flex justify-content-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                        style="color: #00ffff;" fill="currentColor" class="bi bi-thermometer-snow"
                                        viewBox="0 0 16 16">
                                        <path
                                            d="M5 12.5a1.5 1.5 0 1 1-2-1.415V9.5a.5.5 0 0 1 1 0v1.585A1.5 1.5 0 0 1 5 12.5" />
                                        <path
                                            d="M1 2.5a2.5 2.5 0 0 1 5 0v7.55a3.5 3.5 0 1 1-5 0zM3.5 1A1.5 1.5 0 0 0 2 2.5v7.987l-.167.15a2.5 2.5 0 1 0 3.333 0L5 10.486V2.5A1.5 1.5 0 0 0 3.5 1m5 1a.5.5 0 0 1 .5.5v1.293l.646-.647a.5.5 0 0 1 .708.708L9 5.207v1.927l1.669-.963.495-1.85a.5.5 0 1 1 .966.26l-.237.882 1.12-.646a.5.5 0 0 1 .5.866l-1.12.646.884.237a.5.5 0 1 1-.26.966l-1.848-.495L9.5 8l1.669.963 1.849-.495a.5.5 0 1 1 .258.966l-.883.237 1.12.646a.5.5 0 0 1-.5.866l-1.12-.646.237.883a.5.5 0 1 1-.966.258L10.67 9.83 9 8.866v1.927l1.354 1.353a.5.5 0 0 1-.708.708L9 12.207V13.5a.5.5 0 0 1-1 0v-11a.5.5 0 0 1 .5-.5" />
                                    </svg>
                                    <p style="padding-left: 5px;">Độ ẩm</p>
                                </div>
                                <h5 id="RH">-</h5>
                            </div>
                        </div>
                        <div id="box-RP" class="d-none col-6 p-2">
                            <div class="box-value" style="height: 116px; margin: 0;">
                                <div class="d-flex justify-content-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                        style="color: #0084ff;" fill="currentColor" class="bi bi-speedometer2"
                                        viewBox="0 0 16 16">
                                        <path
                                            d="M8 4a.5.5 0 0 1 .5.5V6a.5.5 0 0 1-1 0V4.5A.5.5 0 0 1 8 4M3.732 5.732a.5.5 0 0 1 .707 0l.915.914a.5.5 0 1 1-.708.708l-.914-.915a.5.5 0 0 1 0-.707M2 10a.5.5 0 0 1 .5-.5h1.586a.5.5 0 0 1 0 1H2.5A.5.5 0 0 1 2 10m9.5 0a.5.5 0 0 1 .5-.5h1.5a.5.5 0 0 1 0 1H12a.5.5 0 0 1-.5-.5m.754-4.246a.39.39 0 0 0-.527-.02L7.547 9.31a.91.91 0 1 0 1.302 1.258l3.434-4.297a.39.39 0 0 0-.029-.518z" />
                                        <path fill-rule="evenodd"
                                            d="M0 10a8 8 0 1 1 15.547 2.661c-.442 1.253-1.845 1.602-2.932 1.25C11.309 13.488 9.475 13 8 13c-1.474 0-3.31.488-4.615.911-1.087.352-2.49.003-2.932-1.25A8 8 0 0 1 0 10m8-7a7 7 0 0 0-6.603 9.329c.203.575.923.876 1.68.63C4.397 12.533 6.358 12 8 12s3.604.532 4.923.96c.757.245 1.477-.056 1.68-.631A7 7 0 0 0 8 3" />
                                    </svg>
                                    <p style="padding-left: 5px;">Áp suất</p>
                                </div>
                                <h5 id="RP">-</h5>
                            </div>
                        </div>
                        <div id="box-RD" class="d-none col-6 p-2">
                            <div class="box-value" style="height: 116px; margin: 0;">
                                <div class="d-flex justify-content-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                        style="color: #d2d6db;" fill="currentColor"
                                        class="bi bi-cloud-lightning-rain-fill" viewBox="0 0 16 16">
                                        <path
                                            d="M2.658 11.026a.5.5 0 0 1 .316.632l-.5 1.5a.5.5 0 1 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.316m9.5 0a.5.5 0 0 1 .316.632l-.5 1.5a.5.5 0 0 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.316m-7.5 1.5a.5.5 0 0 1 .316.632l-.5 1.5a.5.5 0 1 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.316m9.5 0a.5.5 0 0 1 .316.632l-.5 1.5a.5.5 0 0 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.316m-7.105-1.25A.5.5 0 0 1 7.5 11h1a.5.5 0 0 1 .474.658l-.28.842H9.5a.5.5 0 0 1 .39.812l-2 2.5a.5.5 0 0 1-.875-.433L7.36 14H6.5a.5.5 0 0 1-.447-.724zm6.352-7.249a5.001 5.001 0 0 0-9.499-1.004A3.5 3.5 0 1 0 3.5 10H13a3 3 0 0 0 .405-5.973" />
                                    </svg>
                                    <p style="padding-left: 5px;">Lượng mưa</p>
                                </div>
                                <div class="d-flex justify-content-center" style="align-items: center;">
                                    <h5 id="RD">0 mm</h5>
                                    <p style="font-size: 12px; margin: 0; margin-left: 5px; padding-bottom: 5px;"
                                        id="lastTimeRain"></p>
                                </div>
                                <p>Trong ngày</p>
                            </div>
                        </div>
                        <div id="box-RN" class="d-none col-6 p-2">
                            <div class="box-value" style="height: 116px; margin: 0;">
                                <div class="d-flex justify-content-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                        class="bi bi-moisture" viewBox="0 0 16 16">
                                        <path
                                            d="M13.5 0a.5.5 0 0 0 0 1H15v2.75h-.5a.5.5 0 0 0 0 1h.5V7.5h-1.5a.5.5 0 0 0 0 1H15v2.75h-.5a.5.5 0 0 0 0 1h.5V15h-1.5a.5.5 0 0 0 0 1h2a.5.5 0 0 0 .5-.5V.5a.5.5 0 0 0-.5-.5zM7 1.5l.364-.343a.5.5 0 0 0-.728 0l-.002.002-.006.007-.022.023-.08.088a29 29 0 0 0-1.274 1.517c-.769.983-1.714 2.325-2.385 3.727C2.368 7.564 2 8.682 2 9.733 2 12.614 4.212 15 7 15s5-2.386 5-5.267c0-1.05-.368-2.169-.867-3.212-.671-1.402-1.616-2.744-2.385-3.727a29 29 0 0 0-1.354-1.605l-.022-.023-.006-.007-.002-.001zm0 0-.364-.343zm-.016.766L7 2.247l.016.019c.24.274.572.667.944 1.144.611.781 1.32 1.776 1.901 2.827H4.14c.58-1.051 1.29-2.046 1.9-2.827.373-.477.706-.87.945-1.144zM3 9.733c0-.755.244-1.612.638-2.496h6.724c.395.884.638 1.741.638 2.496C11 12.117 9.182 14 7 14s-4-1.883-4-4.267" />
                                    </svg>
                                    <p style="padding-left: 5px;">Mực nước</p>
                                </div>
                                <h5 id="RN">-</h5>
                            </div>
                        </div>
                        <div id="box-SS" class="d-none col-6 p-2">
                            <div class="box-value" style="height: 116px; margin: 0;">
                                <div class="d-flex justify-content-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-droplet-half" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd" d="M7.21.8C7.69.295 8 0 8 0q.164.544.371 1.038c.812 1.946 2.073 3.35 3.197 4.6C12.878 7.096 14 8.345 14 10a6 6 0 0 1-12 0C2 6.668 5.58 2.517 7.21.8m.413 1.021A31 31 0 0 0 5.794 3.99c-.726.95-1.436 2.008-1.96 3.07C3.304 8.133 3 9.138 3 10c0 0 2.5 1.5 5 .5s5-.5 5-.5c0-1.201-.796-2.157-2.181-3.7l-.03-.032C9.75 5.11 8.5 3.72 7.623 1.82z"/>
                                        <path fill-rule="evenodd" d="M4.553 7.776c.82-1.641 1.717-2.753 2.093-3.13l.708.708c-.29.29-1.128 1.311-1.907 2.87z"/>
                                    </svg>
                                    <p style="padding-left: 5px;">Độ mặn</p>
                                </div>
                                <h5 id="SS">-</h5>
                            </div>
                        </div>
                        <div id="box-EC" class="d-none col-6 p-2">
                            <div class="box-value" style="height: 116px; margin: 0;">
                                <div class="d-flex justify-content-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-lightning" viewBox="0 0 16 16">
                                        <path d="M5.52.359A.5.5 0 0 1 6 0h4a.5.5 0 0 1 .474.658L8.694 6H12.5a.5.5 0 0 1 .395.807l-7 9a.5.5 0 0 1-.873-.454L6.823 9.5H3.5a.5.5 0 0 1-.48-.641zM6.374 1 4.168 8.5H7.5a.5.5 0 0 1 .478.647L6.78 13.04 11.478 7H8a.5.5 0 0 1-.474-.658L9.306 1z"/>
                                    </svg>
                                    <p style="padding-left: 5px;">Độ dẫn điện</p>
                                </div>
                                <h5 id="EC">-</h5>
                            </div>
                        </div>
                        <div id="box-TN" class="d-none col-6 p-2">
                            <div class="box-value" style="height: 116px; margin: 0;">
                                <div class="d-flex justify-content-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-beaker" viewBox="0 0 16 16">
                                        <path d="M9.5 3a.5.5 0 0 0 0 1H13V3zm2 2a.5.5 0 0 0 0 1H13V5zm-2 2a.5.5 0 0 0 0 1H13V7zm2 2a.5.5 0 0 0 0 1H13V9zm-2 2a.5.5 0 0 0 0 1H13v-1zm2 2a.5.5 0 0 0 0 1H13v-1z"/>
                                        <path d="M.5 0a.5.5 0 0 0-.354.854l.122.12A2.5 2.5 0 0 1 1 2.744V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V2.743a2.5 2.5 0 0 1 .732-1.768l.122-.121A.5.5 0 0 0 15.5 0zM2 2.743A3.5 3.5 0 0 0 1.535 1h12.93A3.5 3.5 0 0 0 14 2.743V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1z"/>
                                      </svg>
                                    <p style="padding-left: 5px;">Dung tích</p>
                                </div>
                                <h5 id="TN">-</h5>
                            </div>
                        </div>
                        <div id="box-QV" class="d-none col-6 p-2">
                            <div class="box-value" style="height: 116px; margin: 0;">
                                <div class="d-flex justify-content-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-water" viewBox="0 0 16 16">
                                        <path d="M.036 3.314a.5.5 0 0 1 .65-.278l1.757.703a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.757-.703a.5.5 0 1 1 .372.928l-1.758.703a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0L.314 3.964a.5.5 0 0 1-.278-.65m0 3a.5.5 0 0 1 .65-.278l1.757.703a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.757-.703a.5.5 0 1 1 .372.928l-1.758.703a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0L.314 6.964a.5.5 0 0 1-.278-.65m0 3a.5.5 0 0 1 .65-.278l1.757.703a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.757-.703a.5.5 0 1 1 .372.928l-1.758.703a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0L.314 9.964a.5.5 0 0 1-.278-.65m0 3a.5.5 0 0 1 .65-.278l1.757.703a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.757-.703a.5.5 0 1 1 .372.928l-1.758.703a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0l-1.757-.703a.5.5 0 0 1-.278-.65"/>
                                      </svg>
                                    <p style="padding-left: 5px;">Lưu lượng đến</p>
                                </div>
                                <h5 id="QV">-</h5>
                            </div>
                        </div>
                        <div id="box-QR" class="d-none col-6 p-2">
                            <div class="box-value" style="height: 116px; margin: 0;">
                                <div class="d-flex justify-content-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-water" viewBox="0 0 16 16">
                                        <path d="M.036 3.314a.5.5 0 0 1 .65-.278l1.757.703a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.757-.703a.5.5 0 1 1 .372.928l-1.758.703a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0L.314 3.964a.5.5 0 0 1-.278-.65m0 3a.5.5 0 0 1 .65-.278l1.757.703a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.757-.703a.5.5 0 1 1 .372.928l-1.758.703a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0L.314 6.964a.5.5 0 0 1-.278-.65m0 3a.5.5 0 0 1 .65-.278l1.757.703a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.757-.703a.5.5 0 1 1 .372.928l-1.758.703a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0L.314 9.964a.5.5 0 0 1-.278-.65m0 3a.5.5 0 0 1 .65-.278l1.757.703a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.757-.703a.5.5 0 1 1 .372.928l-1.758.703a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0l-1.757-.703a.5.5 0 0 1-.278-.65"/>
                                      </svg>
                                    <p style="padding-left: 5px;">Lưu lượng xả</p>
                                </div>
                                <h5 id="QR">-</h5>
                            </div>
                        </div>
                        <div id="box-QN" class="d-none col-6 p-2">
                            <div class="box-value" style="height: 116px; margin: 0;">
                                <div class="d-flex justify-content-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-water" viewBox="0 0 16 16">
                                        <path d="M.036 3.314a.5.5 0 0 1 .65-.278l1.757.703a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.757-.703a.5.5 0 1 1 .372.928l-1.758.703a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0L.314 3.964a.5.5 0 0 1-.278-.65m0 3a.5.5 0 0 1 .65-.278l1.757.703a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.757-.703a.5.5 0 1 1 .372.928l-1.758.703a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0L.314 6.964a.5.5 0 0 1-.278-.65m0 3a.5.5 0 0 1 .65-.278l1.757.703a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.757-.703a.5.5 0 1 1 .372.928l-1.758.703a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0L.314 9.964a.5.5 0 0 1-.278-.65m0 3a.5.5 0 0 1 .65-.278l1.757.703a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.757-.703a.5.5 0 1 1 .372.928l-1.758.703a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0l-1.757-.703a.5.5 0 0 1-.278-.65"/>
                                      </svg>
                                    <p style="padding-left: 5px;">Lưu lượng Nước</p>
                                </div>
                                <h5 id="QN">-</h5>
                            </div>
                        </div>
                        <div id="box-VN" class="d-none col-6 p-2">
                            <div class="box-value" style="height: 116px; margin: 0;">
                                <div class="d-flex justify-content-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-water" viewBox="0 0 16 16">
                                        <path d="M.036 3.314a.5.5 0 0 1 .65-.278l1.757.703a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.757-.703a.5.5 0 1 1 .372.928l-1.758.703a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0L.314 3.964a.5.5 0 0 1-.278-.65m0 3a.5.5 0 0 1 .65-.278l1.757.703a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.757-.703a.5.5 0 1 1 .372.928l-1.758.703a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0L.314 6.964a.5.5 0 0 1-.278-.65m0 3a.5.5 0 0 1 .65-.278l1.757.703a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.757-.703a.5.5 0 1 1 .372.928l-1.758.703a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0L.314 9.964a.5.5 0 0 1-.278-.65m0 3a.5.5 0 0 1 .65-.278l1.757.703a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.757-.703a.5.5 0 1 1 .372.928l-1.758.703a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0l-1.757-.703a.5.5 0 0 1-.278-.65"/>
                                      </svg>
                                    <p style="padding-left: 5px;">Tốc độ dòng chảy</p>
                                </div>
                                <h5 id="VN">-</h5>
                            </div>
                        </div>
                    </div>
                    <div id="acQuy">
                        <!-- <div class="progress"
                            style="background-color: #242427; border: solid 1px #484848; height: 25px; border-radius: 15px; box-shadow: 2px 2px #0c0c0c;">
                            <div id="acQuy-bar" class="progress-bar" role="progressbar" style="width: 25%;" aria-valuenow="25"
                                aria-valuemin="0" aria-valuemax="100">-</div>
                        </div> -->
                    </div>
                    <div id="Chart">
                        <div class="d-flex justify-content-between">
                            <div class="d-none d-flex justify-content-center align-items-center"
                                style="height: 40px; padding-top: 10px; padding-left: 10px;">
                                <div id="loading-spinner" class="d-none spinner-border text-light" role="status">
                                </div>
                            </div>
                            <div class="button-list">
                                <button id="button-list-ngay" class="btn btn-primary btn-chart active"
                                    type="button">Ngày</button>
                                <button id="button-list-tuan" class="btn btn-primary btn-chart"
                                    type="button">Tuần</button>
                                <button id="button-list-thang" class="btn btn-primary btn-chart"
                                    type="button">Tháng</button>
                                <button id="button-list-nam" class="btn btn-primary btn-chart"
                                    type="button">Năm</button>
                            </div>
                        </div>
                        <div id="chart-TN" class="d-none form-total">
                            <div class="header-form d-flex">
                                <h3 style="margin: 0; padding-left: 2px;">Biểu đồ dung tích</h3>
                            </div>
                            <div class="content-form">
                                <canvas id="ChartTN" width="400" height="200"></canvas>
                            </div>
                        </div>
                        <div id="chart-QV" class="d-none form-total">
                            <div class="header-form d-flex">
                                <h3 style="margin: 0; padding-left: 2px;">Biểu đồ lưu lượng đến</h3>
                            </div>
                            <div class="content-form">
                                <canvas id="ChartQV" width="400" height="200"></canvas>
                            </div>
                        </div>
                        <div id="chart-QR" class="d-none form-total">
                            <div class="header-form d-flex">
                                <h3 style="margin: 0; padding-left: 2px;">Biểu đồ lưu lượng xả</h3>
                            </div>
                            <div class="content-form">
                                <canvas id="ChartQR" width="400" height="200"></canvas>
                            </div>
                        </div>
                        <div id="chart-QN" class="d-none form-total">
                            <div class="header-form d-flex">
                                <h3 style="margin: 0; padding-left: 2px;">Biểu đồ lưu lượng nước</h3>
                            </div>
                            <div class="content-form">
                                <canvas id="ChartQN" width="400" height="200"></canvas>
                            </div>
                        </div>
                        <div id="chart-VN" class="d-none form-total">
                            <div class="header-form d-flex">
                                <h3 style="margin: 0; padding-left: 2px;">Biểu đồ tốc độ dòng chảy</h3>
                            </div>
                            <div class="content-form">
                                <canvas id="ChartVN" width="400" height="200"></canvas>
                            </div>
                        </div>
                        <div id="chart-RD" class="d-none form-total">
                            <div class="header-form d-flex">
                                <!-- <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" style="color: white; padding-top: 5px;" class="bi bi-gear-fill" viewBox="0 0 16 16">
                                    <path d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"/>
                                </svg> -->
                                <h3 style="margin: 0; padding-left: 2px;">Biểu đồ lượng mưa</h3>
                            </div>
                            <div class="content-form">
                                <canvas id="lineBarChart" width="400" height="200"></canvas>
                            </div>
                        </div>
                        <div id="chart-RT" class="d-none form-total">
                            <div class="header-form d-flex">
                                <!-- <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" style="color: white; padding-top: 5px;" class="bi bi-gear-fill" viewBox="0 0 16 16">
                                    <path d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"/>
                                </svg> -->
                                <h3 id="titleChartRT" style="margin: 0; padding-left: 2px;">Biểu đồ nhiệt độ</h3>
                            </div>
                            <div class="content-form">
                                <canvas id="ChartRT" width="400" height="200"></canvas>
                            </div>
                        </div>
                        <div id="chart-RH" class="d-none form-total">
                            <div class="header-form d-flex">
                                <!-- <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" style="color: white; padding-top: 5px;" class="bi bi-gear-fill" viewBox="0 0 16 16">
                                    <path d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"/>
                                </svg> -->
                                <h3 style="margin: 0; padding-left: 2px;">Biểu đồ độ ẩm</h3>
                            </div>
                            <div class="content-form">
                                <canvas id="ChartRH" width="400" height="200"></canvas>
                            </div>
                        </div>
                        <div id="chart-RP" class="d-none form-total">
                            <div class="header-form d-flex">
                                <!-- <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" style="color: white; padding-top: 5px;" class="bi bi-gear-fill" viewBox="0 0 16 16">
                                    <path d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"/>
                                </svg> -->
                                <h3 style="margin: 0; padding-left: 2px;">Biểu đồ áp suất</h3>
                            </div>
                            <div class="content-form">
                                <canvas id="ChartRP" width="400" height="200"></canvas>
                            </div>
                        </div>
                        <div id="chart-RN" class="d-none form-total">
                            <div class="header-form d-flex">
                                <!-- <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" style="color: white; padding-top: 5px;" class="bi bi-gear-fill" viewBox="0 0 16 16">
                                    <path d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"/>
                                </svg> -->
                                <h3 style="margin: 0; padding-left: 2px;">Biểu đồ mực nước</h3>
                            </div>
                            <div class="content-form">
                                <canvas id="ChartRN" width="400" height="200"></canvas>
                            </div>
                        </div>
                        <div id="chart-RN72H" class="d-none form-total">
                            <div class="header-form d-flex">
                                <!-- <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" style="color: white; padding-top: 5px;" class="bi bi-gear-fill" viewBox="0 0 16 16">
                                    <path d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"/>
                                </svg> -->
                                <h3 style="margin: 0; padding-left: 2px;">Mực nước trong 72h qua</h3>
                            </div>
                            <div class="content-form">
                                <canvas id="ChartRN72H" width="400" height="200"></canvas>
                            </div>
                        </div>
                        <div id="chart-SS" class="d-none form-total">
                            <div class="header-form d-flex">
                                <!-- <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" style="color: white; padding-top: 5px;" class="bi bi-gear-fill" viewBox="0 0 16 16">
                                    <path d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"/>
                                </svg> -->
                                <h3 style="margin: 0; padding-left: 2px;">Biểu đồ độ mặn</h3>
                            </div>
                            <div class="content-form">
                                <canvas id="ChartSS" width="400" height="200"></canvas>
                            </div>
                        </div>
                        <div id="chart-EC" class="d-none form-total">
                            <div class="header-form d-flex">
                                <!-- <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" style="color: white; padding-top: 5px;" class="bi bi-gear-fill" viewBox="0 0 16 16">
                                    <path d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"/>
                                </svg> -->
                                <h3 style="margin: 0; padding-left: 2px;">Biểu đồ độ dẫn điện</h3>
                            </div>
                            <div class="content-form">
                                <canvas id="ChartEC" width="400" height="200"></canvas>
                            </div>
                        </div>
                        
                        <div style="color: #313539;">-</div>
                    </div>
                </div>
                <div class="homePage-footer history-footer d-flex text-white justify-content-around align-items-center" style="z-index: 1001; position: fixed; height: 60px; bottom: 0; left: 0; right: 0; margin: 10px 20px; border-radius: 50px; box-shadow: 0 0 1px rgba(0, 0, 0, .125), 0 1px 3px rgba(0, 0, 0, .2); background: rgba(0, 0, 0, 0.6);">
                    <!-- <div class="d-flex align-items-center"> -->
                        <button id="export-kttv" class="btn d-flex flex-column align-items-center text-white p-0" style="margin-right: 10px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                 class="bi bi-file-earmark-arrow-down mb-1" viewBox="0 0 16 16">
                                <path d="M8.5 6.5a.5.5 0 0 0-1 0v3.793L6.354 9.146a.5.5 0 1 0-.708.708l2 2a.5.5 0 0 0 .708 0l2-2a.5.5 0 0 0-.708-.708L8.5 10.293z"/>
                                <path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2M9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"/>
                            </svg>
                            <small>Xuất báo cáo</small>
                        </button>
                        <button id="scanUpload" class="btn d-none flex-column align-items-center text-white p-0" style="margin-right: 10px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="22" style="color: #fff;" fill="currentColor" class="bi bi-camera" viewBox="0 0 16 16">
                                <path d="M15 12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h1.172a3 3 0 0 0 2.12-.879l.83-.828A1 1 0 0 1 6.827 3h2.344a1 1 0 0 1 .707.293l.828.828A3 3 0 0 0 12.828 5H14a1 1 0 0 1 1 1zM2 4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.172a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 9.172 2H6.828a2 2 0 0 0-1.414.586l-.828.828A2 2 0 0 1 3.172 4z"/>
                                <path d="M8 11a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5m0 1a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7M3 6.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0"/>
                            </svg>
                            <small>Báo cáo hiện trạng</small>
                        </button>
                        <button id="settingAlert" class="btn d-flex flex-column align-items-center text-white p-0" style="margin-right: 10px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" style="color: #fff;" fill="currentColor" class="bi bi-gear" viewBox="0 0 16 16">
                                <path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492M5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0"/>
                                <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115z"/>
                            </svg>
                            <small>Cảnh báo</small>
                        </button>
                    <!-- </div> -->
                </div>
            </div>
        </div>
        <div id="guarantee" class="hidden">
            <div class="container-homePage" style="padding: 0; width: 100%;">
                <div class="homePage-header history-header" style="background-color: #282d31;">
                    <div style="line-height: 50px; justify-content: flex-start;" class="d-flex">
                        <button class="WarrantyScanNext" style="height: 40px; border: none; background-color: #282d31;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" style="color: #fff; margin-right: 10px;" class="bi bi-arrow-left" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8" />
                            </svg>
                        </button>
                        <p id="header-productName" style="width: 250px; color: #fff; text-align: left; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">-</p>
                    </div>
                    <div class="d-flex" style="line-height: 50px;">
                        <button id="errorWarranty"
                            style="height: 40px; border: none; background-color: #282d31; padding: 0;margin-right: 10px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" style="color: #fff;"
                                fill="currentColor" class="bi bi-exclamation-circle" viewBox="0 0 16 16">
                                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16" />
                                <path
                                    d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0M7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0z" />
                            </svg>
                        </button>
                        <button class="homepage-Pre-pickApp"
                            style="height: 40px; border: none; background-color: #282d31; padding: 0;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" style="color: #fff;"
                                fill="currentColor" class="bi bi-house" viewBox="0 0 16 16">
                                <path
                                    d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L2 8.207V13.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V8.207l.646.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293zM13 7.207V13.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V7.207l5-5z" />
                            </svg>
                        </button>
                    </div>
                </div>
                <div id="warranty-body">
                    <div class="content">
                        <!-- Tab Content -->
                        <div id="tab-0" class="tab-content">
                            <div>
                                <div class="d-flex" style="color: #fff; padding-left: 10px;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                                        class="bi bi-clock-history" viewBox="0 0 16 16">
                                        <path
                                            d="M8.515 1.019A7 7 0 0 0 8 1V0a8 8 0 0 1 .589.022zm2.004.45a7 7 0 0 0-.985-.299l.219-.976q.576.129 1.126.342zm1.37.71a7 7 0 0 0-.439-.27l.493-.87a8 8 0 0 1 .979.654l-.615.789a7 7 0 0 0-.418-.302zm1.834 1.79a7 7 0 0 0-.653-.796l.724-.69q.406.429.747.91zm.744 1.352a7 7 0 0 0-.214-.468l.893-.45a8 8 0 0 1 .45 1.088l-.95.313a7 7 0 0 0-.179-.483m.53 2.507a7 7 0 0 0-.1-1.025l.985-.17q.1.58.116 1.17zm-.131 1.538q.05-.254.081-.51l.993.123a8 8 0 0 1-.23 1.155l-.964-.267q.069-.247.12-.501m-.952 2.379q.276-.436.486-.908l.914.405q-.24.54-.555 1.038zm-.964 1.205q.183-.183.35-.378l.758.653a8 8 0 0 1-.401.432z" />
                                        <path d="M8 1a7 7 0 1 0 4.95 11.95l.707.707A8.001 8.001 0 1 1 8 0z" />
                                        <path
                                            d="M7.5 3a.5.5 0 0 1 .5.5v5.21l3.248 1.856a.5.5 0 0 1-.496.868l-3.5-2A.5.5 0 0 1 7 9V3.5a.5.5 0 0 1 .5-.5" />
                                    </svg>
                                    <h6 style="padding-left: 10px; padding-left: 10px;">Lịch sử bảo hành sản phẩm:</h6>
                                </div>
                            </div>
                            <ul id="history-warranty-detail"
                                style="overflow-y: auto; max-height: 538px; padding: 10px 0 0px;">
                                <h5 style="color: #fff;">Sản phẩm chưa từng bảo hành</h5>
                            </ul>
                        </div>

                        <div id="tab-1" class="tab-content active">
                            <div class="row">
                                <div class=" col-12 p-2">
                                    <div class="box-value" style="height: 150px; margin: 0;">
                                        <div class="d-flex justify-content-center">
                                            <!-- <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-moisture" viewBox="0 0 16 16">
                                                <path d="M13.5 0a.5.5 0 0 0 0 1H15v2.75h-.5a.5.5 0 0 0 0 1h.5V7.5h-1.5a.5.5 0 0 0 0 1H15v2.75h-.5a.5.5 0 0 0 0 1h.5V15h-1.5a.5.5 0 0 0 0 1h2a.5.5 0 0 0 .5-.5V.5a.5.5 0 0 0-.5-.5zM7 1.5l.364-.343a.5.5 0 0 0-.728 0l-.002.002-.006.007-.022.023-.08.088a29 29 0 0 0-1.274 1.517c-.769.983-1.714 2.325-2.385 3.727C2.368 7.564 2 8.682 2 9.733 2 12.614 4.212 15 7 15s5-2.386 5-5.267c0-1.05-.368-2.169-.867-3.212-.671-1.402-1.616-2.744-2.385-3.727a29 29 0 0 0-1.354-1.605l-.022-.023-.006-.007-.002-.001zm0 0-.364-.343zm-.016.766L7 2.247l.016.019c.24.274.572.667.944 1.144.611.781 1.32 1.776 1.901 2.827H4.14c.58-1.051 1.29-2.046 1.9-2.827.373-.477.706-.87.945-1.144zM3 9.733c0-.755.244-1.612.638-2.496h6.724c.395.884.638 1.741.638 2.496C11 12.117 9.182 14 7 14s-4-1.883-4-4.267" />
                                            </svg> -->
                                            <p style="padding-left: 5px;">Thông tin sản phẩm</p>
                                        </div>
                                        <h6 id="productName">Sản phẩm: -</h6>
                                        <h6 id="productCode">Mã định danh: -</h6>
                                        <h6 id="productSeri">Số seri: -</h6>
                                    </div>
                                </div>
                                <div class=" col-6 p-2">
                                    <div class="box-value" style="height: 116px; margin: 0;">
                                        <div class="d-flex justify-content-center">
                                            <p style="padding-left: 5px;">Bảo hành</p>
                                        </div>
                                        <h6 id="warrantyActive">-</h6>
                                        <h6 id="warrantyTimeActive"></h6>
                                    </div>
                                </div>
                                <div class=" col-6 p-2">
                                    <div class="box-value" style="height: 116px; margin: 0;">
                                        <div class="d-flex justify-content-center">
                                            <!-- <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-moisture" viewBox="0 0 16 16">
                                                <path d="M13.5 0a.5.5 0 0 0 0 1H15v2.75h-.5a.5.5 0 0 0 0 1h.5V7.5h-1.5a.5.5 0 0 0 0 1H15v2.75h-.5a.5.5 0 0 0 0 1h.5V15h-1.5a.5.5 0 0 0 0 1h2a.5.5 0 0 0 .5-.5V.5a.5.5 0 0 0-.5-.5zM7 1.5l.364-.343a.5.5 0 0 0-.728 0l-.002.002-.006.007-.022.023-.08.088a29 29 0 0 0-1.274 1.517c-.769.983-1.714 2.325-2.385 3.727C2.368 7.564 2 8.682 2 9.733 2 12.614 4.212 15 7 15s5-2.386 5-5.267c0-1.05-.368-2.169-.867-3.212-.671-1.402-1.616-2.744-2.385-3.727a29 29 0 0 0-1.354-1.605l-.022-.023-.006-.007-.002-.001zm0 0-.364-.343zm-.016.766L7 2.247l.016.019c.24.274.572.667.944 1.144.611.781 1.32 1.776 1.901 2.827H4.14c.58-1.051 1.29-2.046 1.9-2.827.373-.477.706-.87.945-1.144zM3 9.733c0-.755.244-1.612.638-2.496h6.724c.395.884.638 1.741.638 2.496C11 12.117 9.182 14 7 14s-4-1.883-4-4.267" />
                                            </svg> -->
                                            <p style="padding-left: 5px;">Thời gian Bảo hành</p>
                                        </div>
                                        <h6 id="warrantyTime">-</h6>
                                    </div>
                                </div>
                                <div class=" col-12 p-2">
                                    <div class="box-value" style="height: 250px; margin: 0; padding: 0;">
                                        <img id="deviceImg"
                                            style="width: 100%; height: 100%; object-fit: cover; border-radius: 4px;"
                                            src="" alt="">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="tab-2" class="tab-content">
                            <h3 style="color: #fff; margin-top: 50px;">Tạo nhiều QR Code</h3>
                            <!-- <input type="number" class="form-control"  id="startValue" placeholder="Nhập số lượng mã QR cần in"> -->
                            <input id="startValue" type="text" placeholder="Nhập số lượng mã QR cần in"
                                style="width: 100%; border-radius: 4px; height: 50px; color: #fff; padding-left: 20px; margin-top: 10px; background-color: #343a40; border: none; border-bottom: 1px solid #626262;">
                            <button id="generateQRCodes" class="btn btn-warning"
                                style="background-color: #f39c12;margin-top: 20px; border: solid 1px #f39c12; width: 100%; height: 35px; color: #fff;">Tạo
                                QR</button>
                        </div>
                    </div>

                    <!-- Bottom Navigation -->
                    <div id="menu-warranty" class="bottom-navigation d-none">
                        <button id="btn-tab1" data-tab="1">
                            <!-- <img src="https://cdn-icons-png.flaticon.com/512/3409/3409588.png" alt="Quét QR"> -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                class="bi bi-list-ul" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2" />
                            </svg>
                            Chi tiết
                        </button>
                        <button id="btn-tab1" data-tab="0">
                            <!-- <img src="./assets/img/Screenshot 2024-10-11 103819.png" alt="Tạo QR"> -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                class="bi bi-clock-history" viewBox="0 0 16 16">
                                <path
                                    d="M8.515 1.019A7 7 0 0 0 8 1V0a8 8 0 0 1 .589.022zm2.004.45a7 7 0 0 0-.985-.299l.219-.976q.576.129 1.126.342zm1.37.71a7 7 0 0 0-.439-.27l.493-.87a8 8 0 0 1 .979.654l-.615.789a7 7 0 0 0-.418-.302zm1.834 1.79a7 7 0 0 0-.653-.796l.724-.69q.406.429.747.91zm.744 1.352a7 7 0 0 0-.214-.468l.893-.45a8 8 0 0 1 .45 1.088l-.95.313a7 7 0 0 0-.179-.483m.53 2.507a7 7 0 0 0-.1-1.025l.985-.17q.1.58.116 1.17zm-.131 1.538q.05-.254.081-.51l.993.123a8 8 0 0 1-.23 1.155l-.964-.267q.069-.247.12-.501m-.952 2.379q.276-.436.486-.908l.914.405q-.24.54-.555 1.038zm-.964 1.205q.183-.183.35-.378l.758.653a8 8 0 0 1-.401.432z" />
                                <path d="M8 1a7 7 0 1 0 4.95 11.95l.707.707A8.001 8.001 0 1 1 8 0z" />
                                <path
                                    d="M7.5 3a.5.5 0 0 1 .5.5v5.21l3.248 1.856a.5.5 0 0 1-.496.868l-3.5-2A.5.5 0 0 1 7 9V3.5a.5.5 0 0 1 .5-.5" />
                            </svg>
                            Lịch sử
                        </button>
                        <button id="btn-tab1" data-tab="2" class="d-none">
                            <!-- <img src="./assets/img/Screenshot 2024-10-11 103819.png" alt="Tạo nhiều QR"> -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                class="bi bi-qr-code" viewBox="0 0 16 16">
                                <path d="M2 2h2v2H2z" />
                                <path d="M6 0v6H0V0zM5 1H1v4h4zM4 12H2v2h2z" />
                                <path d="M6 10v6H0v-6zm-5 1v4h4v-4zm11-9h2v2h-2z" />
                                <path
                                    d="M10 0v6h6V0zm5 1v4h-4V1zM8 1V0h1v2H8v2H7V1zm0 5V4h1v2zM6 8V7h1V6h1v2h1V7h5v1h-4v1H7V8zm0 0v1H2V8H1v1H0V7h3v1zm10 1h-1V7h1zm-1 0h-1v2h2v-1h-1zm-4 0h2v1h-1v1h-1zm2 3v-1h-1v1h-1v1H9v1h3v-2zm0 0h3v1h-2v1h-1zm-4-1v1h1v-2H7v1z" />
                                <path d="M7 12h1v3h4v1H7zm9 2v2h-3v-1h2v-1z" />
                            </svg>
                            Tạo QR
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div id="condition" class="hidden">
            <div class="container" style="padding: 0; width: 100%; height: 100%; padding-bottom: 10px;">
                <div class="homePage-header history-header" style="background-color: #282d31; z-index: 1001; position: fixed; height: 50px; top: 0; left: 0;">
                    <div style="line-height: 50px; justify-content: flex-start;" class="d-flex">
                        <button class="WarrantyScanNext" style="height: 40px; border: none; background-color: #282d31;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                                style="color: #fff; margin-right: 10px;" class="bi bi-arrow-left" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8" />
                            </svg>
                        </button>
                        <p id="header-conditionName"
                            style="width: 230px; color: #fff; text-align: left; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">
                            -</p>
                    </div>
                    <div class="d-flex" style="line-height: 50px;">
                        <button id="export-condition" style="height: 40px; border: none; background-color: #282d31; padding: 0;margin-right: 10px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" style="color: #fff;" fill="currentColor" class="bi bi-file-earmark-arrow-down" viewBox="0 0 16 16">
                                <path d="M8.5 6.5a.5.5 0 0 0-1 0v3.793L6.354 9.146a.5.5 0 1 0-.708.708l2 2a.5.5 0 0 0 .708 0l2-2a.5.5 0 0 0-.708-.708L8.5 10.293z"/>
                                <path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2M9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"/>
                              </svg>
                        </button>
                        <button id="schedule-condition" 
                            style="height: 40px; border: none; background-color: #282d31; padding: 0;margin-right: 10px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" style="color: #fff;"
                                fill="currentColor" class="bi bi-calendar-check" viewBox="0 0 16 16">
                                <path
                                    d="M10.854 7.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7.5 9.793l2.646-2.647a.5.5 0 0 1 .708 0" />
                                <path
                                    d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5M1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4z" />
                            </svg>
                        </button>
                        <button id="error-condition" class="d-none"
                            style="height: 40px; border: none; background-color: #282d31; padding: 0;margin-right: 10px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" style="color: #fff;"
                                fill="currentColor" class="bi bi-exclamation-circle" viewBox="0 0 16 16">
                                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16" />
                                <path
                                    d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0M7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0z" />
                            </svg>
                        </button>
                        <!-- <button class="homepage-Pre-pickApp" style="height: 40px; border: none; background-color: #282d31; padding: 0;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" style="color: #fff;" fill="currentColor" class="bi bi-house" viewBox="0 0 16 16">
                                <path d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L2 8.207V13.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V8.207l.646.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293zM13 7.207V13.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V7.207l5-5z"/>
                            </svg>
                        </button> -->
                    </div>
                </div>
                <div id="homePage-body" class="mb-3 mt-4">
                    <div>-</div>
                    <div class="d-flex">
                        <div class="col-5" style="padding-right: 5px;">
                            <div class="mt-3 p-2 border rounded-5"
                                style="padding-top: 60px; height: 95px; background-color: black; color: white; border-radius: 15px;">
                                <div class="row mb-5" style="--bs-gutter-x: 0rem;">
                                    <div class="d-flex w-100 justify-content-between">
                                        <div class="col-6 d-flex flex-column align-items-center">
                                            <div id="power"
                                                class="bs-icon-xl bs-icon-circle d-flex flex-shrink-0 justify-content-center align-items-center d-inline-block bs-icon xl pb-2"
                                                style="background: #000000;box-shadow: 0px 0px 30px 5px #000000;border: 1px solid;width: 55px;height: 55px;border-radius: 50%;">
                                                <button class="btn btn-primary buttonClickWater p-0 m-0" type="button"
                                                    style="background-color: initial;border: none;font-size: 35px; outline: none; box-shadow: none;">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"
                                                        fill="currentColor" class="bi bi-lightning-charge"
                                                        viewBox="0 0 16 16">
                                                        <path
                                                            d="M11.251.068a.5.5 0 0 1 .227.58L9.677 6.5H13a.5.5 0 0 1 .364.843l-8 8.5a.5.5 0 0 1-.842-.49L6.323 9.5H3a.5.5 0 0 1-.364-.843l8-8.5a.5.5 0 0 1 .615-.09zM4.157 8.5H7a.5.5 0 0 1 .478.647L6.11 13.59l5.732-6.09H9a.5.5 0 0 1-.478-.647L9.89 2.41z" />
                                                    </svg>
                                                </button>
                                            </div>
                                            <span>Power</span>
                                        </div>
                                        <div class="col-6 d-flex flex-column align-items-center">
                                            <div id="online"
                                                class="bs-icon-xl bs-icon-circle d-flex flex-shrink-0 justify-content-center align-items-center d-inline-block bs-icon xl pb-2"
                                                style="background: #000000;box-shadow: 0px 0px 30px 5px #000000;border: 1px solid;width: 55px;height: 55px;border-radius: 50%;">
                                                <button class="btn btn-primary buttonClickWater p-0 m-0" type="button"
                                                    style="background-color: initial;border: none;font-size: 35px; outline: none; box-shadow: none;">
                                                    <!-- <svg class="bi bi-power" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 16 16">
                                                        <path d="M7.5 1v7h1V1z"></path>
                                                        <path d="M3 8.812a4.999 4.999 0 0 1 2.578-4.375l-.485-.874A6 6 0 1 0 11 3.616l-.501.865A5 5 0 1 1 3 8.812"></path>
                                                    </svg> -->
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"
                                                        fill="currentColor" class="bi bi-plugin" viewBox="0 0 16 16">
                                                        <path fill-rule="evenodd"
                                                            d="M1 8a7 7 0 1 1 2.898 5.673c-.167-.121-.216-.406-.002-.62l1.8-1.8a3.5 3.5 0 0 0 4.572-.328l1.414-1.415a.5.5 0 0 0 0-.707l-.707-.707 1.559-1.563a.5.5 0 1 0-.708-.706l-1.559 1.562-1.414-1.414 1.56-1.562a.5.5 0 1 0-.707-.706l-1.56 1.56-.707-.706a.5.5 0 0 0-.707 0L5.318 5.975a3.5 3.5 0 0 0-.328 4.571l-1.8 1.8c-.58.58-.62 1.6.121 2.137A8 8 0 1 0 0 8a.5.5 0 0 0 1 0" />
                                                    </svg>
                                                </button>
                                            </div>
                                            <span id="statusCabinet">Offline</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-7" style="padding-left: 5px;">
                            <div class="mt-3 p-4 border rounded-5" style="padding-top: 60px; height: 95px; background-color: black; color: white; border-radius: 15px;">
                                <div class="row mb-5" style="--bs-gutter-x: 0rem;">
                                    <div class="col-12 d-flex flex-column align-items-center">
                                        <div class="d-flex mb-1" style="line-height: 20px;">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                                fill="currentColor" class="bi bi-arrow-left-right" viewBox="0 0 16 16">
                                                <path fill-rule="evenodd"
                                                    d="M1 11.5a.5.5 0 0 0 .5.5h11.793l-3.147 3.146a.5.5 0 0 0 .708.708l4-4a.5.5 0 0 0 0-.708l-4-4a.5.5 0 0 0-.708.708L13.293 11H1.5a.5.5 0 0 0-.5.5m14-7a.5.5 0 0 1-.5.5H2.707l3.147 3.146a.5.5 0 1 1-.708.708l-4-4a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L2.707 4H14.5a.5.5 0 0 1 .5.5" />
                                            </svg>
                                            <p style="margin: 0; font-size: 16px; margin-left: 10px;">Cập nhật</p>
                                        </div>
                                        <div>
                                            <p id="setDateTimeCondition" style="font-size: 16px; margin: 0;">-</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="m-3 m-md-5 p-4 border rounded-5"
                        style="padding-top: 60px; background-color: black; color: white; border-radius: 15px;">
                        <div id="relay-container" class="row" style="--bs-gutter-x: 0rem;">
                        </div>
                        <div id="meter-container" class="mt-1 mb-4 p-0 px-md-5 justify-content-center">

                        </div>
                        <div class="d-none mt-1 mb-4 p-0 px-md-5 justify-content-center">
                            <div id="ElectricityMeter-1" class="w-100 p-2 mt-4"
                                style="border: 1px solid;cursor: pointer;">
                                <div>
                                    <p class="m-0" style="font-size: 20px;">Điện thiết bị 1</p>
                                </div>
                                <div class="d-flex">
                                    <div class="w-50">
                                        <div class="d-flex py-4">
                                            <div id="testResizableDiv1" class="w-75">
                                                <div id="testResizableArray1" class="float-end">
                                                </div>
                                            </div><span class="pt-2 px-2"
                                                style="font-size: 20px;color: #149aa4;"><strong>V</strong></span>
                                        </div>
                                        <div class="d-flex py-4">
                                            <div id="testResizableDiv1-1" class="w-75">
                                                <div id="testResizableArray1-1" class="float-end">
                                                </div>
                                            </div><span class="pt-2 px-2"
                                                style="font-size: 20px;color: #e97540;"><strong>W</strong></span>
                                        </div>
                                    </div>
                                    <div class="w-50">
                                        <div class="d-flex py-4">
                                            <div id="testResizableDiv1-2">
                                                <div id="testResizableArray1-2"></div>
                                            </div><span class="pt-2 px-2"
                                                style="font-size: 20px;color: #f2f442;"><strong>A</strong></span>
                                        </div>
                                        <div class="d-flex py-4">
                                            <div id="testResizableDiv1-3">
                                                <div id="testResizableArray1-3"></div>
                                            </div><span class="pt-2 px-2"
                                                style="font-size: 20px;color: #1a8f93;"><strong>Kwh</strong></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div id="ElectricityMeter-2" class=" w-100 p-2 mt-2"
                                style="border: 1px solid;cursor: pointer;">
                                <div>
                                    <p class="m-0" style="font-size: 20px;">Điện thiết bị 2</p>
                                </div>
                                <div class="d-flex">
                                    <div class="w-50">
                                        <div class="d-flex py-4">
                                            <div id="testResizableDiv2" class="w-75">
                                                <div id="testResizableArray2" class="float-end">
                                                </div>
                                            </div><span class="pt-2 px-2"
                                                style="font-size: 20px;color: #149aa4;"><strong>V</strong></span>
                                        </div>
                                        <div class="d-flex py-4">
                                            <div id="testResizableDiv2-1" class="w-75">
                                                <div id="testResizableArray2-1" class="float-end">
                                                </div>
                                            </div><span class="pt-2 px-2"
                                                style="font-size: 20px;color: #e97540;"><strong>W</strong></span>
                                        </div>
                                    </div>
                                    <div class="w-50">
                                        <div class="d-flex py-4">
                                            <div id="testResizableDiv2-2">
                                                <div id="testResizableArray2-2"></div>
                                            </div><span class="pt-2 px-2"
                                                style="font-size: 20px;color: #f2f442;"><strong>A</strong></span>
                                        </div>
                                        <div class="d-flex py-4">
                                            <div id="testResizableDiv2-3">
                                                <div id="testResizableArray2-3"></div>
                                            </div><span class="pt-2 px-2"
                                                style="font-size: 20px;color: #1a8f93;"><strong>Kwh</strong></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div id="ElectricityMeter-3" class=" w-100 p-2 mt-2"
                                style="border: 1px solid;cursor: pointer;">
                                <div>
                                    <p class="m-0" style="font-size: 20px;">Điện thiết bị 3</p>
                                </div>
                                <div class="d-flex">
                                    <div class="w-50">
                                        <div class="d-flex py-4">
                                            <div id="testResizableDiv3" class="w-75">
                                                <div id="testResizableArray3" class="float-end">
                                                </div>
                                            </div><span class="pt-2 px-2"
                                                style="font-size: 20px;color: #149aa4;"><strong>V</strong></span>
                                        </div>
                                        <div class="d-flex py-4">
                                            <div id="testResizableDiv3-1" class="w-75">
                                                <div id="testResizableArray3-1" class="float-end">
                                                </div>
                                            </div><span class="pt-2 px-2"
                                                style="font-size: 20px;color: #e97540;"><strong>W</strong></span>
                                        </div>
                                    </div>
                                    <div class="w-50">
                                        <div class="d-flex py-4">
                                            <div id="testResizableDiv3-2">
                                                <div id="testResizableArray3-2"></div>
                                            </div><span class="pt-2 px-2"
                                                style="font-size: 20px;color: #f2f442;"><strong>A</strong></span>
                                        </div>
                                        <div class="d-flex py-4">
                                            <div id="testResizableDiv3-3">
                                                <div id="testResizableArray3-3"></div>
                                            </div><span class="pt-2 px-2"
                                                style="font-size: 20px;color: #1a8f93;"><strong>Kwh</strong></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="chatAI" class="hidden" style="color: white;">

        </div>
        <div id="qr-popup" class="modal">
            <div id="qr-reader"></div>
            <button id="close-scanner">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-x"
                    viewBox="0 0 16 16">
                    <path
                        d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708" />
                </svg>
            </button>
            <button id="toggle-camera">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                    class="bi bi-arrow-repeat" viewBox="0 0 16 16">
                    <path
                        d="M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41m-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9" />
                    <path fill-rule="evenodd"
                        d="M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5 5 0 0 0 8 3M3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9z" />
                </svg>
            </button>
            <div id="result-form" class="d-none" style="width: 95vh; height: 200px;">
                <div id="result-form-group">
                    <div id="result-form-total" class="d-none">
                        <div id="result-form-title" class="d-none" style="width: 100%; text-align: center;">
                            <p style="color: #fff;">Mã truy cập lỗi, vui lòng thử lại.</p>
                        </div>
                        <input id="result-form-stationID" disabled type="text"
                            style="width: 100%; height: 50px; color: #fff; padding-left: 20px; margin-top: 10px; background-color: #343a40; border: none; border-bottom: 1px solid #626262;">
                        <input id="result-form-stationName" disabled type="text"
                            style="width: 100%; height: 50px; color: #fff; padding-left: 20px; margin-top: 10px; background-color: #343a40; border: none; border-bottom: 1px solid #626262;">
                        <div class="d-flex justify-content-center pt-2">
                            <button id="result-scanagain" class="btn mx-2"
                                style="background-color: #c44133;border: solid 1px #c44133; width: 47%; color: #fff;">Quét
                                lại</button>
                            <button id="result-truycap" disabled class="btn mx-2"
                                style="background-color: #f39c12;border: solid 1px #f39c12; width: 47%; color: #fff;">Truy
                                cập</button>
                        </div>
                    </div>
                    <div id="result-product" class="d-none">
                        <div id="result-product-title" class="d-none" style="width: 100%; text-align: center;">
                            <p style="color: #fff;">Mã sản phẩm lỗi, vui lòng thử lại.</p>
                        </div>
                        <p></p>
                        <input id="result-form-productName" disabled type="text"
                            style="width: 100%; height: 50px; color: #fff; padding-left: 20px; margin-top: 10px; background-color: #343a40; border: none; border-bottom: 1px solid #626262;">
                        <input id="result-form-productCode" disabled type="text"
                            style="width: 100%; height: 50px; color: #fff; padding-left: 20px; margin-top: 10px; background-color: #343a40; border: none; border-bottom: 1px solid #626262;">
                        <div class="d-flex justify-content-between pt-2">
                            <button id="result-product-scanagain" class="btn "
                                style="background-color: #c44133;border: solid 1px #c44133; width: 47%; color: #fff;">Quét
                                lại</button>
                            <button id="result-product-truycap" disabled class="btn "
                                style="background-color: #f39c12;border: solid 1px #f39c12; width: 47%; color: #fff;">Xem
                                chi tiết</button>
                        </div>
                        <button id="result-product-warranty" class="btn mt-2"
                            style="background-color: #f39c12;border: solid 1px #f39c12; width: 100%; color: #fff;">Kích
                            hoạt bảo hành</button>
                    </div>
                    <div id="result-condition" class="d-none">
                        <div id="result-condition-title" class="d-none" style="width: 100%; text-align: center;">
                            <p style="color: #fff;">Mã sản phẩm lỗi, vui lòng thử lại.</p>
                        </div>
                        <p></p>
                        <input id="result-form-conditionName" disabled type="text"
                            style="width: 100%; height: 50px; color: #fff; padding-left: 20px; margin-top: 10px; background-color: #343a40; border: none; border-bottom: 1px solid #626262;">
                        <input id="result-form-conditionCode" disabled type="text"
                            style="width: 100%; height: 50px; color: #fff; padding-left: 20px; margin-top: 10px; background-color: #343a40; border: none; border-bottom: 1px solid #626262;">
                        <div class="d-flex justify-content-between pt-2">
                            <button id="result-condition-scanagain" class="btn "
                                style="background-color: #c44133;border: solid 1px #c44133; width: 47%; color: #fff;">Quét
                                lại</button>
                            <button id="result-condition-truycap" disabled class="btn "
                                style="background-color: #f39c12;border: solid 1px #f39c12; width: 47%; color: #fff;">truy
                                cập</button>
                        </div>
                    </div>
                    <div id="result-form-loading">
                        <div style="width: 100%; text-align: center;">
                            <p style="color: #fff;">Đang kiểm tra dữ liệu.</p>
                        </div>
                        <div class="progress">
                            <div class="progress-bar progress-bar-striped" role="progressbar" style="width: 100%"
                                aria-valuenow="10" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="upload-qr">
                <p>Di chuyển camera đến mã QR để quét hoặc</p>
                <div class="d-flex justify-content-center">
                    <button style="margin-right: 5px;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                            class="bi bi-cloud-arrow-up" viewBox="0 0 16 16">
                            <path fill-rule="evenodd"
                                d="M7.646 5.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708z" />
                            <path
                                d="M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383m.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z" />
                        </svg>
                    </button>
                    <p style="margin-top: 10px;">Tải hình ảnh lên</p>
                </div>
            </div>
            <!-- <div id="footer-instruct-scanQR" class="d-none footer-instruct">
                <div class="step">
                    <div class="circle">04</div>
                </div>
                <p>Truy cập xem thông tin hoặc nhấn quét lại</p>
            </div> -->
            <input type="file" id="file-input" accept="image/*">
        </div>
        <div id="loading-popup" class="modal">
            <div class="modal-content" style="width: 80%; margin-top: 50px; margin-left: 10%;">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Đang tải dữ liệu...</h5>
                    <button id="button-modal-close" type="button" class="btn-close d-none" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="progress">
                        <div class="progress-bar progress-bar-striped" role="progressbar" style="width: 100%"
                            aria-valuenow="10" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>
            </div>
        </div>
        <div id="share-popup" class="modal">
            <div class="container" style="width: 100%; height: 100%; background-color: #1E2833;">
                <div class="d-flex" style="line-height: 50px;">
                    <button id="BackCodeQR" style="height: 40px; border: none; background-color: #1E2833;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                            style="color: #fff; margin-right: 10px;" class="bi bi-arrow-left" viewBox="0 0 16 16">
                            <path fill-rule="evenodd"
                                d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8" />
                        </svg>
                    </button>
                    <p style="width: 250px;font-size: 20px; color: #fff; text-align: left; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">Chia sẻ trạm</p>
                </div>
                <img src="https://central.homeos.vn/images/Logo_HomeOS_White.png" alt="" width="200"
                    style="padding-bottom: 3rem;">
                <div>
                    <p id="text-content-QRcode" style="color: #fff;"></p>
                </div>
                <div id="qrcode"></div>
                <button id="share-workStation" class="btn btn-warning" style="margin-top: 20px; background-color: #1f87a3;border: solid 1px #1f87a3; width: 100%; height: 35px; color: #fff; padding: 3px 10px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-share" viewBox="0 0 16 16">
                        <path d="M13.5 1a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3M11 2.5a2.5 2.5 0 1 1 .603 1.628l-6.718 3.12a2.5 2.5 0 0 1 0 1.504l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.256l6.718-3.12A2.5 2.5 0 0 1 11 2.5m-8.5 4a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3m11 5.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3"/>
                    </svg> Chia sẻ trạm cho bạn bè
                </button>
            </div>

        </div>
        <div id="chartCondition-popup" class="modal">
            <div class="container" style="width: 100%; height: 100%; background-color: #1E2833;">
                <div class="d-flex" style="line-height: 50px;">
                    <button id="BackCondition" style="height: 40px; border: none; background-color: #1E2833;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                            style="color: #fff; margin-right: 10px;" class="bi bi-arrow-left" viewBox="0 0 16 16">
                            <path fill-rule="evenodd"
                                d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8" />
                        </svg>
                    </button>
                    <p id="title-condition-popup"
                        style="width: 250px;font-size: 20px; color: #fff; text-align: left; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">
                        -</p>
                </div>
                <div class="row">
                    <div class="col-md-12 mb-4"><canvas id="chartVoltage"></canvas></div>
                    <div class="col-md-12 mb-4"><canvas id="chartCurrent"></canvas></div>
                    <div class="col-md-12 mb-4"><canvas id="chartPower"></canvas></div>
                    <div class="col-md-12 mb-4"><canvas id="chartEnergy"></canvas></div>
                </div>
            </div>
        </div>
        <div id="error-popup" class="modal">
            <div class="container" style="width: 100%; height: 100%; background-color: #1E2833;">
                <div class="d-flex" style="line-height: 50px;">
                    <button id="BackWarranty" style="height: 40px; border: none; background-color: #1E2833;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                            style="color: #fff; margin-right: 10px;" class="bi bi-arrow-left" viewBox="0 0 16 16">
                            <path fill-rule="evenodd"
                                d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8" />
                        </svg>
                    </button>
                    <p
                        style="width: 250px;font-size: 20px; color: #fff; text-align: left; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">
                        Khai báo lỗi</p>
                </div>
                <img src="https://central.homeos.vn/images/Logo_HomeOS_White.png" alt="" width="200"
                    style="padding-bottom: 3rem;">
                <div>
                    <div class="content-form" style="background-color: #1E2833; padding: 0;">
                        <div class="form-group content-detail">
                            <label class="form-label content-label" for="errorInput">Lỗi:</label>
                            <input type="text" id="errorInput" class="form-control content-input"
                                placeholder="Nhập lỗi...">
                        </div>
                        <div class="form-group content-detail">
                            <label class="form-label content-label" for="ap_ssid">Loại lỗi:</label>
                            <!-- <input type="text" id="ap_ssid" class="form-control content-input" placeholder="Nhập tên điểm truy cập..."> -->
                            <select name="" id="errorType" class="form-control content-input">
                                <option value="1">Lỗi thiết bị</option>
                                <option value="2">Lỗi người dùng</option>
                            </select>
                        </div>
                        <div class="form-group content-detail">
                            <label class="form-label content-label" for="ap_password">Mô tả:</label>
                            <!-- <input type="tex" id="ap_password" class="form-control content-input" placeholder="Nhập mật khẩu điểm truy cập..."> -->
                            <textarea id="errorDesc" class="form-control content-input" style="height: 120px;"
                                placeholder="Mô tả lỗi"></textarea>
                        </div>
                    </div>
                    <button id="submitError" class="btn btn-warning"
                        style="margin-top: 20px; background-color: #f39c12;border: solid 1px #f39c12; width: 100%; height: 35px; color: #fff; padding: 3px 10px;">
                        Xác nhận lỗi
                    </button>
                </div>

            </div>

        </div>
        <div id="schedule-condition-popup" class="modal">
            <div class="container" style="width: 100%; height: 100%; background-color: #1E2833;">
                <div class="d-flex" style="line-height: 50px;">
                    <button id="BackSchedule" style="height: 40px; border: none; background-color: #1E2833;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                            style="color: #fff; margin-right: 10px;" class="bi bi-arrow-left" viewBox="0 0 16 16">
                            <path fill-rule="evenodd"
                                d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8" />
                        </svg>
                    </button>
                    <p
                        style="width: 250px;font-size: 20px; color: #fff; text-align: left; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">
                        Lập lịch bật tắt</p>
                </div>
                <div class="content-form" style="background-color: #1E2833; padding: 0;">
                    <div class="form-group content-detail">
                        <label class="form-label content-label" for="txtScheduleName">Tên lịch:</label>
                        <input type="text" id="txtScheduleName" class="form-control content-input"
                            placeholder="Nhập tên lịch...">
                    </div>
                    <div class="row mb-2">
                        <div class="col-sm-12">
                            <label for="sltDeviceForSchedule">Relay được áp dụng</label>
                            <div id="sltDeviceForSchedule" class="row">
                                <div class="col-2 form-group content-detail">
                                    <label class="form-label content-label" for="checkboxK1">K1:</label>
                                    <input type="checkbox" id="checkboxK1" placeholder="Nhập tên lịch..."
                                        data-relayId="1">
                                </div>
                                <div class="col-2 form-group content-detail">
                                    <label class="form-label content-label" for="checkboxK2">K2:</label>
                                    <input type="checkbox" id="checkboxK2" placeholder="Nhập tên lịch..."
                                        data-relayId="2">
                                </div>
                                <div class="col-2 form-group content-detail">
                                    <label class="form-label content-label" for="checkboxK3">K3:</label>
                                    <input type="checkbox" id="checkboxK3" placeholder="Nhập tên lịch..."
                                        data-relayId="3">
                                </div>
                                <div class="col-2 form-group content-detail">
                                    <label class="form-label content-label" for="checkboxK4">K4:</label>
                                    <input type="checkbox" id="checkboxK4" placeholder="Nhập tên lịch..."
                                        data-relayId="4">
                                </div>
                                <div class="col-2 form-group content-detail">
                                    <label class="form-label content-label" for="checkboxK5">K5:</label>
                                    <input type="checkbox" id="checkboxK5" placeholder="Nhập tên lịch..."
                                        data-relayId="5">
                                </div>
                                <div class="col-2 form-group content-detail">
                                    <label class="form-label content-label" for="checkboxK6">K6:</label>
                                    <input type="checkbox" id="checkboxK6" placeholder="Nhập tên lịch..."
                                        data-relayId="6">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row flex-row" style="justify-content: space-between;">
                        <div class="col-12 d-flex flex-row pr-0" style="align-items: center;">
                            <div class="mr-3 d-flex flex-column w-100">
                                <label for="">Kịch bản áp dụng</label>
                                <div class="card mw-100 mh-100 m-0 p-3">
                                    <div class="form-group content-detail">
                                        <label class="form-label content-label" for="startTime">Thời điểm:</label>
                                        <input type="time" id="startTime" class="form-control content-input w-100">
                                    </div>
                                    <div class="mb-2">
                                        <div class="form-group content-detail">
                                            <label class="form-label content-label" for="cboScriptsCabinet">Kịch
                                                bản:</label>
                                        </div>
                                        <div class="row">
                                            <div class="col-6 form-group content-detail">
                                                <label class="form-label content-label" for="radioOn">Bật:</label>
                                                <input type="radio" name="cboScripts" id="radioOn"
                                                    placeholder="Nhập tên lịch..." checked>
                                            </div>
                                            <div class="col-6 form-group content-detail">
                                                <label class="form-label content-label" for="radioOff">Tắt:</label>
                                                <input type="radio" name="cboScripts" id="radioOff"
                                                    placeholder="Nhập tên lịch...">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <button id="submitCalendar" class="btn btn-warning"
                            style="margin-top: 20px; background-color: #2c697b;border: solid 1px #2c697b; width: 100%; height: 35px; color: #fff; padding: 3px 10px;">
                            Áp dụng kịch bản
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div id="error-condition-popup" class="modal">
            <div class="container" style="width: 100%; height: 100%; background-color: #1E2833;">
                <div class="d-flex" style="line-height: 50px;">
                    <button id="BackConditionError" style="height: 40px; border: none; background-color: #1E2833;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                            style="color: #fff; margin-right: 10px;" class="bi bi-arrow-left" viewBox="0 0 16 16">
                            <path fill-rule="evenodd"
                                d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8" />
                        </svg>
                    </button>
                    <p
                        style="width: 250px;font-size: 20px; color: #fff; text-align: left; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">
                        Khai báo lỗi</p>
                </div>
                <!-- <img src="https://central.homeos.vn/images/Logo_HomeOS_White.png" alt="" width="200" style="padding-bottom: 3rem;"> -->
                <div>
                    <div class="content-form" style="background-color: #1E2833; padding: 0;">
                        <div class="d-flex row">
                            <div class="col-6 form-group content-detail">
                                <label class="form-label content-label" for="ap_ssid">Ca làm việc:</label>
                                <!-- <input type="text" id="ap_ssid" class="form-control content-input" placeholder="Nhập tên điểm truy cập..."> -->
                                <select name="" id="errorCaType" class="form-control content-input">
                                    <option value="1">Ca 1</option>
                                    <option value="2">Ca 2</option>
                                    <option value="3">Ca 3</option>
                                </select>
                            </div>
                            <div class="col-6 form-group content-detail">
                                <label class="form-label content-label" for="ap_ssid">Loại lỗi:</label>
                                <!-- <input type="text" id="ap_ssid" class="form-control content-input" placeholder="Nhập tên điểm truy cập..."> -->
                                <select name="" id="errorConditionType" class="form-control content-input">
                                    <option value="1">Lỗi thiết bị</option>
                                    <option value="2">Lỗi người dùng</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group content-detail">
                            <label class="form-label content-label" for="textCondition">Lệnh sản xuất:</label>
                            <input type="text" id="LSXCondition" class="form-control content-input"
                                placeholder="Nhập lệnh sản xuất...">
                        </div>
                        <div class="form-group content-detail">
                            <label class="form-label content-label" for="ap_password">Mô tả:</label>
                            <!-- <input type="tex" id="ap_password" class="form-control content-input" placeholder="Nhập mật khẩu điểm truy cập..."> -->
                            <textarea id="errorConditionDesc" class="form-control content-input" style="height: 120px;"
                                placeholder="Mô tả lỗi"></textarea>
                        </div>
                        <div class="form-group content-detail">
                            <label class="form-label content-label" for="textCondition">Số lượng thiệt hại:</label>
                            <input type="text" id="textCondition" class="form-control content-input"
                                placeholder="Nhập lỗi...">
                        </div>
                        <div class="d-flex row">
                            <div class="col-6 form-group content-detail">
                                <label class="form-label content-label" for="errorStartTime">Thời gian bắt đầu:</label>
                                <input type="datetime-local" id="errorStartTime" class="form-control content-input"
                                    placeholder="Nhập lỗi...">
                            </div>
                            <div class="col-6 form-group content-detail">
                                <label class="form-label content-label" for="errorEndTime">Thời gian kết thúc:</label>
                                <input type="datetime-local" id="errorEndTime" class="form-control content-input"
                                    placeholder="Nhập lỗi...">
                            </div>
                        </div>
                    </div>
                    <button id="submitConditionError" class="btn btn-warning"
                        style="margin-top: 20px; background-color: #f39c12;border: solid 1px #f39c12; width: 100%; height: 35px; color: #fff; padding: 3px 10px;">
                        Xác nhận lỗi
                    </button>
                </div>
            </div>
        </div>
        <div id="export-condition-popup" class="modal">
            <div class="container" style="width: 100%; height: 100%; background-color: #1E2833;">
                <div class="d-flex" style="line-height: 50px;">
                    <button id="BackExportCondition" style="height: 40px; border: none; background-color: #1E2833;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                            style="color: #fff; margin-right: 10px;" class="bi bi-arrow-left" viewBox="0 0 16 16">
                            <path fill-rule="evenodd"
                                d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8" />
                        </svg>
                    </button>
                    <p style="width: 250px;font-size: 20px; color: #fff; text-align: left; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">Xuất báo cáo</p>
                </div>
                <div class="content-form" style="background-color: #1E2833; padding: 0;">
                    <div class="row flex-row" style="justify-content: space-between;">
                        <div class="col-12 d-flex flex-row pr-0" style="align-items: center;">
                            <div class="mr-3 d-flex flex-column w-100">
                                <div class="card mw-100 mh-100 m-0 p-3">
                                    <div class="form-group content-detail">
                                        <label class="form-label content-label" for="startTime">Kì báo cáo:</label>
                                        <select name="" class="form-control content-input" id="dateTimeReport">
                                            
                                        </select>
                                    </div>
                                    <div class="row">
                                        <div class="form-group content-detail col-6">
                                            <label class="form-label content-label" for="startTime">Ngày bắt đầu:</label>
                                            <input type="date" id="startDate" class="form-control content-input w-100">
                                        </div>
                                        <div class="form-group content-detail col-6">
                                            <label class="form-label content-label" for="startTime">Ngày kết thúc:</label>
                                            <input type="date" id="endDate" class="form-control content-input w-100">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="filter-kttv" class="form-group content-detail">
                        <div class="card mw-100 mh-100 m-0 mt-2 p-3">
                            <label class="form-label content-label" for="txtScheduleName">Yếu tố:</label>
                            <!-- <input type="text" id="txtScheduleName" class="form-control content-input" placeholder="Nhập tên lịch..."> -->
                            <select name="" class="form-control content-input" id="KTTV_Report">
                            </select>
                            <!-- <div id="KTTV_Report" style="overflow-y: auto; height: 160px;">

                            </div> -->
                        </div>
                        <!-- <div class="card mw-100 mh-100 m-0 mt-2 p-3">
                            <label class="form-label content-label" for="txtScheduleName">Yếu tố đã chọn:</label> -->
                            <!-- <input type="text" id="txtScheduleName" class="form-control content-input" placeholder="Nhập tên lịch..."> -->
                            <!-- <select name="" class="form-control content-input" id="KTTV_Report">
                            </select> -->
                            <!-- <div id="KTTV_Report" style="overflow-y: auto; height: 160px;">

                            </div>
                        </div> -->
                    </div>
                    <div id="filter-condition" class="form-group content-detail">
                        <label class="form-label content-label" for="txtScheduleName">Báo cáo:</label>
                        <!-- <input type="text" id="txtScheduleName" class="form-control content-input" placeholder="Nhập tên lịch..."> -->
                        <select name="" class="form-control content-input" id="nameReport">
                            <option value="RPT_BAO_CAO_GIO">Báo cáo điện năng theo giờ</option>
                            <option value="RPT_BAO_CAO_NGAY">Báo cáo điện năng theo ngày</option>
                            <option value="RPT_BAO_CAO">Báo cáo điện năng</option>
                        </select>
                    </div>
                    <div>
                        <button id="submitExport" class="btn btn-warning" style="margin-top: 20px; background-color: #2c697b;border: solid 1px #2c697b; width: 100%; height: 35px; color: #fff; padding: 3px 10px;">
                            Xuất dữ liệu báo cáo (excel)
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div id="alert-kttv-popup" class="modal">
            <div class="container" style="width: 100%; height: 100%; background-color: #1E2833;">
                <div class="d-flex" style="line-height: 50px;">
                    <button id="BackAlertKTTV" style="height: 40px; border: none; background-color: #1E2833;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" style="color: #fff; margin-right: 10px;" class="bi bi-arrow-left" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8" />
                        </svg>
                    </button>
                    <p style="width: 250px;font-size: 20px; color: #fff; text-align: left; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">Cài đặt cảnh báo</p>
                </div>
                <div class="content-form" style="background-color: #1E2833; padding: 0;">
                    <div class="row flex-row" style="justify-content: space-between;">
                        <div class="col-12 d-flex flex-row pr-0" style="align-items: center;">
                            <div class="mr-3 d-flex flex-column w-100">
                                <div class="card mw-100 mh-100 m-0 p-3">
                                    <div class="form-group content-detail">
                                        <label class="form-label content-label" for="startTime">Yếu tố cần thông báo:</label>
                                        <select name="" class="form-control content-input" id="device_ID_alert">
                                        
                                        </select>
                                    </div>
                                    <div class="form-group content-detail">
                                        <label class="form-label content-label" for="startTime">Tần suất nhận cảnh báo:</label>
                                        <select name="" class="form-control content-input" id="timeAlert">
                                            <option value="10">10 phút</option>
                                            <option value="30">30 phút</option>
                                            <option value="60">1 giờ</option>
                                            <option value="180">3 giờ</option>
                                            <option value="360">6 giờ</option>
                                        </select>
                                    </div>
                                    <div class="form-group content-detail">
                                        <label class="form-label content-label" for="startTime">Ngưỡng cảnh báo:</label>
                                        <div class="row">
                                            <div class="col-6 form-group content-detail">
                                                <!-- <label class="form-label content-label" for="startTime">Ngưỡng thấp</label> -->
                                                <input type="text" id="warningMin" class="form-control content-input w-100" placeholder="Ngưỡng thấp">
                                            </div>
                                            <div class="col-6 form-group content-detail">
                                                <!-- <label class="form-label content-label" for="startTime">Ngưỡng cao</label> -->
                                                <input type="text" id="warningMax" class="form-control content-input w-100" placeholder="Ngưỡng cao">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group content-detail">
                                        <label class="form-label content-label" >
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-exclamation-triangle" viewBox="0 0 16 16">
                                                <path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.15.15 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.2.2 0 0 1-.054.06.1.1 0 0 1-.066.017H1.146a.1.1 0 0 1-.066-.017.2.2 0 0 1-.054-.06.18.18 0 0 1 .002-.183L7.884 2.073a.15.15 0 0 1 .054-.057m1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767z"/>
                                                <path d="M7.002 12a1 1 0 1 1 2 0 1 1 0 0 1-2 0M7.1 5.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0z"/>
                                            </svg>
                                            Lưu ý: khi nhận được 7 tin nhắn cảnh báo hãy tương tác lại, ví dụ: nhắn lại 1 tin cho OA.
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <button id="submitAlert" class="btn btn-warning" style="margin-top: 20px; background-color: #2c697b;border: solid 1px #2c697b; width: 100%; height: 35px; color: #fff; padding: 3px 10px;">
                            Nhận cảnh báo
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <!-- <script src="https://home-os-iot-smart.vercel.app/jquery-ui.min.js"></script> -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script> -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.2/Draggable.min.js"></script>
    <script type="text/javascript" src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/knockout/2.2.1/knockout-min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script>
        $(document).ready(function () {
            var listDomain = [];
            async function getListDomain() {
                const datatest = await getDM("https://central.homeos.vn/service_XD/service.svc", 'WARRANTY_SERVICE', "1=1");
                for (let i = 0; i < datatest.data.length; i++) {
                    listDomain.push(datatest.data[i].DOMAIN);
                }
            }
            getListDomain()
            $("#share-workStation").click(function () {
                const item = JSON.parse(localStorage.getItem("itemHistory"));
                window.shareWorkStation("Trạm quan trắc "+ item.NameWorkStation, 'https://central.homeos.vn/images/MiniAppLoadingScreen.png', item.CodeWorkStation);
            });
            let historyStack = ['pickApp'];

            let observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.attributeName === "class") {
                        let target = mutation.target;
                        let isHidden = target.classList.contains('hidden');
                        let id = target.id;

                        if (!isHidden && id && !historyStack.includes(id) && id != 'LoadScreen') {
                            historyStack.push(id);
                        }
                    }
                });
            });
            let screens = document.querySelectorAll('.app > div[id]');
            screens.forEach(screen => observer.observe(screen, { attributes: true }));

            if (typeof HomeOS !== 'undefined') {
                HomeOS.goBack = function () {
                    if (historyStack.length <= 1) {
                        return;
                    }

                    let currentScreen = historyStack.pop();
                    document.getElementById(currentScreen).classList.add('hidden');
                    let prevScreen = historyStack[historyStack.length - 1];
                    document.getElementById(prevScreen).classList.remove('hidden');
                };
            }
            // window.historyStack = 
            // window.goBack = goBack;

            var DataUser;
            var typeQR;
            
            var locations = [];
            var checkTabHistory = 0;
            var checkReport = '';
            // Gọi hàm GetUser từ script chính
            DataUser = JSON.parse(localStorage.getItem("userInfo"));
            var UserID = localStorage.getItem("userID");
            console.log(DataUser);
            
            async function handleUser() {
                if (UserID) {
                    try {
                        if (DataUser && DataUser.id === UserID) {
                            $(".userName").text(DataUser.name);
                            document.getElementById("PickApp-button-login").classList.add("d-none");
                            $(".userAvt").attr("src", DataUser.avatar);
                            document.getElementById("LogoPickScreen").style.paddingTop = "10vh";
                            const dataUserResponse = await getDM("https://central.homeos.vn/service_XD/service.svc", "WARRANTY_USER", "USER_ID='" + UserID + "'");
                            console.log(dataUserResponse.data);
                            if (dataUserResponse.data.length == 0) {
                                const willInsertData = {
                                    USER_ID: DataUser.id,
                                    USER_NAME: DataUser.name,
                                    USER_ROLE: "GUEST",
                                    DATE_CREATE: new Date(),
                                    DATASTATE: "ADD",
                                };
                                add('WARRANTY_USER', willInsertData);
                                localStorage.setItem('RoleUser', "GUEST");
                            } else {
                                console.log(dataUserResponse);
                                localStorage.setItem('RoleUser', dataUserResponse.data[0].USER_ROLE);
                            }
                        } else if (DataUser != undefined) {
                            const dataUserResponse = await getDM("https://central.homeos.vn/service_XD/service.svc", "WARRANTY_USER", "USER_ID='" + UserID + "'");
                            console.log(dataUserResponse.data);
                            if (dataUserResponse.data.length == 0) {
                                const willInsertData = {
                                    USER_ID: DataUser.id,
                                    USER_NAME: DataUser.name,
                                    USER_ROLE: "GUEST",
                                    DATE_CREATE: new Date(),
                                    DATASTATE: "ADD",
                                };
                                add('WARRANTY_USER', willInsertData);
                            }
                        } else {
                            localStorage.setItem('RoleUser', 'GUEST');
                        }
                    } catch (error) {
                        console.error("Error fetching user data:", error);
                    }
                } else {
                    // localStorage.setItem('RoleUser', 'GUEST');
                    document.getElementById("QUYEN").classList.add("d-none");
                    document.getElementById("LogoPickScreen").style.paddingTop = "10vh";
                }
                WarrantyCheckUser(localStorage.getItem("RoleUser"));
            }

            
            handleUser();
            var historyItems = [];
            var waranntyItems = [];
            var CategoryItems = [];
            var DataCategory = [];
            var historyListDetail = $('#history-detail');
            var historyListCategoryDetail = $('#list-history-detail');
            var historyListCategoryAdd = $('#list-history-add');
            var listCategory = $('#history-setting-detail');
            var listWarrantyHistory = $('#history-warranty-detail');
            var listLotProduct = $('#lot-warranty-detail');
            var NameWorkStation;
            var intervalId; // Lưu ID của setInterval
            var checkTab = false;
            var checkApp;

            // var user_id = "admin";
            // var session = "7b504acc-988a-437a-890f-389765305b47";

            const buttons = document.querySelectorAll(".btn-chart");
            buttons.forEach((button) => {
                button.addEventListener("click", function () {
                    buttons.forEach((btn) => btn.classList.remove("active"));
                    this.classList.add("active");
                });
            });
            function openTab(evt, tabName) {
                // Ẩn tất cả nội dung tab
                var tabContent = document.getElementsByClassName("tab-content");
                for (var i = 0; i < tabContent.length; i++) {
                    tabContent[i].classList.remove("active");
                }

                // Xóa class 'active' trên tất cả các nút
                var tabLinks = document.getElementsByClassName("tablinks");
                for (var i = 0; i < tabLinks.length; i++) {
                    tabLinks[i].classList.remove("active");
                }

                // Hiển thị tab được chọn và thêm class 'active' cho nút đã nhấn
                document.getElementById(tabName).classList.add("active");
                evt.currentTarget.classList.add("active");
            }

            function openTabGuarantee(evt, tabName) {
                // Ẩn tất cả nội dung tab

                var tabContent = document.getElementsByClassName("tab-content-guarantee");
                for (var i = 0; i < tabContent.length; i++) {
                    tabContent[i].classList.remove("active");
                }

                // Xóa class 'active' trên tất cả các nút
                var tabLinks = document.getElementsByClassName("tablinkGuarantee");
                for (var i = 0; i < tabLinks.length; i++) {
                    tabLinks[i].classList.remove("active");
                }

                // Hiển thị tab được chọn và thêm class 'active' cho nút đã nhấn
                document.getElementById(tabName).classList.add("active");
                evt.currentTarget.classList.add("active");
            }

            function openTabHistory(evt, tabName) {
                // Ẩn tất cả nội dung tab và bỏ class 'active'
                $('.tab-content-history').removeClass('active');
                $('.tablinkHistory').removeClass('active');

                // Hiển thị tab được chọn và thêm class 'active' cho nút đã nhấn
                $('#' + tabName).addClass('active');
                $(evt.currentTarget).addClass('active');

                if (typeof map !== 'undefined' && map) {
                    map.invalidateSize();
                }
            }

            function checkHeight() {
                const vh = $(window).height();
                $('#history-detail').height(vh - 180);
                $('#tabMap').height(vh - 130);
                $('#list-history-detail').height(vh - 530);
                $('#history-setting-detail').css('max-height', vh - 200);
            }

            checkHeight();
            $(window).on('resize', checkHeight);
            // Mặc định mở tab đầu tiên
            setTimeout(() => {
                document.getElementById("LoadScreen").classList.add("d-none");
                document.getElementById("LogoLoadScreen").classList.add("hidden");
                document.getElementById("pickApp").classList.remove("hidden");
                
                if(window.workstationID){
                    $('#nameHistory').addClass("d-none");
                    $('#nameHistory').removeClass("d-flex");
                    $('#listTabMap').removeClass("d-none");
                    $('#NameHistoryPage').text("Quan trắc:")
                    $('#descHistoryPage').text("Lịch sử truy cập")
                    $('#historySelect').removeClass("d-none");
                    $('#footerHistoryPage').text("thêm mới mã trạm hoặc chọn trạm đã lưu");

                    $('.workstation_access').removeClass("d-none");
                    $('.workstation_category').removeClass("d-none");
                    $('.warranty_scansQRcode').addClass("d-none");
                    $('.warranty_lot').addClass("d-none");
                    $('.warranty_scanQRcode').addClass("d-none");
                    checkTabHistory = 1;

                    getInputValue(window.workstationID);
                    document.getElementById("pickApp").classList.add("hidden");
                    document.getElementById("history").classList.add("hidden");
                }
            }, 2000);

            var maTram = '';
            function changeHistory() {
                document.getElementById("history").classList.remove("hidden");
                document.getElementById("homePage").classList.add("hidden");
                maTram = '';
            }
            function changeQRcode() {
                // openTab(event, 'tab1');
                document.getElementById("ScanQR").classList.remove("hidden");
                document.getElementById("homePage").classList.add("hidden");
                document.getElementById("history").classList.add("hidden");
                document.querySelector(".tablinkQR").click();
                maTram = '';
            }
            function OpenAddCategory() {
                $(".history-avt").addClass("d-none");
                document.getElementById("category-back").classList.remove("d-none");
                localStorage.setItem('listItemCategory', JSON.stringify([]));
                historyListCategoryAdd.empty()
                showHistoryCategory();
                document.getElementById("list-category").classList.add("d-none");
                document.getElementById("save-category").classList.remove("d-none");
            }
            function truyCap() {
                // document.getElementById("footer-instruct-scanQR").classList.add("d-none");
                document.getElementById("result-form").classList.add("d-none");
                $('#qr-popup').hide();
                document.getElementById("ScanQR").classList.add("hidden");
                document.getElementById("history").classList.add("hidden");
                document.getElementById("homePage").classList.remove("hidden");
                matram = localStorage.getItem("MATRAM");
                $("button-modal-loading").click();
                saveHistory(localStorage.getItem('MATRAM'));
                checkTypeWorkstation();
                getDataMonitoring();
            }
            function DetailProduct() {
                // document.getElementById("footer-instruct-scanQR").classList.add("d-none");
                document.getElementById("result-form").classList.add("d-none");
                document.getElementById("result-product").classList.add("d-none");
                document.getElementById("tab-0").classList.remove("active");
                document.getElementById("tab-1").classList.add("active");
                document.getElementById("btn-tab1").classList.add("menuWarranty");
                $('#qr-popup').hide()
                document.getElementById("ScanQRWarranty").classList.add("hidden");
                document.getElementById("guarantee").classList.remove("hidden");
                document.getElementById("menu-warranty").classList.remove("d-none");
                $('#loading-popup').hide()
                console.log('hide');
            }
            function DetailCondition() {
                // document.getElementById("footer-instruct-scanQR").classList.add("d-none");
                document.getElementById("result-form").classList.add("d-none");
                document.getElementById("result-product").classList.add("d-none");
                document.getElementById("tab-0").classList.remove("active");
                document.getElementById("tab-1").classList.add("active");
                document.getElementById("btn-tab1").classList.add("menuWarranty");
                $('#qr-popup').hide()
                document.getElementById("ScanQRWarranty").classList.add("hidden");
                document.getElementById("condition").classList.remove("hidden");
                $('#loading-popup').hide()
            }
            function scanAgain() {
                console.log("scan2");
                // document.getElementById("footer-instruct-scanQR").classList.add("d-none");
                document.getElementById("result-form").classList.add("d-none");
                document.getElementById("file-input").value = '';
                startQRcode();
            }
            $(".start").click(function () {
                const buttonId = $(this).attr("id"); // Lấy id của nút
                const dataId = $(this).data("id"); // Lấy giá trị data-id
                $("#result-form").addClass("d-none");
                console.log(dataId);
                typeQR = dataId;
                if (dataId == 3) {
                    const lotNumber = $("#lot-number").val(); // Giá trị của select
                    const classProduct = $("#classProduct").val().trim(); // Giá trị của input lớp sản phẩm
                    const classProductNumber = $("#classProductNumber").val().trim(); // Giá trị của input số lượng quét
                    let isValid = true;
                    if (lotNumber === "0") {
                        toastr.error("vui lòng chọn lô trước khi quét")
                        isValid = false;
                    } else if (classProduct === "") {
                        toastr.error("Vui lòng nhập Lớp sản phẩm!");
                        isValid = false;
                    } else if (classProductNumber === "" || isNaN(classProductNumber) || Number(classProductNumber) <= 0) {
                        toastr.error("Vui lòng nhập số lượng cần quét hợp lệ (lớn hơn 0)!");
                        isValid = false;
                    }
                    if (isValid) {
                        startQRcode();
                    }
                } else {
                    startQRcode();
                }
            })
            $("#PickApp-button-mua").click(function () {
                $('#nameHistory').addClass("d-none");
                $('#nameHistory').removeClass("d-flex");
                $('#listTabMap').removeClass("d-none");
                $('#NameHistoryPage').text("Quan trắc:")
                $('#descHistoryPage').text("Lịch sử truy cập")
                $('#historySelect').removeClass("d-none");
                $('#footerHistoryPage').text("thêm mới mã trạm hoặc chọn trạm đã lưu");

                $('.workstation_access').removeClass("d-none");
                $('.workstation_category').removeClass("d-none");
                $('.warranty_scansQRcode').addClass("d-none");
                $('.warranty_lot').addClass("d-none");
                $('.warranty_scanQRcode').addClass("d-none");

                historyListDetail.empty();
                showAddWorkStationButton();
                checkTabHistory = 1;
                showHistory();
                pickApp('MUA');
            });
            
            $("#PickApp-button-warranty").click(function () {
                $('#nameHistory').removeClass("d-none");
                $('#nameHistory').addClass("d-flex");
                $('#listTabMap').addClass("d-none");
                $('#NameHistoryPage').text("Sản phẩm:")
                $('#descHistoryPage').text("Lịch sử sản phẩm đã xem")
                $('#historySelect').addClass("d-none");
                $('#footerHistoryPage').text("Chọn sản phẩm đã xem hoặc thêm mới")

                openTabHistory(event, 'tabHistory');
                $('.workstation_access').addClass("d-none");
                $('.workstation_category').addClass("d-none");
                $('.warranty_scansQRcode').removeClass("d-none");
                $('.warranty_lot').removeClass("d-none");
                $('.warranty_scanQRcode').removeClass("d-none");

                historyListDetail.empty();
                showAddWorkStationButton();
                checkTabHistory = 2;
                addItemWarranty();
                pickApp('GUA');
            });
            $("#PickApp-button-condition").click(function () {
                $('#nameHistory').removeClass("d-none");
                $('#nameHistory').addClass("d-flex");
                $('#listTabMap').addClass("d-none");
                $('#NameHistoryPage').text("Tủ điều khiển:");
                $('#descHistoryPage').text("Lịch sử tủ đã truy cập:");
                $('#historySelect').addClass("d-none");
                $('#footerHistoryPage').text("chọn tủ đã truy cập hoặc thêm mới");

                openTabHistory(event, 'tabHistory');
                $('.workstation_access').addClass("d-none");
                $('.workstation_category').addClass("d-none");
                $('.warranty_scansQRcode').addClass("d-none");
                $('.warranty_lot').addClass("d-none");
                $('.warranty_scanQRcode').addClass("d-none");

                historyListDetail.empty();
                showAddWorkStationButton();
                checkTabHistory = 2;
                addItemWarranty('condition');
                pickApp('DK');
            });

            $("#PickApp-button-IOT").click(function () {
                pickApp('IOT');
            });

            $("#PickApp-button-pick").click(function () {
                showHistory();
                pickApp('PICK');
            });
            
            $("#PickApp-button-login").click(function () {
                pickApp('LOGIN');
            });

            $("#PickApp-button-AI").click(function () {
                pickApp("AI");
            });

            $("#backHistoryWarranty").click(function () {
                $('#ScanQRWarranty').addClass("hidden");
                if (checkApp == 'GUA') {
                    $("#PickApp-button-warranty").click();
                } else {
                    $("#PickApp-button-condition").click();
                }

            });
            $(".Pre-pickApp").click(function () {
                stopInterval()
                pickApp('PRE');
            });
            $("#share-qrcode-workstation").click(function () {
                // Hiển thị popup với hiệu ứng modal
                $("#share-popup").show()

                // Xóa nội dung mã QR cũ
                $('#qrcode').empty();

                // Dữ liệu để tạo mã QR
                const text = localStorage.getItem("URL") + "$" + localStorage.getItem("MATRAM");
                document.getElementById("text-content-QRcode").textContent =
                    localStorage.getItem("MATRAM") + " - " + JSON.parse(localStorage.getItem('itemHistory')).NameWorkStation;
                // Tạo mã QR
                QRCode.toCanvas(text, { width: 200 }, function (error, canvas) {
                    if (error) {
                        console.error("Lỗi khi tạo mã QR:", error);
                        alert('Lỗi khi tạo mã QR!');
                        return;
                    }

                    // Thêm canvas QR vào DOM
                    $('#qrcode').append(canvas);

                    // Tạo ảnh ẩn từ canvas (tùy chọn)
                    const image = canvas.toDataURL('image/png');
                    const img = $('<img>')
                        .attr('src', image)
                        .css({ display: 'none' }) // Ẩn ảnh đi
                        .attr('id', 'hidden-image');
                    $('#qrcode').append(img);
                });
            });

            $("#errorWarranty").click(function () {
                $("#error-popup").show();
            });
            $("#BackCodeQR").click(function () {
                $('#share-popup').hide();
            });
            $("#BackCondition").click(function () {
                $('#chartCondition-popup').hide();
                clearCharts();
            });
            $("#BackSchedule").click(function () {
                $('#schedule-condition-popup').hide();
            });
            $("#BackConditionError").click(function () {
                $('#error-condition-popup').hide();
            });
            $("#BackExportCondition").click(function () {
                $('#export-condition-popup').hide();
            });
            $("#BackAlertKTTV").click(function () {
                $('#alert-kttv-popup').hide();
            });
            $("#download-QRcode").click(function () {
                const img = $('#hidden-image')[0];

                if (!img) {
                    alert('Chưa có mã QR để tải!');
                }

                // Tạo thẻ <a> để tải xuống
                const link = document.createElement('a');
                link.href = img.src;
                link.download = 'qrcode.pdf';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            });
            $(".homepage-Pre-pickApp").click(function () {
                stopInterval();
                pickApp('PRE');
            });
            $("#tab-scan-qr").click(function (event) {
                openTab(event, 'tab1')
            });
            $("#tab-text").click(function (event) {
                openTab(event, 'tab2')
            });

            $("#tab-scan").click(function (event) {
                checkTab = false;
                openTabGuarantee(event, 'tab3')
            });
            $("#tab-history").click(function (event) {
                openTabGuarantee(event, 'tab4')
            });

            $("#tab-historys").click(function (event) {
                console.log(1);
                
                checkTab = false;
                openTabHistory(event, 'tabHistory')
            });
            $("#tab-map").click(function (event) {
                
                openTabHistory(event, 'tabMap');
            });

            $("#truycap").click(function () {
                getInputValue()
            });
            $("#saveCategory").click(function () {
                saveCategory()
            });
            $(".ScanQRNext").click(function () {
                document.getElementById("RT").textContent = '-';
                document.getElementById("RH").textContent = '-';
                document.getElementById("energy").textContent = '-';
                document.getElementById("status").style.background = "red";
                document.getElementById("text-status").textContent = "Mất kết nối";
                document.getElementById("RP").textContent = '-';
                document.getElementById("RD").textContent = '0 mm';
                document.getElementById("lastTimeRain").textContent = '';
                document.getElementById("lateDateTime").textContent = "-";
                pickApp('HISTORY');
            });
            $(".WarrantyScanNext").click(function () {
                document.getElementById("ScanQRWarranty").classList.remove("hidden");
                document.getElementById("guarantee").classList.add("hidden");
                document.getElementById("condition").classList.add("hidden");
                document.getElementById("menu-warranty").classList.add("d-none");
                document.getElementById("history").classList.add("hidden");

                document.querySelector(".tablinkGuarantee").click();
                onClose();
            });
            $("#button-list-ngay").click(function () {
                clickGetData('NGAY')
            });
            $("#button-list-tuan").click(function () {
                clickGetData('TUAN')
            });
            $("#button-list-thang").click(function () {
                clickGetData('THANG')
            });
            $("#button-list-nam").click(function () {
                clickGetData('NAM')
            });
            $("#result-scanagain").click(function () {
                document.getElementById("result-form-total").classList.add("d-none");
                document.getElementById("result-form-loading").classList.remove("d-none");
                document.getElementById("result-form-title").classList.add("d-none");
                document.getElementById("result-form-stationID").classList.remove("d-none");
                document.getElementById("result-form-stationName").classList.remove("d-none");
                document.getElementById("result-truycap").classList.remove("d-none");
                scanAgain();
            });
            $("#result-product-scanagain").click(function () {
                document.getElementById("result-product").classList.add("d-none");
                document.getElementById("result-form-loading").classList.remove("d-none");
                document.getElementById("result-product-title").classList.add("d-none");
                document.getElementById("result-form-productName").classList.remove("d-none");
                document.getElementById("result-form-productCode").classList.remove("d-none");
                document.getElementById("result-truycap").classList.remove("d-none");
                scanAgain();
            });
            $("#result-condition-scanagain").click(function () {
                document.getElementById("result-condition").classList.add("d-none");
                document.getElementById("result-form-loading").classList.remove("d-none");
                document.getElementById("result-condition-title").classList.add("d-none");
                document.getElementById("result-form-conditionName").classList.remove("d-none");
                document.getElementById("result-form-conditionCode").classList.remove("d-none");
                document.getElementById("result-truycap").classList.remove("d-none");
                scanAgain();
            });
            $("#PickApp-button-scanQR").click(function () {
                if (checkTabHistory == 1) {
                    stopInterval()
                    changeQRcode()
                } else if (checkTabHistory == 2) {
                    $(".WarrantyScanNext").click();
                }
            });
            $("#addWorkStation").click(function () {
                console.log(checkTabHistory);

                if (checkTabHistory == 1) {
                    changeQRcode()
                } else if (checkTabHistory == 2) {
                    $(".WarrantyScanNext").click();
                }
            });
            $("#addCategory").click(function () {
                OpenAddCategory()
            });
            $("#btnAddCategory").click(function () {
                OpenAddCategory()
            });
            $("#backCategory").click(function () {
                $(".history-avt").removeClass("d-none");
                document.getElementById("category-back").classList.add("d-none");
                document.getElementById("list-category").classList.remove("d-none");
                document.getElementById("save-category").classList.add("d-none");
                document.getElementById("detail-category").classList.add("d-none");
                showCategory();
                historyListCategoryAdd.empty();
            });
            $("#result-truycap").click(function () {
                document.getElementById("result-truycap").disabled = true;
                $("#loading-popup").show();
                truyCap();
            });
            $("#result-product-truycap").click(function () {
                document.getElementById("result-product-truycap").disabled = true;
                $("#loading-popup").show()
                DetailProduct();
            });
            $("#result-condition-truycap").click(function () {
                document.getElementById("result-condition-truycap").disabled = true;
                $("#loading-popup").show()
                getWebSocket("homeos.vn:447");
                DetailCondition();
            });
            $("#BackWarranty").click(function () {
                $("#error-popup").hide();
                $("#errorInput").val("");
                $("#errorType").val("");
                $("#errorDesc").val("");
            });
            document.getElementById("historySelect").addEventListener("change", function () {
                const selectedValue = this.value; // Lấy giá trị đã chọn
                const selectedText = this.options[this.selectedIndex].text; // Lấy văn bản đã chọn
                showHistory(selectedValue);
            });
            async function pickApp(type) {
                if (type == 'MUA') {
                    document.getElementById("LoadScreen").classList.remove("d-none");
                    document.getElementById("img-station").classList.remove("hidden");
                    document.getElementById("pickApp").classList.add("hidden");
                    setTimeout(() => {
                        document.getElementById("LoadScreen").classList.add("d-none");
                        document.getElementById("img-station").classList.add("hidden");
                        document.getElementById("history").classList.remove("hidden");
                    }, 2000);
                } else if (type == 'IOT') {
                    window.location.href = "http://devices.homeos.vn/";
                } else if (type == 'PICK') {
                    document.getElementById("history").classList.remove("hidden");
                    document.getElementById("ScanQR").classList.add("hidden");
                    document.getElementById("history-setting").classList.add("d-none");
                    document.getElementById("history-homePage").classList.remove("d-none");
                } else if (type == 'PRE') {
                    document.getElementById("history").classList.add("hidden");
                    document.getElementById("homePage").classList.add("hidden");
                    document.getElementById("pickApp").classList.remove("hidden");
                    document.getElementById("guarantee").classList.add("hidden");
                    document.getElementById("ScanQRWarranty").classList.add("hidden");
                    document.getElementById("menu-warranty").classList.add("d-none");
                    // document.getElementById("footer-instruct-warranty").classList.add("d-none");
                } else if (type == 'HISTORY') {
                    showHistory()
                    document.getElementById("history").classList.remove("hidden");
                    document.getElementById("homePage").classList.add("hidden");
                } else if (type == 'GUA') {
                    checkApp = type;
                    document.getElementById("LoadScreen").classList.remove("d-none");
                    document.getElementById("LogoLoadScreen").classList.remove("hidden");
                    document.getElementById("history").classList.remove("hidden");
                    setTimeout(() => {
                        document.getElementById("LoadScreen").classList.add("d-none");
                        document.getElementById("LogoLoadScreen").classList.add("hidden");
                    }, 2000);

                    // document.getElementById("ScanQRWarranty").classList.remove("hidden");

                    document.getElementById("pickApp").classList.add("hidden");
                    // document.getElementById("footer-instruct-warranty").classList.remove("d-none");

                    // document.querySelector(".tablinkGuarantee").click();

                    $(".warrantyDetailProduct").removeClass("d-none");
                    $("#ScanAllQRcode").addClass("d-none");
                    $("#lotProduct").addClass("d-none");
                    checkTab = false;
                } else if (type == 'LOGIN') {
                    if (window.GetUser) {
                        await window.GetUser();
                        DataUser = JSON.parse(localStorage.getItem("userInfo"));
                        $(".userName").text(DataUser.name);
                        document.getElementById("PickApp-button-login").classList.add("d-none");
                        $(".userAvt").attr("src", DataUser.avatar);
                        document.getElementById("LogoPickScreen").style.paddingTop = '10vh';
                        const dataUserResponse = await getDM("https://central.homeos.vn/service_XD/service.svc", "WARRANTY_USER", "USER_ID='" + UserID + "'");
                        if (dataUserResponse.data.length == 0) {
                            const willInsertData = {
                                USER_ID: DataUser.id,
                                USER_NAME: DataUser.name,
                                USER_ROLE: "GUEST",
                                DATE_CREATE: new Date(),
                                DATASTATE: "ADD",
                            };
                            add('WARRANTY_USER', willInsertData);
                        }
                    }
                } else if (type == 'DK') {
                    checkApp = type;
                    // document.getElementById("condition").classList.remove("hidden");
                    document.getElementById("pickApp").classList.add("hidden");
                    document.getElementById("history").classList.remove("hidden");
                    
                    // getWebSocket("hoangminhlighting.vn:447")
                } else if (type == 'AI') {
                    document.getElementById("LoadScreen").classList.remove("d-none");
                    document.getElementById("LogoLoadScreen").classList.remove("hidden");
                    document.getElementById("pickApp").classList.add("hidden");
                    setTimeout(() => {
                        document.getElementById("LoadScreen").classList.add("d-none");
                        document.getElementById("LogoLoadScreen").classList.add("hidden");
                        document.getElementById("chatAI").classList.remove("hidden");
                    }, 2000);
                    $("#chatAI").load("/pages/ChatAI/chatAI.html");
                }
            }
            async function CheckWorkStation(workstationID) {
                // var listDomain = ["thoitiet.ifee.edu.vn", "namdinh.homeos.vn", "kttvthaibinh.com.vn", "cctl-dongthap.homeos.vn", "angiang.homeos.vn", "pctthn.homeos.vn", "thanthongnhat.homeos.vn", "ninhbinh.homeos.vn"]
                var domain;
                var data;
                for (let i = 0; i < listDomain.length; i++) {
                    data = await getDataStation(workstationID, listDomain[i]);

                    if (data.length == 0 || data.length == undefined || data == null || data == '' || data == []) {
                        domain = '';
                    } else {
                        domain = listDomain[i];
                        break;
                    }
                }
                if (domain == '') {
                    toastr.error("Mã trạm không tồn tại");
                    $('#loading-popup').hide()
                } else {
                    localStorage.setItem("URL", "https://" + domain + "/Service/Service.svc");
                    //$("#result").text("Kết quả quét: " + data[0].WORKSTATION_ID +"- Trạm:"+ data[0].WORKSTATION_NAME);
                    document.getElementById("footer-stationName").textContent = data[0].WORKSTATION_ID + " - " + data[0].WORKSTATION_NAME;
                    localStorage.setItem("MATRAM", data[0].WORKSTATION_ID);
                    toastr.success("Truy cập thành công!");
                    truyCap()
                }
            }
            // kiểm tra xem trạm nhập chạy ở service nào
            async function getDomain(workstationID, type) {
                return new Promise(async (resolve, reject) => {
                    // var listDomain = ["thoitiet.ifee.edu.vn", "namdinh.homeos.vn", "kttvthaibinh.com.vn", "cctl-dongthap.homeos.vn", "angiang.homeos.vn", "pctthn.homeos.vn", "thanthongnhat.homeos.vn", "ninhbinh.homeos.vn"]
                    var domain;
                    var data;
                    for (let i = 0; i < listDomain.length; i++) {
                        data = await getDataStation(workstationID, listDomain[i]);

                        if (data.length == 0 || data.length == undefined || data == null || data == '' || data == []) {
                            domain = '';
                        } else {
                            domain = listDomain[i]
                            break;
                        }
                    }
                    if (type == "domain") {
                        resolve(domain);
                    } else {
                        resolve(data);
                    }
                });
            }

            async function getDataMonitoring() {
                const data = await getNewData(
                    localStorage.getItem("MATRAM"),
                    "WORKSTATION_ID='" + localStorage.getItem("MATRAM") + "'",
                    localStorage.getItem("URL")
                );
                const item = JSON.parse(localStorage.getItem('itemHistory'));
                const TypeWorkstation = getDayMessage(item.workstationType);
                const dataChart = await getDataChart('NGAY', '', '', TypeWorkstation, localStorage.getItem("MATRAM"), localStorage.getItem("URL"));
                // const dataChart = await getDataChart('NGAY', '', '', 'RD---', localStorage.getItem("MATRAM"), localStorage.getItem("URL"));
                
                if (dataChart != []) {
                    createChartData(dataChart, 'RD', 'NGAY')
                }

                changeDataHomePage(data.D);
                setInterval(async () => {
                    const data = await getNewData(
                        localStorage.getItem("MATRAM"),
                        "WORKSTATION_ID='" + localStorage.getItem("MATRAM") + "'",
                        localStorage.getItem("URL")
                    );
                    changeDataHomePage(data.D);
                }, 10000);
            }

            function getCurrentTime(time) {
                // Tạo đối tượng Date mới để lấy thời gian hiện tại
                let now;
                if (time) {
                    now = new Date(time);
                } else {
                    now = new Date();
                }

                const ngay = now.getDate(); // Ngày (1-31)
                const thang = now.getMonth() + 1; // Tháng (0-11) nên cần +1
                const nam = now.getFullYear(); // Năm (4 chữ số)
                // Lấy giờ, phút, giây
                const hours = now.getHours();   // Giờ (0-23)
                const minutes = now.getMinutes(); // Phút (0-59)
                const seconds = now.getSeconds(); // Giây (0-59)

                // Định dạng giờ thành dạng HH:MM:SS
                const chuoiNgay = `${ngay.toString().padStart(2, '0')}/${thang.toString().padStart(2, '0')}/${nam}`;
                const currentTime = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

                // Hiển thị giờ hiện tại
                if (time) {
                    document.getElementById("lateDateTime").textContent = chuoiNgay + " " + currentTime;
                }
                return chuoiNgay + " " + currentTime;
            }

            function getIconWorkstation(type) {
                switch (type) {
                    case "NAAM":
                        return '<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" style="color: #fff;" fill="currentColor" viewBox="0 0 640 512"><path d="M294.2 1.2c5.1 2.1 8.7 6.7 9.6 12.1l10.4 62.4c-23.3 10.8-42.9 28.4-56 50.3c-14.6-9-31.8-14.1-50.2-14.1c-53 0-96 43-96 96c0 35.5 19.3 66.6 48 83.2c.8 31.8 13.2 60.7 33.1 82.7l-56 39.2c-4.5 3.2-10.3 3.8-15.4 1.6s-8.7-6.7-9.6-12.1L98.1 317.9 13.4 303.8c-5.4-.9-10-4.5-12.1-9.6s-1.5-10.9 1.6-15.4L52.5 208 2.9 137.2c-3.2-4.5-3.8-10.3-1.6-15.4s6.7-8.7 12.1-9.6L98.1 98.1l14.1-84.7c.9-5.4 4.5-10 9.6-12.1s10.9-1.5 15.4 1.6L208 52.5 278.8 2.9c4.5-3.2 10.3-3.8 15.4-1.6zM208 144c13.8 0 26.7 4.4 37.1 11.9c-1.2 4.1-2.2 8.3-3 12.6c-37.9 14.6-67.2 46.6-77.8 86.4C151.8 243.1 144 226.5 144 208c0-35.3 28.7-64 64-64zm69.4 276c11 7.4 14 22.3 6.7 33.3l-32 48c-7.4 11-22.3 14-33.3 6.7s-14-22.3-6.7-33.3l32-48c7.4-11 22.3-14 33.3-6.7zm96 0c11 7.4 14 22.3 6.7 33.3l-32 48c-7.4 11-22.3 14-33.3 6.7s-14-22.3-6.7-33.3l32-48c7.4-11 22.3-14 33.3-6.7zm96 0c11 7.4 14 22.3 6.7 33.3l-32 48c-7.4 11-22.3 14-33.3 6.7s-14-22.3-6.7-33.3l32-48c7.4-11 22.3-14 33.3-6.7zm96 0c11 7.4 14 22.3 6.7 33.3l-32 48c-7.4 11-22.3 14-33.3 6.7s-14-22.3-6.7-33.3l32-48c7.4-11 22.3-14 33.3-6.7zm74.5-116.1c0 44.2-35.8 80-80 80l-271.9 0c-53 0-96-43-96-96c0-47.6 34.6-87 80-94.6l0-1.3c0-53 43-96 96-96c34.9 0 65.4 18.6 82.2 46.4c13-9.1 28.8-14.4 45.8-14.4c44.2 0 80 35.8 80 80c0 5.9-.6 11.7-1.9 17.2c37.4 6.7 65.8 39.4 65.8 78.7z"/></svg>';
                    case "N":
                        return '<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" style="color: #fff;" fill="currentColor" class="bi bi-moisture" viewBox="0 0 16 16"><path d="M13.5 0a.5.5 0 0 0 0 1H15v2.75h-.5a.5.5 0 0 0 0 1h.5V7.5h-1.5a.5.5 0 0 0 0 1H15v2.75h-.5a.5.5 0 0 0 0 1h.5V15h-1.5a.5.5 0 0 0 0 1h2a.5.5 0 0 0 .5-.5V.5a.5.5 0 0 0-.5-.5zM7 1.5l.364-.343a.5.5 0 0 0-.728 0l-.002.002-.006.007-.022.023-.08.088a29 29 0 0 0-1.274 1.517c-.769.983-1.714 2.325-2.385 3.727C2.368 7.564 2 8.682 2 9.733 2 12.614 4.212 15 7 15s5-2.386 5-5.267c0-1.05-.368-2.169-.867-3.212-.671-1.402-1.616-2.744-2.385-3.727a29 29 0 0 0-1.354-1.605l-.022-.023-.006-.007-.002-.001zm0 0-.364-.343zm-.016.766L7 2.247l.016.019c.24.274.572.667.944 1.144.611.781 1.32 1.776 1.901 2.827H4.14c.58-1.051 1.29-2.046 1.9-2.827.373-.477.706-.87.945-1.144zM3 9.733c0-.755.244-1.612.638-2.496h6.724c.395.884.638 1.741.638 2.496C11 12.117 9.182 14 7 14s-4-1.883-4-4.267"/></svg>';
                    case "M":
                        return '<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" style="color: #fff;" fill="currentColor" class="bi bi-cloud-lightning-rain" viewBox="0 0 16 16"><path d="M2.658 11.026a.5.5 0 0 1 .316.632l-.5 1.5a.5.5 0 1 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.316m9.5 0a.5.5 0 0 1 .316.632l-.5 1.5a.5.5 0 1 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.316m-7.5 1.5a.5.5 0 0 1 .316.632l-.5 1.5a.5.5 0 1 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.316m9.5 0a.5.5 0 0 1 .316.632l-.5 1.5a.5.5 0 1 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.316m-.753-8.499a5.001 5.001 0 0 0-9.499-1.004A3.5 3.5 0 1 0 3.5 10H13a3 3 0 0 0 .405-5.973M8.5 1a4 4 0 0 1 3.976 3.555.5.5 0 0 0 .5.445H13a2 2 0 0 1 0 4H3.5a2.5 2.5 0 1 1 .605-4.926.5.5 0 0 0 .596-.329A4 4 0 0 1 8.5 1M7.053 11.276A.5.5 0 0 1 7.5 11h1a.5.5 0 0 1 .474.658l-.28.842H9.5a.5.5 0 0 1 .39.812l-2 2.5a.5.5 0 0 1-.875-.433L7.36 14H6.5a.5.5 0 0 1-.447-.724z"/></svg>';
                    case "NNS":
                        return '<svg xmlns="http://www.w3.org/2000/svg" width="38" height="48" style="color: #fff;" fill="currentColor" class="bi bi-droplet-half" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M7.21.8C7.69.295 8 0 8 0q.164.544.371 1.038c.812 1.946 2.073 3.35 3.197 4.6C12.878 7.096 14 8.345 14 10a6 6 0 0 1-12 0C2 6.668 5.58 2.517 7.21.8m.413 1.021A31 31 0 0 0 5.794 3.99c-.726.95-1.436 2.008-1.96 3.07C3.304 8.133 3 9.138 3 10c0 0 2.5 1.5 5 .5s5-.5 5-.5c0-1.201-.796-2.157-2.181-3.7l-.03-.032C9.75 5.11 8.5 3.72 7.623 1.82z"/><path fill-rule="evenodd" d="M4.553 7.776c.82-1.641 1.717-2.753 2.093-3.13l.708.708c-.29.29-1.128 1.311-1.907 2.87z"/></svg>';
                    default:
                        return '<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" style="color: #fff;" fill="currentColor" class="bi bi-cloud" viewBox="0 0 16 16"><path d="M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383m.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z"/></svg>';
                }
            }

            function addItemHistory(item, type) {
                // Tạo phần tử nội dung chính
                if (type) {
                    const element = $(
                        '<div class="iconApp">' +
                        '<div id="App' + item.CodeWorkStation + '" class="icon" style="background-color: #28a745 !important;">' +
                        getIconWorkstation(item.workstationType) +
                        '</div>' +
                        '<div class="info-box-content" style="padding-right: 0">' +
                        '<div class="d-flex justify-content-between">' +
                        '<span class="app-text">' + item.CodeWorkStation + '</span>' +
                        '<span class="app-text" style="padding-right: 0">' + item.date + '</span>' +
                        '</div>' +
                        '<span class="app-text-number" style="padding-right: 0">' + item.NameWorkStation + '</span>' +
                        '</div>' +
                        '</div>'
                    );
                    // Tạo phần tử bao bọc với nút X
                    const totalElement = $(
                        '<div style="padding-bottom: 13px; position: relative;" class="history-item" data-code="' + item.CodeWorkStation + '">' +
                        '</div>'
                    );

                    // Thêm phần tử chính vào phần tử bao bọc
                    totalElement.append(element);
                    // Gắn sự kiện click cho phần tử chính
                    element.on('click', function () {
                        handleItemCategoryClick(item);
                    });
                    if (type == 'category') {
                        historyListCategoryDetail.append(totalElement);
                    } else {
                        historyListCategoryAdd.append(totalElement);
                    }
                } else {
                    const element = $(
                        '<div class="iconApp">' +
                        '<div id="App' + item.CodeWorkStation + '" class="icon" style="background-color: #28a745 !important; display: block">' +
                        '<div id="Value' + item.CodeWorkStation + '" style="background-color: #1052e7; width: 70px; height: 20px;font-size: 12px;color: #fff; border-radius: 4px 4px 0 0;">-</div>' +
                        getIconWorkstation(item.workstationType) +
                        '</div>' +
                        '<div class="info-box-content" style="padding-right: 0">' +
                        '<div class="d-flex justify-content-between">' +
                        '<span class="app-text">' + item.CodeWorkStation + '</span>' +
                        '<span class="app-text" style="padding-right: 0">' + item.date + '</span>' +
                        '</div>' +
                        '<span class="app-text-number" style="padding-right: 0">' + item.NameWorkStation + '</span>' +
                        '</div>' +
                        '</div>'
                    );
                    // Tạo phần tử bao bọc với nút X
                    const totalElement = $(
                        '<div style="padding-bottom: 13px; position: relative;" class="history-item" data-code="' + item.CodeWorkStation + '">' +
                        '<div class="close-icon">' +
                        '<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-x" viewBox="0 0 16 16">' +
                        '<path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>' +
                        '</svg>' +
                        '</div>' +
                        '</div>'
                    );

                    // Thêm phần tử chính vào phần tử bao bọc
                    totalElement.append(element);

                    // Gắn sự kiện click cho nút X
                    totalElement.find('.close-icon').on('click', function (e) {
                        e.stopPropagation(); // Ngăn chặn sự kiện click lan đến phần tử chính

                        // Hiển thị popup xác nhận
                        const confirmDelete = confirm(`Bạn có chắc chắn muốn xóa trạm "${item.NameWorkStation} [${item.CodeWorkStation}]" không?`);
                        if (confirmDelete) {
                            totalElement.remove(); // Xóa phần tử nếu người dùng chọn "Có"
                            historyItems = historyItems.filter(i => i.CodeWorkStation !== item.CodeWorkStation);
                            localStorage.setItem('dataHistory', JSON.stringify(historyItems));
                            toastr.success(`Trạm "${item.CodeWorkStation}" đã bị xóa!`);
                            if (historyItems.length == 0) {
                                showAddWorkStationButton(); // Ẩn nút nếu có ít nhất 1 phần tử
                            }
                        }
                    });

                    // Gắn sự kiện click cho phần tử chính
                    element.on('click', function () {
                        document.getElementById("RD").textContent = '0 mm';
                        document.getElementById("lastTimeRain").textContent = '';
                        handleItemClick(item);
                    });

                    // Thêm phần tử vào danh sách lịch sử

                    historyListDetail.append(totalElement);
                }

            }

            $(document).ready(function () {
                $(".toggle-button").click(function () {
                    // Lấy danh sách con gần nhất (nếu có)
                    const childList = $(this).siblings(".child-list");

                    // Toggle hiển thị/ẩn danh sách con
                    childList.slideToggle(200);

                    // Xoay icon mũi tên
                    const arrowIcon = $(this).find(".arrow-icon");
                    arrowIcon.toggleClass("expanded");

                    if (arrowIcon.hasClass("expanded")) {
                        arrowIcon.css("transform", "rotate(90deg)");
                    } else {
                        arrowIcon.css("transform", "rotate(0deg)");
                    }
                });
            });

            function addItemCategory(item, type) {
                let element = ''
                for (let i = 0; i < item.itemCategory.length; i++) {
                    element += '<li>' +
                        '<div style="position: relative;" class="history-item" data-code="' + item.itemCategory[i].CodeWorkStation + '">' +
                        '<div class="iconApp">' +
                        '<div id="App' + item.itemCategory[i].CodeWorkStation + '" class="icon" style="background-color: #28a745 !important;">' +
                        getIconWorkstation(item.itemCategory[i].workstationType) +
                        '</div>' +
                        '<div class="info-box-content" style="padding-right: 0">' +
                        '<div class="d-flex justify-content-between">' +
                        '<span class="app-text">' + item.itemCategory[i].CodeWorkStation + '</span>' +
                        '<span class="app-text" style="padding-right: 0">' + item.itemCategory[i].date + '</span>' +
                        '</div>' +
                        '<span class="app-text-number" style="padding-right: 0">' + item.itemCategory[i].NameWorkStation + '</span>' +
                        '</div>' +
                        '</div>' +
                        '</div>' +
                        '</li>'
                }

                element += '<li>' +
                    '<div  style="width: 100%;">' +
                    '<button class="btnRemoveCategory btn btn-danger" style="width: 100%; height: 35px; color: #fff; padding: 3px 10px;">Xoá danh mục</button>' +
                    '</div>' +
                    '</li>'
                // Tạo phần tử bao bọc với nút X
                const totalElement = $(
                    '<li class="parent-item">' +
                    '<button class="toggle-button">' +
                    '<div>' +
                    '<h4 style="margin: 0;">' + item.NameCategory + '</h4>' +
                    '<p style="margin: 10px 0 0 0; font-size: 14px; font-weight: 300;">Danh mục có ' + item.itemCategory.length + ' trạm</p>' +
                    '</div>' +
                    '<span class="arrow-icon">▶</span>' +
                    '</button>' +
                    '<ul class="child-list">' +
                    element +
                    '</ul>' +
                    '</li>'
                );

                // Thêm phần tử chính vào phần tử bao bọc
                // totalElement.append(element);

                // Gắn sự kiện click cho nút X
                // totalElement.find('.close-icon').on('click', function (e) {
                //     e.stopPropagation(); // Ngăn chặn sự kiện click lan đến phần tử chính

                //     // Hiển thị popup xác nhận
                //     const confirmDelete = confirm(`Bạn có chắc chắn muốn xóa danh mục "${item.NameCategory}" không?`);
                //     if (confirmDelete) {
                //         totalElement.remove(); // Xóa phần tử nếu người dùng chọn "Có"
                //         DataCategory = DataCategory.filter(i => i.NameCategory !== item.NameCategory);
                //         localStorage.setItem('dataCategory', JSON.stringify(DataCategory));
                //         toastr.success(`Danh mục "${item.NameCategory}" đã bị xóa!`);
                //         if (DataCategory.length == 0) {
                //             showAddCategoryButton();
                //         }
                //     }
                // }); 

                totalElement.find('.toggle-button').on('click', function (e) {
                    e.preventDefault(); // Ngăn chặn hành động mặc định của thẻ <a>

                    // Lấy danh sách con gần nhất (nếu có)
                    const childList = $(this).siblings(".child-list");

                    // Toggle hiển thị/ẩn danh sách con
                    childList.slideToggle(200);

                    // Xoay icon mũi tên
                    const arrowIcon = $(this).find(".arrow-icon");
                    arrowIcon.toggleClass("expanded");

                    if (arrowIcon.hasClass("expanded")) {
                        arrowIcon.css("transform", "rotate(90deg)");
                    } else {
                        arrowIcon.css("transform", "rotate(0deg)");
                    }
                });

                totalElement.find('.btnRemoveCategory').on('click', function (e) {
                    e.preventDefault(); // Ngăn chặn hành động mặc định của thẻ <a>
                    const confirmDelete = confirm(`Bạn có chắc chắn muốn xóa danh mục "${item.NameCategory}" không?`);
                    if (confirmDelete) {
                        totalElement.remove(); // Xóa phần tử nếu người dùng chọn "Có"
                        DataCategory = DataCategory.filter(i => i.NameCategory !== item.NameCategory);
                        localStorage.setItem('dataCategory', JSON.stringify(DataCategory));
                        toastr.success(`Danh mục "${item.NameCategory}" đã bị xóa!`);
                        if (DataCategory.length == 0) {
                            showAddCategoryButton();
                        }
                    }
                });

                // Gắn sự kiện click cho phần tử chính
                // element.on('click', function () {
                //     // handleItemClick(item);
                // });

                // Thêm phần tử vào danh sách lịch sử

                listCategory.append(totalElement);
            }
            function showAddCategoryButton() {
                const buttonHTML = $(
                    '<div class="col-12" style="margin-top: 10px; display: flex; justify-content: center; align-items: center;">' +
                    '<button id="addCategory" style="width: 200px; height: 200px; border-radius: 50%; border: 1px dashed #fff; background-color: #1E2833; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #fff; font-size: 14px; text-align: center;">' +
                    '<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" style="color: #fff; margin-bottom: 8px;" fill="currentColor" class="bi bi-plus" viewBox="0 0 16 16">' +
                    '<path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"/>' +
                    '</svg>' +
                    'Tạo mới danh mục trạm.' +
                    '</button>' +
                    '</div>'
                );
                document.getElementById("btnAddCategory").classList.add("d-none");
                buttonHTML.on('click', function () {

                    OpenAddCategory();
                });
                listCategory.append(buttonHTML);
            }

            function showAddWorkStationButton() {
                const buttonHTML = $(
                    '<div style="margin-top: 10px; display: flex; justify-content: center; align-items: center;">' +
                    '<button id="addWorkStation" style="width: 200px; height: 200px; border-radius: 50%; border: 1px dashed #fff; background-color: #1E2833; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #fff; font-size: 14px; text-align: center;">' +
                    '<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" style="color: #fff; margin-bottom: 8px;" fill="currentColor" class="bi bi-plus" viewBox="0 0 16 16">' +
                    '<path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"/>' +
                    '</svg>' +
                    'Thêm mới' +
                    '</button>' +
                    '</div>'
                );
                buttonHTML.on('click', function () {
                    if (checkTabHistory == 1) {
                        changeQRcode()
                    } else if (checkTabHistory == 2) {
                        $(".WarrantyScanNext").click();
                    }
                });
                historyListDetail.append(buttonHTML); // Giả sử bạn có một div với id "addWorkStationContainer" để chứa nút này
            }

            // click ở trang lịch sử để truy cập
            window.handleItemClick = function(item) {
                stopInterval();
                localStorage.setItem("URL", "https://" + item.domain + "/Service/Service.svc");
                document.getElementById("footer-stationName").textContent = item.CodeWorkStation + " - " + item.NameWorkStation;
                localStorage.setItem("MATRAM", item.CodeWorkStation);
                const itemHistory = { 'CodeWorkStation': item.CodeWorkStation, 'NameWorkStation': item.NameWorkStation, 'domain': item.domain, 'date': getCurrentTime(), 'workstationType': item.workstationType }
                localStorage.setItem('itemHistory', JSON.stringify(itemHistory));
                $("#loading-popup").show();
                truyCap();
            }

            function handleItemCategoryClick(item) {
                const itemHistory = { 'CodeWorkStation': item.CodeWorkStation, 'NameWorkStation': item.NameWorkStation, 'domain': item.domain, 'date': getCurrentTime(), 'workstationType': item.workstationType }
                CategoryItems = JSON.parse(localStorage.getItem('listItemCategory'));
                let filterItem = []
                if (CategoryItems) {
                    filterItem = CategoryItems.filter(itemdetail => itemdetail.CodeWorkStation === item.CodeWorkStation);
                }
                if (filterItem.length > 0) {
                    CategoryItems = CategoryItems.filter(itemdetail => itemdetail.CodeWorkStation !== item.CodeWorkStation);
                    localStorage.setItem('listItemCategory', JSON.stringify(CategoryItems));

                    historyListCategoryAdd.empty();
                    for (let i = CategoryItems.length - 1; i >= 0; i--) {
                        addItemHistory(CategoryItems[i], 'add');
                    }
                } else {
                    if (CategoryItems) {
                        CategoryItems = CategoryItems.filter(itemdetail => itemdetail.CodeWorkStation !== item.CodeWorkStation);
                        CategoryItems.push(itemHistory);
                        if (CategoryItems.length > 20) {
                            CategoryItems.shift();
                        }
                    } else {
                        CategoryItems = [];
                        CategoryItems.push(itemHistory);
                    }
                    localStorage.setItem('listItemCategory', JSON.stringify(CategoryItems));

                    if (CategoryItems && CategoryItems.length > 0) {
                        historyListCategoryAdd.empty();
                        for (let i = CategoryItems.length - 1; i >= 0; i--) {
                            addItemHistory(CategoryItems[i], 'add');
                        }
                    }
                }
                showHistoryCategory()
            }

            let ZONE_PROPERTY = 'RD';
            let ZONE_UNIT = ' mm';
            let ZONE_PROPERTY_NNS = 'RT';
            let ZONE_UNIT_NNS = ' °C';
            var ZONE_PROPERTY_TD = 'RN';
            var ZONE_UNIT_TD = ' cm';
            var ZONE_PROPERTY_SL = 'RD';
            var ZONE_UNIT_SL = ' mm';

            function getColorByTimeDiff(dateStr) {
                const now = new Date();
                const providedTime = new Date(dateStr);
                const minutesDiff = (now - providedTime) / (1000 * 60);
                return minutesDiff < 15 ? "#28a745" : "#da4a58";
            }

            function getDisplayValue(item, type) {
                switch (type) {
                    case "NAAM":
                        return item.ZONE_VALUE / 10 + ZONE_UNIT;
                    case "N":
                        return item.ZONE_VALUE + " cm";
                    case "MSL":
                    case "M":
                    case "MS":
                        return item.ZONE_VALUE / 10 + " mm";
                    case "NNS":
                        if (ZONE_PROPERTY_NNS === "SS") {
                            return (item.ZONE_VALUE / 10000).toFixed(2) + ZONE_UNIT_NNS;
                        } else if (ZONE_PROPERTY_NNS === "EC") {
                            return (item.ZONE_VALUE / 1000).toFixed(2) + ZONE_UNIT_NNS;
                        } else if(ZONE_PROPERTY_NNS === "RN") {
                            return item.ZONE_VALUE + ZONE_UNIT_NNS;
                        } else {
                            return item.ZONE_VALUE / 10 + ZONE_UNIT_NNS;
                        }
                    case "TD":
                        if(ZONE_PROPERTY_NNS === "RN") {
                            return item.ZONE_VALUE + ZONE_UNIT_TD;
                        } else {
                            return item.ZONE_VALUE + ZONE_UNIT_TD;
                        }
                    case "NMLLTD":
                        if(ZONE_PROPERTY_SL === "RD") {
                            return item.ZONE_VALUE / 10 + ZONE_UNIT_SL;
                        } else {
                            return item.ZONE_VALUE / 100 + ZONE_UNIT_SL;
                        }
                    default:
                        return "-";
                }
            }

            function rotateProperties() {
                const props = [
                    { prop: 'RD', unit: ' mm' },
                    { prop: 'RT', unit: ' °C' },
                    { prop: 'RH', unit: ' %' },
                    { prop: 'RP', unit: ' hPa' }
                ];
                const index = props.findIndex(p => p.prop === ZONE_PROPERTY);
                const next = props[(index + 1) % props.length];
                ZONE_PROPERTY = next.prop;
                ZONE_UNIT = next.unit;

                const nnsProps = [
                    { prop: 'RT', unit: ' °C' },
                    { prop: 'RN', unit: ' cm' },
                    { prop: 'SS', unit: ' ppt' },
                    { prop: 'EC', unit: ' μs/cm' }
                ];
                const nnsIndex = nnsProps.findIndex(p => p.prop === ZONE_PROPERTY_NNS);
                const nextNNS = nnsProps[(nnsIndex + 1) % nnsProps.length];
                ZONE_PROPERTY_NNS = nextNNS.prop;
                ZONE_UNIT_NNS = nextNNS.unit;

                const TDProps = [
                    { prop: 'RN', unit: ' cm' },
                    { prop: 'TN', unit: ' tr.m³' },
                    { prop: 'QV', unit: ' m³/s' },
                    { prop: 'QR', unit: ' m³/s' }
                ];

                const TDIndex = TDProps.findIndex(p => p.prop === ZONE_PROPERTY_TD);
                const nextTD = TDProps[(TDIndex + 1) % TDProps.length];
                ZONE_PROPERTY_TD = nextTD.prop;
                ZONE_UNIT_TD = nextTD.unit;

                const SLProps = [
                    { prop: 'RD', unit: ' mm' },
                    { prop: 'RN', unit: ' m' },
                    { prop: 'QN', unit: ' m³/s' },
                    { prop: 'VN', unit: ' m/s' }
                ];

                const SLIndex = SLProps.findIndex(p => p.prop === ZONE_PROPERTY_SL);
                const nextSL = SLProps[(SLIndex + 1) % SLProps.length];
                ZONE_PROPERTY_SL = nextSL.prop;
                ZONE_UNIT_SL = nextSL.unit;
            }

            async function updateWorkstationUI(station, data) {
                const filteredItems = data.D.filter(item => item.ZONE_ADDRESS === station.CodeWorkStation);
                const elementValue = document.getElementById('Value' + station.CodeWorkStation);
                const button = document.getElementById('App' + station.CodeWorkStation);

                if (filteredItems.length === 0) {
                    if (button) button.style.backgroundColor = "#da4a58";
                    return;
                }
                console.log(station, data, );
                
                let prop = 'RD';
                if (station.workstationType === "NAAM") prop = ZONE_PROPERTY;
                else if (station.workstationType === "N") prop = 'RN';
                else if (["M", "MS", "MSL"].includes(station.workstationType)) prop = 'RD';
                else if (station.workstationType === "NNS") prop = ZONE_PROPERTY_NNS;
                else if (station.workstationType === "TD") prop = ZONE_PROPERTY_TD;
                else if (station.workstationType === "NMLLTD") prop = ZONE_PROPERTY_SL;

                const dataRD = filteredItems.find(item => item.ZONE_PROPERTY === prop);
                elementValue.textContent = dataRD ? getDisplayValue(dataRD, station.workstationType) : '_';
                if(station.workstationType === "NNS"){
                    dataRD
                }
                if(prop == 'RD' && !dataRD){
                    elementValue.textContent = "0mm";
                }
                try {
                    const dataRA = filteredItems.find(item => item.ZONE_PROPERTY === 'RA');
                    if (dataRA) {
                        const color = getColorByTimeDiff(dataRA.DATE_CREATE);
                        if (button) button.style.backgroundColor = color;
                    } else {
                        if (button) button.style.backgroundColor = "#da4a58";
                    }
                } catch (e) {
                    if (button) button.style.backgroundColor = "#da4a58";
                }
            }

            async function startInterval() {
                if (intervalId) return;

                for (let i = historyItems.length - 1; i >= 0; i--) {
                    const station = historyItems[i];
                    const data = await getNewData(
                        station.CodeWorkStation,
                        `WORKSTATION_ID='${station.CodeWorkStation}'`,
                        `https://${station.domain}/Service/Service.svc`
                    );
                    processAndUpdate(data);
                    await updateWorkstationUI(station, data);
                }

                intervalId = setInterval(async () => {
                    rotateProperties();

                    for (let i = historyItems.length - 1; i >= 0; i--) {
                        const station = historyItems[i];
                        const data = await getNewData(
                            station.CodeWorkStation,
                            `WORKSTATION_ID='${station.CodeWorkStation}'`,
                            `https://${station.domain}/Service/Service.svc`
                        );
                        processAndUpdate(data);
                        await updateWorkstationUI(station, data);
                    }
                }, 10000);
            }

            function stopInterval() {
                // Xóa interval nếu đang chạy
                if (intervalId) {
                    clearInterval(intervalId);
                    intervalId = null;
                }
            }

            $('#search-category').on('change', function () {
                const searchValue = $(this).val().toLowerCase();
                showHistoryCategory(searchValue)
            });
            // hiển thị dữ liệu lịch sử truy cập 
            async function showHistory(type) {
                const historySetting = document.getElementById("history-setting");
                const historyHomePage = document.getElementById("history-homePage");
                const historySelect = document.getElementById("historySelect");

                if (type === "ADD") {
                    historySetting.classList.remove("d-none");
                    historyHomePage.classList.add("d-none");
                    OpenAddCategory();
                    return;
                }

                historyItems = JSON.parse(localStorage.getItem('dataHistory')) || [];
                DataCategory = JSON.parse(localStorage.getItem('dataCategory')) || [];
                const arrayCategory = ["ADD"];

                // Tạo danh sách tên danh mục không trùng
                DataCategory.forEach(cat => {
                    if (!arrayCategory.includes(cat.NameCategory)) {
                        arrayCategory.push(cat.NameCategory);
                    }
                });

                if (type) {
                    const categoryMatched = DataCategory.find(cat => cat.NameCategory === type);

                    if (type !== "ALL" && !categoryMatched) {
                        historyItems = historyItems.filter(item => item.workstationType === type);
                    } else if (categoryMatched && categoryMatched.itemCategory?.length) {
                        historyItems = categoryMatched.itemCategory
                            .map(catItem => historyItems.find(h => h.CodeWorkStation === catItem.CodeWorkStation))
                            .filter(Boolean);
                    }
                }

                if (!historyItems || historyItems.length === 0) return;

                // Làm sạch và hiển thị danh sách
                historyListDetail.empty();
                locations = [];
                for (const item of historyItems) {
                    console.log(item);
                    addItemHistory(item);
                    const dataWorkstation = await getDM(
                        "https://" + item.domain + "/service/service.svc",
                        "DM_WORKSTATION",
                        "WORKSTATION_ID = '" + item.CodeWorkStation + "'",
                        "NotCentral"
                    );
                    addDataLocation(dataWorkstation.data[0], dataWorkstation.dataSet.DM_TOOLTIP_TEMPLATE, item);
                    if (!arrayCategory.includes(item.workstationType)) {
                        arrayCategory.push(item.workstationType);
                    }

                    await delay(10); // đợi 100ms trước khi xử lý item tiếp theo
                }
                addMarkers(locations, "mappingWorkstation");
                arrayCategory.push("ALL");

                // Chỉ tạo select nếu chưa có type (tức là lần đầu vào)
                if (!type) {
                    historySelect.innerHTML = "";
                    arrayCategory.slice().reverse().forEach(cat => {
                        const option = document.createElement("option");

                        switch (cat) {
                            case "NAAM":
                                option.value = cat;
                                option.text = "Trạm Mưa, nhiệt, ẩm, áp";
                                break;
                            case "N":
                                option.value = cat;
                                option.text = "Trạm mực nước";
                                break;
                            case "MSL":
                                option.value = cat;
                                option.text = "Trạm Mưa Sơn La";
                                break;
                            case "M":
                                option.value = cat;
                                option.text = "Trạm Mưa";
                                break;
                            case "MS":
                                option.value = cat;
                                option.text = "Trạm Mưa, sóng";
                                break;
                            case "NNS":
                                option.value = cat;
                                option.text = "Trạm mặn, nhiệt, mực nước";
                                break;
                            case "TD":
                                option.value = cat;
                                option.text = "Hồ chứa";
                                break;
                            case "NMLLTD":
                                option.value = cat;
                                option.text = "Trạm Nước, mưa, lưu lượng, tốc độ";
                                break;
                            case "ALL":
                                option.value = cat;
                                option.text = "Tất cả trạm";
                                break;
                            case "ADD":
                                option.value = cat;
                                option.text = " + Thêm danh mục mới";
                                option.className = "custom-option";
                                break;
                            default:
                                option.value = cat;
                                option.text = cat;
                                break;
                        }

                        historySelect.appendChild(option);
                    });
                }

                startInterval();
            }

            function delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            function showHistoryCategory(type) {
                historyItems = JSON.parse(localStorage.getItem('dataHistory'));
                CategoryItems = JSON.parse(localStorage.getItem('listItemCategory'));
                if (type) {
                    historyItems = historyItems.filter(item =>
                        item.CodeWorkStation.includes(type) ||
                        item.NameWorkStation.toLowerCase().includes(type)
                    );
                }
                if (CategoryItems) {
                    for (let i = 0; i < CategoryItems.length; i++) {
                        historyItems = historyItems.filter(item => item.CodeWorkStation != CategoryItems[i].CodeWorkStation);
                    }
                }
                if (historyItems) {
                    historyListCategoryDetail.empty();
                    for (let i = historyItems.length - 1; i >= 0; i--) {
                        addItemHistory(historyItems[i], 'category');
                    }
                }
            }

            function showCategory(type) {
                DataCategory = JSON.parse(localStorage.getItem('dataCategory'));
                if (DataCategory) {
                    if (DataCategory.length > 0) {
                        document.getElementById("btnAddCategory").classList.remove("d-none");
                        listCategory.empty();
                        for (let i = DataCategory.length - 1; i >= 0; i--) {
                            addItemCategory(DataCategory[i], 'category');
                        }
                    }
                }
            }

            // lưu lịch sử
            function saveHistory(code) {
                historyItems = JSON.parse(localStorage.getItem('dataHistory'));
                if (historyItems) {
                    historyItems = historyItems.filter(item => item.CodeWorkStation !== code);
                    const item = JSON.parse(localStorage.getItem('itemHistory'));
                    historyItems.unshift(item);
                    if (historyItems.length > 20) {
                        historyItems.shift();
                    }
                } else {
                    historyItems = [];
                    const item = JSON.parse(localStorage.getItem('itemHistory'));
                    historyItems.push(item);
                }

                localStorage.setItem('dataHistory', JSON.stringify(historyItems));
            }

            function saveCategory() {
                const inputValue = $('#name-category').val();
                if (inputValue) {
                    const item = JSON.parse(localStorage.getItem('listItemCategory'));
                    let itemCategory = { 'NameCategory': inputValue, 'itemCategory': item }
                    DataCategory = JSON.parse(localStorage.getItem('dataCategory'));
                    if (DataCategory) {
                        const checkInput = DataCategory.filter(item => item.NameCategory === inputValue);
                        if (checkInput.length > 0) {
                            const confirmEDIT = confirm(`Danh mục "${inputValue}" đã tồn tại, xác nhận có muốn thêm những trạm đã chọn chưa nằm trong danh mục hay không?`);
                            if (confirmEDIT) {
                                itemCategory.itemCategory.forEach(item2 => {
                                    const exists = checkInput[0].itemCategory.some(item1 => item1.CodeWorkStation === item2.CodeWorkStation);
                                    if (!exists) {
                                        checkInput[0].itemCategory.push(item2);
                                    }
                                });
                                DataCategory = DataCategory.filter(item => item.NameCategory !== inputValue);
                                DataCategory.push(checkInput[0]);
                                localStorage.setItem('dataCategory', JSON.stringify(DataCategory));
                                document.getElementById("list-category").classList.remove("d-none");
                                document.getElementById("save-category").classList.add("d-none");
                                $('#name-category').val('');
                                $('#search-category').val('');
                                localStorage.setItem('listItemCategory', JSON.stringify([]));
                                historyListCategoryAdd.empty();
                                showCategory()
                            }
                        } else if (item.length == 0) {
                            toastr.error("Vui lòng chọn trạm để thêm vào danh mục!");
                        } else {
                            if (DataCategory) {
                                DataCategory.push(itemCategory);
                                if (DataCategory.length > 20) {
                                    DataCategory.shift();
                                }
                            } else {
                                DataCategory = [];
                                DataCategory.push(itemCategory);
                            }
                            localStorage.setItem('dataCategory', JSON.stringify(DataCategory));
                            document.getElementById("list-category").classList.remove("d-none");
                            document.getElementById("save-category").classList.add("d-none");
                            $('#name-category').val('');
                            $('#search-category').val('');
                            localStorage.setItem('listItemCategory', JSON.stringify([]));
                            historyListCategoryAdd.empty();
                            showCategory()
                        }
                    } else {
                        DataCategory = [];
                        DataCategory.push(itemCategory);
                        localStorage.setItem('dataCategory', JSON.stringify(DataCategory));
                        document.getElementById("list-category").classList.remove("d-none");
                        document.getElementById("save-category").classList.add("d-none");
                        $('#name-category').val('');
                        $('#search-category').val('');
                        localStorage.setItem('listItemCategory', JSON.stringify([]));
                        historyListCategoryAdd.empty();
                        showCategory()
                    }

                } else {
                    toastr.error("Vui lòng nhập tên danh mục!");
                }
            }

            function saveWarranty(data) {
                console.log(data);
                const DataQRcode = data[0].QR_CODE.split(',');
                const itemW = {
                    'CodeWarranty': DataQRcode[2].substring(1),
                    'NameWarranty': data[0].PRODUCT_NAME,
                    'imgWarranty': data[0].PRODUCT_IMG,
                    'date': getCurrentTime()
                }

                waranntyItems = JSON.parse(localStorage.getItem('dataWarranty'));
                console.log(waranntyItems, itemW.CodeWarranty);

                if (waranntyItems) {
                    waranntyItems = waranntyItems.filter(item => item.CodeWarranty !== itemW.CodeWarranty);
                    waranntyItems.unshift(itemW);
                    if (waranntyItems.length > 20) {
                        waranntyItems.shift();
                    }
                } else {
                    waranntyItems = [];
                    waranntyItems.push(itemW);
                }

                localStorage.setItem('dataWarranty', JSON.stringify(waranntyItems));
            }

            async function saveCondition(data) {
                console.log(data);
                const DataQRcode = data[0].QR_CODE.split(',');
                const dataDevice = await getDM("https://central.homeos.vn/service_XD/service.svc", "ZALO_LINKED_QRCODE", "ACTIVE = 1 AND QRCODE_ID = " + data[0].PR_KEY + "" );
                console.log(dataDevice);
                const itemW = {
                    'CodeCondition': DataQRcode[3],
                    'NameCondition': dataDevice.data[0].NAME_DEVICE,
                    'imgCondition': data[0].PRODUCT_IMG,
                    'date': getCurrentTime(),
                    'domainCondition': 'homeos.vn:447',
                    'name_channel': dataDevice.data[0].NAME_CHANNEL
                }

                waranntyItems = JSON.parse(localStorage.getItem('dataCondition'));
                console.log(waranntyItems, itemW.CodeCondition);

                if (waranntyItems) {
                    waranntyItems = waranntyItems.filter(item => item.CodeCondition !== itemW.CodeCondition);
                    waranntyItems.unshift(itemW);
                    if (waranntyItems.length > 20) {
                        waranntyItems.shift();
                    }
                    console.log('chạy:');

                } else {
                    waranntyItems = [];
                    waranntyItems.push(itemW);
                    console.log(waranntyItems);
                }

                localStorage.setItem('dataCondition', JSON.stringify(waranntyItems));
            }

            function changeDataHomePage(data) {
                if (!data || data.length === 0) {
                    $('#loading-popup').hide(); 
                    return;
                }

                const matram = localStorage.getItem('MATRAM');
                const itemw = JSON.parse(localStorage.getItem("itemHistory"));
                const filteredItems = data.filter(item => item.ZONE_ADDRESS === matram);
                console.log(filteredItems);

                let checkRD = false;
                let checkRT = false;

                filteredItems.forEach(item => {
                    const { ZONE_PROPERTY, ZONE_VALUE, DATE_CREATE } = item;
                    const value = ZONE_VALUE / 10;

                    switch (ZONE_PROPERTY) {
                        case "RT":
                            checkRT = true;
                            updateText("RT", value + " °C");
                            setRangeValue(value, "success");
                            break;

                        case "RH":
                            updateText("RH", value + " %");
                            break;

                        case "RA":
                            updateText("energy", value + " V");
                            updateText("lateDateTime", " " + getCurrentTime(DATE_CREATE) + "");
                            document.getElementById("statusBattery").innerHTML = getBatteryStatus(value);
                            handleStatus(DATE_CREATE);
                            break;

                        case "RP":
                            updateText("RP", value + " hPa");
                            break;

                        case "RD":
                            checkRD = true;
                            updateText("RD", value + " mm");
                            updateText("lastTimeRain", " (" + getCurrentTime(DATE_CREATE).substring(11) + ")");
                            updateBackground("glass", "https://s3-us-west-2.amazonaws.com/s.cdpn.io/54046/glass_droplets.jpeg");
                            break;

                        case "RN":
                            checkRD = true;
                            if(itemw.workstationType == 'TD'){
                                updateText("RN", ZONE_VALUE / 100 + " m");
                            } else if(itemw.workstationType == 'NMLLTD'){
                                updateText("RN", ZONE_VALUE / 100 + " m");
                            } else {
                                updateText("RN", ZONE_VALUE + " cm");
                            }
                            break;

                        case "SS":
                            checkRD = true;
                            updateText("SS", (ZONE_VALUE / 10000).toFixed(2) + " ppt");
                            break;

                        case "EC":
                            checkRD = true;
                            updateText("EC", (ZONE_VALUE / 1000).toFixed(2) + " μs/cm");
                            break;
                        case "TN":
                            checkRD = true;
                            updateText("TN", (ZONE_VALUE ).toFixed(2) + " tr.m³");
                            break;
                        case "QV":
                            checkRD = true;
                            updateText("QV", (ZONE_VALUE ).toFixed(2) + " m³/s");
                            break;
                        case "QR":
                            checkRD = true;
                            updateText("QR", (ZONE_VALUE ).toFixed(2) + " m³/s");
                            break;
                        case "QN":
                            checkRD = true;
                            updateText("QN", (ZONE_VALUE /100).toFixed(2) + " m³/s");
                            break;
                        case "VN":
                            checkRD = true;
                            updateText("VN", (ZONE_VALUE /100).toFixed(2) + " m/s");
                            break;
                    }
                });

                if (!checkRT) setRangeValue(0);
                if (!checkRD) handleNoRainVisual();

                $('#loading-popup').hide();
            }

            // Helpers
            function updateText(id, text) {
                const el = document.getElementById(id);
                if (el) el.textContent = text;
            }

            function updateBackground(id, url) {
                const el = document.getElementById(id);
                if (el) el.style.background = `url(${url}) center center / cover no-repeat`;
            }

            function handleStatus(dateString, value) {
                const now = new Date();
                const providedTime = new Date(dateString);
                const diffMinutes = (now - providedTime) / (1000 * 60);

                const status = document.getElementById("status");
                const textStatus = document.getElementById("text-status");

                if (!status || !textStatus) return;

                if (diffMinutes < 15) {
                    status.style.background = "green";
                    textStatus.textContent = "Đang hoạt động";
                    status.classList.add('blinking');
                    setTimeout(() => status.classList.remove('blinking'), 3000);
                } else {
                    status.style.background = "red";
                    textStatus.textContent = "Ngừng hoạt động";
                }

                if(value )

                getCurrentTime(dateString); // (nếu cần dùng để log hoặc cập nhật ngoài)
            }

            function getBatteryStatus(voltage) {
                if (voltage < 8) {
                    return `<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" style="margin-right: 5px; color: red" fill="currentColor" class="bi bi-battery" viewBox="0 0 16 16">
                        <path d="M0 6a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1zm14 3a1.5 1.5 0 0 1-1.5 1.5v-3A1.5 1.5 0 0 1 16 8"/>
                    </svg>`;
                } else if (voltage < 10.8) {
                    return `<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" style="margin-right: 5px; color: red" fill="currentColor" class="bi bi-battery-half" viewBox="0 0 16 16">
                        <path d="M2 6h5v4H2z"/>
                        <path d="M2 4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2zm10 1a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1zm4 3a1.5 1.5 0 0 1-1.5 1.5v-3A1.5 1.5 0 0 1 16 8"/>
                    </svg>`;
                } else if (voltage < 12.4) {
                    return `<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" style="margin-right: 5px; color: yellow" fill="currentColor" class="bi bi-battery-half" viewBox="0 0 16 16">
                        <path d="M2 6h5v4H2z"/>
                        <path d="M2 4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2zm10 1a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1zm4 3a1.5 1.5 0 0 1-1.5 1.5v-3A1.5 1.5 0 0 1 16 8"/>
                    </svg>`;
                } else if (voltage > 12.4) {
                    return `<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" style="margin-right: 5px; color: #21ae21" fill="currentColor" class="bi bi-battery-full" viewBox="0 0 16 16">
                        <path d="M2 6h10v4H2z"/>
                        <path d="M2 4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2zm10 1a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1zm4 3a1.5 1.5 0 0 1-1.5 1.5v-3A1.5 1.5 0 0 1 16 8"/>
                    </svg>`;
                } else {
                    return "Bình thường";
                }
            }

            function handleNoRainVisual() {
                const hour = new Date().getHours();
                const glass = document.getElementById("glass");
                const landscape = document.getElementById("landscape");

                if (!glass) return;

                if (hour >= 6 && hour < 18) {
                    updateBackground("glass", "https://i.pinimg.com/736x/9d/1e/b3/9d1eb31563d0694c0eccd2724b5410a9.jpg");
                } else {
                    if (landscape) landscape.classList.add("d-none");
                    updateBackground("glass", "https://i.pinimg.com/736x/43/d4/5d/43d45ddb855463920c7505f846bf2900.jpg");
                }
            }


            if (maTram != "") {
                getDataMonitoring();
                document.getElementById("ScanQR").classList.add("hidden");
                document.getElementById("homePage").classList.remove("hidden");
            }

            function formatDateTime(date) {
                const now = new Date(date);

                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const seconds = String(now.getSeconds()).padStart(2, '0');

                const formattedDatetime = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
                return formattedDatetime
            }
            var checkCam = true;
            // call api getnewdata lấy data mới nhất
            function getNewData(workstation, c, url) {
                return new Promise((resolve, reject) => {
                    $.ajax({
                        url: url + "/GetNewData?w=" + workstation,
                        type: "GET",
                        dataType: "jsonp",
                        contentType: "application/json; charset=utf-8",
                        success: function (msg) {
                            try {
                                let state = JSON.parse(msg);
                                resolve(state); // Trả về dữ liệu khi thành công
                            } catch (error) {
                                reject(error); // Bắt lỗi nếu JSON parse thất bại
                            }
                        },
                        complete: function (data) {
                            // Có thể thêm xử lý khi request hoàn thành ở đây nếu cần
                        },
                        error: function (e, t, x) {
                            document.getElementById("result-form-total").classList.remove("d-none");
                            document.getElementById("result-condition").classList.add("d-none");
                            document.getElementById("result-form-loading").classList.add("d-none");
                            document.getElementById("result-form").classList.remove("d-none");
                            // document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
                            document.getElementById("result-form-title").classList.remove("d-none");
                            document.getElementById("result-form-stationID").classList.add("d-none");
                            document.getElementById("result-form-stationName").classList.add("d-none");
                            document.getElementById("result-truycap").classList.add("d-none");
                            //toastr.error("Vui lòng quét đúng mã QR!");
                        },
                    });
                });
            }

            function getDayMessage(type) {
                switch (type) {
                    case "NAAM":
                        return 'RD-RT-RH-RP';
                    case "N":
                        return 'RN---';
                    case "MSL":
                    case "M":
                    case "MS":
                        return 'RD---';
                    case "NNS":
                        return 'RT-RN-SS-EC';
                    case "TD":
                        return 'RN-TN-QV-QR';
                    case "NMLLTD":
                        return 'RN-RD-QN-VN';
                    default:
                        return "";
                }
            }

            // lọc theo ngày, tháng, năm
            async function clickGetData(type) {
                if (lineBarChart != null) {
                    // lineBarChart.destroy();
                    document.getElementById("loading-spinner").classList.remove("d-none");
                }
                const item = JSON.parse(localStorage.getItem('itemHistory'));
                const TypeWorkstation = getDayMessage(item.workstationType);

                if (type == 'NGAY') {
                    const dataChart = await getDataChart('NGAY', '', '', TypeWorkstation, localStorage.getItem("MATRAM"), localStorage.getItem("URL"));

                    if (dataChart != []) {
                        createChartData(dataChart, 'RD', type)
                    }
                } else if (type == 'TUAN') {
                    const dataChart = await getDataChart('TUAN', '', '', TypeWorkstation, localStorage.getItem("MATRAM"), localStorage.getItem("URL"));
                    if (dataChart != []) {
                        createChartData(dataChart, 'RD', type)
                    }
                } else if (type == 'THANG') {
                    const dataChart = await getDataChart('THANG', '', '', TypeWorkstation, localStorage.getItem("MATRAM"), localStorage.getItem("URL"));
                    if (dataChart != []) {
                        createChartData(dataChart, 'RD', type)
                    }
                } else if (type == 'NAM') {
                    const dataChart = await getDataChart('NAM', '2025-01-01 16$50$08', '2025-12-30 16$50$08', TypeWorkstation, localStorage.getItem("MATRAM"), localStorage.getItem("URL"));
                    if (dataChart != []) {
                        createChartData(dataChart, 'RD', type)
                    }
                }
            }

            //call api GetDataWorkStation lấy dữ liệu của WorkStation được chỉ định
            function getDataStation(workstationID, domain) {

                return new Promise((resolve, reject) => {
                    $.ajax({
                        url: "https://" + domain + "/Service/Service.svc/ApiServicePublic/" + "GetDataWorkStation" + "/" + "WORKSTATION_ID='" + workstationID + "'",
                        type: "GET",
                        dataType: "jsonp",
                        contentType: "application/json; charset=utf-8",
                        success: function (msg) {
                            try {
                                let state = JSON.parse(msg);
                                if (state != [] && state != "" && state != null && state.length != 0 && state.length != undefined) {
                                    const item = { 'CodeWorkStation': workstationID, 'NameWorkStation': state[0].WORKSTATION_NAME, 'domain': domain, 'date': getCurrentTime(), 'workstationType': state[0].TEMPLATE_TOOLTIP }
                                    localStorage.setItem('itemHistory', JSON.stringify(item));
                                }
                                resolve(state); // Trả về dữ liệu khi thành công
                            } catch (error) {
                                reject(error); // Bắt lỗi nếu JSON parse thất bại
                            }
                        },
                        complete: function (data) {
                            // Có thể thêm xử lý khi request hoàn thành ở đây nếu cần
                        },
                        error: function (e, t, x) {
                            // document.getElementById("result-form").classList.remove("d-none");
                            // document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
                            // toastr.error("Vui lòng quét đúng mã QR của trạm mưa");
                        },
                    });
                });

            }

            //call api GetDataFilterLogzone
            function getDataChart(typeTime, start, end, type, zone, url) {

                const Url = "https://DEV.HOMEOS.vn/service/service.svc/";

                return new Promise((resolve, reject) => {
                    $.ajax({
                        url: url + "/ApiServicePublic/" + "GetDataFilterLogzone" + "/" + "TYPE_TIME='" + typeTime + "',START_DATE='" + start + "',END_DATE='" + end + "',TYPE_VALUE='" + type + "',ZONE_ADDRESS='" + zone + "'",
                        type: "GET",
                        dataType: "jsonp",
                        contentType: "application/json; charset=utf-8",
                        success: function (msg) {
                            try {
                                let state = JSON.parse(msg);
                                resolve(state); // Trả về dữ liệu khi thành công
                            } catch (error) {
                                reject(error); // Bắt lỗi nếu JSON parse thất bại
                            }
                        },
                        complete: function (data) {
                            // Có thể thêm xử lý khi request hoàn thành ở đây nếu cần
                        },
                        error: function (e, t, x) {
                            toastr.error("Lấy dữ liệu bị lỗi vui lòng thử lại sau!");
                        },
                    });
                });
            }

            function checkTypeWorkstation() {
                const $ = (id) => document.getElementById(id);
                const hideElements = ["RT", "RH", "RD", "RP", "RN", "SS", "EC", "TN", "QV", "QR", "QN", "VN"];

                // Reset toàn bộ trạng thái hiển thị
                hideElements.forEach(type => {
                    $(`box-${type}`).classList.add("d-none");
                    $(`chart-${type}`).classList.add("d-none");

                    if (["RD", "RN"].includes(type)) {
                        $(`box-${type}`).classList.remove("col-12");
                        $(`box-${type}`).classList.add("col-6");
                    }
                });
                const item = JSON.parse(localStorage.getItem("itemHistory"));
                $("titleRT").textContent = "Nhiệt độ";
                $("titleChartRT").textContent = "biểu đồ nhiệt độ";
                $(`chart-RN72H`).classList.add("d-none");

                switch (item.workstationType) {
                    case "NAAM":
                        ["RT", "RH", "RD", "RP"].forEach(type => {
                            $(`box-${type}`).classList.remove("d-none");
                            $(`chart-${type}`).classList.remove("d-none");
                        });
                        break;

                    case "N":
                        ["RN"].forEach(type => {
                            $(`box-${type}`).classList.remove("d-none");
                            $(`chart-${type}`).classList.remove("d-none");
                            $(`chart-RN72H`).classList.remove("d-none");
                            $(`box-${type}`).classList.remove("col-6");
                            $(`box-${type}`).classList.add("col-12");
                            WorkstationStatistics(
                                localStorage.getItem("URL"),
                                    "WORKSTATION_ID='"+localStorage.getItem("MATRAM")+"'", 
                                    "NotCentral"
                                ).then(data => {
                                    renderChartRN72H(data);
                                }).catch(error => {
                                    console.error("Lỗi lấy dữ liệu ChartRN72H:", error);
                                });
                            });
                        break;
                    case "MSL":
                    case "M":
                    case "MS":
                        ["RD"].forEach(type => {
                            $(`box-${type}`).classList.remove("d-none");
                            $(`chart-${type}`).classList.remove("d-none");
                            $(`box-${type}`).classList.remove("col-6");
                            $(`box-${type}`).classList.add("col-12");
                        });
                        break;

                    case "NNS":
                        ["RN", "RT", "SS", "EC"].forEach(type => {
                            $(`box-${type}`).classList.remove("d-none");
                            $(`chart-${type}`).classList.remove("d-none");
                            $(`chart-RN72H`).classList.remove("d-none");
                            if(type == 'RN'){
                                WorkstationStatistics(
                                    localStorage.getItem("URL"),
                                    "WORKSTATION_ID='"+localStorage.getItem("MATRAM")+"'", 
                                    "NotCentral"
                                ).then(data => {
                                    renderChartRN72H(data);
                                }).catch(error => {
                                    console.error("Lỗi lấy dữ liệu ChartRN72H:", error);
                                });
                            }
                            
                        });

                        // $("box-SS").classList.remove("col-6");
                        // $("box-SS").classList.add("col-12");

                        $("titleRT").textContent = "Nhiệt độ nước";
                        $("titleChartRT").textContent = "biểu đồ nhiệt độ nước";
                        break;
                    case "TD":
                        ["RN", "TN", "QV", "QR"].forEach(type => {
                            $(`box-${type}`).classList.remove("d-none");
                            $(`chart-${type}`).classList.remove("d-none");
                        });
                        break;

                    case "NMLLTD":
                        ["RN", "RD", "QN", "VN"].forEach(type => {
                            $(`box-${type}`).classList.remove("d-none");
                            $(`chart-${type}`).classList.remove("d-none");
                        });
                        break;
                }
            }


            function roundToTwoDecimals(num) {
                if (Number.isInteger(num)) {
                    return num; // Nếu là số nguyên thì trả về nguyên gốc
                }
                return Math.round(num * 100) / 100; // Làm tròn đến 2 chữ số thập phân
            }

            var chartConfigs = [
                { id: "lineBarChart", varName: "lineBarChart", zone: "RD", label: "Lượng mưa (mm)", unit: "mm", type: "bar", color: "rgba(75, 192, 192, 0.5)", border: "rgba(75, 192, 192, 1)", divideBy10: true },
                { id: "ChartRT", varName: "ChartRT", zone: "RT", label: "Nhiệt độ (°C)", unit: "°C", type: "line", color: "rgb(173 14 14)", border: "rgb(173 14 14)", divideBy10: true, tension: 0.4 },
                { id: "ChartRH", varName: "ChartRH", zone: "RH", label: "Độ ẩm (%)", unit: "%", type: "line", color: "rgb(13,154,154, 0.5)", border: "rgb(13,154,154)", divideBy10: true, fill: true, tension: 0.4, min: 0, max: 100 },
                { id: "ChartRP", varName: "ChartRP", zone: "RP", label: "Áp suất (hPa)", unit: "hPa", type: "line", color: "rgb(40, 167, 69)", border: "rgb(40, 167, 69)", divideBy10: true, dashed: true },
                { id: "ChartRN", varName: "ChartRN", zone: "RN", label: "Mực nước (cm)", unit: "cm", type: "line", color: "rgb(0,95,95, 0.5)", border: "rgb(13,154,154)", divideBy10: true, fill: true, tension: 0.4 },
                { id: "ChartSS", varName: "ChartSS", zone: "SS", label: "Độ mặn (ppt)", unit: "ppt", type: "line", color: "rgb(40, 167, 69)", border: "rgb(40, 167, 69)", divideBy10: true, tension: 0.4 },
                { id: "ChartEC", varName: "ChartEC", zone: "EC", label: "Độ dẫn điện (μs/cm)", unit: "μs/cm", type: "line", color: "rgb(0,95,95)", border: "rgb(13,154,154)", divideBy10: true, tension: 0.4 },
                { id: "ChartTN", varName: "ChartTN", zone: "TN", label: "dung tích (tr.m³)", unit: "tr.m³", type: "line", color: "rgb(0,95,95)", border: "rgb(13,154,154)", divideBy10: true, tension: 0.4 },
                { id: "ChartQV", varName: "ChartQV", zone: "QV", label: "Lưu lượng đến (m³/S)", unit: "m³/S", type: "line", color: "rgb(0,95,95)", border: "rgb(13,154,154)", divideBy10: true, tension: 0.4 },
                { id: "ChartQR", varName: "ChartQR", zone: "QR", label: "Lưu lượng xả (m³/S)", unit: "m³/S", type: "line", color: "rgb(0,95,95)", border: "rgb(13,154,154)", divideBy10: true, tension: 0.4 },
                { id: "ChartQN", varName: "ChartQN", zone: "QN", label: "Lưu lượng nước (m³/S)", unit: "m³/S", type: "line", color: "rgb(0,95,95)", border: "rgb(13,154,154)", divideBy10: true, tension: 0.4 },
                { id: "ChartVN", varName: "ChartVN", zone: "VN", label: "Tốc độ dòng chảy (m/S)", unit: "m/S", type: "line", color: "rgb(0,95,95)", border: "rgb(13,154,154)", divideBy10: true, tension: 0.4 },
                { id: "ChartRN72H", varName: "ChartRN72H", zone: "AA", label: "Mực nước (cm)", unit: "cm", type: "line", color: "rgb(0,95,95, 0.5)", border: "rgb(13,154,154)", divideBy10: true, tension: 0.4 }
            ];

            var charts = {};

            function createChartData(data, type, typeData) {
                // Destroy old charts
                chartConfigs.forEach(cfg => {
                    if (charts[cfg.varName]) {
                        if(cfg.id == "ChartRN72H") {
                        
                        } else {
                            charts[cfg.varName].destroy();
                        }
                    }
                });

                // Xử lý dữ liệu
                var datasets = {};
                var labels = {};

                chartConfigs.forEach(cfg => {
                    datasets[cfg.zone] = [];
                    labels[cfg.zone] = [];
                });
                const itemw = JSON.parse(localStorage.getItem("itemHistory"));
                $.each(data, function (i, item) {
                    let zone = item.ZONE_PROPERTY;
                    let config = chartConfigs.find(c => c.zone === zone);
                    if (!config) return;

                    if (zone === 'RD' || item.AverageValue !== 0) {
                        let value;
                        console.log(zone);
                        
                        if(zone == 'SS'){
                            value = config.divideBy10 ? item.AverageValue / 10000 : item.AverageValue;
                        } else if(zone == 'EC'){
                            value = config.divideBy10 ? item.AverageValue / 1000 : item.AverageValue;
                        } else if(itemw.workstationType == 'NMLLTD' && zone == 'RN' || itemw.workstationType == 'TD' && zone == 'RN' || zone == 'QN' || zone == 'VN') {
                            console.log(item);
                            
                            value = config.divideBy10 ? item.AverageValue / 100 : item.AverageValue;
                        } else if(zone == 'RN') {
                            value = config.divideBy10 ? item.AverageValue : item.AverageValue;
                        } else {
                            value = config.divideBy10 ? item.AverageValue / 10 : item.AverageValue;
                        }
                        value = roundToTwoDecimals(value).toFixed(2);
                        labels[zone].push(item.Label);
                        datasets[zone].push(value);
                    }
                });

                let labelSuffix = typeData === "NGAY" ? "giờ" : "";

                chartConfigs.forEach(cfg => {
                    if(cfg.id == "ChartRN72H") {
                        
                    } else {
                        let ctx = document.getElementById(cfg.id).getContext('2d');
                        
                        let dataSet = [{
                            type: cfg.type,
                            label: cfg.label,
                            data: datasets[cfg.zone],
                            backgroundColor: cfg.color,
                            borderColor: cfg.border,
                            borderWidth: 1,
                            fill: cfg.fill ? 'start' : false,
                            tension: cfg.tension || 0,
                            borderDash: cfg.dashed ? [5, 5] : undefined
                        }];
                        console.log(cfg);
                        if(itemw.workstationType == 'NMLLTD' && cfg.id == 'ChartRN' || itemw.workstationType == 'TD' && cfg.id == 'ChartRN') {
                            let dataSetRN = dataSet;
                            console.log(dataSetRN);
                            dataSetRN[0].label = "Mực nước (m)"
                            charts[cfg.varName] = new Chart(ctx, createChart("bar", labels[cfg.zone], [], 'm', "", dataSet, labelSuffix, cfg.min, cfg.max));
                        } else {
                            charts[cfg.varName] = new Chart(ctx, createChart("bar", labels[cfg.zone], [], cfg.unit, "", dataSet, labelSuffix, cfg.min, cfg.max));
                        }
                    }
                });

                $("#loading-spinner").addClass("d-none");
            }

            function renderChartRN72H(data) {
                const cfg = chartConfigs.find(c => c.id === "ChartRN72H");
                const labels = [];
                const dataset = [];

                data.forEach(item => {
                    labels.push(item.ZONE_NAME.slice(0, 5) + ' ' + item.ZONE_NAME.slice(11, 16) ); // thời gian
                    let value = cfg.divideBy10 ? item.ZONE_VALUE : item.ZONE_VALUE;
                    value = roundToTwoDecimals(value).toFixed(2);
                    dataset.push(value);
                });
                
                const ctx = document.getElementById(cfg.id).getContext('2d');
                const dataSet = [{
                    type: cfg.type,
                    label: cfg.label,
                    data: dataset,
                    backgroundColor: cfg.color,
                    borderColor: cfg.border,
                    borderWidth: 1,
                    fill: cfg.fill ? 'start' : false,
                    tension: cfg.tension || 0,
                    borderDash: cfg.dashed ? [5, 5] : undefined,
                    pointRadius: 0,
                    pointHoverRadius: 5
                }];

                if (charts[cfg.varName]) charts[cfg.varName].destroy();
                charts[cfg.varName] = new Chart(ctx, createChart("line", labels, [], cfg.unit, "", dataSet, ""));
            }

            // hàm để tạo chart
            createChart = function (type, Label, Data, Unit, LabelData, dataSet, labelNgay, Min, Max) {
                return {
                    type: type, // Loại biểu đồ
                    data: {
                        labels: Label,
                        datasets: dataSet
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true, // Không giữ tỷ lệ khung hình
                        responsive: true,
                        scales: {
                            y: {  // Sử dụng 'y' thay vì 'yAxes'
                                beginAtZero: false,
                                ticks: {
                                    callback: function (value, index, values) {
                                        return roundToTwoDecimals(value) + ' ' + Unit;  // Thêm đơn vị Volts vào mỗi giá trị trục y
                                    }
                                },
                                min: Min ?? undefined,
                                max: Max ?? undefined,
                            }
                        },
                        interaction: {
                            mode: 'nearest', // hoặc 'index'
                            axis: 'x',       // hoặc 'y', hoặc 'xy'
                            intersect: false // Đảm bảo tooltip hiển thị ngay cả khi không chạm chính xác
                        },
                        plugins: {
                            tooltip: { // Sử dụng 'plugins.tooltip' thay vì 'tooltips'
                                callbacks: {
                                    title: function (tooltipItems) {
                                        const index = tooltipItems[0].dataIndex; // Lấy index của điểm dữ liệu
                                        return Label[index] + " " + labelNgay; // Thay "labelNgay" bằng array chứa thời gian
                                    },
                                    label: function (tooltipItem) {
                                        let label = tooltipItem.dataset.label || ''; // Lấy label từ dataset
                                        if (label) {
                                            label += ': ';
                                        }
                                        label += tooltipItem.raw + ' ' + Unit; // Sử dụng tooltipItem.raw để lấy giá trị y
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                }
            }

            //qrcode
            var html5QrCode;
            var currentCameraIndex = 0;  // Index camera hiện tại
            var devices = [];  // Danh sách các camera
            var isScannerRunning = false;  // Biến theo dõi trạng thái quét
            var currentCamera;

            async function startScan(cameraId, cam) {
                currentCamera = cam;
                html5QrCode = new Html5Qrcode("qr-reader");
                html5QrCode.start(
                    cameraId,
                    {
                        fps: 30,    // Số khung hình trên giây
                        qrbox: { width: 250, height: 250 },  // Kích thước khung quét QR
                        aspectRatio: 1.7, // Đặt tỉ lệ khung hình
                        videoConstraints: {
                            // width: { ideal: 3840 }, // Độ phân giải video 4k
                            // height: { ideal: 2160 },
                            width: { ideal: 1920 }, // Độ phân giải video 1080p
                            height: { ideal: 1080 },
                            // width: { ideal: 2560 }, // Độ phân giải video 2k 
                            // height: { ideal: 1440 },
                            facingMode: { exact: cam },
                            advanced: [{ zoom: 2 }]
                        }
                    },
                    onScanSuccess,
                    onScanFailure
                ).then(() => {
                    isScannerRunning = true;  // Đánh dấu scanner đang chạy
                    setTimeout(() => {
                        if (typeQR == 1) {
                            $('#qr-shaded-region').css('border-width', '35vh 10vh');
                            // $('#qr-shaded-region').attr('style', 'border-width: 35vh 10vh !important;');
                        } else {
                            $('#qr-shaded-region').css('border-width', '36vh 13vh');
                            // $('#qr-shaded-region').attr('style', 'border-width: 40vh 15vh !important;');
                        }
                    }, 100);
                }).catch(err => {
                    console.error("Lỗi khi khởi động camera: ", err);
                });

            }

            // Khi nhấn nút mở popup quét QR
            function startQRcode() {
                document.getElementById("result-form-total").classList.add("d-none");
                document.getElementById("result-form-loading").classList.remove("d-none");
                document.getElementById("result-form-title").classList.add("d-none");
                document.getElementById("result-form-stationID").classList.remove("d-none");
                document.getElementById("result-form-stationName").classList.remove("d-none");
                $("#qr-popup").show();

                // Lấy danh sách camera và bắt đầu quét
                Html5Qrcode.getCameras().then(_devices => {
                    devices = _devices; // Lưu lại danh sách camera
                    if (devices && devices.length) {
                        if (devices.length == 1) {
                            startScan(devices[currentCameraIndex].id, "user");  // Bắt đầu quét với camera đầu tiên
                        } else {
                            startScan(devices[currentCameraIndex].id, "environment");
                        }
                    } else {
                        console.error("Không tìm thấy thiết bị camera nào.");
                    }
                }).catch(err => {
                    console.error("Lỗi khi lấy danh sách camera: ", err);
                });
            };

            // Chuyển đổi camera
            $("#toggle-camera").click(function () {
                if (currentCameraIndex == devices.length) {
                    currentCamera = 0
                } else {
                    currentCameraIndex = (currentCameraIndex + 1) % devices.length; // Chuyển qua camera tiếp theo
                }
                if (currentCamera == "user") {
                    startScan(devices[currentCameraIndex].id, 'environment'); // Bắt đầu quét với camera mới
                } else {
                    startScan(devices[currentCameraIndex].id, 'user');
                }
            });

            // Khi nhấn nút đóng popup
            $("#close-scanner").click(function () {
                if (isScannerRunning) {
                    html5QrCode.stop().then(ignore => {
                        isScannerRunning = false;  // Đánh dấu scanner đã dừng
                        $('#qr-popup').hide() // Đóng popup
                    }).catch(err => {
                        console.error("Lỗi khi dừng quét QR: ", err);
                    });
                } else {
                    $('#qr-popup').hide() // Nếu không có quét đang chạy, chỉ đóng popup
                }
            });

            // Hàm xử lý khi quét thành công
            async function onScanSuccess(decodedText, decodedResult) {
                // Hiển thị kết quả trên trang chính
                //$("#result").text("Kết quả quét: " + decodedText);

                html5QrCode.stop().then(ignore => {
                    isScannerRunning = false;  // Đánh dấu scanner đã dừng
                    document.getElementById("result-form").classList.remove("d-none");
                    // document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
                }).catch(err => {
                    console.error("Lỗi khi dừng camera sau khi quét thành công: ", err);
                });
                let data;
                let domain;
                let workstation;
                let checkQRcode = decodedText.split(',');
                if (typeQR == 2 || typeQR == 3) {
                    data = await getDataMDQRcode(decodedText.replaceAll(',', '$'));
                    if (data.length > 0 && checkQRcode.length == 3) {
                        if (checkTab) {
                            if (data[0].LOT_ID == 0) {
                                const dataQRCODE = await getDM("https://central.homeos.vn/service_XD/service.svc", "DM_QRCODE", "LOT_ID='" + $('#lot-number').val() + "' AND LOT_CLASS='" + $('#classProduct').val() + "'")
                                if (dataQRCODE.data.length < $('#classProductNumber').val()) {
                                    const willInsertData = {
                                        PR_KEY: data[0].PR_KEY,
                                        QR_CODE: decodedText,
                                        MA_SAN_PHAM: checkQRcode[1],
                                        LOT_ID: $('#lot-number').val(),
                                        LOT_CLASS: $('#classProduct').val(),
                                        DATE_CREATE: new Date(),
                                        ACTIVATE_WARRANTY: new Date('1999-01-01 07:00:00.000'),
                                        USER_ID: UserID,
                                        DATASTATE: "EDIT",
                                    };
                                    add('DM_QRCODE', willInsertData);
                                    toastr.success("Quét QR và lưu thông tin thành công!");
                                } else {
                                    toastr.error("Lớp đã quét đủ vui lòng nhập lớp mới!");
                                }
                            } else {
                                if (data[0].LOT_ID == $('#lot-number').val()) {
                                    toastr.error("Sản phẩm đã tồn tại trong lô này!");
                                } else {
                                    toastr.error("Sản phẩm đã thuộc 1 lô khác, vui lòng kiểm tra lại!");
                                }
                            }
                            scanAgain();
                        } else {
                            document.getElementById("result-product").classList.remove("d-none");
                            document.getElementById("result-form-loading").classList.add("d-none");
                            document.getElementById("result-form").classList.remove("d-none");
                            // document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
                            document.getElementById("result-product-truycap").disabled = false;
                            document.getElementById("result-form-productName").value = checkQRcode[1];
                            document.getElementById("result-form-productCode").value = checkQRcode[2].substring(1);
                            document.getElementById("header-productName").textContent = checkQRcode[1] + " - " + checkQRcode[2].substring(1);
                            changeDataWarranty(data);
                        }

                    } if (checkQRcode.length == 4) {
                        data = await getDataMDQRcode(decodedText.replaceAll(',', '$'));
                        // const checkValue = dataLot.data.some(item => item.LOT_NUMBER == decodedText);
                        if (data.length == 0) {
                            const willInsertData = {
                                QR_CODE: decodedText,
                                MA_SAN_PHAM: checkQRcode[1],
                                DATE_CREATE: new Date(),
                                ACTIVATE_WARRANTY: new Date('1999-01-01 07:00:00.000'),
                                USER_ID: UserID,
                                DATASTATE: "ADD",
                            };
                            console.log(willInsertData);

                            add('DM_QRCODE', willInsertData).then(async data => {
                                try {
                                    toastr.success("Quét QR và lưu thông tin thành công!");
                                    if (checkTab) {
                                        scanAgain();
                                    } else {
                                        document.getElementById("result-condition").classList.remove("d-none");
                                        document.getElementById("result-form-loading").classList.add("d-none");
                                        document.getElementById("result-form").classList.remove("d-none");
                                        // document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
                                        document.getElementById("result-condition-truycap").disabled = false;
                                        document.getElementById("result-form-conditionName").value = checkQRcode[1];
                                        document.getElementById("result-form-conditionCode").value = checkQRcode[3];
                                        document.getElementById("header-conditionName").textContent = data[0].PRODUCT_NAME + "[" + checkQRcode[3] + "]";
                                        data = await getDataMDQRcode(decodedText.replaceAll(',', '$'));
                                        localStorage.setItem("itemCondition", JSON.stringify(data));
                                    }
                                } catch (e) { }
                            }).catch(err => {
                                console.error('Error:', err);
                            });
                        } else {
                            console.log(data);
                            document.getElementById("result-condition").classList.remove("d-none");
                            document.getElementById("result-form-loading").classList.add("d-none");
                            document.getElementById("result-form").classList.remove("d-none");
                            // document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
                            document.getElementById("result-condition-truycap").disabled = false;
                            document.getElementById("result-form-conditionName").value = checkQRcode[1];
                            document.getElementById("result-form-conditionCode").value = checkQRcode[3];
                            document.getElementById("header-conditionName").textContent = data[0].PRODUCT_NAME + "[" + checkQRcode[3] + "]";
                            localStorage.setItem("itemCondition", JSON.stringify(data));
                        }
                    } else {
                        if (typeQR == 3 && checkQRcode[0].substring(0, 3) == "T20") {
                            const dataQRCODE = await getDM("https://central.homeos.vn/service_XD/service.svc", "DM_QRCODE", "LOT_ID='" + $('#lot-number').val() + "' AND LOT_CLASS='" + $('#classProduct').val() + "'")
                            if (dataQRCODE.data.length < $('#classProductNumber').val()) {
                                const willInsertData = {
                                    QR_CODE: decodedText,
                                    MA_SAN_PHAM: checkQRcode[1],
                                    LOT_ID: $('#lot-number').val(),
                                    LOT_CLASS: $('#classProduct').val(),
                                    DATE_CREATE: new Date(),
                                    ACTIVATE_WARRANTY: new Date('1999-01-01 07:00:00.000'),
                                    USER_ID: UserID,
                                    DATASTATE: "ADD",
                                };
                                await add('DM_QRCODE', willInsertData).then(async data => {
                                    try {
                                        toastr.success("Quét QR và lưu thông tin thành công!");
                                        const dataEdit = await getDataMDQRcode(decodedText.replaceAll(',', '$'));
                                        const willInsert = {
                                            TYPE: "ADD",
                                            ERROR_NAME: "Hoàn thành sản phẩm",
                                            DESCRIPTION: "Nhập sản phẩm vào hệ thống",
                                            DATE_CREATE: new Date(),
                                            ERROR_STATUS: 0,
                                            QRCODE_ID: dataEdit[0].PR_KEY,
                                            USER_ID: UserID,
                                            DATASTATE: "ADD",
                                        };
                                        await add('WARRANTY_ERROR', willInsert)
                                        scanAgain();
                                    } catch (e) { }
                                }).catch(err => {
                                    console.error('Error:', err);
                                });

                            } else {
                                toastr.error("Lớp đã quét đủ vui lòng nhập lớp mới!");
                                scanAgain();
                            }
                        } else {
                            const dataLot = await getDM("https://central.homeos.vn/service_XD/service.svc", "WARRANTY_LOT", "1=1")
                            console.log();
                            const checkValue = dataLot.data.some(item => item.LOT_NUMBER == decodedText);
                            if (checkValue) {
                                console.log(decodedText);
                            } else if (checkQRcode[0].substring(0, 3) == "T20") {
                                const willInsertData = {
                                    QR_CODE: decodedText,
                                    MA_SAN_PHAM: checkQRcode[1],
                                    DATE_CREATE: new Date(),
                                    ACTIVATE_WARRANTY: new Date('1999-01-01 07:00:00.000'),
                                    USER_ID: UserID,
                                    DATASTATE: "ADD",
                                };
                                add('DM_QRCODE', willInsertData).then(async data => {
                                    try {
                                        toastr.success("Quét QR và lưu thông tin thành công!");
                                        if (checkTab) {
                                            scanAgain();
                                        } else {
                                            document.getElementById("result-product").classList.remove("d-none");
                                            document.getElementById("result-form-loading").classList.add("d-none");
                                            document.getElementById("result-form").classList.remove("d-none");
                                            // document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
                                            document.getElementById("result-product-truycap").disabled = false;
                                            document.getElementById("result-form-productName").value = checkQRcode[1];
                                            document.getElementById("result-form-productCode").value = checkQRcode[2].substring(1);
                                            document.getElementById("header-productName").textContent = checkQRcode[1] + " - " + checkQRcode[2].substring(1);
                                            data = await getDataMDQRcode(decodedText.replaceAll(',', '$'));
                                            const willInsertData = {
                                                TYPE: "ADD",
                                                ERROR_NAME: "Hoàn thành sản phẩm",
                                                DESCRIPTION: "Nhập sản phẩm vào hệ thống",
                                                DATE_CREATE: new Date(),
                                                ERROR_STATUS: 0,
                                                QRCODE_ID: data[0].PR_KEY,
                                                USER_ID: UserID,
                                                DATASTATE: "ADD",
                                            };
                                            await add('WARRANTY_ERROR', willInsertData)
                                            changeDataWarranty(data);
                                        }
                                    } catch (e) { }
                                }).catch(err => {
                                    console.error('Error:', err);
                                });
                            } else {
                                document.getElementById("result-form").classList.remove("d-none");
                                // document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
                                document.getElementById("result-form-total").classList.remove("d-none");
                                document.getElementById("result-condition").classList.add("d-none");
                                document.getElementById("result-form-loading").classList.add("d-none");
                                document.getElementById("result-form-title").classList.remove("d-none");
                                document.getElementById("result-form-stationID").classList.add("d-none");
                                document.getElementById("result-form-stationName").classList.add("d-none");
                                document.getElementById("result-truycap").classList.add("d-none");
                                toastr.error("Vui lòng quét đúng mã QR!");
                            }
                        }
                    }
                } else {
                    if (decodedText.length > 6) {
                        var resultArray = decodedText.split("$");
                        data = await getNewData(
                            localStorage.getItem("MATRAM"),
                            "WORKSTATION_ID='" + resultArray[1] + "'",
                            resultArray[0]
                        );
                        localStorage.setItem("URL", resultArray[0]);
                        workstation = resultArray[1];
                        document.getElementById("result-form-total").classList.remove("d-none");
                        document.getElementById("result-condition").classList.add("d-none");
                        document.getElementById("result-form-loading").classList.add("d-none");
                        document.getElementById("result-form").classList.remove("d-none");
                        // document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
                    } else if (decodedText.length == 6) {
                        domain = await getDomain(decodedText, 'domain');
                        const url = "https://" + domain + "/service/service.svc/"
                        data = await getNewData(
                            localStorage.getItem("MATRAM"),
                            "WORKSTATION_ID='" + decodedText + "'",
                            url
                        );
                        localStorage.setItem("URL", url);
                        workstation = decodedText;
                        document.getElementById("result-form-total").classList.remove("d-none");
                        document.getElementById("result-condition").classList.add("d-none");
                        document.getElementById("result-form-loading").classList.add("d-none");
                        document.getElementById("result-form").classList.remove("d-none");
                        // document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
                    } else {
                        document.getElementById("result-form-total").classList.remove("d-none");
                        document.getElementById("result-condition").classList.add("d-none");
                        document.getElementById("result-form-loading").classList.add("d-none");
                        document.getElementById("result-form-title").classList.remove("d-none");
                        document.getElementById("result-form-stationID").classList.add("d-none");
                        document.getElementById("result-form-stationName").classList.add("d-none");
                        document.getElementById("result-truycap").classList.add("d-none");
                        toastr.error("Vui lòng quét đúng mã QR!");
                    }

                    if (data.data != []) {
                        document.getElementById("result-truycap").disabled = false;
                        matram = workstation;
                        const value = await getDomain(workstation);
                        document.getElementById("result-form-stationID").value = workstation;
                        document.getElementById("result-form-stationName").value = value[0].WORKSTATION_NAME;
                        document.getElementById("footer-stationName").textContent = workstation + " - " + value[0].WORKSTATION_NAME;
                        checkCam = true;
                        localStorage.setItem("MATRAM", workstation);
                        toastr.success("Quét QR thành công");
                    } else {
                        document.getElementById("result-form-total").classList.remove("d-none");
                        document.getElementById("result-condition").classList.add("d-none");
                        document.getElementById("result-form-loading").classList.add("d-none");
                        document.getElementById("result-form-title").classList.remove("d-none");
                        document.getElementById("result-form-stationID").classList.add("d-none");
                        document.getElementById("result-form-stationName").classList.add("d-none");
                        document.getElementById("result-truycap").classList.add("d-none");
                        toastr.error("Vui lòng quét đúng mã QR!");
                    }
                }
            }

            // Hàm xử lý khi quét thất bại
            function onScanFailure(error) {
                // Xử lý lỗi (nếu cần)
            }

            // Khi nhấn nút upload QR từ hình ảnh
            $("#upload-qr").click(function () {
                $("#file-input").click();  // Mở hộp thoại chọn file
            });

            // Khi chọn file hình ảnh từ input
            $("#file-input").change(function (event) {
                var file = event.target.files[0];  // Đảm bảo lấy file đúng
                if (file) {
                    // Dừng quét camera trước khi quét file
                    if (isScannerRunning) {
                        html5QrCode.stop().then(function () {
                            isScannerRunning = false;  // Đánh dấu scanner đã dừng
                            var reader = new FileReader();
                            reader.onload = function (e) {
                                var img = new Image();
                                img.onload = function () {
                                    // Quét QR từ hình ảnh đã tải lên
                                    html5QrCode.scanFile(file).then(async decodedText => {  // Sửa tại đây
                                        document.getElementById("result-form").classList.remove("d-none");
                                        // document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
                                        let data;
                                        let domain;
                                        let workstation;
                                        let checkQRcode = decodedText.split(',');

                                        // if(checkQRcode[0].substring(0, 3) == "T20"){
                                        if (typeQR == 2 || typeQR == 3) {
                                            console.log(2);
                                            data = await getDataMDQRcode(decodedText.replaceAll(',', '$'));
                                            console.log(data);

                                            if (data.length > 0) {
                                                if (checkTab) {
                                                    if (data[0].LOT_ID == 0) {
                                                        const dataQRCODE = await getDM("https://central.homeos.vn/service_XD/service.svc", "DM_QRCODE", "LOT_ID='" + $('#lot-number').val() + "' AND LOT_CLASS='" + $('#classProduct').val() + "'")
                                                        if (dataQRCODE.data.length < $('#classProductNumber').val()) {
                                                            const willInsertData = {
                                                                PR_KEY: data[0].PR_KEY,
                                                                QR_CODE: decodedText,
                                                                MA_SAN_PHAM: checkQRcode[1],
                                                                LOT_ID: $('#lot-number').val(),
                                                                LOT_CLASS: $('#classProduct').val(),
                                                                DATE_CREATE: new Date(),
                                                                ACTIVATE_WARRANTY: new Date('1999-01-01 07:00:00.000'),
                                                                USER_ID: UserID,
                                                                DATASTATE: "EDIT",
                                                            };
                                                            add('DM_QRCODE', willInsertData);
                                                            toastr.success("Quét QR và lưu thông tin thành công!");
                                                        } else {
                                                            toastr.error("Lớp đã quét đủ vui lòng nhập lớp mới!");
                                                        }
                                                    } else {
                                                        if (data[0].LOT_ID == $('#lot-number').val()) {
                                                            toastr.error("Sản phẩm đã tồn tại trong lô này!");
                                                        } else {
                                                            toastr.error("Sản phẩm đã thuộc 1 lô khác, vui lòng kiểm tra lại!");
                                                        }
                                                    }
                                                    scanAgain()
                                                } else {
                                                    document.getElementById("result-product").classList.remove("d-none");
                                                    document.getElementById("result-form-loading").classList.add("d-none");
                                                    document.getElementById("result-form").classList.remove("d-none");
                                                    // document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
                                                    document.getElementById("result-product-truycap").disabled = false;
                                                    document.getElementById("result-form-productName").value = checkQRcode[1];
                                                    document.getElementById("result-form-productCode").value = checkQRcode[2].substring(1);
                                                    document.getElementById("header-productName").textContent = checkQRcode[1] + " - " + checkQRcode[2].substring(1);
                                                    changeDataWarranty(data);
                                                }

                                            } if (checkQRcode.length == 4) {
                                                data = await getDataMDQRcode(decodedText.replaceAll(',', '$'));
                                                // const checkValue = dataLot.data.some(item => item.LOT_NUMBER == decodedText);
                                                if (data.length == 0) {
                                                    const willInsertData = {
                                                        QR_CODE: decodedText,
                                                        MA_SAN_PHAM: checkQRcode[1],
                                                        DATE_CREATE: new Date(),
                                                        ACTIVATE_WARRANTY: new Date('1999-01-01 07:00:00.000'),
                                                        USER_ID: UserID,
                                                        DATASTATE: "ADD",
                                                    };
                                                    console.log(willInsertData);

                                                    add('DM_QRCODE', willInsertData).then(async data => {
                                                        try {
                                                            toastr.success("Quét QR và lưu thông tin thành công!");
                                                            if (checkTab) {
                                                                scanAgain();
                                                            } else {
                                                                document.getElementById("result-condition").classList.remove("d-none");
                                                                document.getElementById("result-form-loading").classList.add("d-none");
                                                                document.getElementById("result-form").classList.remove("d-none");
                                                                // document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
                                                                document.getElementById("result-condition-truycap").disabled = false;
                                                                document.getElementById("result-form-conditionName").value = checkQRcode[1];
                                                                document.getElementById("result-form-conditionCode").value = checkQRcode[3];
                                                                document.getElementById("header-conditionName").textContent = data[0].PRODUCT_NAME + "[" + checkQRcode[3] + "]";
                                                                data = await getDataMDQRcode(decodedText.replaceAll(',', '$'));
                                                                localStorage.setItem("itemCondition", JSON.stringify(data));
                                                            }
                                                        } catch (e) { }
                                                    }).catch(err => {
                                                        console.error('Error:', err);
                                                    });
                                                } else {
                                                    console.log(data);
                                                    document.getElementById("result-condition").classList.remove("d-none");
                                                    document.getElementById("result-form-loading").classList.add("d-none");
                                                    document.getElementById("result-form").classList.remove("d-none");
                                                    // document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
                                                    document.getElementById("result-condition-truycap").disabled = false;
                                                    document.getElementById("result-form-conditionName").value = checkQRcode[1];
                                                    document.getElementById("result-form-conditionCode").value = checkQRcode[3];
                                                    document.getElementById("header-conditionName").textContent = data[0].PRODUCT_NAME + "[" + checkQRcode[3] + "]";
                                                    localStorage.setItem("itemCondition", JSON.stringify(data));
                                                }
                                            } else {
                                                if (typeQR == 3 && checkQRcode[0].substring(0, 3) == "T20") {
                                                    console.log(1);

                                                    const dataQRCODE = await getDM("https://central.homeos.vn/service_XD/service.svc", "DM_QRCODE", "LOT_ID='" + $('#lot-number').val() + "' AND LOT_CLASS='" + $('#classProduct').val() + "'")
                                                    if (dataQRCODE.data.length < $('#classProductNumber').val()) {
                                                        const willInsertData = {
                                                            QR_CODE: decodedText,
                                                            MA_SAN_PHAM: checkQRcode[1],
                                                            LOT_ID: $('#lot-number').val(),
                                                            LOT_CLASS: $('#classProduct').val(),
                                                            DATE_CREATE: new Date(),
                                                            ACTIVATE_WARRANTY: new Date('1999-01-01 07:00:00.000'),
                                                            USER_ID: UserID,
                                                            DATASTATE: "ADD",
                                                        };
                                                        await add('DM_QRCODE', willInsertData).then(async data => {
                                                            try {
                                                                toastr.success("Quét QR và lưu thông tin thành công!");
                                                                const dataEdit = await getDataMDQRcode(decodedText.replaceAll(',', '$'));
                                                                const willInsert = {
                                                                    TYPE: "ADD",
                                                                    ERROR_NAME: "Hoàn thành sản phẩm",
                                                                    DESCRIPTION: "Nhập sản phẩm vào hệ thống",
                                                                    DATE_CREATE: new Date(),
                                                                    ERROR_STATUS: 0,
                                                                    QRCODE_ID: dataEdit[0].PR_KEY,
                                                                    USER_ID: UserID,
                                                                    DATASTATE: "ADD",
                                                                };
                                                                await add('WARRANTY_ERROR', willInsert)
                                                                scanAgain();
                                                            } catch (e) { }
                                                        }).catch(err => {
                                                            console.error('Error:', err);
                                                        });
                                                        console.log(2);

                                                    } else {
                                                        toastr.error("Lớp đã quét đủ vui lòng nhập lớp mới!");
                                                        scanAgain();
                                                        console.log(1);
                                                    }
                                                } else {
                                                    const dataLot = await getDM("https://central.homeos.vn/service_XD/service.svc", "WARRANTY_LOT", "1=1")
                                                    console.log(dataLot);
                                                    const checkValue = dataLot.data.some(item => item.LOT_NUMBER == decodedText);
                                                    if (checkValue) {
                                                        console.log(decodedText);
                                                    } else if (checkQRcode[0].substring(0, 3) == "T20") {
                                                        const willInsertData = {
                                                            QR_CODE: decodedText,
                                                            MA_SAN_PHAM: checkQRcode[1],
                                                            DATE_CREATE: new Date(),
                                                            ACTIVATE_WARRANTY: new Date('1999-01-01 07:00:00.000'),
                                                            USER_ID: UserID,
                                                            DATASTATE: "ADD",
                                                        };
                                                        add('DM_QRCODE', willInsertData).then(async data => {
                                                            try {
                                                                toastr.success("Quét QR và lưu thông tin thành công!");
                                                                if (checkTab) {
                                                                    scanAgain();
                                                                } else {
                                                                    document.getElementById("result-product").classList.remove("d-none");
                                                                    document.getElementById("result-form-loading").classList.add("d-none");
                                                                    document.getElementById("result-form").classList.remove("d-none");
                                                                    // document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
                                                                    document.getElementById("result-product-truycap").disabled = false;
                                                                    document.getElementById("result-form-productName").value = checkQRcode[1];
                                                                    document.getElementById("result-form-productCode").value = checkQRcode[2].substring(1);
                                                                    document.getElementById("header-productName").textContent = checkQRcode[1] + " - " + checkQRcode[2].substring(1);
                                                                    data = await getDataMDQRcode(decodedText.replaceAll(',', '$'));
                                                                    const willInsertData = {
                                                                        TYPE: "ADD",
                                                                        ERROR_NAME: "Hoàn thành sản phẩm",
                                                                        DESCRIPTION: "Nhập sản phẩm vào hệ thống",
                                                                        DATE_CREATE: new Date(),
                                                                        ERROR_STATUS: 0,
                                                                        QRCODE_ID: data[0].PR_KEY,
                                                                        USER_ID: UserID,
                                                                        DATASTATE: "ADD",
                                                                    };
                                                                    await add('WARRANTY_ERROR', willInsertData)
                                                                    changeDataWarranty(data);
                                                                }
                                                            } catch (e) { }
                                                        }).catch(err => {
                                                            console.error('Error:', err);
                                                        });
                                                        console.log(2);

                                                    } else {
                                                        document.getElementById("result-form").classList.remove("d-none");
                                                        // document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
                                                        document.getElementById("result-form-total").classList.remove("d-none");
                                                        document.getElementById("result-condition").classList.add("d-none");
                                                        document.getElementById("result-form-loading").classList.add("d-none");
                                                        document.getElementById("result-form-title").classList.remove("d-none");
                                                        document.getElementById("result-form-stationID").classList.add("d-none");
                                                        document.getElementById("result-form-stationName").classList.add("d-none");
                                                        document.getElementById("result-truycap").classList.add("d-none");
                                                        toastr.error("Vui lòng quét đúng mã QR!");
                                                    }
                                                }

                                            }
                                        } else {
                                            console.log(3);

                                            if (decodedText.length > 6) {
                                                var resultArray = decodedText.split("$");
                                                data = await getNewData(
                                                    localStorage.getItem("MATRAM"),
                                                    "WORKSTATION_ID='" + resultArray[1] + "'",
                                                    resultArray[0]
                                                );
                                                localStorage.setItem("URL", resultArray[0]);
                                                workstation = resultArray[1];
                                                document.getElementById("result-form-total").classList.remove("d-none");
                                                document.getElementById("result-condition").classList.add("d-none");
                                                document.getElementById("result-form-loading").classList.add("d-none");
                                                document.getElementById("result-form").classList.remove("d-none");
                                                // document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
                                            } else if (decodedText.length == 6) {
                                                domain = await getDomain(decodedText, 'domain');
                                                const url = "https://" + domain + "/service/service.svc/"
                                                data = await getNewData(
                                                    localStorage.getItem("MATRAM"),
                                                    "WORKSTATION_ID='" + decodedText + "'",
                                                    url
                                                );
                                                localStorage.setItem("URL", url);
                                                workstation = decodedText;
                                                document.getElementById("result-form-total").classList.remove("d-none");
                                                document.getElementById("result-condition").classList.add("d-none");
                                                document.getElementById("result-form-loading").classList.add("d-none");
                                                document.getElementById("result-form").classList.remove("d-none");
                                                // document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
                                            } else {
                                                document.getElementById("result-form-total").classList.remove("d-none");
                                                document.getElementById("result-condition").classList.add("d-none");
                                                document.getElementById("result-form-loading").classList.add("d-none");
                                                toastr.error("Vui lòng quét đúng mã QR!");
                                            }


                                            if (data != []) {

                                                document.getElementById("result-truycap").disabled = false;
                                                matram = workstation
                                                const value = await getDomain(workstation);
                                                document.getElementById("result-form-stationID").value = workstation;
                                                document.getElementById("result-form-stationName").value = value[0].WORKSTATION_NAME;
                                                document.getElementById("footer-stationName").textContent = workstation + " - " + value[0].WORKSTATION_NAME;
                                                checkCam = true;
                                                toastr.success("Quét QR thành công");
                                                localStorage.setItem("MATRAM", workstation);
                                            }
                                        }
                                    }).catch(err => {
                                        document.getElementById("result-form").classList.remove("d-none");
                                        // document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
                                        document.getElementById("result-form-total").classList.remove("d-none");
                                        document.getElementById("result-condition").classList.add("d-none");
                                        document.getElementById("result-form-loading").classList.add("d-none");
                                        document.getElementById("result-form-title").classList.remove("d-none");
                                        document.getElementById("result-form-stationID").classList.add("d-none");
                                        document.getElementById("result-form-stationName").classList.add("d-none");
                                        document.getElementById("result-truycap").classList.add("d-none");
                                        toastr.error("Vui lòng quét đúng mã QR!");
                                    });
                                };
                                img.src = e.target.result;
                            };
                            reader.readAsDataURL(file);  // Đọc hình ảnh từ file
                        }).catch(err => {
                            console.error("Lỗi khi dừng camera: ", err);
                        });
                    } else {
                        // Nếu không có scanner đang chạy, quét trực tiếp từ hình ảnh
                        var reader = new FileReader();
                        reader.onload = function (e) {
                            var img = new Image();
                            img.onload = function () {
                                html5QrCode.scanFile(file).then(decodedText => {
                                    $("#result").text("Kết quả quét: " + decodedText); // Hiển thị kết quả
                                }).catch(err => {
                                    $("#result").text("Không thể quét QR từ hình ảnh.");
                                    console.error("Lỗi khi quét hình ảnh QR: ", err);
                                });
                            };
                            img.src = e.target.result;
                        };
                        reader.readAsDataURL(file);  // Đọc hình ảnh từ file
                    }
                }
            });


            //lấy value khi nhập mã trạm thủ công.
            async function getInputValue(checkW) {
                var inputValue = document.getElementById("device_name").value;
                if(checkW){
                    $("#loading-popup").show();
                    CheckWorkStation(checkW)
                } else {
                    if (inputValue == null || inputValue == "") {
                        toastr.error("Vui lòng nhập mã trạm!");
                    } else {
                        $("#loading-popup").show()
                        CheckWorkStation(inputValue)
                    }
                }
            }

            // ẩn phần bước khi bật bàn phí trên mobile
            // function adjustFooter() {
            //     // const footer = document.querySelector('.footer-instruct');
            //     const windowHeight = window.innerHeight;

            //     window.addEventListener('resize', () => {
            //         if (window.innerHeight < windowHeight) {
            //             // Keyboard is visible, hide or adjust footer
            //             document.getElementById("footer-instruct-text")?.classList.add("d-none");
            //             document.getElementById("footer-instruct-warranty")?.classList.add("d-none");
            //             // footer.style.display = 'none'; // You can also reposition it instead of hiding
            //         } else {
            //             // Keyboard is hidden, show footer
            //             document.getElementById("footer-instruct-text")?.classList.remove("d-none");
            //             document.getElementById("footer-instruct-warranty")?.classList.remove("d-none");
            //             // footer.style.display = 'block';
            //         }
            //     });
            // }
            // adjustFooter();
            // Sidebar toggle logic
            const menuToggle = $(".menuToggle");
            const sidebar = $(".sidebar");

            // Toggle the sidebar visibility
            menuToggle.on("click", (e) => {
                e.stopPropagation(); // Ngăn chặn sự kiện click lan ra ngoài
                sidebar.toggleClass("open");
            });

            // Detect clicks outside the sidebar
            $(document).on("click", (e) => {
                if (sidebar.hasClass("open") && !$(e.target).closest(".sidebar").length) {
                    sidebar.removeClass("open");
                }
            });


            // Handle menu item clicks
            const menuItems = document.querySelectorAll(".menu-item, .submenu li");
            menuItems.forEach((item) => {
                item.addEventListener("click", async (e) => {
                    e.stopPropagation(); // Prevent the click from propagating to the document

                    // Detect which menu item was clicked
                    const menuText = item.innerText.trim(); // Get the text of the menu item

                    if (menuText == "Giải pháp thông minh") {
                        console.log(menuText);
                        $("#tab-add-category").click();
                    } else if (menuText == "Quản lý danh mục") {
                        document.getElementById("history-setting").classList.remove("d-none");
                        document.getElementById("history-homePage").classList.add("d-none");
                        document.getElementById("list-category").classList.remove("d-none");
                        document.getElementById("save-category").classList.add("d-none");
                        $(".history-avt").removeClass("d-none");
                        document.getElementById("category-back").classList.add("d-none");
                        showCategory()
                        // document.querySelector(".tablink-history").click();
                    } else if (menuText == "Truy cập Trạm") {
                        document.getElementById("history-setting").classList.add("d-none");
                        document.getElementById("history-homePage").classList.remove("d-none");
                        localStorage.setItem('listItemCategory', JSON.stringify([]));
                        showHistory()
                    } else if (menuText == "Thông tin công ty") {
                        window.location.href = "https://homeos.com.vn/";
                    } else if (menuText == "Thông tin sản phẩm") {
                        $("#history").addClass("hidden");
                        $("#ScanQRWarranty").removeClass("hidden");
                        $(".warrantyDetailProduct").removeClass("d-none");
                        document.querySelector(".tablinkGuarantee").click();
                        $("#ScanAllQRcode").addClass("d-none");
                        $("#lotProduct").addClass("d-none");
                        checkTab = false;
                    } else if (menuText == "Quét lô sản phẩm") {
                        $("#history").addClass("hidden");
                        $("#ScanQRWarranty").removeClass("hidden");
                        $(".warrantyDetailProduct").addClass("d-none");
                        $("#ScanAllQRcode").removeClass("d-none");
                        $("#lotProduct").addClass("d-none");
                        $('#lot-number').empty();
                        const Data = await getDM("https://central.homeos.vn/service_XD/service.svc", 'WARRANTY_LOT', "1=1");
                        const newOption = $('<option>', {
                            value: '0', // Giá trị của option
                            text: 'Chọn lô sản phẩm' // Nội dung hiển thị
                        });
                        // Thêm vào select
                        $('#lot-number').append(newOption);
                        Data.data.forEach(item => {
                            console.log(item);
                            const newOption = $('<option>', {
                                value: item.PR_KEY, // Giá trị của option
                                text: item.LOT_NAME // Nội dung hiển thị
                            });
                            // Thêm vào select
                            $('#lot-number').append(newOption);
                        });
                        checkTab = true;
                    } else if (menuText == "Quản lý và xuất lô hàng") {
                        $("#history").addClass("hidden");
                        $("#ScanQRWarranty").removeClass("hidden");
                        $(".warrantyDetailProduct").addClass("d-none");
                        $("#ScanAllQRcode").addClass("d-none");
                        $("#lotProduct").removeClass("d-none");
                        addItemLotproduct();
                    }
                    // Close the sidebar after selection (optional)
                    sidebar.removeClass("open");
                });
            });

            // Code Bảo hành:

            // Hàm thêm sửa xoá dữ liệu
            async function add(table, data, URL, check) {
                // const d = {Uid: "vannt", Sid:'3d798037-9bd9-4195-8673-a4794547d2fd', tablename:table, jd:JSON.stringify(data), ex:''};
                let user_id_getDm = 'admin';
                let Sid_getDM = 'cb880c13-5465-4a1d-a598-28e06be43982';
                let url = 'https://central.homeos.vn/service_XD/service.svc';
                if(check == "NotCentral"){
                    url = URL;
                    let dataUser;
                    if(url.toLowerCase() == "https://cctl-dongthap.homeos.vn/service/service.svc" || url.toLowerCase() == "https://pctthn.homeos.vn/service/service.svc"){
                        dataUser = await checkRoleUser("admin", sha1Encode("123" + "@1B2c3D4e5F6g7H8").toString(), url+'/');
                    } else if(url.toLowerCase() == "https://thanthongnhat.homeos.vn/service/service.svc"){
                        dataUser = await checkRoleUser("admin", sha1Encode("1" + "@1B2c3D4e5F6g7H8").toString(), url+'/');
                    } else {
                        dataUser = await checkRoleUser("dev", sha1Encode("1" + "@1B2c3D4e5F6g7H8").toString(), url+'/');
                    }
                    
                    user_id_getDm = dataUser[0].StateName;
                    Sid_getDM = dataUser[0].StateId;
                }
                
                const d = { Uid: user_id_getDm, Sid: Sid_getDM, tablename: table, jd: JSON.stringify(data), ex: '' };

                return new Promise((resolve, reject) => {
                    $.ajax({
                        // url: "https://DEV.HOMEOS.vn/service/service.svc/ExecuteData?callback=?",
                        url: url+"/ExecuteData?callback=?",
                        type: "GET",
                        dataType: "jsonp",
                        data: d,
                        contentType: "application/json; charset=utf-8",
                        success: function (msg) {
                            try {
                                let state = JSON.parse(msg);
                                resolve(state);  // Trả về dữ liệu khi thành công
                            } catch (error) {
                                reject(error);  // Bắt lỗi nếu JSON parse thất bại
                            }
                        },
                        complete: function (data) {
                        },
                        error: function (e, t, x) {
                        }
                    });
                });
            }

            // lấy dữ liệu QR code
            function getDataMDQRcode(QRcode) {

                // const url = "https://DEV.HOMEOS.vn/service/service.svc/";
                const url = "https://central.homeos.vn/service_XD/service.svc/";

                return new Promise((resolve, reject) => {
                    $.ajax({
                        url: url + "ApiServicePublic/" + "GetDataQRcode" + "/" + "QRCODEINPUT=" + QRcode,
                        type: "GET",
                        dataType: "jsonp",
                        contentType: "application/json; charset=utf-8",
                        success: function (msg) {
                            try {
                                let state = JSON.parse(msg);
                                resolve(state); // Trả về dữ liệu khi thành công
                            } catch (error) {
                                reject(error); // Bắt lỗi nếu JSON parse thất bại
                            }
                        },
                        complete: function (data) {
                            // Có thể thêm xử lý khi request hoàn thành ở đây nếu cần
                        },
                        error: function (e, t, x) {
                            // document.getElementById("result-form").classList.remove("d-none");
                            // document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
                            // toastr.error("Vui lòng quét đúng mã QR của trạm mưa");
                            document.getElementById("result-form").classList.remove("d-none");
                            // document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
                            document.getElementById("result-form-total").classList.remove("d-none");
                            document.getElementById("result-condition").classList.add("d-none");
                            document.getElementById("result-form-loading").classList.add("d-none");
                            document.getElementById("result-form-title").classList.remove("d-none");
                            document.getElementById("result-form-stationID").classList.add("d-none");
                            document.getElementById("result-form-stationName").classList.add("d-none");
                            document.getElementById("result-truycap").classList.add("d-none");
                            toastr.error("Vui lòng quét đúng mã QR!");
                        },
                    });
                });
            }

            $('.bottom-navigation button').click(function () {
                value = $(this).data('tab');
                $('.bottom-navigation button').removeClass('menuWarranty');
                $(this).addClass('menuWarranty');
                $('.tab-content').removeClass('active');
                $('#tab-' + value).addClass('active');
            });

            function changeDataWarranty(data) {
                let DataQRcode = data[0].QR_CODE.split(',');
                localStorage.setItem("productWarranty", JSON.stringify(data));
                const dataWarranty = JSON.parse(localStorage.getItem("productWarranty"));
                console.log(dataWarranty);
                document.getElementById('productName').textContent = "Tên sản phẩm: " + data[0].PRODUCT_NAME;
                document.getElementById('productCode').textContent = "Mã định danh: " + data[0].PRODUCT_CODE;
                document.getElementById('productSeri').textContent = "Số seri: " + DataQRcode[2].substring(1);
                document.getElementById("deviceImg").src = data[0].PRODUCT_IMG;
                if (data[0].ACTIVATE_WARRANTY == "1999-01-01T00:00:00") {
                    document.getElementById('warrantyActive').textContent = "Chưa kích hoạt";
                    document.getElementById('warrantyTimeActive').textContent = " ";
                    const WarrantyAct = DataQRcode[0].substring(1, 5) + "-" + DataQRcode[0].substring(5, 7) + "-" + DataQRcode[0].substring(7, 9);
                    const time = calculateWarrantyRemaining(data[0].DATE_CREATE, Number(data[0].TIME_WARRANTY));
                    console.log(WarrantyAct, data);
                    document.getElementById('warrantyTime').textContent = time;
                    document.getElementById('result-product-warranty').classList.remove("d-none");
                } else {
                    document.getElementById('warrantyActive').textContent = "Đã kích hoạt";
                    const now = new Date(data[0].ACTIVATE_WARRANTY);

                    const year = now.getFullYear();
                    const month = String(now.getMonth() + 1).padStart(2, '0');
                    const day = String(now.getDate()).padStart(2, '0');
                    document.getElementById('warrantyTimeActive').textContent = `${year}-${month}-${day}`;
                    document.getElementById('result-product-warranty').classList.add("d-none");
                    const WarrantyAct = DataQRcode[0].substring(1, 5) + "-" + DataQRcode[0].substring(5, 7) + "-" + DataQRcode[0].substring(7, 9);
                    const time = calculateWarrantyRemaining(data[0].DATE_CREATE, Number(data[0].TIME_WARRANTY));
                    document.getElementById('warrantyTime').textContent = time;
                }
                // const item = { 'CodeWorkStation': workstationID, 'NameWorkStation': state[0].WORKSTATION_NAME, 'domain': domain, 'date': getCurrentTime(), 'workstationType': state[0].TEMPLATE_TOOLTIP }
                // localStorage.setItem('itemHistory', JSON.stringify(item));
                saveWarranty(data);
                addItemHistoryWarranty(data[0].PR_KEY, data);
            }

            $('#result-product-warranty').click(function () {
                const dataWarranty = JSON.parse(localStorage.getItem("productWarranty"));
                const DataQRcode = dataWarranty[0].QR_CODE.split(',');
                const confirmActivate = confirm(`Xác nhận kích hoạt bảo hành của sản phẩm "${dataWarranty[0].PRODUCT_NAME}-${DataQRcode[2].substring(1)}" không?`);
                if (confirmActivate) {
                    const willInsertData = {
                        PR_KEY: dataWarranty[0].PR_KEY,
                        QR_CODE: dataWarranty[0].QR_CODE,
                        MA_SAN_PHAM: dataWarranty[0].MA_SAN_PHAM,
                        DATE_CREATE: dataWarranty[0].DATE_CREATE,
                        ACTIVATE_WARRANTY: new Date(),
                        USER_ID: dataWarranty[0].USER_ID,
                        DATASTATE: "EDIT",
                    };
                    add('DM_QRCODE', willInsertData).then(async data => {
                        try {
                            toastr.success("Kích hoạt bảo hành của sản phẩm thành công!");
                            const InsertData = {
                                TYPE: "ACTIVATE",
                                ERROR_NAME: "Kích hoạt bảo hành",
                                DESCRIPTION: DataUser.name + " đã kích hoạt bảo hành sản phẩm",
                                DATE_CREATE: new Date(),
                                ERROR_STATUS: 0,
                                QRCODE_ID: dataWarranty[0].PR_KEY,
                                USER_ID: UserID,
                                DATASTATE: "ADD",
                            };
                            add('WARRANTY_ERROR', InsertData)

                            data = await getDataMDQRcode(dataWarranty[0].QR_CODE.replaceAll(',', '$'));
                            changeDataWarranty(data);
                        } catch (e) { }
                    }).catch(err => {
                        console.error('Error:', err);
                    });
                }
            });

            function calculateWarrantyRemaining(startDate, timeWarranty) {
                const warrantyPeriodMonths = timeWarranty; // Thời gian bảo hành là 12 tháng

                // Chuyển ngày bắt đầu bảo hành sang đối tượng Date
                const startDateObj = new Date(startDate);
                // Ngày kết thúc bảo hành
                const warrantyEndDate = new Date(startDateObj);
                warrantyEndDate.setMonth(warrantyEndDate.getMonth() + warrantyPeriodMonths);

                console.log(warrantyEndDate);

                // Ngày hiện tại
                const currentDate = new Date();

                // Tính thời gian còn lại
                if (currentDate > warrantyEndDate) {
                    return "Thời gian bảo hành đã hết.";
                } else {
                    // Tính tổng số tháng còn lại
                    let totalMonthsRemaining =
                        (warrantyEndDate.getFullYear() - currentDate.getFullYear()) * 12 +
                        (warrantyEndDate.getMonth() - currentDate.getMonth());

                    // Tính số ngày còn lại
                    let daysRemaining = warrantyEndDate.getDate() - currentDate.getDate();

                    // Điều chỉnh nếu số ngày âm
                    if (daysRemaining < 0) {
                        // Lấy số ngày của tháng trước
                        const lastMonth = new Date(warrantyEndDate.getFullYear(), warrantyEndDate.getMonth(), 0);
                        daysRemaining += lastMonth.getDate();
                        totalMonthsRemaining -= 1;
                    }
                    // ${daysRemaining} ngày.
                    return `Còn lại: ${totalMonthsRemaining} tháng`;
                }
            }

            $("#submitError").click(function () {
                // Lấy giá trị từ các trường
                const errorInput = $("#errorInput").val();
                const errorType = $("#errorType").val();
                const errorDesc = $("#errorDesc").val();
                const dataWarranty = JSON.parse(localStorage.getItem("productWarranty"));
                console.log(dataWarranty);
                const willInsertData = {
                    TYPE: 'ERROR',
                    ERROR_TYPE: errorType,
                    ERROR_NAME: errorInput,
                    DESCRIPTION: errorDesc,
                    DATE_CREATE: new Date(),
                    ERROR_STATUS: 1,
                    QRCODE_ID: dataWarranty[0].PR_KEY,
                    USER_ID: UserID,
                    DATASTATE: "ADD",
                };
                add('WARRANTY_ERROR', willInsertData).then(async data => {
                    try {
                        toastr.success("Báo lỗi thành công!");
                        addItemHistoryWarranty(dataWarranty[0].PR_KEY, dataWarranty);
                        $("#BackWarranty").click();
                    } catch (e) { }
                }).catch(err => {
                    console.error('Error:', err);
                });
            });

            $('#generateQRCodes').click(function () {
                startValue = parseInt($('#startValue').val()) || 1;
                getTranNo();
            });


            async function getTranNo() {
                try {
                    const data = await getDM("https://central.homeos.vn/service_XD/service.svc", 'SYS_TRAN_NO', "TABLE_NAME='DM_QRCODE'");
                    const state = data.data;
                    let temp = state[0].TRAN_NO || null;
                    temp = temp.replace(/\[YEAR\]/g, (new Date()).getFullYear());
                    temp = temp.replace(/\[MONTH\]/g, ((new Date()).getMonth() + 1).toString().padStart(2, '0'));
                    temp = temp.replace(/\[DAY\]/g, (new Date()).getDate().toString().padStart(2, '0'));
                    temp = temp.replace(/\[HOUR\]/g, (new Date()).getHours().toString().padStart(2, '0'));
                    temp = temp.replace(/\[MINUTE\]/g, (new Date()).getMinutes().toString().padStart(2, '0'));
                    temp = temp.replace(/\[SECOND\]/g, (new Date()).getSeconds().toString().padStart(2, '0'));
                    const codes = [];
                    let auto_key = state[0].AUTO_KEY;
                    for (let i = 1; i <= startValue; i++) {
                        auto_key += 1;
                        const code = temp.replace(/\[AUTO_KEY\]/g, (auto_key).toString().padStart(state[0].LENGTH_KEY, '0'));
                        codes.push(code);
                    }
                    generateQRCodes(codes);
                    console.log(auto_key, state[0].TABLE_NAME, state[0].TRAN_NO, state[0].LENGTH_KEY);

                    updateTranNo(auto_key, state[0].TABLE_NAME, state[0].TRAN_NO, state[0].LENGTH_KEY);
                } catch (error) {
                    console.error("Lỗi khi lấy dữ liệu:", error);
                }
            }

            async function getDM(url, table_name, c, check) {
                let user_id_getDm = 'admin';
                let Sid_getDM = 'cb880c13-5465-4a1d-a598-28e06be43982';
                if(check == "NotCentral"){
                    let dataUser;
                    if(url.toLowerCase() == "https://cctl-dongthap.homeos.vn/service/service.svc" || url.toLowerCase() == "https://pctthn.homeos.vn/service/service.svc"){
                        dataUser = await checkRoleUser("admin", sha1Encode("123" + "@1B2c3D4e5F6g7H8").toString(), url+'/');
                    } else if(url.toLowerCase() == "https://thanthongnhat.homeos.vn/service/service.svc"){
                        dataUser = await checkRoleUser("admin", sha1Encode("1" + "@1B2c3D4e5F6g7H8").toString(), url+'/');
                    } else {
                        dataUser = await checkRoleUser("dev", sha1Encode("1" + "@1B2c3D4e5F6g7H8").toString(), url+'/');
                    }
                    
                    user_id_getDm = dataUser[0].StateName;
                    Sid_getDM = dataUser[0].StateId;
                }
                const d = {
                    // Uid: 'vannt',
                    // Sid: 'b99213e4-a8a5-45f4-bb5c-cf03ae90d8d7',
                    Uid: user_id_getDm,
                    Sid: Sid_getDM,
                    tablename: table_name,
                    c: c,
                    other: '',
                    cmd: ''
                };
                
                // const Url = 'https://DEV.HOMEOS.vn/service/service.svc/';

                return new Promise((resolve, reject) => {
                    $.ajax({
                        url: url+"/getDm?callback=?",
                        type: "GET",
                        dataType: "jsonp",
                        data: d,
                        contentType: "application/json; charset=utf-8",
                        success: function (msg) {
                            try {
                                let state = JSON.parse(msg);
                                resolve(state);  // Trả về dữ liệu khi thành công
                            } catch (error) {
                                reject(error);  // Bắt lỗi nếu JSON parse thất bại
                            }
                        },
                        complete: function (data) {
                            // Có thể thêm xử lý khi request hoàn thành ở đây nếu cần
                        },
                        error: function (e, t, x) {
                            HomeOS.Service.SetActionControl(true);
                            HomeOS.Service.ShowLabel('Lỗi dữ liệu');
                            reject(e);  // Trả về lỗi nếu thất bại
                        }
                    });
                });
            }
            
            async function WorkstationStatistics(url, c, check, code) {
                let user_id_getDm = 'admin';
                let Sid_getDM = 'cb880c13-5465-4a1d-a598-28e06be43982';
                if(check == "NotCentral"){
                    let dataUser;
                    if(url.toLowerCase() == "https://cctl-dongthap.homeos.vn/service/service.svc" || url.toLowerCase() == "https://pctthn.homeos.vn/service/service.svc"){
                        dataUser = await checkRoleUser("admin", sha1Encode("123" + "@1B2c3D4e5F6g7H8").toString(), url+'/');
                    } else if(url.toLowerCase() == "https://thanthongnhat.homeos.vn/service/service.svc"){
                        dataUser = await checkRoleUser("admin", sha1Encode("1" + "@1B2c3D4e5F6g7H8").toString(), url+'/');
                    } else {
                        dataUser = await checkRoleUser("dev", sha1Encode("1" + "@1B2c3D4e5F6g7H8").toString(), url+'/');
                    }
                    
                    user_id_getDm = dataUser[0].StateName;
                    Sid_getDM = dataUser[0].StateId;
                }
                const maTram = localStorage.getItem("MATRAM");
                const d = {
                    // Uid: 'vannt',
                    // Sid: 'b99213e4-a8a5-45f4-bb5c-cf03ae90d8d7',
                    Uid: user_id_getDm,
                    Sid: Sid_getDM,
                    c: c
                };
                
                // const Url = 'https://DEV.HOMEOS.vn/service/service.svc/';

                return new Promise((resolve, reject) => {
                    $.ajax({
                        url: url+"/WorkstationStatistics?callback=?",
                        type: "GET",
                        dataType: "jsonp",
                        data: d,
                        contentType: "application/json; charset=utf-8",
                        success: function (msg) {
                            try {
                                let state = JSON.parse(msg);
                                const result = state.DATA.find(obj => obj.hasOwnProperty("DN"+maTram+"3"));
                                const dataArray = result["DN"+maTram+"3"];
                                resolve(dataArray);  // Trả về dữ liệu khi thành công
                            } catch (error) {
                                reject(error);  // Bắt lỗi nếu JSON parse thất bại
                            }
                        },
                        complete: function (data) {
                            // Có thể thêm xử lý khi request hoàn thành ở đây nếu cần
                        },
                        error: function (e, t, x) {
                            HomeOS.Service.SetActionControl(true);
                            HomeOS.Service.ShowLabel('Lỗi dữ liệu');
                            reject(e);  // Trả về lỗi nếu thất bại
                        }
                    });
                });
            }
            async function generateQRCodes(listcode) {
                const newTab = window.open('', '_blank');
                if (!newTab || newTab.closed || typeof newTab.closed == 'undefined') {
                    alert('Tab mới không thể mở. Vui lòng kiểm tra cài đặt popup của trình duyệt.');
                    return;
                }
                let htmlContent = `
                    <html>
                    <head>
                        <style>
                            body {
                                text-align: center;
                                padding: 5px;
                            }
                            .qr-grid {
                                display: grid;
                                grid-template-columns: repeat(auto-fill, minmax(68px, 1fr));
                                margin-top: 10px;
                            }
                            .qr-item {
                                display: flex;
                                flex-direction: column;
                                align-items: center;
                            }
                            .qr-item img {
                                width: 57px;
                            }
                            .qr-item p {
                                margin-top: 5px;
                                margin-bottom: 8px;
                                font-size: 11px;
                            }
                        </style>
                    </head>
                    <body>
                        <div class="qr-grid">
                `;
                for (const code of listcode) {
                    // Tạo một <div> tạm để render mã QR
                    const tempDiv = document.createElement('div');
                    const qrCode = new QRCode(tempDiv, {
                        text: code,           // Mã code muốn tạo
                        width: 57,           // Chiều rộng mã QR
                        height: 57           // Chiều cao mã QR
                        // width: 76,           // Chiều rộng mã QR
                        // height: 76           // Chiều cao mã QR
                    });

                    // Chờ QRCode render xong và lấy hình ảnh từ thẻ canvas
                    const qrDataUrl = await new Promise((resolve) => {
                        setTimeout(() => {
                            const canvas = tempDiv.querySelector('canvas');  // Lấy thẻ canvas chứa mã QR
                            resolve(canvas.toDataURL());                    // Chuyển canvas thành DataURL
                        }, 500);  // Đợi một thời gian ngắn để chắc chắn mã QR được tạo xong
                    });
                    const mang = code.split(',');

                    // Thêm nội dung HTML vào chuỗi htmlContent
                    htmlContent += `
                        <div class="qr-item">
                            <img src="${qrDataUrl}" alt="QR Code for ${code}" />
                            <p>${mang[2].substring(3)}</p>
                        </div>
                    `;
                }





                // Chèn nội dung HTML vào tab mới
                newTab.document.write(htmlContent);
                newTab.document.close();

                const script = newTab.document.createElement("script");
                script.textContent = "window.onload = function() { window.print(); }";
                newTab.document.body.appendChild(script);
            }

            async function generateLotQRCodes(item) {
                const newTab = window.open('', '_blank');
                if (!newTab || newTab.closed || typeof newTab.closed == 'undefined') {
                    alert('Tab mới không thể mở. Vui lòng kiểm tra cài đặt popup của trình duyệt.');
                    return;
                }

                let htmlContent = `
                    <html>
                    <head>
                        <style>
                            body {
                                text-align: center;
                                padding: 5px;
                            }
                            p{

                            }
                        </style>
                    </head>
                    <body>
                        <div class="qr-grid">
                            <h4>Khi nhận hàng sử dụng zalo miniapp</h4>
                            <h4>HomeOS IoT Smart để xác nhận</h4>
                `;

                try {
                    // Tạo QR code dưới dạng canvas
                    const canvas = document.createElement('canvas');
                    await QRCode.toCanvas(canvas, item.LOT_NUMBER, { width: 300 });

                    // Chuyển canvas thành ảnh base64
                    const image = canvas.toDataURL('image/png');

                    // Thêm thẻ <img> chứa ảnh QR vào htmlContent
                    htmlContent += `<img src="${image}" alt="QR Code">
                        <p>${item.LOT_NUMBER}</p>
                    `;

                    // Chèn nội dung HTML vào tab mới
                    newTab.document.write(htmlContent);
                    newTab.document.close();

                    // Thêm script để in sau khi nội dung được tải
                    const script = newTab.document.createElement("script");
                    script.textContent = "window.onload = function() { window.print(); }";
                    newTab.document.body.appendChild(script);
                } catch (error) {
                    console.error("Lỗi khi tạo mã QR:", error);
                    alert('Lỗi khi tạo mã QR!');
                }
            }

            async function generateVoucher(item) {
                console.log(item);
                const data = await getDM("https://central.homeos.vn/service_XD/service.svc", "DM_QRCODE", "LOT_ID='" + item.PR_KEY + "'")
                let uniqueClasses = [...new Set(data.data.map(item => item.LOT_CLASS))];
                uniqueClasses.sort();
                console.log(uniqueClasses);

                const groupedData = uniqueClasses.map(cls => {
                    return {
                        LOT_CLASS: cls,
                        items: data.data.filter(item => item.LOT_CLASS === cls)
                    };
                });
                console.log(groupedData);
                const newTab = window.open('', '_blank');
                if (!newTab || newTab.closed || typeof newTab.closed == 'undefined') {
                    alert('Tab mới không thể mở. Vui lòng kiểm tra cài đặt popup của trình duyệt.');
                    return;
                }
                let htmlContent = `
                    <html>
                    <head>
                        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
                        <style>
                            body {
                                font-family: 'Times New Roman', Times, serif;
                            }
                            .header-logo {
                                width: 80px;
                            }
                            .table-bordered td, .table-bordered th {
                                vertical-align: middle;
                            }
                            .text-small {
                                font-size: 0.85rem;
                            }
                            .text-start {
                                font-size: 13px;
                            }
                        </style>
                    </head>
                    <body>
                        <div class="my-4">
                            <div class="row">
                                <div class="col-8 text-center">
                                    <img src="https://homeos.com.vn/storage/photos/logo_1611367959_1716866836.webp" style="width: 150px;" alt="Logo" class="header-logo">
                                    <p class="mt-2">
                                        <strong>CÔNG TY CỔ PHẦN CÔNG NGHỆ HOMEOS VIỆT NAM</strong><br>
                                        Địa chỉ: Số 24, Ngõ 22, Đường Kim Giang, Q. Thanh Xuân, TP Hà Nội
                                    </p>
                                </div>
                                <div class="col-4 text-center" style="margin-top: 30px;">
                                    <p class="text-small"><b>Mẫu số 02 - VT</b></p>
                                    <p class="text-small">(Ban hành theo Thông tư số: 200/2014/TT-BTC ngày 22/12/2014 của Bộ Tài Chính)</p>
                                </div>
                            </div>

                            <div class="text-center my-4">
                                <h4><strong>PHIẾU XUẤT KHO</strong></h4>
                                <p class="text-small m-0"><b>(Kiêm bảo hành)</b></p>
                                <p class="m-0"><strong>Số phiếu: `+ item.LOT_NUMBER + `</strong></p>
                                <p class="m-0"><b><i>Ngày ... tháng ... năm 2025</i></b></p>
                            </div>

                            <p class="m-0" style="font-size: 14px;">- Họ và tên người nhận hàng: CÔNG TY TNHH ĐIỆN CÔNG NGHIỆP KHỞI MINH</p>
                            <p class="m-0" style="font-size: 14px;">- Lý do xuất kho: Xuất bán</p>
                            <p class="m-0" style="font-size: 14px;">- Xuất tại địa điểm: J04 - L02, An Phú Shop Villa, Dương Kinh, Hà Đông, Hà Nội.</p>

                            <table class="table table-bordered text-center mt-2">
                                <thead>
                                    <tr style="font-size: 14px;">
                                        <th>STT</th>
                                        <th>DANH MỤC HÀNG HÓA</th>
                                        <th>ĐVT</th>
                                        <th>SL</th>
                                        <th style="width: 30px;">GHI CHÚ</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td colspan="5" style="text-align: start;"><b>Thiết bị rơ le an toàn phao nước</b></td>
                                    </tr>
                `;
                for (let i = 0; i < groupedData.length; i++) {
                    let danhMuc = '';
                    let number = 0;
                    groupedData[i].items.forEach(element => {
                        number++;
                        const checkQRcode = element.QR_CODE.split(',');

                        if (number == groupedData[i].items.length) {
                            danhMuc += checkQRcode[2].substring(3).replace(/\./g, "");
                        } else {
                            danhMuc += checkQRcode[2].substring(3).replace(/\./g, "") + ', ';
                        }
                    });
                    console.log(danhMuc);
                    htmlContent += `
                    <tr>
                        <td style="font-size: 15px;">`+ groupedData[i].LOT_CLASS + `</td>
                        <td class="text-start">
                            `+ danhMuc + `
                        </td>
                        <td style="font-size: 15px;">Bộ</td>
                        <td style="font-size: 15px;">`+ groupedData[i].items.length + `</td>
                        <td></td>
                    </tr>
                    `

                }
                htmlContent += `
                    </tbody>
                    </table>
                    <p style="font-size: 14px;">Số chứng từ gốc kèm theo:.....................................................................................</p>
                    <div class="row text-center" style="font-size: 14px;">
                        <div class="col-3">
                            <b>Người lập phiếu</b>
                        </div>
                        <div class="col-3">
                            <b>Người nhận hàng</b>
                        </div>
                        <div class="col-3">
                            <b>Thủ kho</b>
                        </div>
                        <div class="col-3">
                            <b>Kế toán</b>
                        </div>
                    </div>
                `


                // Chèn nội dung HTML vào tab mới
                newTab.document.write(htmlContent);
                newTab.document.close();

                const script = newTab.document.createElement("script");
                script.textContent = "window.onload = function() { window.print(); }";
                const script1 = newTab.document.createElement("script");
                script1.src = "https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js";
                newTab.document.body.appendChild(script1);
                newTab.document.body.appendChild(script);
            }

            function updateTranNo(result, tableName, tranNo, lengthKey) {
                const willInsertData = {
                    PR_KEY: 15,
                    TABLE_NAME: tableName,
                    TRAN_NO: tranNo,
                    ORGANIZATION_ID: '',
                    AUTO_KEY: result,
                    LENGTH_KEY: lengthKey,
                    DATASTATE: "EDIT",
                };
                console.log(willInsertData);
                add(user_id, session, 'SYS_TRAN_NO', willInsertData)
            }

            async function addItemHistoryWarranty(QRID, dataQR) {
                const data = await getDM("https://central.homeos.vn/service_XD/service.svc", 'WARRANTY_ERROR', "QRCODE_ID='" + QRID + "'");
                const data_lot = await getDM("https://central.homeos.vn/service_XD/service.svc", 'WARRANTY_LOT', "PR_KEY='" + dataQR[0].LOT_ID + "'");
                let dataWarranty = data.data.filter(item => item.GROUP_ID === 0);
                let dataWarrantyGroup = data.data.filter(item => item.GROUP_ID !== 0);
                if (localStorage.getItem('RoleUser') == "GUEST") {
                    dataWarranty = data.data.filter(item => item.TYPE !== "ADD");
                }
                if (dataWarranty.length > 0) {
                    listWarrantyHistory.empty();
                    for (let i = 0; i < dataWarranty.length; i++) {
                        let element = '';
                        const CheckGroupWarranty = dataWarrantyGroup.filter(item => item.GROUP_ID == dataWarranty[i].PR_KEY);
                        let itemElement = '';
                        const [dateALL, timeALL] = dataWarranty[i].DATE_CREATE.split('T');
                        if (CheckGroupWarranty.length > 0) {
                            for (let i = 0; i < CheckGroupWarranty.length; i++) {
                                const [date, time] = CheckGroupWarranty[i].DATE_CREATE.split('T');
                                let nameClass;
                                if (CheckGroupWarranty[i].ERROR_STATUS == 1) {
                                    nameClass = 'badge-warning';
                                } else if (CheckGroupWarranty[i].ERROR_STATUS == 2) {
                                    nameClass = 'badge-danger';
                                } else if (CheckGroupWarranty[i].ERROR_STATUS == 3) {
                                    nameClass = 'badge-success';
                                }
                                itemElement += '<div class="vertical-timeline-item vertical-timeline-element">' +
                                    '<div>' +
                                    '<span class="vertical-timeline-element-icon bounce-in">' +
                                    '<i class="badge badge-dot badge-dot-xl ' + nameClass + '"> </i>' +
                                    '</span>' +
                                    '<div class="vertical-timeline-element-content bounce-in">' +
                                    '<h4 class="timeline-title">' + CheckGroupWarranty[i].ERROR_NAME + '</h4>' +
                                    '<p>' + CheckGroupWarranty[i].DESCRIPTION + '</p>' +
                                    '<span class="vertical-timeline-element-date">' + date + '</span>' +
                                    '<span class="vertical-timeline-element-dateTime">' + time + '</span>' +
                                    '</div>' +
                                    '</div>' +
                                    '</div>'
                            }
                        }

                        if (dataWarranty[i].TYPE == "ERROR") {
                            element += '<li class="parent-item">' +
                                '<button class="toggle-button">' +
                                '<div>' +
                                '<h4 style="margin: 0;">' +
                                '<svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" style="color: #cd5757;" fill="currentColor" class="bi bi-exclamation-triangle" viewBox="0 0 16 16">' +
                                '<path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.15.15 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.2.2 0 0 1-.054.06.1.1 0 0 1-.066.017H1.146a.1.1 0 0 1-.066-.017.2.2 0 0 1-.054-.06.18.18 0 0 1 .002-.183L7.884 2.073a.15.15 0 0 1 .054-.057m1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767z"/>' +
                                '<path d="M7.002 12a1 1 0 1 1 2 0 1 1 0 0 1-2 0M7.1 5.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0z"/>' +
                                '</svg>' +
                                ' Bảo hành' +
                                '</h4>' +
                                '<p style="margin: 1px 0 0 0; font-size: 14px; font-weight: 300;">' + dataWarranty[i].ERROR_NAME + '</p>' +
                                '<p style="margin: 1px 0 0 0; font-size: 14px; font-weight: 300;">' + dateALL + ' ' + timeALL + '</p>' +
                                '</div>' +
                                '<span class="arrow-icon expanded" style="transform: rotate(90deg);">▶</span>' +
                                '</button>' +
                                '<ul class="child-list" style="display: none;">' +
                                '<div class="vertical-timeline vertical-timeline--animate vertical-timeline--one-column">' +
                                '<div class="vertical-timeline-item vertical-timeline-element">' +
                                '<div>' +
                                '<span class="vertical-timeline-element-icon bounce-in">' +
                                '<i class="badge badge-dot badge-dot-xl badge-warning"> </i>' +
                                '</span>' +
                                '<div class="vertical-timeline-element-content bounce-in">' +
                                '<h4 class="timeline-title">Báo lỗi sản phẩm</h4>' +
                                '<p>' + dataWarranty[i].DESCRIPTION + '</p>' +
                                '<span class="vertical-timeline-element-date">' + dateALL + '</span>' +
                                '<span class="vertical-timeline-element-dateTime">' + timeALL + '</span>' +
                                '</div>' +
                                '</div>' +
                                '</div>' +
                                itemElement +
                                '</div>' +
                                '</ul>' +
                                '</li>'
                        } else {
                            element += '<li class="parent-item">' +
                                '<button class="toggle-button">' +
                                '<div>' +
                                '<h4 style="margin: 0;">' +
                                '<svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" style="color: #27c527;" fill="currentColor" class="bi bi-check-circle" viewBox="0 0 16 16">' +
                                '<path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>' +
                                '<path d="m10.97 4.97-.02.022-3.473 4.425-2.093-2.094a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05"/>' +
                                '</svg>' +
                                ' ' + dataWarranty[i].ERROR_NAME +
                                '</h4>' +
                                '<p style="margin: 1px 0 0 0; font-size: 14px; font-weight: 300;">Sản phẩm thuộc: ' + data_lot.data[0].LOT_NUMBER + '</p>' +
                                '<p style="margin: 1px 0 0 0; font-size: 14px; font-weight: 300;">' + dateALL + ' ' + timeALL + '</p>' +
                                '</div>' +
                                '</button>' +
                                '</li>'
                        }
                        const $element = $(element);

                        $element.find('.toggle-button').on('click', function (e) {
                            e.preventDefault(); // Ngăn chặn hành động mặc định của thẻ <a>

                            // Lấy danh sách con gần nhất (nếu có)
                            const childList = $(this).siblings(".child-list");

                            // Toggle hiển thị/ẩn danh sách con
                            childList.slideToggle(200);

                            // Xoay icon mũi tên
                            const arrowIcon = $(this).find(".arrow-icon");
                            arrowIcon.toggleClass("expanded");

                            if (arrowIcon.hasClass("expanded")) {
                                arrowIcon.css("transform", "rotate(90deg)");
                            } else {
                                arrowIcon.css("transform", "rotate(0deg)");
                            }
                        });

                        listWarrantyHistory.append($element);
                    }
                }

            }

            async function addItemLotproduct() {
                const data = await getDM("https://central.homeos.vn/service_XD/service.svc", 'WARRANTY_LOT', "1=1");
                listLotProduct.empty();
                data.data.forEach(item => {
                    let element = '';
                    const [dateALL, timeALL] = item.DATE_CREATE.split('T');
                    element += '<div class="col-12" style="padding: 5px 10px;">' +
                        '<div id="PickApp-button-mua" class="iconApp">' +
                        '<div class="info-box-content">' +
                        '<div class="d-flex justify-content-between">' +
                        '<span class="app-text-number">' + item.LOT_NUMBER + '</span>' +
                        '</div>' +
                        '<span class="app-text">' + dateALL + ' ' + timeALL + '</span>' +
                        '</div>' +
                        '<button class="icon QRlot-button" style="background-color: #17a2b8; margin-right: 10px; box-shadow: 0 0 1px rgba(0, 0, 0, .125), 0 1px 3px rgba(0, 0, 0, .2); border: none; ">' +
                        '<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" style="color: #fff" fill="currentColor" class="bi bi-qr-code" viewBox="0 0 16 16">' +
                        '<path d="M2 2h2v2H2z"/>' +
                        '<path d="M6 0v6H0V0zM5 1H1v4h4zM4 12H2v2h2z"/>' +
                        '<path d="M6 10v6H0v-6zm-5 1v4h4v-4zm11-9h2v2h-2z"/>' +
                        '<path d="M10 0v6h6V0zm5 1v4h-4V1zM8 1V0h1v2H8v2H7V1zm0 5V4h1v2zM6 8V7h1V6h1v2h1V7h5v1h-4v1H7V8zm0 0v1H2V8H1v1H0V7h3v1zm10 1h-1V7h1zm-1 0h-1v2h2v-1h-1zm-4 0h2v1h-1v1h-1zm2 3v-1h-1v1h-1v1H9v1h3v-2zm0 0h3v1h-2v1h-1zm-4-1v1h1v-2H7v1z"/>' +
                        '<path d="M7 12h1v3h4v1H7zm9 2v2h-3v-1h2v-1z"/>' +
                        '</svg>' +
                        '</button>' +
                        '<button class="icon print-button" style="background-color: #17a2b8; box-shadow: 0 0 1px rgba(0, 0, 0, .125), 0 1px 3px rgba(0, 0, 0, .2); border: none; ">' +
                        '<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" style="color: #fff" fill="currentColor" class="bi bi-printer" viewBox="0 0 16 16">' +
                        '<path d="M2.5 8a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1"/>' +
                        '<path d="M5 1a2 2 0 0 0-2 2v2H2a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h1v1a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-1h1a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-1V3a2 2 0 0 0-2-2zM4 3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v2H4zm1 5a2 2 0 0 0-2 2v1H2a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v-1a2 2 0 0 0-2-2zm7 2v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1"/>' +
                        '</svg>' +
                        '</button>' +
                        '</div>' +
                        '</div>'

                    const $element = $(element);

                    $element.find('.print-button').on('click', function (e) {
                        e.preventDefault();
                        generateVoucher(item);
                    });

                    $element.find('.QRlot-button').on('click', function (e) {
                        e.preventDefault();
                        generateLotQRCodes(item);
                    });
                    listLotProduct.append($element);
                });
            }

            function addItemWarranty(check) {
                if (check == 'condition') {
                    let ConditionItems = JSON.parse(localStorage.getItem('dataCondition'));

                    console.log('1:', ConditionItems);
                    if (ConditionItems && ConditionItems.length > 0) {
                        historyListDetail.empty()
                        ConditionItems.forEach(item => {

                            const element = $(
                                '<div class="iconApp">' +
                                '<div id="App' + item.CodeCondition + '" class="icon" style="background-color: #28a745 !important; display: block">' +
                                '<img style="width: 70px; height: 70px; object-fit: cover; border-radius: .25rem; margin: 0;" src="' + item.imgCondition + '" alt="">' +
                                '</div>' +
                                '<div class="info-box-content" style="padding-right: 0">' +
                                '<div class="d-flex justify-content-between">' +
                                '<span class="app-text">' + item.CodeCondition + '</span>' +
                                '<span class="app-text" style="padding-right: 0">' + item.date.substring(0, 11) + '</span>' +
                                '</div>' +
                                '<span class="app-text-number" style="padding-right: 0">' + item.NameCondition + '</span>' +
                                '</div>' +
                                '</div>'
                            );
                            // Tạo phần tử bao bọc với nút X
                            const totalElement = $(
                                '<div style="padding-bottom: 13px; position: relative;" class="history-item" data-code="' + item.CodeCondition + '">' +
                                '<div class="close-icon">' +
                                '<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-x" viewBox="0 0 16 16">' +
                                '<path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>' +
                                '</svg>' +
                                '</div>' +
                                '</div>'
                            );

                            // Thêm phần tử chính vào phần tử bao bọc
                            totalElement.append(element);

                            // Gắn sự kiện click cho nút X
                            totalElement.find('.close-icon').on('click', function (e) {
                                e.stopPropagation(); // Ngăn chặn sự kiện click lan đến phần tử chính

                                // Hiển thị popup xác nhận
                                const confirmDelete = confirm(`Bạn có chắc chắn muốn xóa tủ điều khiển "${item.NameCondition}" khỏi phần lịch sử?`);
                                if (confirmDelete) {
                                    totalElement.remove(); // Xóa phần tử nếu người dùng chọn "Có"
                                    ConditionItems = ConditionItems.filter(i => i.CodeCondition !== item.CodeCondition);
                                    localStorage.setItem('dataCondition', JSON.stringify(ConditionItems));
                                    toastr.success(`tủ "${item.CodeCondition}" đã bị xóa!`);
                                    if (ConditionItems.length == 0) {
                                        showAddWorkStationButton(); // Ẩn nút nếu có ít nhất 1 phần tử
                                    }
                                }
                            });

                            // Gắn sự kiện click cho phần tử chính
                            element.on('click', function () {
                                accessDevice(item.CodeCondition, 'DK');
                                document.getElementById("history").classList.add("hidden");
                            });

                            // Thêm phần tử vào danh sách lịch sử

                            historyListDetail.append(totalElement);
                        });
                    }
                } else {
                    warrantyItems = JSON.parse(localStorage.getItem('dataWarranty'));

                    console.log(warrantyItems);
                    if (warrantyItems && warrantyItems.length > 0) {
                        historyListDetail.empty()
                        warrantyItems.forEach(item => {

                            const element = $(
                                '<div class="iconApp">' +
                                '<div id="App' + item.CodeWarranty + '" class="icon" style="background-color: #28a745 !important; display: block">' +
                                '<img style="width: 100%; height: 100%; object-fit: cover; border-radius: .25rem; margin: 0;" src="' + item.imgWarranty + '" alt="">' +
                                '</div>' +
                                '<div class="info-box-content" style="padding-right: 0">' +
                                '<div class="d-flex justify-content-between">' +
                                '<span class="app-text">' + item.CodeWarranty + '</span>' +
                                '<span class="app-text" style="padding-right: 0">' + item.date.substring(0, 11) + '</span>' +
                                '</div>' +
                                '<span class="app-text-number" style="padding-right: 0">' + item.NameWarranty + '</span>' +
                                '</div>' +
                                '</div>'
                            );
                            // Tạo phần tử bao bọc với nút X
                            const totalElement = $(
                                '<div style="padding-bottom: 13px; position: relative;" class="history-item" data-code="' + item.CodeWarranty + '">' +
                                '<div class="close-icon">' +
                                '<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-x" viewBox="0 0 16 16">' +
                                '<path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>' +
                                '</svg>' +
                                '</div>' +
                                '</div>'
                            );

                            // Thêm phần tử chính vào phần tử bao bọc
                            totalElement.append(element);

                            // Gắn sự kiện click cho nút X
                            totalElement.find('.close-icon').on('click', function (e) {
                                e.stopPropagation(); // Ngăn chặn sự kiện click lan đến phần tử chính

                                // Hiển thị popup xác nhận
                                const confirmDelete = confirm(`Bạn có chắc chắn muốn xóa sản phẩm "${item.NameWarranty} [${item.CodeWarranty}]" khỏi phần lịch sử?`);
                                if (confirmDelete) {
                                    totalElement.remove(); // Xóa phần tử nếu người dùng chọn "Có"
                                    warrantyItems = warrantyItems.filter(i => i.CodeWarranty !== item.CodeWarranty);
                                    localStorage.setItem('dataWarranty', JSON.stringify(warrantyItems));
                                    toastr.success(`Trạm "${item.CodeWarranty}" đã bị xóa!`);
                                    if (warrantyItems.length == 0) {
                                        showAddWorkStationButton(); // Ẩn nút nếu có ít nhất 1 phần tử
                                    }
                                }
                            });

                            // Gắn sự kiện click cho phần tử chính
                            element.on('click', function () {
                                accessDevice(item.CodeWarranty.substring(2));
                                document.getElementById("history").classList.add("hidden");
                            });

                            // Thêm phần tử vào danh sách lịch sử

                            historyListDetail.append(totalElement);
                        });
                    }
                }
            }

            $("#warranty-detail").click(async function () {
                var inputValue = document.getElementById("warranty_QR").value;
                if (checkApp == 'GUA') {
                    accessDevice(inputValue);
                } else {
                    accessDevice(inputValue, 'DK');
                }
            })

            async function accessDevice(inputValue, check) {
                console.log(inputValue.length);

                if (inputValue == null || inputValue == "") {
                    toastr.error("Vui lòng nhập mã QRcode!");
                } else {
                    let dataWarranty = [];
                    const dataQRcode = await getDM("https://central.homeos.vn/service_XD/service.svc", "DM_QRCODE", "1=1")
                    const matchedItem = dataQRcode.data.find(item =>
                        item.QR_CODE.slice(-inputValue.length).replace(/\./g, '') === inputValue.replace(/\./g, '')
                    );
                    console.log(dataQRcode);

                    if (matchedItem != undefined) {
                        dataWarranty.push(matchedItem);
                    }
                    if (dataWarranty.length == 1) {
                        if (check == 'DK') {
                            $("#loading-popup").show()
                            let checkQRcode = dataWarranty[0].QR_CODE.split(',');
                            const dataQRCondition = await getDataMDQRcode(dataWarranty[0].QR_CODE.replaceAll(',', '$'));
                            localStorage.setItem("itemCondition", JSON.stringify(dataQRCondition));
                            document.getElementById("condition").classList.remove("hidden");
                            document.getElementById("history").classList.add("hidden");
                            document.getElementById("ScanQRWarranty").classList.add("hidden");
                            document.getElementById("header-conditionName").textContent = dataQRCondition[0].PRODUCT_NAME + "[" + checkQRcode[3] + "]";

                            getWebSocket("homeos.vn:447");
                        } else {

                            $("#loading-popup").show()
                            let checkQRcode = dataWarranty[0].QR_CODE.split(',');
                            const dataQRProduct = await getDataMDQRcode(dataWarranty[0].QR_CODE.replaceAll(',', '$'));
                            document.getElementById("result-product").classList.remove("d-none");
                            document.getElementById("result-form-loading").classList.add("d-none");
                            document.getElementById("result-form").classList.remove("d-none");
                            // document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
                            document.getElementById("result-product-truycap").disabled = false;
                            document.getElementById("result-form-productName").value = checkQRcode[1];
                            document.getElementById("result-form-productCode").value = checkQRcode[2].substring(1);
                            document.getElementById("header-productName").textContent = checkQRcode[1] + " - " + checkQRcode[2].substring(1);
                            changeDataWarranty(dataQRProduct);
                            DetailProduct();
                        }

                    } else {
                        toastr.error("Sản phẩm không tồn tại hoặc chưa được thêm vào hệ thống")
                    }
                }
            }

            function WarrantyCheckUser(ROLE) {
                switch (ROLE) {
                    case "GUEST":
                        $(".warranty_scansQRcode").addClass("d-none");
                        // document.getElementById('result-product-warranty').classList.add('hidden');
                        $("#lotProduct").addClass("d-none");
                        $(".warranty_lot").addClass("d-none");
                        break;
                    case "DISTRIBUTIVE":
                        // $("#lotProduct").add("d-none");
                        $(".warranty_lot").addClass("d-none");
                        $(".warranty_scansQRcode").addClass("d-none");
                        break;
                    default:
                        break;
                }
            }
            //-----------------------------------------------------------------------------------------------------------
            // code điều khiển 

            changeColorbutton = async function (id, color, Status) {
                //console.log(id, Status);
                if (Status == 2) {
                    if ($('#' + id).css('background-color') == 'rgb(0, 0, 0)') {
                        $('#' + id).css('background', color);
                        $('#' + id).css('box-shadow', '0px 0px 30px 5px' + color);
                    } else {
                        $('#' + id).css('background', '#000000');
                        $('#' + id).css('box-shadow', '0px 0px 30px 5px #000000');
                    }
                } else if (Status == 0) {
                    //console.log(id, color, Status);
                    $('#' + id).css('background', '#000000');
                    $('#' + id).css('box-shadow', '0px 0px 30px 5px #000000');
                } else if (Status == 1) {
                    //console.log(id, color, Status);
                    $('#' + id).css('background', color);
                    $('#' + id).css('box-shadow', '0px 0px 30px 5px' + color);
                }
            }

            var ws = null;
            var wss = null;
            var timeoutHandle;
            var intervalId = null;
            const relayTimeouts = {};
            var cabinetID;
            getWebSocket = async function (value) {
                const dataItemcabinet = JSON.parse(localStorage.getItem('itemCondition'));
                const dataDevice = await getDM("https://central.homeos.vn/service_XD/service.svc", "ZALO_LINKED_QRCODE", "ACTIVE = 1 AND QRCODE_ID = " + dataItemcabinet[0].PR_KEY + "" );
                const QRcode = dataItemcabinet[0].QR_CODE.split(',');
                document.getElementById("header-conditionName").textContent = dataDevice.data[0].NAME_DEVICE + "[" + QRcode[3] + "]";
                cabinetID = QRcode[3];
                await renderReray(dataItemcabinet[0].QR_CODE);
                await createElectricityMeter(dataItemcabinet[0].QR_CODE, dataDevice.data[0].NAME_CHANNEL);
                runLed7();
                
                try {
                    ws = new WebSocket("wss://" + value + "/findme");
                    // ws = new WebSocket("wss://" + value + "/forwarding");
                    ws.onopen = function () {
                        // w.send("10eba031-2203-4105-b80b-04b675dfe576");
                        ws.send("Website/" + cabinetID + "/00d37cb1-eee8-42ce-9564-91687f9de0dd");
                    };
                    ws.onmessage = function (data) {
                        var txt = data.data;
                        
                        let checkValue = txt.split(":");
                        if (checkValue[0] == cabinetID) {
                            clearTimeout(timeoutHandle);
                            timeoutHandle = setTimeout(noDataReceived, 120000);
                            $('#power').css('background', '#d41c1f');
                            $('#power').css('box-shadow', '0px 0px 30px 5px' + '#d41c1f');
                            $("#cboDeviceServer").empty();
                            $("#listDevice").empty();
                            let checkLogin = true;
                            if (txt != "NOT FOUND") {
                                // console.log(txt);
                                
                                if (txt.slice(cabinetID.length+1, cabinetID.length+4) == 'T:2') {
                                    if (intervalId) {
                                        clearInterval(intervalId);
                                        intervalId = null;
                                    }
                                    
                                    let temp = txt.split(",");
                                    // document.getElementById("setDateCondition").textContent = temp[0].slice(11, 22);
                                    document.getElementById("setDateTimeCondition").textContent = temp[0].substring(cabinetID.length+3);
                                    document.getElementById("statusCabinet").textContent = 'Online';
                                    $('#online').css('background', '#ceac30');
                                    $('#online').css('box-shadow', '0px 0px 30px 5px' + '#ceac30');
                                    if (temp[temp.length - 1].slice(0, 2) == 'RL') {
                                        let number = parseInt(temp[temp.length - 1].substring(3));

                                        // ✅ Lấy số relay từ QRcode[2], ví dụ "3K" hoặc "6K"
                                        let relayCount = parseInt(QRcode[2]); // "3K" → 3, "6K" → 6

                                        // ✅ Chuyển sang nhị phân, thêm số 0 ở đầu nếu thiếu
                                        let binary = number.toString(2).padStart(relayCount, '0');

                                        // ✅ Tách thành mảng, đảo ngược để tương ứng với K1, K2,...
                                        let binaryArray = binary.split('').reverse();
                                        console.log(binaryArray);
                                        
                                        // ✅ Áp dụng trạng thái cho từng relay
                                        for (let i = 0; i < relayCount; i++) {
                                            const icon = document.getElementById("icon-Relay_" + (i + 1));

                                            if (binaryArray[i] === '1') {
                                                $('#Relay_' + (i + 1)).css('background', '#08ed0a');
                                                $('#Relay_' + (i + 1)).css('box-shadow', '0px 0px 30px 5px #08ed0a');
                                            } else {
                                                $('#Relay_' + (i + 1)).css('background', '#000000');
                                                $('#Relay_' + (i + 1)).css('box-shadow', '0px 0px 30px 5px #000000');
                                            }

                                            resetIcon(icon, 'Relay_' + (i + 1));
                                        }
                                    } else {
                                        // let temp2 = txt.split("T:2");
                                        if (temp[temp.length - 1].slice(0, 2) == 'E:') {
                                            updateDataLed(txt, "testResizableArray");
                                        }
                                    }
                                }
                            } else {
                                $("#cboDeviceServer").append(
                                    $("<option>", {
                                        value: txt,
                                        text: txt,
                                    })
                                );
                                $("#btnAccessDevice").prop("disabled", true);
                            }
                        }
                        // w.close();
                        // "ws://"+$("#txtDNSServer").val() + "/forwarding"
                    };
                    wss = new WebSocket("wss://" + value + "/controller");
                    wss.onopens = function () {
                        // w.send("10eba031-2203-4105-b80b-04b675dfe576");
                        wss.send("Website/" + cabinetID + "/00d37cb1-eee8-42ce-9564-91687f9de0dd");
                    };
                    // var checkOnOff = 'ON';
                    setTimeout(() => {
                        let cmd = [{ CHIP_ID: cabinetID, COMMAND: 'REFRESH;' }];
                        wss.send(JSON.stringify(cmd));
                        
                    }, 500);
                    $("#loading-popup").hide();
                    saveCondition(JSON.parse(localStorage.getItem('itemCondition')));
                } catch (e) {
                    // alert("Máy chủ " + $("#txtDNSServer").val() + " hiện đang tắt.!");
                }
            };

            const renderReray = async function (data) {
                return new Promise((resolve) => {
                    const typeMatch = data.match(/(\d+)K-(\d+)TB/i);
                    const numberOfRelays = typeMatch ? parseInt(typeMatch[1]) : 0;
                    const numberOfMeters = typeMatch ? parseInt(typeMatch[2]) : 0;

                    const container = document.getElementById('relay-container');
                    container.innerHTML = '';

                    for (let i = 1; i <= numberOfRelays; i++) {
                        console.log("OK");
                        
                        const relayDiv = `
                            <div class="col-4 d-flex flex-column align-items-center">
                                <div id="Relay_${i}"
                                    class="bs-icon-xl bs-icon-circle d-flex flex-shrink-0 justify-content-center align-items-center d-inline-block bs-icon xl pb-2"
                                    style="background: #000000;box-shadow: 0px 0px 30px 5px #000000;border: 1px solid;width: 70px;height: 70px;border-radius: 50%;">
                                    <button id="btn-Relay_${i}" class="btn btn-primary buttonClickWater p-0 m-0"
                                        onclick="onOffRelay('Relay_${i}', '#08ed0a')" type="button"
                                        style="background-color: initial;border: none;font-size: 35px; outline: none; box-shadow: none;">
                                        <svg id="icon-Relay_${i}" class="bi bi-power" xmlns="http://www.w3.org/2000/svg"
                                            width="1em" height="1em" fill="currentColor" viewBox="0 0 16 16">
                                            <path d="M7.5 1v7h1V1z"></path>
                                            <path
                                                d="M3 8.812a4.999 4.999 0 0 1 2.578-4.375l-.485-.874A6 6 0 1 0 11 3.616l-.501.865A5 5 0 1 1 3 8.812">
                                            </path>
                                        </svg>
                                    </button>
                                </div>
                                <span>K${i}</span>
                            </div>
                        `;
                        container.insertAdjacentHTML('beforeend', relayDiv);
                    }

                    // Hoàn thành render
                    resolve();
                });
            };

            
            var noDataReceived = function () {
                $('#online').css('background', '#000000');
                $('#online').css('box-shadow', '0px 0px 30px 5px #000000');
                document.getElementById("statusCabinet").textContent = 'Offline';
                intervalId = setInterval(() => {
                    onClose();
                    getWebSocket("homeos.vn:447");
                }, 10000);
            }

            $("#online").click(function () {
                let cmd = [{ CHIP_ID: cabinetID, COMMAND: 'REFRESH;' }];
                wss.send(JSON.stringify(cmd));
            })

            function formatCustomDate(date) {
                const pad = (num) => num.toString().padStart(2, '0');

                const year = date.getFullYear();
                const month = pad(date.getMonth() + 1);
                const day = pad(date.getDate());
                const hour = pad(date.getHours());
                const minute = pad(date.getMinutes());
                const second = pad(date.getSeconds());

                return `${year}-${month}-${day}T${hour}$${minute}$${second}`;
            }

            $("#ElectricityMeter-1").click(async function () {
                $("#title-condition-popup").text("Biểu đồ điện năng thiết bị 1");
                $("#chartCondition-popup").show();
                const now = new Date();
                const formattedNow = formatCustomDate(now);

                const oneHourAgo = new Date(now.getTime() - 60 * 60 * 1000);
                const formattedOneHourAgo = formatCustomDate(oneHourAgo);

                const data = await getDataChartCondition(formattedOneHourAgo, formattedNow, 1)
                createChartDataCondition(data)
            });

            $("#ElectricityMeter-2").click(async function () {
                $("#title-condition-popup").text("Biểu đồ điện năng thiết bị 2");
                $("#chartCondition-popup").show();
                const now = new Date();
                const formattedNow = formatCustomDate(now);

                const oneHourAgo = new Date(now.getTime() - 60 * 60 * 1000);
                const formattedOneHourAgo = formatCustomDate(oneHourAgo);

                const data = await getDataChartCondition(formattedOneHourAgo, formattedNow, 2)
                createChartDataCondition(data)
            });

            $("#ElectricityMeter-3").click(async function () {
                $("#title-condition-popup").text("Biểu đồ điện năng thiết bị 3");
                $("#chartCondition-popup").show();
                const now = new Date();
                const formattedNow = formatCustomDate(now);

                const oneHourAgo = new Date(now.getTime() - 60 * 60 * 1000);
                const formattedOneHourAgo = formatCustomDate(oneHourAgo);

                const data = await getDataChartCondition(formattedOneHourAgo, formattedNow, 3)
                createChartDataCondition(data)
            });



            $("#schedule-condition").click(function () {
                // $("#title-condition-popup").text("Biểu đồ điện năng pha 3");
                $("#schedule-condition-popup").show();
                // initCharts()
            });
            $("#error-condition").click(function () {
                // $("#title-condition-popup").text("Biểu đồ điện năng pha 3");
                $("#error-condition-popup").show();
                // initCharts()
            });

            $("#export-condition").click(function () {
                checkReport = 'condition';
                $("#filter-kttv").addClass("d-none");
                $("#filter-condition").removeClass("d-none");
                $("#export-condition-popup").show();
            });

            $("#export-kttv").click(function () {
                checkReport = 'KTTV';
                getDevicefilter("KTTV");
                $("#filter-kttv").removeClass("d-none");
                $("#filter-condition").addClass("d-none");
                $("#export-condition-popup").show();
            });

            $("#settingAlert").click(function () {
                // if(DataUser){
                    getDevicefilter();
                    $("#alert-kttv-popup").show(); 
                // } else {
                //     toastr.error("Vui lòng liên kết tài khoản Zalo để sử dụng chức năng này.");
                // }
                
            });



            onOffRelay = function (id, color) {
                const icon = document.getElementById("icon-" + id);
                let checkID = parseInt(id.substring(6));
                if ($('#' + id).css('background-color') == 'rgb(0, 0, 0)') {
                    $('#' + id).css('background', '#ceac30');
                    $('#' + id).css('box-shadow', '0px 0px 30px 5px' + '#ceac30');
                    $('#btn-' + id).prop('disabled', true)
                    icon.innerHTML = `
                        <path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2z"/>
                        <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466"/>
                    `;
                    $('#icon-' + id).addClass("spin-loading");
                    let cmd = [{ CHIP_ID: cabinetID, COMMAND: 'CALL BATCH LGS_ON_' + checkID + ';' }];
                    wss.send(JSON.stringify(cmd));
                    relayTimeouts[id] = setTimeout(() => {
                        if ($('#' + id).css('background-color') == 'rgb(206, 172, 48)') {
                            $('#' + id).css('background', '#000000');
                            $('#' + id).css('box-shadow', '0px 0px 30px 5px #000000');
                            $('#btn-' + id).prop('disabled', false)
                        }
                        resetIcon(icon);
                    }, 5000);
                } else {
                    $('#' + id).css('background', '#ceac30');
                    $('#' + id).css('box-shadow', '0px 0px 30px 5px' + '#ceac30');
                    $('#btn-' + id).prop('disabled', true);
                    icon.innerHTML = `
                        <path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2z"/>
                        <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466"/>
                    `;
                    $('#icon-' + id).addClass("spin-loading");
                    // let cmd = [{ CHIP_ID: '12929152', COMMAND: 'SEND CAN(17 0 0 0 41 '+ (checkID+6) +');' }]; 
                    let cmd = [{ CHIP_ID: cabinetID, COMMAND: 'CALL BATCH LGS_OFF_' + (checkID) + ';' }];
                    wss.send(JSON.stringify(cmd));
                    // ws.send('12929152:SEND CAN(17 0 0 0 41 '+ (checkID+6) +');')
                    relayTimeouts[id] = setTimeout(() => {
                        if ($('#' + id).css('background-color') == 'rgb(206, 172, 48)') {
                            $('#' + id).css('background', '#08ed0a');
                            $('#' + id).css('box-shadow', '0px 0px 30px 5px' + '#08ed0a');
                            $('#btn-' + id).prop('disabled', false)
                        }
                        resetIcon(icon);
                    }, 5000);
                }
            }

            function resetIcon(icon, id) {
                icon.innerHTML = `
                    <path d="M7.5 1v7h1V1z"></path>
                    <path d="M3 8.812a4.999 4.999 0 0 1 2.578-4.375l-.485-.874A6 6 0 1 0 11 3.616l-.501.865A5 5 0 1 1 3 8.812"></path>
                `;
                $('#btn-' + id).prop('disabled', false);
                icon.classList.remove("spin-loading");
            }

            // var updateDataLed = function (dataString, id) {
            //     // Xóa ký tự xuống dòng và khoảng trắng dư thừa
            //     dataString = dataString.trim();

            //     // Chuyển chuỗi dữ liệu thành object
            //     var dataObj = {};
            //     dataString.split(",").forEach(function (item) {
            //         var parts = item.split(":");
            //         if (parts.length === 2) {
            //             dataObj[parts[0]] = formatNumber(Number(parts[1])); // Lưu vào object với key:value
            //         }
            //     });
            //     // Cập nhật giá trị cho từng màn hình LED
            //     var keys = ["U", "P", "I", "E"];

            //     keys.forEach(function (key, index) {
            //         var fullId = index === 0 ? `#${id + dataObj["ID"]}` : `#${id + dataObj["ID"]}-${index}`;
            //         $(fullId).sevenSegArray({ value: dataObj[key] || "0" });
            //     });
            // };
            var updateDataLed = function (dataString, idPrefix) {
                // Xóa dòng trắng và tách thành từng dòng
                const lines = dataString.trim().split("\n");

                lines.forEach(function (line) {
                    const dataObj = {};
                    line.split(",").forEach(function (item) {
                        const parts = item.split(":");
                        if (parts.length === 2) {
                            dataObj[parts[0]] = parts[1];
                        }
                    });

                    // Bỏ qua nếu không có ID hoặc NO
                    if (!dataObj["ID"] || !dataObj["NO"]) return;

                    // Tính toán lại chỉ số thiết bị toàn cục (global)
                    const localId = parseInt(dataObj["ID"]);
                    const nodeOffset = (parseInt(dataObj["NO"]) - 31) * 3;
                    const globalId = nodeOffset + localId;

                    // Format các giá trị số
                    const valueU = formatNumber(Number(dataObj["U"] || 0));
                    const valueP = formatNumber(Number(dataObj["P"] || 0));
                    const valueI = formatNumber(Number(dataObj["I"] || 0));
                    const valueE = formatNumber(Number(dataObj["E"] || 0));

                    // Cập nhật từng màn hình LED tương ứng
                    const keys = [valueU, valueP, valueI, valueE];

                    keys.forEach(function (value, index) {
                        const fullId = index === 0
                            ? `#${idPrefix}${globalId}`
                            : `#${idPrefix}${globalId}-${index}`;
                        $(fullId).sevenSegArray({ value: value });
                    });
                });
            };

            function formatNumber(num) {
                const integerPartLength = Math.floor(num).toString().length;
                
                let decimalPlaces = 3; // Mặc định
                if (integerPartLength === 3) {
                    decimalPlaces = 2;
                } else if (integerPartLength === 2) {
                    decimalPlaces = 3;
                } else if (integerPartLength === 1) {
                    decimalPlaces = 3;
                } else {
                    decimalPlaces = 1;
                }

                return Number(num.toFixed(decimalPlaces));
            }

            function runLed7() {
                (function ($) {

                    var numberSegments = [0x3F, 0x06, 0x5B, 0x4F, 0x66, 0x6D, 0x7D, 0x07, 0x7F, 0x6F]; //http://en.wikipedia.org/wiki/Seven-segment_display

                    // Default CSS styles. If you don't specify your own CSS or discrete color options, this is what gets used.
                    // 
                    $("<style type='text/css'>"
                        + ".sevenSeg-svg {fill: #320000; overflow: hidden; stroke-width: 0; height: 100%; width: 100%; background-color: Black}"
                        + ".sevenSeg-segOn {fill: Red}"
                        + "</style>")
                        .prependTo("head");

                    $.widget("bw.sevenSeg", {

                        options: {
                            /**
                            This option controls the display value on the 7seg.  Set this to the numeric digit you
                            want displayed.
                            */
                            value: null,

                            /**
                            Override the default segment on color (Red).  
                            Note: You can alternatively define a CSS style for the class.sevenSeg-segOn that specifies a 'fill' color.
                            */
                            colorOn: null,

                            /**
                            Override the default segment off color (#320000).  
                            Note: You can alternatively define a CSS style for the class .sevenSeg-svg that specifies a 'fill' color.
                            */
                            colorOff: null,

                            /**
                            Override the default background color of the display (Black).  
                            Note: You can alternatively define a CSS style for the class .sevenSeg-svg that specifies a 'background-color' color.
                            */
                            colorBackground: null,

                            /**
                            This option allows skewing the segments to create a slant effect.
                            Note: Setting "transform: skew()" in CSS is problematic for SVG. Would be nice to have, but browser support just 
                            isn't there yet. So, setting the slant must be done through options.
                            */
                            slant: 0,

                            /**
                            This flag controls the appearance of the decimal point 'dot' in the display.
                            The default is to display it (true), but you can set to false to omit it.
                            */
                            decimalPoint: true
                        },

                        /**
                        Widget factory creation handler.
                        */
                        _create: function () {
                            this.jqSvgElement = $("<svg/>", {
                                class: this.widgetName + "-svg",
                                viewBox: "0 0 57 80",
                                version: "1.1",
                                xmlns: "http://www.w3.org/2000/svg",
                                "xmlns:xlink": "http://www.w3.org/1999/xlink"
                            })
                                .css({ fill: this.options.colorOff, "background-color": this.options.colorBackground });

                            $("<defs/>")
                                .append($("<polyline/>", { id: "h-seg", points: "11 0, 37 0, 42 5, 37 10, 11 10, 6 5" }))
                                .append($("<polyline/>", { id: "v-seg", points: "0 11, 5 6, 10 11, 10 34, 5 39, 0 39" }))
                                .appendTo(this.jqSvgElement);

                            this.jqSegments = $("<g/>", { class: this.widgetName + "-segGroup" })
                                .append($("<use/>", { "xlink:href": "#h-seg", x: "0", y: "0" }))                                  //Segment A
                                .append($("<use/>", { "xlink:href": "#v-seg", x: "-48", y: "0", transform: "scale(-1,1)" }))      //Segment B
                                .append($("<use/>", { "xlink:href": "#v-seg", x: "-48", y: "-80", transform: "scale(-1,-1)" }))   //Segment C
                                .append($("<use/>", { "xlink:href": "#h-seg", x: "0", y: "70" }))                                 //Segment D
                                .append($("<use/>", { "xlink:href": "#v-seg", x: "0", y: "-80", transform: "scale(1,-1)" }))      //Segment E
                                .append($("<use/>", { "xlink:href": "#v-seg", x: "0", y: "0" }))                                  //Segment F
                                .append($("<use/>", { "xlink:href": "#h-seg", x: "0", y: "35" }))                                 //Segment G
                                .appendTo(this.jqSvgElement);

                            if (this.options.slant) {
                                this.jqSegments.attr("transform", "skewX(" + -this.options.slant + ")");
                            }

                            if (this.options.decimalPoint) {
                                $("<circle/>", { cx: "52", cy: "75", r: "5" }).appendTo(this.jqSvgElement);
                            }

                            this.jqSvgElement.appendTo(this.element);
                            this.element.append(this.jqSvgElement);

                            // http://stackoverflow.com/a/13654655/390906
                            //
                            this.element.html(this.element.html());
                            this.jqSvgElement = this.element.find("svg");
                            this.jqSegments = this.jqSvgElement.find("." + this.widgetName + "-segGroup");

                            if (this.options.value) {
                                this.displayValue(this.options.value);
                            }
                        },

                        _destroy: function () {
                            this.jqSvgElement.remove();
                        },

                        _setOption: function (key, value) {
                            this.options[key] = value;

                            switch (key) {
                                case "value":
                                    this.displayValue(value);
                                    break;
                            }
                        },

                        /**
                        This is the method to set the digit displayed.
                        @param value The numeric digit to display.  Call with null to blank out the display.
                        @param bDecimalPoint Set to true or false to drive the illumination state of the decimal point
                        (does not apply if decimal point display is disabled)
                        */
                        displayValue: function (value, bDecimalPoint) {
                            var self = this;
                            if (value >= numberSegments.length) return;
                            self.options.value = value;
                            var segments = self._getSegments(value);
                            self.jqSegments.children().each(function (index, element) {
                                self._setSvgElementFill($(element), segments & (1 << index));
                            });

                            self._setSvgElementFill(self.jqSvgElement.find("circle"), bDecimalPoint);
                        },

                        /**
                        Return the bitfield mask for the segments to illuminate for the argumen numeric digit value.    
                        */
                        _getSegments: function (value) {
                            if (value === "-") return 0x40;
                            return numberSegments[value];
                        },

                        _setSvgElementFill: function (jqElement, bOn) {
                            // jQuery addClass/removeClass doesn't work with svg <use> elements. So we have to do it the old way.
                            //
                            jqElement.attr("class", bOn && (this.widgetName + "-segOn"));

                            // Set the fill style if options.colorOn is defined. This overrides CSS definitions.
                            //
                            jqElement.css("fill", (bOn && this.options.colorOn) || "");
                        }

                    });

                    // Plugin Knockout binding handler for sevenSeg if KO is defined.
                    //
                    if (typeof ko !== "undefined" && ko.bindingHandlers) {
                        ko.bindingHandlers.sevenSeg = {
                            init: function (element, valueAccessor) {
                                $(element).sevenSeg(ko.toJS(valueAccessor()));
                            },
                            update: function (element, valueAccessor) {
                                $(element).sevenSeg("option", ko.toJS(valueAccessor()));
                            }
                        };
                    }

                    /**
                    This widget creates a group comprised of any number of discrete sevenSegs.
                    */
                    $.widget("bw.sevenSegArray", {

                        options: {
                            /**
                            This option controls the display value on the 7seg array.  Set this to the numeric value you
                            want displayed.
                            */
                            value: null,

                            /**
                            Defines the number of digits that comprise the array.
                            */
                            digits: 2,

                            /**
                            If you want to also specify control options for the internally created sevenSeg widgets, this is where you do it
                            Simply pass an object with any sevenSeg options you want as property/value pairs.
                            For example { colorOn: "Lime", colorOff: "#003200" }
                            */
                            segmentOptions: null
                        },

                        /**
                        Widget factory creation handler.
                        */
                        _create: function () {
                            this.aJqDigits = [];
                            var sDigitWidth = 100 / this.options.digits + "%";
                            for (var iDigit = 0; iDigit < this.options.digits; ++iDigit) {
                                this.aJqDigits[iDigit] = $("<div/>", { style: "display: inline-block; height: 100%;" })
                                    .css("width", sDigitWidth)
                                    .sevenSeg(this.options.segmentOptions)
                                    .appendTo(this.element);
                            }
                            this.aJqDigits.reverse();
                            if (this.options.value) {
                                this.displayValue(this.options.value);
                            }
                        },

                        _destroy: function () {
                            $.each(this.aJqDigits, function (index, jqDigit) {
                                jqDigit.sevenSeg("destroy");
                                jqDigit.remove();
                            });
                        },

                        _setOption: function (key, value) {
                            this.options[key] = value;

                            switch (key) {
                                case "value":
                                    this.displayValue(value);
                                    break;

                                // TODO BW : Add other options.
                            }
                        },

                        /**
                        Set the value of the digits to display.  You simply call this with a number and the respective
                        digits will be set.  Whatever digits that fit will be displayed, any additional will just be omitted.
                        @param value The numeric value to display.  Call with null to blank out the display.
                        */
                        displayValue: function (value) {
                            var self = this;
                            var sValue = value.toString();
                            var iDecimalIdx = sValue.indexOf('.');
                            var iDigitIdx = sValue.length - 1;
                            $.each(self.aJqDigits, function (index, jqDigit) {
                                var bDecimal = iDecimalIdx >= 0 && iDigitIdx === iDecimalIdx;
                                if (bDecimal) {
                                    --iDigitIdx;
                                }

                                var sDigitValue = sValue[iDigitIdx];
                                jqDigit.sevenSeg("displayValue", sDigitValue, bDecimal);

                                --iDigitIdx;
                            });
                        }

                    });

                    // Plugin Knockout binding handler for sevenSegArray if KO is defined.
                    //
                    if (ko && ko.bindingHandlers) {
                        ko.bindingHandlers.sevenSegArray = {
                            init: function (element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
                                $(element).sevenSegArray(ko.toJS(valueAccessor()));
                            },
                            update: function (element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
                                $(element).sevenSegArray("option", ko.toJS(valueAccessor()));
                            }
                        };
                    }

                })(jQuery);
                initLedDisplay('testResizableArray1');
                initLedDisplay('testResizableArray2');
                initLedDisplay('testResizableArray3');
                initLedDisplay('testResizableArray4');
                initLedDisplay('testResizableArray5');
                initLedDisplay('testResizableArray6');
            }

            async function createElectricityMeter(data, name){
                return new Promise((resolve) => {
                    const typeMatch = data.match(/(\d+)K-(\d+)TB/i);
                    const numberOfRelays = typeMatch ? parseInt(typeMatch[1]) : 0;
                    const numberOfMeters = typeMatch ? parseInt(typeMatch[2]) : 0;
                    // Container chứa các ElectricityMeter
                    const container = document.getElementById("meter-container");
                    container.innerHTML = ""; // Xóa các meter cũ nếu có

                    // Tạo các ElectricityMeter tương ứng
                    for (let i = 1; i <= numberOfMeters; i++) {
                        const meterHTML = `
                            <div id="ElectricityMeter-${i}" class="w-100 p-2 mt-4" style="border: 1px solid;cursor: pointer;">
                                <div>
                                    <p class="m-0" style="font-size: 20px;">${name} ${i}</p>
                                </div>
                                <div class="d-flex">
                                    <div class="w-50">
                                        <div class="d-flex py-4">
                                            <div id="testResizableDiv${i}" class="w-75">
                                                <div id="testResizableArray${i}" class="float-end"></div>
                                            </div>
                                            <span class="pt-2 px-2" style="font-size: 20px;color: #149aa4;"><strong>V</strong></span>
                                        </div>
                                        <div class="d-flex py-4">
                                            <div id="testResizableDiv${i}-1" class="w-75">
                                                <div id="testResizableArray${i}-1" class="float-end"></div>
                                            </div>
                                            <span class="pt-2 px-2" style="font-size: 20px;color: #e97540;"><strong>W</strong></span>
                                        </div>
                                    </div>
                                    <div class="w-50">
                                        <div class="d-flex py-4">
                                            <div id="testResizableDiv${i}-2">
                                                <div id="testResizableArray${i}-2"></div>
                                            </div>
                                            <span class="pt-2 px-2" style="font-size: 20px;color: #f2f442;"><strong>A</strong></span>
                                        </div>
                                        <div class="d-flex py-4">
                                            <div id="testResizableDiv${i}-3">
                                                <div id="testResizableArray${i}-3"></div>
                                            </div>
                                            <span class="pt-2 px-2" style="font-size: 20px;color: #1a8f93;"><strong>Kwh</strong></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                        container.insertAdjacentHTML("beforeend", meterHTML);
                        $(`#ElectricityMeter-${i}`).click(async function () {
                            $("#title-condition-popup").text(`Biểu đồ điện năng thiết bị ${i}`);
                            $("#chartCondition-popup").show();

                            const now = new Date();
                            const formattedNow = formatCustomDate(now);
                            const oneHourAgo = new Date(now.getTime() - 60 * 60 * 1000);
                            const formattedOneHourAgo = formatCustomDate(oneHourAgo);

                            const data = await getDataChartCondition(formattedOneHourAgo, formattedNow, i);
                            createChartDataCondition(data);
                        });
                    }
                // Hoàn thành render
                    resolve();
                });
            }

            function initLedDisplay(baseId) {
                const ledConfigs = [
                    {
                        suffix: "",      // Ví dụ: testResizableArray3
                        digits: 5,
                        colorOff: "#041d1e",
                        colorOn: "#0fb4c0"
                    },
                    {
                        suffix: "-1",    // testResizableArray3-1
                        digits: 5,
                        colorOff: "#180c07",
                        colorOn: "#e97540"
                    },
                    {
                        suffix: "-2",    // testResizableArray3-2
                        digits: 5,
                        colorOff: "#1a1a07",
                        colorOn: "#f2f442"
                    },
                    {
                        suffix: "-3",    // testResizableArray3-3
                        digits: 5,
                        colorOff: "#041d1e",
                        colorOn: "#0fb4c0"
                    }
                ];

                ledConfigs.forEach(function (config) {
                    const ledSelector = `#${baseId}${config.suffix}`;
                    const divSelector = `#${baseId.replace("Array", "Div")}${config.suffix}`;
                    console.log(config.digits);
                    
                    $(ledSelector).sevenSegArray({
                        digits: config.digits,
                        segmentOptions: {
                            colorOff: config.colorOff,
                            colorOn: config.colorOn
                        }
                    });

                    $(divSelector).resizable({ aspectRatio: true });
                });
            }

            var onClose = function () {
                console.log('CLOSED: websocket');
                if (ws != null) {
                    ws.close(1000, "Đóng kết nối bình thường");
                    wss.close(1000, "Đóng kết nối bình thường");
                }
                ws = null;
                wss = null;
            }

            function generateMockData() {
                const voltage = (220 + Math.random() * 10).toFixed(1);
                const current = (5 + Math.random() * 2).toFixed(2);
                const power = (voltage * current).toFixed(0);

                energyCounter += (power / 3600000 * 2); // tăng mỗi 2 giây
                const energy = energyCounter.toFixed(3);

                return `U:${voltage},I:${current},P:${power},E:${energy}`;
            }

            function clearCharts() {
                [voltageChart, currentChart, powerChart, energyChart].forEach(chart => {
                    if (chart) {
                        chart.data.labels = [];
                        chart.data.datasets[0].data = [];
                        chart.update();
                    }
                });
            }

            let dataIndex = 0; // để duyệt qua từng phần tử dữ liệu thật
            let energyCounter = 0;

            async function generateAndUpdateMockData() {
                const realData = await getDataChartCondition();
                // const chartData = dataChart.map(item => ({
                //     time: new Date(item.DATE_CREATE), // hoặc .toISOString() nếu bạn cần định dạng chuẩn
                //     U: item.U,
                //     I: item.I,
                //     P: item.P,
                //     E: item.E,
                // }));
                if (dataIndex >= realData.length) return; // hết dữ liệu thì dừng

                const record = realData[dataIndex];
                const voltage = parseFloat(record.U);
                const current = parseFloat(record.I);
                const power = parseFloat(record.P);
                const energy = parseFloat(record.E);
                const time = new Date(record.DATE_CREATE).toLocaleTimeString();

                addData(voltageChart, time, voltage);
                addData(currentChart, time, current);
                addData(powerChart, time, power);
                addData(energyChart, time, energy);

                dataIndex++;
            }

            function addData(chart, label, value) {
                if (chart.data.labels.length > 20) {
                    chart.data.labels.shift();
                    chart.data.datasets[0].data.shift();
                }

                chart.data.labels.push(label);
                chart.data.datasets[0].data.push(value);
                chart.update();
            }

            var ctx_U = document.getElementById("chartVoltage");
            var ChartU;
            var ctx_I = document.getElementById("chartCurrent");
            var ChartI;
            var ctx_P = document.getElementById("chartPower");
            var ChartP;
            var ctx_E = document.getElementById("chartEnergy");
            var ChartE;
            createChartDataCondition = function (data) {
                if (ChartU != null) ChartU.destroy();
                if (ChartI != null) ChartI.destroy();
                if (ChartP != null) ChartP.destroy();
                if (ChartE != null) ChartE.destroy();

                var ctxU = ctx_U.getContext('2d');
                var ctxI = ctx_I.getContext('2d');
                var ctxP = ctx_P.getContext('2d');
                var ctxE = ctx_E.getContext('2d');

                let labels = [];
                let dataU = [];
                let dataI = [];
                let dataP = [];
                let dataE = [];

                data.forEach(item => {
                    const timeLabel = new Date(item.DATE_CREATE).toLocaleTimeString(); // hoặc toLocaleString()
                    labels.push(timeLabel);
                    dataU.push(parseFloat(item.U).toFixed(2));
                    dataI.push(parseFloat(item.I).toFixed(2));
                    dataP.push(parseFloat(item.P).toFixed(2));
                    dataE.push(parseFloat(item.E).toFixed(3));
                });
                // {
                //         type: "line", // Chọn kiểu bar cho dataset này
                //         label: "Nhiệt độ (°C)",
                //         data: newDataRT,
                //         backgroundColor: "rgb(173 14 14)",
                //         borderColor: "rgb(173 14 14)",
                //         borderWidth: 1,
                //         // fill: 'start',
                //         tension: 0.4,
                //     }
                const createDataSet = (label, data, color) => ({
                    type: "line",
                    label,
                    data,
                    backgroundColor: color,
                    borderColor: color,
                    borderWidth: 1,
                    tension: 0.4,
                });

                // U - điện áp
                const dataSetU = [createDataSet("Điện áp (V)", dataU, "rgba(75,192,192)")];
                ChartU = new Chart(ctxU, createChart("line", labels, [], "V", "", dataSetU, "Thời gian"));

                // I - dòng điện
                const dataSetI = [createDataSet("Dòng điện (A)", dataI, "rgba(255,99,132)")];
                ChartI = new Chart(ctxI, createChart("line", labels, [], "A", "", dataSetI, "Thời gian"));

                // P - công suất
                const dataSetP = [createDataSet("Công suất (W)", dataP, "rgba(54,162,235)")];
                ChartP = new Chart(ctxP, createChart("line", labels, [], "W", "", dataSetP, "Thời gian"));

                // E - điện năng
                const dataSetE = [createDataSet("Điện năng (kWh)", dataE, "rgba(255,206,86)")];
                ChartE = new Chart(ctxE, createChart("line", labels, [], "kWh", "", dataSetE, "Thời gian"));

                // document.getElementById("loading-spinner").classList.add("d-none");
            }

            const GenerateCreateScheduleString = function (batchName, startTime, cmd) {
                let res = 'CREATE(SL,<BATCH_NAME>,<START_TIME>, <END_TIME>,1,<COMMAND_STRING>);\r\n';
                res = res.replace(/<BATCH_NAME>/g, batchName);
                res = res.replace(/<START_TIME>/g, startTime + ":00");
                res = res.replace(/<END_TIME>/g, startTime + ":05");
                res = res.replace(/<COMMAND_STRING>/g, cmd);
                return res;
            }

            $('#submitCalendar').on('click', () => {
                let scheduleName = $('#txtScheduleName').val();
                let startTime = $('#startTime').val();
                let relayList = Array.from(document.querySelectorAll('#sltDeviceForSchedule input')).filter(item => item.checked);
                let state = $('#radioOn').prop('checked');
                let command = '';

                // validate
                let regex = /^[A-Za-z0-9!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]+$/;
                if (!regex.test(scheduleName)) {
                    toastr.error("Tên kịch bản không hợp lệ!");
                    return;
                }
                if (startTime.length == 0) {
                    toastr.error("Chưa chọn thời điểm!");
                    return;
                }
                if (relayList.length == 0) {
                    toastr.error("Không có relay nào được áp dụng!");
                    return;
                }

                if (relayList.length == document.querySelectorAll('#sltDeviceForSchedule input').length) {
                    command += `CALL BATCH ${state ? 'LGS_ON_ALL' : 'LGS_OFF_ALL'}; DELAY 200;`;
                }
                else {
                    relayList.forEach(relay => {
                        let batchName = `${state ? 'LGS_ON_' : 'LGS_OFF_'}${relay.getAttribute('data-relayId')}`;
                        command += `CALL BATCH ${batchName}; DELAY 200;`;
                    });
                }
                command = GenerateCreateScheduleString(scheduleName, startTime, command);
                // gửi lệnh xuống thiết bị
                let cmd = [{ CHIP_ID: cabinetID, COMMAND: command }];
                wss.send(JSON.stringify(cmd));
                toastr.success("Lập lịch thành công!");
            });

            function getDataChartCondition(startDate, endDate, ZONE_ID) {

                // const url = "https://DEV.HOMEOS.vn/service/service.svc/";
                const url = "https://central.homeos.vn/service_XD/service.svc/";

                return new Promise((resolve, reject) => {
                    $.ajax({
                        url: url + "ApiServicePublic/" + "GetdataChart/STARTDATE='" + startDate + "',ENDDATE='" + endDate + "',ZONE_ID=" + ZONE_ID,
                        type: "GET",
                        dataType: "jsonp",
                        contentType: "application/json; charset=utf-8",
                        success: function (msg) {
                            try {
                                let state = JSON.parse(msg);
                                console.log("dữ liệu", state);

                                resolve(state); // Trả về dữ liệu khi thành công
                            } catch (error) {
                                reject(error); // Bắt lỗi nếu JSON parse thất bại
                            }
                        },
                        complete: function (data) {
                            // Có thể thêm xử lý khi request hoàn thành ở đây nếu cần
                        },
                        error: function (e, t, x) {

                        },
                    });
                });
            }
            //-----------------------------------------------------------------------------------------------------------
            // xuất báo cáo
            
            function DateFormatServerToLocal(input, format) {
                if (!input) return '';

                let dateObj;

                // Nếu là Date object
                if (input instanceof Date) {
                    dateObj = input;
                }
                // Nếu là chuỗi, cố gắng parse thành Date
                else if (typeof input === 'string') {
                    dateObj = new Date(input);

                    // Nếu parse fail (Invalid Date), trả về rỗng
                    if (isNaN(dateObj.getTime())) return '';
                } else {
                    return '';
                }

                // Lấy từng phần của ngày/giờ
                let dd = String(dateObj.getDate()).padStart(2, '0');
                let mm = String(dateObj.getMonth() + 1).padStart(2, '0'); // Month bắt đầu từ 0
                let yyyy = dateObj.getFullYear();
                let yy = String(yyyy).slice(-2);
                let HH = String(dateObj.getHours()).padStart(2, '0');
                let MM = String(dateObj.getMinutes()).padStart(2, '0');
                let SS = String(dateObj.getSeconds()).padStart(2, '0');

                const map = { dd, mm, yyyy, yy, HH, MM, SS };

                return format.replace(/dd|mm|yyyy|yy|HH|MM|SS/g, (token) => map[token] || '');
            }

            $('#submitExport').click(function () {
                $('#submitExport').css({
                    'background-color': '#f39c12',
                    'border': 'solid 1px #f39c12'
                });

                // Đổi nội dung text
                $('#submitExport').text('Đang xuất dữ liệu...');
                let reportType;
                if(checkReport == 'KTTV'){
                    reportType = $('#KTTV_Report').val();
                } else {
                    reportType = $('#nameReport').val();
                }
                
                const startDate = $('#startDate').val();
                const endDate = $('#endDate').val();

                console.log("Loại báo cáo:", reportType);
                console.log("Ngày bắt đầu:", startDate);
                console.log("Ngày kết thúc:", endDate);

                exportRepost('E', startDate, endDate, reportType);
                // Bạn có thể xử lý tiếp ở đây, ví dụ:
                // Gọi API, tạo URL báo cáo, hiển thị kết quả...
            });

            function serializeParams(obj) {
                return Object.keys(obj)
                    .map(k => encodeURIComponent(k) + '=' + encodeURIComponent(obj[k]))
                    .join('&');
            }

            function checkRoleUser(user_id, password, url, check) {
                let sessionItems = JSON.parse(localStorage.getItem('dataSession')) || [];

                if (check === "Export") {
                    sessionItems = sessionItems.filter(item => item.url !== url);
                    localStorage.setItem('dataSession', JSON.stringify(sessionItems));
                }
                // Tìm session trùng với URL
                const existingSession = sessionItems.find(item => item.url === url);

                if (existingSession) {
                    // Nếu đã có session → trả về luôn
                    return Promise.resolve([{
                        StateName: user_id,
                        StateId: existingSession.sid // giả sử bạn lưu `sid` ở đây
                    }]);
                }

                // Nếu chưa có session, gọi API
                const d = {
                    Uid: user_id,
                    p: password,
                    ip: '0.0.0.0',
                    a: '6fba9a59-46f1-42e6-baea-b2479fa1eb3b'
                };

                return new Promise((resolve, reject) => {
                    $.ajax({
                        url: url + "GetSessionId?callback=?",
                        type: "GET",
                        dataType: "jsonp",
                        data: d,
                        contentType: "application/json; charset=utf-8",
                        success: function (msg) {
                            try {
                                const state = JSON.parse(msg);
                                const newSession = {
                                    url: url,
                                    sid: state[0]?.StateId || '', // lưu sid nếu có
                                    name: state[0]?.StateName || user_id
                                };
                                // Cập nhật localStorage
                                sessionItems.push(newSession);
                                localStorage.setItem('dataSession', JSON.stringify(sessionItems));
                                resolve(state);
                            } catch (error) {
                                reject(error);
                            }
                        },
                        error: function (e, t, x) {
                            reject(e);
                        }
                    });
                });
            }

            const exportRepost = async function (type, startDate, endDate, reportType, isViewer) {
                
                if (isViewer)
                    this.IsViewer = isViewer;
                // startLoading();
                const data = JSON.parse(localStorage.getItem("itemHistory"));
                console.log(data);
                
                // const datetesst =  DateFormatServerToLocal(Sdate.toISOString(), 'dd/mm/yy');
                // console.log(datetesst, ":--", new Date(datetesst));
                // var c = [{"ID":"091840","NAME":"Trực Ninh","IDFIELD":"WORKSTATION_ID","NAMETABLE":"DM_WORKSTATION","REPORT_ID":"RPT_API_MOBILE"},{"ID":"RT","NAME":"Thiết bị đo nhiệt độ","IDFIELD":"ZONE_PROPERTY","NAMETABLE":"VW_COMMAND","REPORT_ID":"RPT_API_MOBILE"}]
                var c = [];
                var linkbase;
                var nameReport;
                if(checkReport == 'KTTV'){
                    linkbase = 'https://'+data.domain+'/Service/Service.svc/';
                    c = [{"ID":data.CodeWorkStation,"NAME":data.NameWorkStation,"IDFIELD":"WORKSTATION_ID","NAMETABLE":"DM_WORKSTATION","REPORT_ID":"RPT_API_MOBILE"},{"ID":reportType,"NAME":"","IDFIELD":"ZONE_PROPERTY","NAMETABLE":"VW_COMMAND","REPORT_ID":"RPT_API_MOBILE"}];
                    nameReport = 'RPT_API_MOBILE';
                } else {
                    linkbase = 'https://central.homeos.vn/service_XD/service.svc/';
                    nameReport = reportType;
                }
                const dataUser = await checkRoleUser("dev", sha1Encode("1" + "@1B2c3D4e5F6g7H8").toString(), linkbase, "Export");
                
                var val = [];
                
                // val.url = 'https://central.homeos.vn/service_XD/service.svc/' + "GenerateReportOther";
                val.url = linkbase + "GenerateReportOther";
                // this.generateCondition();
                val.data = {
                    // Uid: 'admin',
                    // Sid: 'cb880c13-5465-4a1d-a598-28e06be43982',
                    Uid: dataUser[0].StateName,
                    Sid: dataUser[0].StateId,
                    PRid: nameReport,
                    Rid: nameReport,
                    Sd: DateFormatServerToLocal(startDate, 'yyyy/mm/dd'),
                    Ed: DateFormatServerToLocal(endDate, 'yyyy/mm/dd'),
                    // St: this.txtFromTime.Value(),
                    // Et: this.txtToTime.Value(),
                    c: JSON.stringify(c),
                    type: type
                };
                val.type = "POST";
                val.dataType = "jsonp";
                val.crossDomain = true;
                val.contentType = "application/json; charset=utf-8";
                val.complete = function (data) {
                    // finishLoading();
                };
                val.error = function (e, b) {
                    alert(b);
                    // finishLoading();
                };
                val.success = function (msg) {
                    var state = msg;
                    console.log(state);
                    
                    try {
                        state = JSON.parse(msg);
                        console.log(state);
                        $('#submitExport').css({
                            'background-color': '#2c697b',
                            'border': 'solid 1px #2c697b'
                        });
                    
                        // Đổi nội dung text
                        $('#submitExport').text('Xuất dữ liệu báo cáo (excel)');
                        toastr.error("Xuất báo cáo lỗi, vui lòng kiểm tra lại");
                        // this.MessageBox(state.StateName, "danger", "")
                        return;
                    } catch (e) {
                        state = msg;
                    }
                    if (state != 'error') {
                        if (this.IsViewer) {
                            var link = HomeOS.linkbase().toLowerCase().replace('service.svc/', '') + '' + msg;
                            link = link.replace('service.svc/', '');
                            
                            // this.transOutput.LinkDocument = link;
                            if (!this.transOutput.is_Initial) {
                                this.transOutput.Form_Loaded = function () {
                                    // this.transOutput.fullScreen();
                                    // this.transOutput.SetUrl();
                                }.bind(this);
                                this.transOutput.initial(function () {
                                    this.transOutput.Show();
                                }.bind(this));
                            }
                            else {
                                this.transOutput.SetUrl(link);
                                this.transOutput.Show();
                            }
                        }
                        else {
                            const urlservice = linkbase
                            // const urlservice = 'https://central.homeos.vn/service_XD/service.svc/'
                            var link = urlservice.replace('service.svc/', '') + '' + msg;
                            link = link.replace('service.svc/', '');
                            link = link.replace('Service.svc/', '');
                            // link = link.replace('pdf', 'xls');
                            if(window.downloadFileToDevice){
                                window.downloadFileToDevice(link);
                                toastr.success("download file thành công ")
                            } else {
                                // window.open(link, "download");
                                const a = document.createElement('a');
                                a.href = link;
                                a.download = link.split('/').pop(); // tự lấy tên file từ URL
                                document.body.appendChild(a);
                                a.click();
                                document.body.removeChild(a);
                                console.log(1);
                            }
                            console.log(link);
                            $('#submitExport').css({
                                'background-color': '#2c697b',
                                'border': 'solid 1px #2c697b'
                            });
                        
                            // Đổi nội dung text
                            $('#submitExport').text('Xuất dữ liệu báo cáo (excel)');
                        }
                    }
                    else {
                        this.checkError(msg);
                    }
                    this.IsViewer = false;
                }.bind(this);
                $.ajax(val);
            }
            // exportRepost('E', '2025-04-18', '2025-04-18', 'RPT_API_MOBILE');
            function processCode(code) {
                const prefix = code.slice(0, 2); // lấy 2 chữ đầu
                if (prefix[0] === 'D') {
                    return prefix.split('').reverse().join(''); // đảo ngược nếu bắt đầu bằng D
                }
                return prefix;
            }

            const getDevicefilter = async function (checkReporttext) {
                if(checkReporttext == 'KTTV'){
                    const data = JSON.parse(localStorage.getItem("itemHistory"));
                    const dataDevice = await getDM("https://"+data.domain+"/service/service.svc", "DM_WORKSTATION_DEVICE", "WORKSTATION_ID='" + data.CodeWorkStation + "'", "NotCentral");
                    const selectElement = $('#KTTV_Report');
                    selectElement.empty();

                    for (let i = 0; i < dataDevice.data.length; i++) {
                        const option = $('<option></option>'); // tạo option bằng jQuery
                        option.val(processCode(dataDevice.data[i].TRAN_NO));
                        option.text(dataDevice.data[i].DESCRIPTION);
                        selectElement.append(option); // dùng jQuery append
                    }
                } else {
                    const data = JSON.parse(localStorage.getItem("itemHistory"));
                    const dataDevice = await getDM("https://"+data.domain+"/service/service.svc", "DM_WORKSTATION_DEVICE", "WORKSTATION_ID='" + data.CodeWorkStation + "'", "NotCentral");
                    const selectElement = $('#device_ID_alert');
                    selectElement.empty();

                    for (let i = 0; i < dataDevice.data.length; i++) {
                        const option = $('<option></option>'); // tạo option bằng jQuery
                        option.val(processCode(dataDevice.data[i].TRAN_NO));
                        option.text(dataDevice.data[i].DESCRIPTION);
                        selectElement.append(option); // dùng jQuery append
                    }
                }
            }

            // Danh sách các option theo yêu cầu
            const reportOptions = [
                { value: "CHANGE", text: "Tuỳ ý" },
                { value: "MONTH1", text: "Tháng 1" },
                { value: "MONTH2", text: "Tháng 2" },
                { value: "MONTH3", text: "Tháng 3" },
                { value: "MONTH4", text: "Tháng 4" },
                { value: "MONTH5", text: "Tháng 5" },
                { value: "MONTH6", text: "Tháng 6" },
                { value: "MONTH7", text: "Tháng 7" },
                { value: "MONTH8", text: "Tháng 8" },
                { value: "MONTH9", text: "Tháng 9" },
                { value: "MONTH10", text: "Tháng 10" },
                { value: "MONTH11", text: "Tháng 11" },
                { value: "MONTH12", text: "Tháng 12" },
                { value: "QUY1", text: "Quý 1" },
                { value: "QUY2", text: "Quý 2" },
                { value: "QUY3", text: "Quý 3" },
                { value: "QUY4", text: "Quý 4" },
                { value: "MOMTHSTART", text: "6 tháng đầu năm" },
                { value: "MOMTHEND", text: "6 tháng cuối năm" },
                { value: "MOMTH9START", text: "9 tháng đầu năm" },
                { value: "YEAR", text: "Cả năm" },
            ];

            // Hàm khởi tạo các option trong select
            function renderOptions() {
                const select = document.getElementById("dateTimeReport");
                reportOptions.forEach(opt => {
                    const option = document.createElement("option");
                    option.value = opt.value;
                    option.textContent = opt.text;
                    select.appendChild(option);
                });
            }

            // Hàm xử lý thời gian theo lựa chọn
            function getReportRange(value) {
                const year = new Date().getFullYear();
                let startDate, endDate;

                const date = (m, d) => new Date(year, m - 1, d);

                switch (value) {
                    case "CHANGE":
                        startDate = null;
                        endDate = null;
                        break;
                    case "MONTH1":
                    case "MONTH2":
                    case "MONTH3":
                    case "MONTH4":
                    case "MONTH5":
                    case "MONTH6":
                    case "MONTH7":
                    case "MONTH8":
                    case "MONTH9":
                    case "MONTH10":
                    case "MONTH11":
                    case "MONTH12":
                        const month = parseInt(value.replace("MONTH", ""));
                        startDate = date(month, 1);
                        endDate = new Date(year, month, 0); // ngày cuối cùng của tháng
                        break;
                    case "QUY1":
                        startDate = date(1, 1);
                        endDate = date(3, 31);
                        break;
                    case "QUY2":
                        startDate = date(4, 1);
                        endDate = date(6, 30);
                        break;
                    case "QUY3":
                        startDate = date(7, 1);
                        endDate = date(9, 30);
                        break;
                    case "QUY4":
                        startDate = date(10, 1);
                        endDate = date(12, 31);
                        break;
                    case "MOMTHSTART":
                        startDate = date(1, 1);
                        endDate = date(6, 30);
                        break;
                    case "MOMTHEND":
                        startDate = date(7, 1);
                        endDate = date(12, 31);
                        break;
                    case "MOMTH9START":
                        startDate = date(1, 1);
                        endDate = date(9, 30);
                        break;
                    case "YEAR":
                        startDate = date(1, 1);
                        endDate = date(12, 31);
                        break;
                    default:
                        startDate = null;
                        endDate = null;
                }

                return { startDate, endDate };
            }

            function formatDate(date) {
                if (!date) return '';
                const yyyy = date.getFullYear();
                const mm = String(date.getMonth() + 1).padStart(2, '0');
                const dd = String(date.getDate()).padStart(2, '0');
                return `${yyyy}-${mm}-${dd}`;
            }
            // Gọi khi trang load
            renderOptions();

            // Lắng nghe khi người dùng chọn
            document.getElementById("dateTimeReport").addEventListener("change", function () {
                console.log(1);
                
                const selectedValue = this.value;
                const { startDate, endDate } = getReportRange(selectedValue);

                // Đổ vào input
                document.getElementById("startDate").value = formatDate(startDate);
                document.getElementById("endDate").value = formatDate(endDate);
            });


            function sha1Encode(message) {
                function rotate_left(n, s) {
                    return (n << s) | (n >>> (32 - s));
                }

                function cvt_hex(val) {
                    let str = "";
                    let i;
                    let v;
                    for (i = 7; i >= 0; i--) {
                        v = (val >>> (i * 4)) & 0x0f;
                        str += v.toString(16);
                    }
                    return str;
                }

                function utf8_encode(str) {
                    return unescape(encodeURIComponent(str));
                }

                let blockstart;
                let i, j;
                const W = new Array(80);
                let H0 = 0x67452301;
                let H1 = 0xEFCDAB89;
                let H2 = 0x98BADCFE;
                let H3 = 0x10325476;
                let H4 = 0xC3D2E1F0;
                let A, B, C, D, E;
                let temp;

                message = utf8_encode(message);
                const msg_len = message.length;

                const word_array = [];
                for (i = 0; i < msg_len - 3; i += 4) {
                    j = (message.charCodeAt(i) << 24) |
                        (message.charCodeAt(i + 1) << 16) |
                        (message.charCodeAt(i + 2) << 8) |
                        message.charCodeAt(i + 3);
                    word_array.push(j);
                }

                switch (msg_len % 4) {
                    case 0:
                        i = 0x080000000;
                        break;
                    case 1:
                        i = (message.charCodeAt(msg_len - 1) << 24) | 0x0800000;
                        break;
                    case 2:
                        i = (message.charCodeAt(msg_len - 2) << 24) |
                            (message.charCodeAt(msg_len - 1) << 16) |
                            0x08000;
                        break;
                    case 3:
                        i = (message.charCodeAt(msg_len - 3) << 24) |
                            (message.charCodeAt(msg_len - 2) << 16) |
                            (message.charCodeAt(msg_len - 1) << 8) |
                            0x80;
                        break;
                }

                word_array.push(i);

                while ((word_array.length % 16) !== 14) word_array.push(0);

                word_array.push(msg_len >>> 29);
                word_array.push((msg_len << 3) & 0x0ffffffff);

                for (blockstart = 0; blockstart < word_array.length; blockstart += 16) {
                    for (i = 0; i < 16; i++) W[i] = word_array[blockstart + i];
                    for (i = 16; i <= 79; i++) W[i] = rotate_left(W[i - 3] ^ W[i - 8] ^ W[i - 14] ^ W[i - 16], 1);

                    A = H0;
                    B = H1;
                    C = H2;
                    D = H3;
                    E = H4;

                    for (i = 0; i <= 19; i++) {
                        temp = (rotate_left(A, 5) + ((B & C) | (~B & D)) + E + W[i] + 0x5A827999) & 0x0ffffffff;
                        E = D;
                        D = C;
                        C = rotate_left(B, 30);
                        B = A;
                        A = temp;
                    }

                    for (i = 20; i <= 39; i++) {
                        temp = (rotate_left(A, 5) + (B ^ C ^ D) + E + W[i] + 0x6ED9EBA1) & 0x0ffffffff;
                        E = D;
                        D = C;
                        C = rotate_left(B, 30);
                        B = A;
                        A = temp;
                    }

                    for (i = 40; i <= 59; i++) {
                        temp = (rotate_left(A, 5) + ((B & C) | (B & D) | (C & D)) + E + W[i] + 0x8F1BBCDC) & 0x0ffffffff;
                        E = D;
                        D = C;
                        C = rotate_left(B, 30);
                        B = A;
                        A = temp;
                    }

                    for (i = 60; i <= 79; i++) {
                        temp = (rotate_left(A, 5) + (B ^ C ^ D) + E + W[i] + 0xCA62C1D6) & 0x0ffffffff;
                        E = D;
                        D = C;
                        C = rotate_left(B, 30);
                        B = A;
                        A = temp;
                    }

                    H0 = (H0 + A) & 0x0ffffffff;
                    H1 = (H1 + B) & 0x0ffffffff;
                    H2 = (H2 + C) & 0x0ffffffff;
                    H3 = (H3 + D) & 0x0ffffffff;
                    H4 = (H4 + E) & 0x0ffffffff;
                }

                const sha1hash = cvt_hex(H0) + cvt_hex(H1) + cvt_hex(H2) + cvt_hex(H3) + cvt_hex(H4);
                return sha1hash.toLowerCase();
            }

            // map
            var map = null;
            const markerMap = new Map();
            // ✅ Hàm thêm các marker từ danh sách
            function addMarkers(locations, mapContainerId) {
                if (map) {
                    map.remove(); // Xóa bản đồ cũ
                }
                const bounds = L.latLngBounds(
                    L.latLng(6.2, 100.1),  // Góc dưới trái
                    L.latLng(26.3, 110.6)  // Góc trên phải
                );
                map = L.map(mapContainerId, {
                    maxBounds: bounds,
                    maxBoundsViscosity: 1.0,
                    minZoom: 6,
                    maxZoom: 19,
                }).setView([16.0, 106.0], 6);

                map.on('moveend', function () {
                    if (!bounds.contains(map.getCenter())) {
                        map.panInsideBounds(bounds, { animate: true });
                    }
                });

                // map.on('zoomend', function () {
                //     if (!bounds.contains(map.getBounds().getNorthWest()) || !bounds.contains(map.getBounds().getSouthEast())) {
                //         map.fitBounds(bounds, { animate: true });
                //     }
                // });

                const tiles = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                // const tiles = L.tileLayer('http://somebits.com:8001/rivers/{z}/{x}/{y}.json', {
                    maxZoom: 19
                }).addTo(map);
                // fetch(`http://somebits.com:8001/rivers/${10}/${512}/${314}.json`)
                // .then(response => response.json())
                // .then(data => {
                //     L.geoJSON(data).addTo(map);
                // });
                locations.forEach(loc => {
                    let typeName = '';
                    if(loc.type == "N"){
                        typeName = 'N';
                    } else if(loc.type == "M" || loc.type == "MS"){
                        typeName = 'R';
                    }
                    const customHTML = `
                        <div class="marker-wrapper marker-${loc.code}">
                            <div class="marker-label marker-label-${loc.code}" style="font-size: 13px;"></div>
                            <svg class="marker-pin" viewBox="0 0 24 24">
                                <path d="M12 0C8.1 0 5 3.1 5 7c0 5.3 7 13 7 13s7-7.7 7-13c0-3.9-3.1-7-7-7z" fill="#4285f4" stroke="rgb(66, 133, 244)" stroke-width="2"/>
                                <circle cx="12" cy="8.5" r="3.5" fill="white"/>
                            </svg>
                            <div class="mePin-wrapper">
                                <div class="mePin-child">
                                    <b>${typeName}</b>
                                    <svg id="mePin" xmlns="http://www.w3.org/2000/svg" width="33.3" height="32.4" viewBox="0 0 43.3 42.4">
                                        <path class="ring_outer mePin bounceInDown" fill="#dc3545" d="M28.6 23c6.1 1.4 10.4 4.4 10.4 8 0 4.7-7.7 8.6-17.3 8.6-9.6 0-17.4-3.9-17.4-8.6 0-3.5 4.2-6.5 10.3-7.9.7-.1-.4-1.5-1.3-1.3C5.5 23.4 0 27.2 0 31.7c0 6 9.7 10.7 21.7 10.7s21.6-4.8 21.6-10.7c0-4.6-5.7-8.4-13.7-10-.8-.2-1.8 1.2-1 1.4z"></path>
                                        <path class="ring_inner" fill="#dc3545" d="M27 25.8c2 .7 3.3 1.8 3.3 3 0 2.2-3.7 3.9-8.3 3.9-4.6 0-8.3-1.7-8.3-3.8 0-1 .8-1.9 2.2-2.6.6-.3-.3-2-1-1.6-2.8 1-4.6 2.7-4.6 4.6 0 3.2 5.1 5.7 11.4 5.7 6.2 0 11.3-2.5 11.3-5.7 0-2-2.1-3.9-5.4-5-.7-.1-1.2 1.3-.7 1.5z"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    `;

                    const icon = L.divIcon({
                        className: `custom-marker custom-${loc.code}`,
                        html: customHTML,
                        iconSize: [40, 40],
                        iconAnchor: [20, 40],
                        popupAnchor: [0, -40]
                    });
                    console.log(loc);

                    const marker = L.marker(loc.coords, { icon, customData: loc }).addTo(map);
                    marker.options.customData = {
                        type: loc.type, // Loại của trạm (NAAM, N, M, v.v.)
                        name: loc.name,
                        code: loc.code,
                        item: loc.item
                    };
                    marker.on('click', function (e) {
                        map.setView(loc.coords, 8); // Hoặc dùng map.flyTo(...) nếu muốn hiệu ứng mượt
                    });
                    marker.bindPopup(loc.popup);
                    markerMap.set(loc.code, marker);
                });

                setTimeout(() => {
                    map.invalidateSize();
                }, 10);
            }
            // setInterval(() => {
                    
            //     }, 4000);
            function getFieldsByType(type) {
                switch (type) {
                    case "NAAM":
                        return ['RD', 'RT', 'RH', 'RP'];
                    case "N":
                        return ['RN'];
                    case "MSL":
                    case "M":
                    case "MS":
                        return ['RD'];
                    case "NNS":
                        return ['RT', 'RN', 'SS', 'EC'];
                    case "TD":
                        return ['RN', 'TN', 'QV', 'QR'];
                    case "NMLLTD":
                        return ['RN', 'RD', 'QN', 'VN'];
                    default:
                        return [];
                }
            }

            // Dữ liệu mẫu cho các yếu tố
            var defaultValues = {
                RD: '0mm',   // Lượng mưa
                RT: '0°C',   // Nhiệt độ
                RH: '0%',    // Độ ẩm
                RP: '0hPa',  // Áp suất
                RN: '0mm',   // Mưa
                SS: '0w',    // Ánh sáng/Năng lượng
                EC: '0mS/cm', // Độ dẫn điện
                TN: 'tr.m³',
                QV: 'm³/s', 
                QR: 'm³/s', 
                QN: 'm³/s', 
                VN: 'm/s', 
            };

            function generatePopupHTML(name, code, type, item) {
                const fields = getFieldsByType(type);

                let dynamicRows = '';
                console.log(item);
                
                fields.forEach(field => {
                    let label = '';
                    switch (field) {
                        case 'RD': label = 'Lượng mưa'; break;
                        case 'RT': label = 'Nhiệt độ'; break;
                        case 'RH': label = 'Độ ẩm'; break;
                        case 'RP': label = 'Áp suất khí quyển'; break;
                        case 'RN': label = 'Mực nước'; break;
                        case 'SS': label = 'Độ mặn'; break;
                        case 'EC': label = 'Độ dẫn điện'; break;
                        case 'TN': label = 'Dung tích'; break;
                        case 'QV': label = 'Lưu lượng đến'; break;
                        case 'QR': label = 'Lưu lượng xả'; break;
                        case 'QN': label = 'Lưu lượng nước'; break;
                        case 'VN': label = 'Tốc độ dòng chảy'; break;
                    }

                    dynamicRows += `
                        <tr style="height:22px">
                            <td><b>${label}: <span id="popup-${code}-${field}">0</span></b></td>
                        </tr>
                    `;
                });
                const itemStr = JSON.stringify(item).replace(/"/g, '&quot;');
                return `
                    <table style="width:400px;">
                        <tbody>
                            <tr style="height:25px">
                                <td>
                                    <h4 style="clear:both;border-bottom:solid 1px #ccc;max-width:300px;word-break:break-word;">
                                        ${name}-${code}
                                    </h4>
                                </td>
                            </tr>
                            ${dynamicRows}
                            <tr style="height:22px;border-top:solid 1px #ccc">
                                <td>Năng lượng: <span id="popup-${code}-Energy">0v</span></td>
                            </tr>
                            <tr style="height:22px;max-width:300px;word-break:break-word;">
                                <td>Hoạt động cuối lúc: <span id="popup-${code}-LastTime">@LASTTIME</span></td>
                            </tr>
                            <tr style="height:22px">
                                <td><div><button id="tooltip" class="btn btn-warning" style="margin-top: 20px; background-color: #f39c12;border: solid 1px #f39c12; width: 75%; height: 35px; color: #fff; padding: 3px 10px;" onclick="handleItemClick(${itemStr});">Xem chi tiết</button></div></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }

            function generatePopupValueHTML(loc) {
                let extraContent = '';
                let lastTimeRain = '';
                if(loc.lastTimeRD){
                    lastTimeRain = "("+loc.lastTimeRD.split(" ")[1]+")";
                }
                
                switch (loc.type) {
                    case "NAAM":
                        extraContent = `
                            <tr><td>Lượng mưa (00h): ${loc.RD ?? 0} mm ${lastTimeRain}</td></tr>
                            <tr><td><b>Nhiệt độ: ${WarningTemperature(loc.RT) ?? 0} °C</b></td></tr>
                            <tr><td><b>Độ ẩm: ${WarningHumidity(loc.RH) ?? 0} %</b></td></tr>
                            <tr><td><b>Áp suất khí quyển: ${loc.RP ?? 0} hPa</b></td></tr>
                        `;
                        break;
                    case "N":
                        extraContent = `
                            <tr><td>Mực nước: ${loc.RN ?? 0} cm</td></tr>
                        `;
                        break;
                    case "MSL":
                    case "M":
                    case "MS":
                        extraContent = `
                            <tr><td>Lượng mưa (00h): ${loc.RD ?? 0} mm ${lastTimeRain}</td></tr>
                        `;
                        break;
                    case "NNS":
                        extraContent = `
                            <tr><td>Mực nước: ${loc.RN ?? 0} cm</td></tr>
                            <tr><td><b>Nhiệt độ: ${WarningTemperature(loc.RT)} °C</b></td></tr>
                            <tr><td><b>Độ mặn: ${loc.SS ?? 0} ppt</b></td></tr>
                            <tr><td><b>Độ dẫn điện: ${loc.EC ?? 0} μs/cm</b></td></tr>
                        `;
                        break;
                    case "TD":
                        extraContent = `
                            <tr><td>Mực nước: ${(loc.RN/1000).toFixed(2) ?? 0} m</td></tr>
                            <tr><td><b>Dung tích: ${loc.TN ?? 0} tr.m³</b></td></tr>
                            <tr><td><b>Lưu lượng đến: ${loc.QV ?? 0} m³/s</b></td></tr>
                            <tr><td><b>Lưu lượng xả: ${loc.QR ?? 0} m³/s</b></td></tr>
                        `;
                        break;
                    case "NMLLTD":
                        extraContent = `
                            <tr><td>Mực nước: ${loc.RN ?? 0} m</td></tr>
                            <tr><td><b>Lượng mưa: ${loc.RD ?? 0} mm ${lastTimeRain}</b></td></tr>
                            <tr><td><b>Lưu lượng nước: ${loc.QN ?? 0} m³/s</b></td></tr>
                            <tr><td><b>Tốc độ dòng chảy: ${loc.VN ?? 0} m/s</b></td></tr>
                        `;
                        break;
                    default:
                        extraContent = `<tr><td>Không có dữ liệu</td></tr>`;
                }
                const itemStr = JSON.stringify(loc.item).replace(/"/g, '&quot;');
                return `
                    <table style="width:400px;">
                        <tbody>
                            <tr style="height:25px">
                                <td>
                                    <h4 style="clear:both;border-bottom:solid 1px #ccc;max-width:300px;word-break:break-word;color:#0078A8">
                                        ${loc.name}
                                    </h4>
                                </td>
                            </tr>
                            ${extraContent}
                            <tr style="height:22px;border-top:solid 1px #ccc">
                                <td>Năng lượng: <span id="popup-${loc.code}-Energy">${WarningEnergy(loc.RA)} v</span></td>
                            </tr>
                            <tr style="height:22px;max-width:300px;word-break:break-word;">
                                <td>Hoạt động cuối lúc: <span id="popup-${loc.code}-LastTime">${formatDateTime(loc.lastTime)}</span></td>
                            </tr>
                            <tr style="height:22px">
                                <td><div><button id="tooltip" class="btn btn-warning" style="margin-top: 20px; background-color: #f39c12;border: solid 1px #f39c12; width: 75%; height: 35px; color: #fff; padding: 3px 10px;" onclick="handleItemClick(${itemStr});">Xem chi tiết</button></div></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }

            async function addDataLocation(item, tooltip, itemW) {
                const itemLocation = {
                    name: item.WORKSTATION_NAME+'-'+item.WORKSTATION_ID,
                    coords: [item.LONGITUDE, item.LATITUDE],
                    type: item.TEMPLATE_TOOLTIP,
                    code: item.WORKSTATION_ID,
                    item: itemW,
                    popup: generatePopupHTML(item.WORKSTATION_NAME, item.WORKSTATION_ID, item.TEMPLATE_TOOLTIP, itemW)
                }
                locations.push(itemLocation);
            }

            function updatePopupData(code, newZoneData) {
                const marker = markerMap.get(code);
                if (!marker) return;

                const oldData = marker.options.customData || {};
                const mergedData = { ...oldData };
                
                const newTimeFormatted = newZoneData.lastTime;
                const isNewTime = newTimeFormatted !== oldData.lastTime;

                if (isNewTime) {
                    const markerElement = document.querySelector(`.marker-${code}`);
                    if (markerElement) {
                        markerElement.classList.add('bounce-animation');
                        setTimeout(() => {
                            markerElement.classList.remove('bounce-animation');
                        }, 5000);
                    }
                }
                
                // 🎯 Chỉ update những field phù hợp với type
                switch (oldData.type) {
                    case "NAAM":
                        mergedData.RD = parseValue(newZoneData.RD); // Lượng mưa (nếu có)
                        if(newZoneData.RD){
                            mergedData.lastTimeRD = formatDateTime(newZoneData.lastTimeRD);
                            $(".marker-label-"+code).html(WarningRain(parseValue(newZoneData.RD)))
                            $(".marker-"+code+" .marker-pin circle").attr("fill", "red");
                            $(".marker-"+code+" .mePin-wrapper .mePin-child b").css("color", "red");
                        }
                        mergedData.RT = parseValue(newZoneData.RT); // Nhiệt độ
                        mergedData.RH = parseValue(newZoneData.RH); // Độ ẩm
                        mergedData.RP = parseValue(newZoneData.RP); // Áp suất
                        break;
                    case "N":
                        $(".marker-label-"+code).text(newZoneData.RN)
                        mergedData.RN = parseValue(newZoneData.RN); // Lượng mưa
                        break;
                    case "MSL":
                    case "M":
                    case "MS":
                        if(newZoneData.RD){
                            mergedData.lastTimeRD = formatDateTime(newZoneData.lastTimeRD);
                            $(".marker-label-"+code).html(WarningRain(parseValue(newZoneData.RD)))
                            $(".marker-"+code+" .marker-pin circle").attr("fill", "red");
                            $(".marker-"+code+" .mePin-wrapper .mePin-child b").css("color", "red");
                        }
                        mergedData.RD = parseValue(newZoneData.RD); // Lượng mưa
                        break;
                    case "NNS":
                        mergedData.RT = parseValue(newZoneData.RT);
                        mergedData.RN = parseValue(newZoneData.RN);
                        mergedData.SS = parseValue(newZoneData.SS);
                        mergedData.EC = parseValue(newZoneData.EC);
                        break;
                    case "TD":
                        if(newZoneData.QV){
                            $(".marker-label-"+code).html(WarningQN(parseValue(newZoneData.QV), "m³/s"));
                            $(".marker-"+code+" .marker-pin rect").attr("fill", "#6c3483");
                            $(".marker-"+code+" .marker-pin rect").attr("stroke", "#6c3483");
                        }
                        mergedData.RN = parseValue(newZoneData.RN);
                        mergedData.TN = parseValue(newZoneData.TN);
                        mergedData.QV = parseValue(newZoneData.QV);
                        mergedData.QR = parseValue(newZoneData.QR);
                        break;
                    case "NMLLTD":
                        if(newZoneData.RN){
                            mergedData.lastTimeRD = formatDateTime(newZoneData.lastTimeRD);
                        }
                        if(newZoneData.QN){
                            $(".marker-label-"+code).html(WarningQN(parseValue(newZoneData.QN)/100, "m³/s"))
                            $(".marker-"+code+" .marker-pin polygon").attr("fill", "red");
                            $(".marker-"+code+" .marker-pin polygon").attr("stroke", "red");
                            $(".marker-"+code+" .mePin-wrapper .mePin-child b").css("color", "red");
                        }
                        mergedData.RN = parseValue(newZoneData.RN)/100;
                        mergedData.RD = parseValue(newZoneData.RD);
                        mergedData.QN = parseValue(newZoneData.QN)/100;
                        mergedData.VN = parseValue(newZoneData.VN)/100;
                        break;
                    default:
                        console.warn(`Không biết cách update cho type: ${oldData.type}`);
                }
                mergedData.RA = parseValue(newZoneData.RA);
                mergedData.lastTime = newZoneData.lastTime; // Cập nhật thời gian hiện tại

                const updatedHTML = generatePopupValueHTML(mergedData);
                marker.setPopupContent(updatedHTML);

                // Update lại dữ liệu trong marker
                marker.options.customData = mergedData;
            }

            // Hàm phụ: bỏ đơn vị (°C, %, hPa, mm...) để lấy số
            function parseValue(str) {
                if (typeof str !== "string") return str;
                return parseFloat(str.replace(/[^\d.-]/g, ''));
            }

            function processAndUpdate(data) {
                const items = data.D;
                const grouped = {};
                let dateTimeRA;
                let dateTimeRD;
                // Gom nhóm theo code
                items.forEach(item => {
                    const code = item.ZONE_ADDRESS;
                    if(item.ZONE_PROPERTY == 'RA'){
                        dateTimeRA = item.DATE_CREATE;
                    }
                    if(item.ZONE_PROPERTY == 'RD'){
                        dateTimeRD = item.DATE_CREATE;
                    }
                    if (!grouped[code]) grouped[code] = {};

                    // Gán dữ liệu theo field
                    grouped[code][item.ZONE_PROPERTY] = item.ZONE_VALUE;
                });

                // Update dữ liệu
                for (const code in grouped) {
                    const item = grouped[code];

                    const formattedData = {};

                    // Format từng giá trị theo kiểu đẹp
                    if (item.RA != null) formattedData.RA = (item.RA / 10) + "v";  // ắc quy
                    if (item.RD != null) formattedData.RD = (item.RD / 10) + "mm";  // Lượng mưa
                    if (item.RD != null) formattedData.lastTimeRD = dateTimeRD;  // Thời gian mưa
                    if (item.RT != null) formattedData.RT = (item.RT / 10) + "°C";  // Nhiệt độ
                    if (item.RH != null) formattedData.RH = (item.RH / 10) + "%";   // Độ ẩm
                    if (item.RP != null) formattedData.RP = (item.RP / 10) + "hPa"; // Áp suất
                    if (item.RN != null) formattedData.RN = (item.RN) + "cm"; // Mực nước
                    if (item.SS != null) formattedData.SS = (item.SS / 10000).toFixed(2) + "ppt"; // Độ mặn
                    if (item.EC != null) formattedData.EC = (item.EC / 1000).toFixed(2) + "μs/cm"; // Độ dẫn điện
                    if (item.TN != null) formattedData.TN = (item.TN).toFixed(2) + "tr.m³"; // dung tích hồ chứa
                    if (item.QV != null) formattedData.QV = (item.QV).toFixed(2) + "m³/s"; // Lưu lượng đến
                    if (item.QR != null) formattedData.QR = (item.QR).toFixed(2) + "m³/s"; // Lưu lượng xả
                    if (item.QN != null) formattedData.QN = (item.QN).toFixed(2) + "m³/s"; // Lưu lượng nước
                    if (item.VN != null) formattedData.VN = (item.VN).toFixed(2) + "m/s"; // tốc độ dòng chảy

                    formattedData.lastTime = dateTimeRA;
                    
                    updatePopupData(code, formattedData);
                }
            }
            
            // Gọi hàm
        
            const WarningRain = function (value) {
                var energy = "<b><font>" + value + "</font></b>";
                if (value >= 0 && value < 5) energy = "<b><font color='#1a6985'>" + value + "mm</font></b>";
                if (value >= 5 && value < 10) energy = "<b><font color='#0f3c4c'>" + value + "mm</font></b>";
                if (value >= 10 && value < 20) energy = "<b><font color='#0084FF'>" + value + "mm</font></b>";
                if (value >= 20 && value < 50) energy = "<b><font color='#6766ff'>" + value + "mm</font></b>";
                if (value >= 50 && value < 100) energy = "<b><font color='#cc6600'>" + value + "mm</font></b>";
                if (value >= 100 && value < 150) energy = "<b><font color='#006600'>" + value + "mm</font></b>";
                if (value >= 150 && value < 200) energy = "<b><font color='#00FFFF'>" + value + "mm</font></b>";
                if (value >= 200 && value < 300) energy = "<b><font color='#99004d'>" + value + "mm</font></b>";
                if (value >= 300 && value < 400) energy = "<b><font color='#7b7b7b'>" + value + "mm</font></b>";
                if (value >= 400) energy = "<b><font color='#A00BA0'>" + value + "mm</font></b>";
                console.log(energy);
                
                return energy;
            }
            const WarningTemperature = function (value) {
                var energy = '0';
                if (value > 27.0 && value <= 30.0) energy = "<b><font color='green'>" + value + "</font></b>";
                if (value > 30.0 && value <= 36.0) energy = "<b><font color='orange'>" + value + "</font></b>";
                if (value >= 11.0 && value <= 27) energy = "<b><font color='blue'>" + value + "</font></b>";
                if (value > 36) energy = "<b><font color='red'>" + value + "</font></b>";
                if (value < 11.0) energy = "<b><font color='yellow'>" + value + "</font></b>";
                return energy;
            }
            function WarningWaterLevel(value, unit) {
                var energy = "<b><font>" + value + "</font></b>";
                if (value >= 0 && value < 5) energy = "<b><font color='#1a6985'>" + value + ""+unit+"</font></b>";
                if (value >= 5 && value < 10) energy = "<b><font color='#0f3c4c'>" + value + ""+unit+"</font></b>";
                if (value >= 10 && value < 20) energy = "<b><font color='#0084FF'>" + value + ""+unit+"</font></b>";
                if (value >= 20 && value < 50) energy = "<b><font color='#6766ff'>" + value + ""+unit+"</font></b>";
                if (value >= 50 && value < 100) energy = "<b><font color='#cc6600'>" + value + ""+unit+"</font></b>";
                if (value >= 100 && value < 150) energy = "<b><font color='#006600'>" + value + ""+unit+"</font></b>";
                if (value >= 150 && value < 200) energy = "<b><font color='#00FFFF'>" + value + ""+unit+"</font></b>";
                if (value >= 200 && value < 300) energy = "<b><font color='#1a6985'>" + value + ""+unit+"</font></b>";
                if (value >= 300 && value < 400) energy = "<b><font color='#0f3c4c'>" + value + ""+unit+"</font></b>";
                if (value >= 400) energy = "<b><font color='#A00BA0'>" + value + ""+unit+"</font></b>";
                
                return energy;
            }
            function WarningQN(value, unit) {
                var energy = "<b><font>" + value + "</font></b>";
                if (value >= 0 && value < 100) energy = "<b><font color='#1a6985'>" + value + ""+unit+"</font></b>";
                if (value >= 100 && value < 300) energy = "<b><font color='#0f3c4c'>" + value + ""+unit+"</font></b>";
                if (value >= 300 && value < 600) energy = "<b><font color='#0084FF'>" + value + ""+unit+"</font></b>";
                if (value >= 600 && value < 1000) energy = "<b><font color='#6766ff'>" + value + ""+unit+"</font></b>";
                if (value >= 1000 && value < 1500) energy = "<b><font color='#cc6600'>" + value + ""+unit+"</font></b>";
                if (value >= 1500 && value < 2000) energy = "<b><font color='#006600'>" + value + ""+unit+"</font></b>";
                if (value >= 2000 && value < 2500) energy = "<b><font color='#00FFFF'>" + value + ""+unit+"</font></b>";
                if (value >= 2500 && value < 3000) energy = "<b><font color='#1a6985'>" + value + ""+unit+"</font></b>";
                if (value >= 3000 && value < 3500) energy = "<b><font color='#0f3c4c'>" + value + ""+unit+"</font></b>";
                if (value >= 3500) energy = "<b><font color='#A00BA0'>" + value + ""+unit+"</font></b>";
                
                return energy;
            }
            const WarningHumidity = function (value) {
                var energy = '';
                if (value >= 55.0 && value <= 65.0) energy = "<b><font color='green'>" + value + "</font></b>";
                if (value > 65.0 && value <= 80.0) energy = "<b><font color='orange'>" + value + "</font></b>";
                if (value > 80.0) energy = "<b><font color='red'>" + value + "</font></b>";
                if (value < 55.0) energy = "<b><font color='yellow'>" + value + "</font></b>";
                return energy;
            }
            const WarningEnergy = function (value) {
                var energy = "<b><font>" + value + "</font></b>";
                if (value >= 11.5 && value <= 15.0) energy = "<b><font color='green'>" + value + "</font></b>";
                if (value >= 11.0 && value < 11.5) energy = "<b><font color='orange'>" + value + "</font></b>";
                if (value < 11.0) energy = "<b><font color='red'>" + value + "</font></b>";
                return energy;
            }
            // ------------------------------------------------------
            // cảnh báo
            $("#submitAlert").click(async function (){

                const deviceId = document.getElementById('device_ID_alert').value.trim();
                const timeAlert = document.getElementById('timeAlert').value.trim();
                const warningMin = document.getElementById('warningMin').value.trim();
                const warningMax = document.getElementById('warningMax').value.trim();

                // Kiểm tra dữ liệu đầu vào
                if (!deviceId) {
                    alert('Vui lòng chọn yếu tố cần thông báo.');
                    return;
                }

                if (!timeAlert) {
                    alert('Vui lòng chọn tần suất cảnh báo.');
                    return;
                }

                if (!warningMin || isNaN(warningMin)) {
                    alert('Vui lòng nhập ngưỡng thấp hợp lệ.');
                    return;
                }

                if (!warningMax || isNaN(warningMax)) {
                    alert('Vui lòng nhập ngưỡng cao hợp lệ.');
                    return;
                }

                if (parseFloat(warningMin) >= parseFloat(warningMax)) {
                    alert('Ngưỡng thấp phải nhỏ hơn ngưỡng cao.');
                    return;
                }

                // ✅ Nếu tất cả đều hợp lệ, tiến hành xử lý tiếp
                const alertData = {
                    deviceId,
                    timeAlert,
                    warningMin: parseFloat(warningMin),
                    warningMax: parseFloat(warningMax)
                };

                console.log('Dữ liệu hợp lệ:', alertData);
                const willInsertData = {
                    USER_ID: "6722547918621605824",
                    WORKSTATION_ID: localStorage.getItem("MATRAM"),
                    DEVICE_ID: deviceId + localStorage.getItem("MATRAM"),
                    WARNING_THRESHOLD_MIN: parseFloat(warningMin),
                    WARNING_THRESHOLD_MAX: parseFloat(warningMax),
                    TIME_ALERT: timeAlert,
                    ACTIVE: 1,
                    DATE_CREATE: new Date(),
                    DATASTATE: "ADD"
                };
                await add('ZALO_SETTING_ALERT', willInsertData, localStorage.getItem("URL"), "NotCentral")
            })


            // code gauge nhiệt độ
            var xmlns = "http://www.w3.org/2000/svg",
                xlinkns = "http://www.w3.org/1999/xlink",
                select = function (s) {
                    return document.querySelector(s);
                },
                selectAll = function (s) {
                    return document.querySelectorAll(s);
                },
                liquid = selectAll('.liquid'),
                tubeShine = select('.tubeShine'),
                label = select('.label'),
                follower = select('.follower'),
                dragger = select('.dragger'),
                dragTip = select('.dragTip'),
                minDragY = -380,
                liquidId = 0,
                step = Math.abs(minDragY / 50),
                snap = Math.abs(minDragY / 10),
                followerVY = 0;

            gsap.set('svg', { visibility: 'visible' });
            gsap.set(dragTip, { transformOrigin: '20% 50%' });

            var tl = gsap.timeline();
            tl.to(liquid, { x: '-=200', ease: 'none', repeat: -1, stagger: 0.9 });

            tl.time(100);

            document.addEventListener('touchmove', function (event) {
                event.preventDefault();
            });

            Draggable.create(dragger, {
                type: 'y',
                bounds: { minY: minDragY, maxY: 0 },
                onDrag: onUpdate,
                throwProps: true,
                throwResistance: 2300,
                onThrowUpdate: onUpdate,
                overshootTolerance: 0,
                snap: function (value) {
                    // Optional: snap to steps of 10
                    // return Math.round(value / snap) * snap;
                }
            });

            function onUpdate() {
                // Get the current y position of the dragger using gsap.getProperty
                var draggerY = gsap.getProperty(dragger, 'y');
                liquidId = Math.abs(Math.round(draggerY / step));
                label.textContent = liquidId + '°C';;

                gsap.to(liquid, {
                    y: draggerY * 1.12,
                    ease: 'elastic.out(1, 0.4)',
                    duration: 1.3
                });
            }

            gsap.to(follower, {
                y: '+=0',
                repeat: -1,
                duration: 1,
                modifiers: {
                    y: function (y) {
                        var draggerY = gsap.getProperty(dragger, 'y');
                        followerVY += (draggerY - gsap.getProperty(follower, 'y')) * 0.23;
                        followerVY *= 0.69;
                        return gsap.getProperty(follower, 'y') + followerVY;
                    }
                }
            });

            gsap.to(dragTip, {
                rotation: '+=0',
                repeat: -1,
                duration: 1,
                modifiers: {
                    rotation: function (rotation) {
                        return rotation - followerVY;
                    }
                }
            });

            gsap.to(label, {
                y: '+=0',
                repeat: -1,
                duration: 1,
                modifiers: {
                    y: function (y) {
                        return y - followerVY * 0.5;
                    }
                }
            });

            gsap.to(dragger, {
                y: minDragY / 2,
                onUpdate: onUpdate,
                ease: 'expo.inOut',
                duration: 1.4
            });
            function setRangeValue(value, type) {
                // Chuyển đổi giá trị value từ 0-100 thành vị trí y tương ứng
                var newY
                if (type == 'success') {
                    newY = value * (minDragY / 50);
                } else {
                    newY = 1 * (minDragY / 50);
                }

                // Cập nhật vị trí của dragger và các phần liên quan
                gsap.to(dragger, {
                    y: newY,
                    onUpdate: onUpdate, // Gọi lại onUpdate để cập nhật các phần khác
                    ease: "expo.inOut",
                    duration: 1.0 // Tốc độ di chuyển
                });
            }
        });
    </script>
</body>

</html>